<?xml version="1.0" encoding="utf-8"?>
<Simulations xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" Version="7">
  <Name>Simulations</Name>
  <DataStore>
    <Name>DataStore</Name>
    <IncludeInDocumentation>true</IncludeInDocumentation>
    <AutoExport>false</AutoExport>
    <MaximumResultsPerPage>0</MaximumResultsPerPage>
  </DataStore>
  <Folder>
    <Name>The SoilArbitrator</Name>
    <Memo>
      <Name>Description</Name>
      <IncludeInDocumentation>true</IncludeInDocumentation>
      <MemoText><![CDATA[The SoilArbitrator is an innovative approach to solving the problem of multiple crops in multiple soil zones competing for water and nutrient resources.  A single instance of the component is needed in each simulation (usually at the top of simulation tree but location is unimportant) and deals with all forms of uptake, all crops and all zones in the simulation.

The approach ...

Overview the tests ...]]></MemoText>
    </Memo>
    <IncludeInDocumentation>true</IncludeInDocumentation>
    <ShowPageOfGraphs>true</ShowPageOfGraphs>
  </Folder>
  <Folder>
    <Name>Tests of Multiple Crops in a Single Zone</Name>
    <Memo>
      <Name>Overview</Name>
      <IncludeInDocumentation>true</IncludeInDocumentation>
      <MemoText><![CDATA[The series of test and simulations in this section test the performance of SoilArbitrator when there are multiple plants competing for resources in a single zone.  These tests take place with either a deep or a shallow soil and in the Lincoln (NZ) environment.  The plants vary between one or more Slurps, one or more ryegrasses and then finally a ryegrass – white clover sward.

The first test compares simulations with one Slurp against equivalent simulations with two Slurps (each with half the leaf area etc. as the single Slurp).  The point is to demonstrate that the SoilArbitrator can effectively aggregate the multiple Slurps to match the single.

“AgPasture Deep Soil Test” simulations have either two deep-rooted ryegrasses or one deep and one shallow rooted.  The simulated plant growth and sward composition are compared when under conditions with and without irrigation and fertiliser.  The exercise is repeated in “AgPasture Shallow Soil Test” but using a soil with substantially reduced soil water storage.

“AgPasture Test Root Depth Differential” repeats “AgPasture Deep Soil Test” but only under conditions of no irrigation or fertiliser but with a range of rooting depths of the second ryegrass.

 The final test “A Ryegrass and White Clover Example” is more realistic in that it contains a white clover competing with a ryegrass and examines the changing sward composition as water and/or fertiliser are added to the simulation.
]]></MemoText>
    </Memo>
    <Folder>
      <Name>Basic Conceptual Test</Name>
      <Memo>
        <Name>Memo BasicConceptualTest</Name>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <MemoText><![CDATA[This 'experiment' does a basic test of the SoilArbitrator comparing a single Slurp to two equal Slurps, both with and without irrigation and fertiliser.  Slurp is a static plant model in which LAI, water and nitrogen demand are user-set constants but in which the uptake of water and N are determined by availability and competition.  

Success in this test is that there should be minimal differences in leaf weight, soil water and soil nitrogen uptake when comparing one Slurp (OneSlurp) to two equal Slurps (TwoSlurp).  The simulations are done under conditions of unlimited irrigation and fertiliser (Plus) and with no irrigation or fertiliser (Minus).  In the graphs below, the relevant outputs from the individual Slurps in TwoSlurp are added together in the Output component.

OneSlurp models are set up with photosynthesis at 6.0 g C /m2, LAI at 3.5 and N uptake at 2.5 kg N /ha /day.  TwoSlurp simulations are set up with two equal Slurps using values of 3.0 g C /m2, LAI at 1.75 and N uptake at 1.25 kg N /ha /day.  All simulations are run using the Lincoln weather data.

The first four graphs below show soil water storage, soil nitrate N storage, cumulative water uptake and cumulative N uptake for the four contrasting simulations.  As expected, there are minimal differences caused by the number of Slurp models in the simulation but there are substantial differences caused by the presence or absence of irrigation and fertiliser.  

There are small differences in the soil water storage for the water-limited simulations (first graph, SoilWater) under conditions of severe water shortage.  These are likely to be due to the approximations in the Runge-Kutta method.  While it might be improved with a higher-order solution, the third plot (WaterUptake) shows that there are no persistent differences in water uptake and that the Runge-Kutta solution is likely to be sufficient for the types of simulation for which APSIM is used.

The second and fourth graphs minimal differences in N storage and N uptake.

The final two plots show the water and N uptake from the TwoSlurp simulations only giving the uptake from the individual crops.  As expected, there are no discernible differences between the crops.

The simulations in this section are very simple conceptual tests using the static Slurp model.  They show that the Runge-Kutta method in SoilArbitrator is behaving sensibly in the presence of two equal crops when they are compared to a single equivalent crop.  These were intentionally simple tests.  Slurp is a static model and will not reduce its water or N demand in response to stress (i.e. no feedback to crop performance).  The next series of tests will use a dynamic model that will include that feedback.]]></MemoText>
      </Memo>
      <Graph>
        <Name>SoilWater</Name>
        <Series>
          <Name>Series</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>BasicConceptualTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>sum(LismoreSoil.SoilWater.SWmm)</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>SoilNO3</Name>
        <Series>
          <Name>Series</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>BasicConceptualTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>sum(LismoreSoil.SoilNitrogen.NO3)</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>WaterUptake</Name>
        <Series>
          <Name>Series</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>BasicConceptualTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>WaterTakenUp</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>NUptake</Name>
        <Series>
          <Name>Series</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>BasicConceptualTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>NTakenUp</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>Individual_Water_Uptake</Name>
        <Series>
          <Name>Slurp1</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-11094807</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>BasicConceptualTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Slurp1.Root.WaterUptake</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>NumSlurps = 2</Filter>
        </Series>
        <Series>
          <Name>Slurp2</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>Plus</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>BasicConceptualTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Slurp2.Root.WaterUptake</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>NumSlurps = 2</Filter>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>Individual_N_Uptake</Name>
        <Series>
          <Name>Slurp1</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-11094807</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>BasicConceptualTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Slurp1.Root.NTakenUp</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>NumSlurps = 2</Filter>
        </Series>
        <Series>
          <Name>Slurp2</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>Plus</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>BasicConceptualTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Slurp2.Root.NTakenUp</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>NumSlurps = 2</Filter>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Experiment>
        <Name>Experiment</Name>
        <Factors>
          <Name>Factors</Name>
          <Factor>
            <Name>Factor</Name>
            <Factor>
              <Name>OneSlurp_Plus</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Specifications>
                <string>[SlurpSowMulitple].Script.NumSlurps = 1</string>
                <string>[SetProduction].Script.OverRidePhoto = 6.0</string>
                <string>[SetProduction].Script.OverRideLAI = 3.5</string>
                <string>[SetProduction].Script.OverRideNUp = 2.5</string>
                <string>[OnOffFertiliser].Script.FertOn = 1</string>
                <string>[OnOffIrrigation].Script.IrrigOn = 1</string>
              </Specifications>
            </Factor>
            <Factor>
              <Name>TwoSlurp_Plus</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Specifications>
                <string>[SlurpSowMulitple].Script.NumSlurps = 2</string>
                <string>[SetProduction].Script.OverRidePhoto = 3.0</string>
                <string>[SetProduction].Script.OverRideLAI = 1.75</string>
                <string>[SetProduction].Script.OverRideNUp = 1.25</string>
                <string>[OnOffFertiliser].Script.FertOn = 1</string>
                <string>[OnOffIrrigation].Script.IrrigOn = 1</string>
              </Specifications>
            </Factor>
            <Factor>
              <Name>OneSlurp_Minus</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Specifications>
                <string>[SlurpSowMulitple].Script.NumSlurps = 1</string>
                <string>[SetProduction].Script.OverRidePhoto = 6.0</string>
                <string>[SetProduction].Script.OverRideLAI = 3.5</string>
                <string>[SetProduction].Script.OverRideNUp = 2.5</string>
                <string>[OnOffFertiliser].Script.FertOn = 0</string>
                <string>[OnOffIrrigation].Script.IrrigOn = 0</string>
              </Specifications>
            </Factor>
            <Factor>
              <Name>TwoSlurp_Minus</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Specifications>
                <string>[SlurpSowMulitple].Script.NumSlurps = 2</string>
                <string>[SetProduction].Script.OverRidePhoto = 3.0</string>
                <string>[SetProduction].Script.OverRideLAI = 1.75</string>
                <string>[SetProduction].Script.OverRideNUp = 1.25</string>
                <string>[OnOffFertiliser].Script.FertOn = 0</string>
                <string>[OnOffIrrigation].Script.IrrigOn = 0</string>
              </Specifications>
            </Factor>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <Specifications />
          </Factor>
          <IncludeInDocumentation>true</IncludeInDocumentation>
        </Factors>
        <Simulation>
          <Name>BasicConceptualTest</Name>
          <Clock>
            <Name>Clock</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <StartDate>1980-07-01T00:00:00</StartDate>
            <EndDate>1981-06-30T00:00:00</EndDate>
          </Clock>
          <Weather>
            <Name>Weather</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <FileName>%root%\Examples\WeatherFiles\lincoln.met</FileName>
            <ExcelWorkSheetName />
          </Weather>
          <Summary>
            <Name>Summary</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </Summary>
          <SoilArbitrator>
            <Name>SoilArbitrator</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </SoilArbitrator>
          <Zone>
            <Name>Field</Name>
            <Folder>
              <Name>Managers</Name>
              <Manager>
                <Name>OnOffFertiliser</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <AllowFertiliser>yes</AllowFertiliser>
                  <FertOn>1</FertOn>
                  <Depth2SoilN>500</Depth2SoilN>
                  <CriticalSoilN>200</CriticalSoilN>
                  <FertNAmount>100</FertNAmount>
                  <FertType>UreaN</FertType>
                  <FertApplicationDepth>1</FertApplicationDepth>
                  <FertMinimumDays>1</FertMinimumDays>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using APSIM.Shared.Utilities;
using System.Xml.Serialization;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		[Link] Soil Soil;

		//User inputs from properties tab
		[Description("Turn fertiliser applications on? ")]
		public yesnoType AllowFertiliser { get; set; }
		
		[Description("Temporary variable to turn fertiliser on (1) or off (0): ")] public int FertOn { get; set; }

		[Description("Depth to calculate available soil N (mm): ")]
		public double Depth2SoilN { get; set; }

		[Description("Minimum available N, triggers an application (kgN/ha): ")]
		public double CriticalSoilN { get; set; }

		[Description("Amount of N fertiliser for each application (kgN/ha): ")]
		public double FertNAmount { get; set; }

		[Description("Type of N fertiliser to apply: ")]
		public Fertiliser.Types FertType { get; set; }

		[Description("Depth at which to apply the fertiliser (mm): ")]
		public double FertApplicationDepth { get; set; }
	   
		[Description("Minimum period between applications (days): ")]
		public double FertMinimumDays { get; set; }
	   
		public enum yesnoType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		[XmlIgnore] public double TopMineralN { get; set; }
		
		private DateTime lastApplicationDate;
		private bool fertiliserIsAllowed;
		private int nLayers;

		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{
			fertiliserIsAllowed = (AllowFertiliser == yesnoType.yes);
			nLayers = Soil.SoilWater.Thickness.Length;
		}

		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			double daysSinceLastApplication = (Clock.Today - lastApplicationDate).TotalDays;
			
			// get the N stored in the soil
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopMineralN = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (Depth2SoilN - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopMineralN += (Soil.SoilNitrogen.NO3[layer]
				+ Soil.SoilNitrogen.NH4[layer]
				+ Soil.SoilNitrogen.urea[layer])
				* fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= Depth2SoilN)
					layer = nLayers;
			}

			if (fertiliserIsAllowed && (daysSinceLastApplication >= FertMinimumDays) && (TopMineralN <= CriticalSoilN))
			{
				fertiliser.Apply(FertNAmount * FertOn, FertType, FertApplicationDepth);
				lastApplicationDate = Clock.Today;
			}
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>OnOffIrrigation</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <allowIrrigation>yes</allowIrrigation>
                  <IrrigOn>1</IrrigOn>
                  <seasonStart>15-Aug</seasonStart>
                  <seasonEnd>30-May</seasonEnd>
                  <seasonsAllocation>10000</seasonsAllocation>
                  <triggerDeficit>75</triggerDeficit>
                  <targetDeficit>99</targetDeficit>
                  <returndays>1</returndays>
                  <maximumAmount>30</maximumAmount>
                  <depthPAWC>300</depthPAWC>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using System.Xml.Serialization;
using Models.PMF;
using APSIM.Shared.Utilities;

        
namespace Models
{
	[Serializable] 
	[System.Xml.Serialization.XmlInclude(typeof(Model))]
	public class Script : Model
	{
		//Communication to other modules
		[Link] ISummary summary = null;
		[Link] Irrigation Irrigation;
		[Link] Clock Clock;
		[Link] Soil Soil;
		[Link(IsOptional = true)] ICrop existingCrop;
	   
		//User inputs from properties tab
		[Description("Turn irrigation on?")]
		public answerType allowIrrigation { get; set; }
		
		[Description("Temporary variable to turn fertiliser on (1) or off (0): ")] public int IrrigOn { get; set; }


		[Description("Start of irrigation season (dd-MMM)")]
		public string seasonStart { get; set; }
		[Description("End of irrigation season (dd-MMM)")]
		public string seasonEnd { get; set; }
		[Description("Season allocation (mm)")]
		public double seasonsAllocation { get; set; }
		[Description("Deficit to trigger irrigation (% PAWC)")]
		public double triggerDeficit { get; set; }
		[Description("Deficit to stop irrigaton (% PAWC)")]
		public double targetDeficit { get; set; }
		[Description("Minimum days for irrigation to return")]
		public double returndays { get; set; }
		[Description("Maximum irrigation application (mm/day)")]
		public double maximumAmount { get; set; }
		[Description("Depth to calculate PAWC (mm)")]
		public double depthPAWC { get; set; }
	   
		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		//Class members
		[XmlIgnore] public double TopSWdeficit { get; set; }
		[XmlIgnore] public double TopSWC { get; set; }
		[XmlIgnore] public double DaysSinceIrrigation { get; set; }
		[XmlIgnore] public double AmountToApply { get; set; }
		[XmlIgnore] public double SeasonAppliedAmount { get; set; }
		
		private bool IrrigationIsAllowed { get; set; }
		private bool SeasonIsOpen { get; set; }
		private bool CropIsActive { get; set; }
		private bool IrrigatorIsAvailable { get; set; }
		private bool SoilIsDry { get; set; }

		private DateTime StartDate;
		private DateTime EndDate;
		private double TopDUL;
		private double TopLL;
		private int nLayers;
	
		//Calculate static soil variables
		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{   
			//Set the season dates
			StartDate = DateTime.Parse(seasonStart + "-" + Clock.Today.Year.ToString());
			EndDate = DateTime.Parse(seasonEnd + "-" + Clock.Today.Year.ToString());
			
			//Can we irrigate at all?
			IrrigationIsAllowed = false; 
			if (allowIrrigation == answerType.yes)
				IrrigationIsAllowed = true; 

			//Calculate soil water variables
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			nLayers = Soil.SoilWater.Thickness.Length;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopLL += Soil.SoilWater.LL15mm[layer] * fracLayer;
				TopDUL += Soil.SoilWater.DULmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
		}
	   	  
		//Determine daily requirement for irrigation
		[EventSubscribe("StartOfDay")]
		private void OnStartOfDay(object sender, EventArgs e)
		{
			//Can we irrigate today?		  
			SeasonIsOpen = isBetween(Clock.Today, StartDate, EndDate);

			//Is there a crop in the ground that needs irrigation?
			CropIsActive = false;
			if ((existingCrop != null) && (existingCrop.IsAlive))
				CropIsActive = true;
	      
			//Is the irrigator available?
			IrrigatorIsAvailable = false;
			DaysSinceIrrigation += 1;
			if (DaysSinceIrrigation >= returndays)
				IrrigatorIsAvailable = true;
	      
			//Is the soil dry enough to require irrigation?
			SoilIsDry = false;
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopSWC = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			//for (int layer = 0; depthFromSurface < depthPAWC + Soil.SoilWater.Thickness[layer]; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopSWC += Soil.SoilWater.SWmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
			
			TopSWdeficit = TopSWC - TopDUL;
			if (Math.Max(0.0, -TopSWdeficit) >= (TopDUL - TopLL) * (100 - triggerDeficit) / 100)
				SoilIsDry = true;
	            
			//Are all the conditions ratifying irrigation
			if (IrrigationIsAllowed && SeasonIsOpen && CropIsActive && IrrigatorIsAvailable && SoilIsDry)
			{
				//Lets bloody well irrigate then!!!!
				AmountToApply = TopDUL * targetDeficit / 100 - TopSWC;
				AmountToApply = Math.Max(0.0, Math.Min(AmountToApply, seasonsAllocation - SeasonAppliedAmount));
				Irrigation.Apply(AmountToApply * IrrigOn);
				DaysSinceIrrigation = 0;
				SeasonAppliedAmount += AmountToApply;
			}
		}
		
		///Checks whether theDate is between iniDate and endDate (non-year specific)
		private bool isBetween(DateTime theDay, DateTime iniDate, DateTime endDate)
		{
			bool result = false;
			if (iniDate.DayOfYear < endDate.DayOfYear)
			{
				// period is within one year, ex: summer in the northern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) && (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			else
			{
				// period goes over the end of the year, ex: summer in the southern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) || (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			
			return result;
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>SlurpSowMulitple</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <NumSlurps>1</NumSlurps>
                  <CultivarName>StaticCrop</CultivarName>
                  <InitialRootDepth>600</InitialRootDepth>
                  <SowingDate>1980-07-01</SowingDate>
                </Script>
                <Code><![CDATA[
using System;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;
        
namespace Models
{
	[Serializable] 
	[System.Xml.Serialization.XmlInclude(typeof(Model))]
	public class Script : Model
	{
		[ScopedLinkByName] Plant Slurp1;
		[ScopedLinkByName] Plant Slurp2;
		[Link] Clock Clock;

		[Description("How many Slurps should be sown?")] public int NumSlurps { get; set; }
		[Description("Cultivar")] public string CultivarName { get; set; }
		[Description("Initial Root Depth")] public double InitialRootDepth { get; set; }
		[Description("Sowing Date")] public DateTime SowingDate { get; set; }

               
		[EventSubscribe("DoManagement")] private void OnDoManagement(object sender, EventArgs e)
		{
			if (Clock.Today.Date == SowingDate)
			{
				Slurp1.Sow(cultivar: CultivarName, population: 1, depth: InitialRootDepth, rowSpacing: 150);
				if (NumSlurps > 1)
					Slurp2.Sow(cultivar: CultivarName, population: 1, depth: InitialRootDepth, rowSpacing: 150);				
			}
		}
	}
}
				]]></Code>
              </Manager>
              <Manager>
                <Name>SetProduction</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <myNumSlurps>0</myNumSlurps>
                  <OverRidePath>Leaf.Photosynthesis.FixedValue</OverRidePath>
                  <ChangeDate>1980-07-01</ChangeDate>
                  <OverRidePhoto>6</OverRidePhoto>
                  <OverRideLAI>3.5</OverRideLAI>
                  <OverRideNUp>4</OverRideNUp>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using System.Collections.Generic;
using System.Text;
using Models.PMF;
using Models;
using System.Xml.Serialization;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable] 
	public class Script : Model
	{
		[Link] Plant Plant;
		[ScopedLinkByName] Plant Slurp1;
		[ScopedLinkByName] Plant Slurp2;
		[Link] Clock Clock;
		[Link] Zone zone;
		
		public int myNumSlurps { get; set; }
		public string OverRidePath { get; set; }
		
		[Description("Change Date")] public DateTime ChangeDate { get; set; }
		[Description("Value for Leaf.Photosynthesis.FixedValue")] public double OverRidePhoto { get; set; }
		[Description("Value for Leaf.LAIFunction.FixedValue")] public double OverRideLAI { get; set; }
		[Description("Value for Root.MaxDailyNUptake.FixedValue")] public double OverRideNUp { get; set; }
		//[Description("Value for new coefficient Integer")] public int OverRideInteger { get; set; }




		[EventSubscribe("StartOfSimulation")] private void OnStartOfSimulation(object sender, EventArgs e)
		{
			myNumSlurps = (int)zone.Get("[SlurpSowMulitple].Script.NumSlurps");
			OverRidePath = "Leaf.Photosynthesis.FixedValue";
		}
        
		[EventSubscribe("DoManagement")] private void OnDoManagement(object sender, EventArgs e)
		{
			if (Clock.Today.Date == ChangeDate)
			{
				object ResetValue = OverRidePhoto;
				OverRidePath = "Leaf.Photosynthesis.FixedValue";
				zone.Set("Slurp1." + OverRidePath, ResetValue);
				if (myNumSlurps > 1)
					zone.Set("Slurp2." + OverRidePath, ResetValue);

				ResetValue = OverRideLAI;
				OverRidePath = "Leaf.LAIFunction.FixedValue";
				zone.Set("Slurp1." + OverRidePath, ResetValue);
				if (myNumSlurps > 1)
					zone.Set("Slurp2." + OverRidePath, ResetValue);

				ResetValue = OverRidePhoto;
				OverRidePath = "Root.MaxDailyNUptake.FixedValue";
				zone.Set("Slurp1." + OverRidePath, ResetValue);
				if (myNumSlurps > 1)
					zone.Set("Slurp2." + OverRidePath, ResetValue);
			}
		}
	}
}
	   ]]></Code>
              </Manager>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ShowPageOfGraphs>true</ShowPageOfGraphs>
            </Folder>
            <MicroClimate>
              <Name>MicroClimate</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <a_interception>0</a_interception>
              <b_interception>0</b_interception>
              <c_interception>0</c_interception>
              <d_interception>0</d_interception>
              <soil_albedo>0.23</soil_albedo>
              <sun_angle>15</sun_angle>
              <soil_heat_flux_fraction>0.4</soil_heat_flux_fraction>
              <night_interception_fraction>0.5</night_interception_fraction>
              <refheight>2</refheight>
              <albedo>0.29366217672824863</albedo>
              <emissivity>0.96</emissivity>
              <RadIntTotal>0</RadIntTotal>
            </MicroClimate>
            <Irrigation>
              <Name>Irrigation</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Irrigation>
            <Fertiliser>
              <Name>Fertiliser</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Fertiliser>
            <SurfaceOrganicMatter>
              <Name>SurfaceOrganicMatter</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ReportAdditions>no</ReportAdditions>
              <ReportRemovals>no</ReportRemovals>
              <ResidueTypes>
                <Name>ResidueTypes</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LoadFromResource>ResidueTypes</LoadFromResource>
              </ResidueTypes>
              <TillageTypes>
                <Name>TillageTypesList</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <TillageType />
              </TillageTypes>
              <Pools>
                <Pool>
                  <PoolName>Sward</PoolName>
                  <ResidueType>grass</ResidueType>
                  <Mass>1000</Mass>
                  <CNRatio>15</CNRatio>
                  <CPRatio>NaN</CPRatio>
                  <StandingFraction>0</StandingFraction>
                </Pool>
              </Pools>
              <PoolName>Sward</PoolName>
              <type>grass</type>
              <mass>1000</mass>
              <standing_fraction>0</standing_fraction>
              <cpr />
              <cnr>15</cnr>
              <CriticalResidueWeight>2000</CriticalResidueWeight>
              <OptimumDecompTemp>20</OptimumDecompTemp>
              <MaxCumulativeEOS>20</MaxCumulativeEOS>
              <CNRatioDecompCoeff>0.277</CNRatioDecompCoeff>
              <CNRatioDecompThreshold>25</CNRatioDecompThreshold>
              <TotalLeachRain>25</TotalLeachRain>
              <MinRainToLeach>10</MinRainToLeach>
              <CriticalMinimumOrganicC>0.004</CriticalMinimumOrganicC>
              <DefaultCPRatio>0</DefaultCPRatio>
              <DefaultStandingFraction>0</DefaultStandingFraction>
              <StandingExtinctCoeff>0.5</StandingExtinctCoeff>
              <FractionFaecesAdded>0.5</FractionFaecesAdded>
            </SurfaceOrganicMatter>
            <SoluteManager>
              <Name>SoluteManager</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </SoluteManager>
            <Plant>
              <Name>Slurp1</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ResourceName>Slurp</ResourceName>
              <CropType>Slurp</CropType>
              <SowingDate>0001-01-01T00:00:00</SowingDate>
            </Plant>
            <Plant>
              <Name>Slurp2</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ResourceName>Slurp</ResourceName>
              <CropType>Slurp</CropType>
              <SowingDate>0001-01-01T00:00:00</SowingDate>
            </Plant>
            <Soil>
              <Name>LismoreSoil</Name>
              <Analysis>
                <Name>Analysis</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>200</double>
                  <double>150</double>
                  <double>250</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <Rocks>
                  <double>0</double>
                  <double>0</double>
                  <double>10</double>
                  <double>40</double>
                  <double>60</double>
                  <double>70</double>
                  <double>70</double>
                </Rocks>
                <Texture />
                <MunsellColour />
                <PH>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                </PH>
                <CEC>
                  <double>12.5</double>
                  <double>10</double>
                  <double>9</double>
                  <double>5</double>
                  <double>4</double>
                  <double>4</double>
                  <double>4</double>
                </CEC>
                <ParticleSizeSand>
                  <double>15</double>
                  <double>20</double>
                  <double>25</double>
                  <double>35</double>
                  <double>40</double>
                  <double>40</double>
                  <double>40</double>
                </ParticleSizeSand>
                <ParticleSizeSilt>
                  <double>65</double>
                  <double>65</double>
                  <double>63</double>
                  <double>57</double>
                  <double>54</double>
                  <double>55</double>
                  <double>55</double>
                </ParticleSizeSilt>
                <ParticleSizeClay>
                  <double>20</double>
                  <double>15</double>
                  <double>12</double>
                  <double>8</double>
                  <double>6</double>
                  <double>5</double>
                  <double>5</double>
                </ParticleSizeClay>
                <PHUnits>Water</PHUnits>
                <BoronUnits>HotWater</BoronUnits>
              </Analysis>
              <Water>
                <Name>Water</Name>
                <SoilCrop>
                  <Name>SwardSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.15</double>
                    <double>0.14</double>
                    <double>0.06</double>
                    <double>0.02</double>
                    <double>0.01</double>
                    <double>0.01</double>
                    <double>0.01</double>
                  </LL>
                  <KL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.04</double>
                    <double>0.01</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>RyegrassSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.15</double>
                    <double>0.14</double>
                    <double>0.06</double>
                    <double>0.02</double>
                    <double>0.01</double>
                    <double>0.01</double>
                    <double>0.01</double>
                  </LL>
                  <KL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.04</double>
                    <double>0.01</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>WhiteCloverSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.15</double>
                    <double>0.14</double>
                    <double>0.06</double>
                    <double>0.02</double>
                    <double>0.01</double>
                    <double>0.01</double>
                    <double>0.01</double>
                  </LL>
                  <KL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.04</double>
                    <double>0.01</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>Slurp1Soil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.15</double>
                    <double>0.14</double>
                    <double>0.06</double>
                    <double>0.02</double>
                    <double>0.01</double>
                    <double>0.01</double>
                    <double>0.01</double>
                  </LL>
                  <KL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.04</double>
                    <double>0.01</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>Slurp2Soil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.15</double>
                    <double>0.14</double>
                    <double>0.06</double>
                    <double>0.02</double>
                    <double>0.01</double>
                    <double>0.01</double>
                    <double>0.01</double>
                  </LL>
                  <KL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.04</double>
                    <double>0.01</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>200</double>
                  <double>150</double>
                  <double>250</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <BD>
                  <double>1.3</double>
                  <double>1.35</double>
                  <double>1</double>
                  <double>0.53</double>
                  <double>0.31</double>
                  <double>0.3</double>
                  <double>0.3</double>
                </BD>
                <AirDry>
                  <double>0.05</double>
                  <double>0.12</double>
                  <double>0.055</double>
                  <double>0.015</double>
                  <double>0.01</double>
                  <double>0.01</double>
                  <double>0.01</double>
                </AirDry>
                <LL15>
                  <double>0.15</double>
                  <double>0.14</double>
                  <double>0.055</double>
                  <double>0.015</double>
                  <double>0.01</double>
                  <double>0.01</double>
                  <double>0.01</double>
                </LL15>
                <DUL>
                  <double>0.36</double>
                  <double>0.34</double>
                  <double>0.19</double>
                  <double>0.065</double>
                  <double>0.04</double>
                  <double>0.03</double>
                  <double>0.03</double>
                </DUL>
                <SAT>
                  <double>0.45</double>
                  <double>0.43</double>
                  <double>0.25</double>
                  <double>0.15</double>
                  <double>0.11</double>
                  <double>0.11</double>
                  <double>0.11</double>
                </SAT>
                <KS>
                  <double>5000</double>
                  <double>2500</double>
                  <double>3000</double>
                  <double>10000</double>
                  <double>17500</double>
                  <double>20000</double>
                  <double>20000</double>
                </KS>
              </Water>
              <SoilWater>
                <Name>SoilWater</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <SummerDate>1-Nov</SummerDate>
                <SummerU>6</SummerU>
                <SummerCona>3.5</SummerCona>
                <WinterDate>1-apr</WinterDate>
                <WinterU>2</WinterU>
                <WinterCona>2</WinterCona>
                <DiffusConst>88</DiffusConst>
                <DiffusSlope>35</DiffusSlope>
                <Salb>0.13</Salb>
                <CN2Bare>73</CN2Bare>
                <CNRed>20</CNRed>
                <CNCov>0.8</CNCov>
                <slope>0</slope>
                <discharge_width>0</discharge_width>
                <catchment_area>0</catchment_area>
                <max_pond>0</max_pond>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>200</double>
                  <double>150</double>
                  <double>250</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <SWCON>
                  <double>0.5</double>
                  <double>0.52</double>
                  <double>0.55</double>
                  <double>0.6</double>
                  <double>0.65</double>
                  <double>0.65</double>
                  <double>0.65</double>
                </SWCON>
                <KLAT>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </KLAT>
                <residueinterception>0</residueinterception>
              </SoilWater>
              <SoilNitrogen>
                <Name>SoilNitrogen</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <fom_type>
                  <string>default</string>
                  <string>manure</string>
                  <string>mucuna</string>
                  <string>lablab</string>
                  <string>shemp</string>
                  <string>stable</string>
                </fom_type>
                <fract_carb>
                  <double>0.2</double>
                  <double>0.3</double>
                  <double>0.54</double>
                  <double>0.57</double>
                  <double>0.45</double>
                  <double>0</double>
                </fract_carb>
                <fract_cell>
                  <double>0.7</double>
                  <double>0.3</double>
                  <double>0.37</double>
                  <double>0.37</double>
                  <double>0.47</double>
                  <double>0.1</double>
                </fract_cell>
                <fract_lign>
                  <double>0.1</double>
                  <double>0.4</double>
                  <double>0.09</double>
                  <double>0.06</double>
                  <double>0.08</double>
                  <double>0.9</double>
                </fract_lign>
                <wfpsN2N2O_x>
                  <double>22</double>
                  <double>88</double>
                </wfpsN2N2O_x>
                <wfpsN2N2O_y>
                  <double>0.1</double>
                  <double>1</double>
                </wfpsN2N2O_y>
                <oc>
                  <double>3.7136764881329496</double>
                  <double>2.4698281813043792</double>
                  <double>1.2383961716086014</double>
                  <double>0.49836009167083023</double>
                  <double>0.25025052330473485</double>
                  <double>0.15035274660681502</double>
                  <double>0.10019396267774858</double>
                </oc>
              </SoilNitrogen>
              <SoilOrganicMatter>
                <Name>SoilOrganicMatter</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <RootCN>40</RootCN>
                <RootWt>1000</RootWt>
                <SoilCN>12</SoilCN>
                <EnrACoeff>7.4</EnrACoeff>
                <EnrBCoeff>0.2</EnrBCoeff>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>200</double>
                  <double>150</double>
                  <double>250</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <Depth>
                  <string>0-15</string>
                  <string>15-30</string>
                  <string>30-50</string>
                  <string>50-65</string>
                  <string>65-90</string>
                  <string>90-120</string>
                  <string>120-150</string>
                </Depth>
                <OC>
                  <double>3</double>
                  <double>1</double>
                  <double>0.6</double>
                  <double>0.4</double>
                  <double>0.25</double>
                  <double>0.15</double>
                  <double>0.1</double>
                </OC>
                <FBiom>
                  <double>0.04</double>
                  <double>0.02</double>
                  <double>0.02</double>
                  <double>0.01</double>
                  <double>0.01</double>
                  <double>0</double>
                  <double>0</double>
                </FBiom>
                <FInert>
                  <double>0.5</double>
                  <double>0.7</double>
                  <double>0.83</double>
                  <double>0.9</double>
                  <double>0.95</double>
                  <double>0.99</double>
                  <double>0.99</double>
                </FInert>
                <OCUnits>Total</OCUnits>
              </SoilOrganicMatter>
              <InitialWater>
                <Name>Initial water</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <PercentMethod>EvenlyDistributed</PercentMethod>
                <FractionFull>0.95</FractionFull>
                <DepthWetSoil>NaN</DepthWetSoil>
              </InitialWater>
              <Sample>
                <Name>Initial nitrogen</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>200</double>
                  <double>150</double>
                  <double>250</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <NO3>
                  <double>50</double>
                  <double>50</double>
                  <double>50</double>
                  <double>50</double>
                  <double>50</double>
                  <double>50</double>
                  <double>50</double>
                </NO3>
                <NH4>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </NH4>
                <NO3Units>ppm</NO3Units>
                <NH4Units>ppm</NH4Units>
                <SWUnits>Volumetric</SWUnits>
                <OCUnits>Total</OCUnits>
                <PHUnits>Water</PHUnits>
              </Sample>
              <CERESSoilTemperature>
                <Name>CERESSoilTemperature</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
              </CERESSoilTemperature>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <RecordNumber>0</RecordNumber>
              <SoilType>NZ_Sedimentary</SoilType>
              <LocalName>Lismore</LocalName>
              <Site>Winchmore</Site>
              <NearestTown>Ashburton</NearestTown>
              <Region>Canterbury</Region>
              <Country>New Zealand</Country>
              <NaturalVegetation />
              <Latitude>-48.48</Latitude>
              <Longitude>0</Longitude>
            </Soil>
            <Report>
              <Name>BasicConceptualTest</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ExperimentFactorNames />
              <ExperimentFactorValues />
              <VariableNames>
                <string>[Clock].Today as Date</string>
                <string>[SlurpSowMulitple].Script.NumSlurps as NumSlurps</string>
                <string>[Slurp1].Leaf.Wt</string>
                <string>[Slurp2].Leaf.Wt</string>
                <string>[Slurp1].Root.NTakenUp</string>
                <string>[Slurp2].Root.NTakenUp</string>
                <string>[Slurp1].Root.WaterUptake</string>
                <string>[Slurp2].Root.WaterUptake</string>
                <string>([Slurp1].Leaf.Wt+[Slurp2].Leaf.Wt) as LeafWt</string>
                <string>([Slurp1].Leaf.LAI+[Slurp2].Leaf.LAI) as LAI</string>
                <string>([Slurp1].Root.WaterUptake+[Slurp2].Root.WaterUptake) as WaterTakenUp</string>
                <string>([Slurp1].Root.NTakenUp+[Slurp2].Root.NTakenUp) as NTakenUp</string>
                <string>sum([LismoreSoil].SoilNitrogen.NO3)</string>
                <string>sum([LismoreSoil].SoilWater.SWmm)</string>
              </VariableNames>
              <EventNames>
                <string>[Clock].EndOfDay</string>
              </EventNames>
            </Report>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <Area>1</Area>
            <Slope>0</Slope>
          </Zone>
          <IncludeInDocumentation>true</IncludeInDocumentation>
        </Simulation>
        <IncludeInDocumentation>true</IncludeInDocumentation>
      </Experiment>
      <IncludeInDocumentation>true</IncludeInDocumentation>
      <ShowPageOfGraphs>true</ShowPageOfGraphs>
    </Folder>
    <Folder>
      <Name>AgPasture Deep Soil Test</Name>
      <Memo>
        <Name>Memo AgPastureDeepSoilTest</Name>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <MemoText><![CDATA[This next series of tests uses a dynamic (full) crop model so that any discrepancies in water or N supply to the plant will produce feedbacks into demand and subsequent uptake.  In this series of tests each simulation contains two ryegrass models.  In the “Equal” simulations both ryegrasses have a rooting depth of 750 mm while in the “Unequal” simulations Rye1 has a 750 mm root depth but Rye2 has a 150 mm root depth.  In all other respects the crops are equal.  Simulations are run with unlimited irrigation and fertiliser (“IrrigFert”) and without either input supplied (“DryNofert”).  The simulations use a soil with 132 mm of PAW to 750 mm deep in the Lincoln environment. 

The first two graphs show that there is no difference in standing herbage between the ryegrasses if they have the same rooting depth.  Graphs 3 and 4 show the significant advantage that the deeper-rooting Rye1 has over Rye2 in the Unequal simulations.  

The fifth graph “Yield” shows that there is a slight yield advantage, persistent despite inputs of irrigation or fertiliser, when the rooting depths are equal and deep.  This shows that the yield from the deeper-rooting Rye1 cannot completely compensate for the loss of yield from the shallow-rooting Rye2.  The sixth graph shows the proportion of the total yield originating from Rye1.  In the Equal simulations this sits, of course, at 0.5.  However, in the Unequal simulations the proportion of yield from Rye1 rises to 0.65 with earlier increases in this proportion when no irrigation or fertiliser is applied. 
]]></MemoText>
      </Memo>
      <Graph>
        <Name>StandingHerbage EqualIrrigFert</Name>
        <Series>
          <Name>Rye1</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>Cross</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureDeepSoilTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Rye1.AboveGroundWt</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Factor] = 'EqualIrrigFert'</Filter>
        </Series>
        <Series>
          <Name>Rye2</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16777216</ColourArgb>
          <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureDeepSoilTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Rye2.AboveGroundWt</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Factor] = 'EqualIrrigFert'</Filter>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>StandingHerbage EqualDryNofert</Name>
        <Series>
          <Name>Rye1</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>Cross</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureDeepSoilTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Rye1.AboveGroundWt</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Factor] = 'EqualDryNofert'</Filter>
        </Series>
        <Series>
          <Name>Rye2</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16777216</ColourArgb>
          <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureDeepSoilTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Rye2.AboveGroundWt</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Factor] = 'EqualDryNofert'</Filter>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>StandingHerbage UnequalIrrigFert</Name>
        <Series>
          <Name>Rye1</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>Cross</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureDeepSoilTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Rye1.AboveGroundWt</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Factor] = 'UnequalIrrigFert'</Filter>
        </Series>
        <Series>
          <Name>Rye2</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16777216</ColourArgb>
          <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureDeepSoilTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Rye2.AboveGroundWt</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Factor] = 'UnequalIrrigFert'</Filter>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>StandingHerbage UnequalDryNofert</Name>
        <Series>
          <Name>Rye1</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>Cross</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureDeepSoilTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Rye1.AboveGroundWt</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Factor] = 'UnequalDryNofert'</Filter>
        </Series>
        <Series>
          <Name>Rye2</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16777216</ColourArgb>
          <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureDeepSoilTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Rye2.AboveGroundWt</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Factor] = 'UnequalIrrigFert'</Filter>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>Yield</Name>
        <Series>
          <Name>Yield</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Right</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureDeepSoilTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Yield</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Right</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>PropRye1</Name>
        <Series>
          <Name>PropRye1</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>0</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>0</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureDeepSoilTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>PropYieldRye1</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>0.45</Minimum>
          <Maximum>0.7</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Experiment>
        <Name>Experiment</Name>
        <Factors>
          <Name>Factors</Name>
          <Factor>
            <Name>Factor</Name>
            <Factor>
              <Name>EqualIrrigFert</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Specifications>
                <string>[OnOffFertiliser].Script.FertOn = 1</string>
                <string>[OnOffIrrigation].Script.IrrigOn = 1</string>
              </Specifications>
            </Factor>
            <Factor>
              <Name>EqualDryNofert</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Specifications>
                <string>[OnOffFertiliser].Script.FertOn = 0</string>
                <string>[OnOffIrrigation].Script.IrrigOn = 0</string>
              </Specifications>
            </Factor>
            <Factor>
              <Name>UnequalIrrigFert</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Specifications>
                <string>[OnOffFertiliser].Script.FertOn = 1</string>
                <string>[OnOffIrrigation].Script.IrrigOn = 1</string>
                <string>[Rye2].RootDepthMaximum = 150</string>
                <string>[Rye2].InitialRootDepth = 150</string>
              </Specifications>
            </Factor>
            <Factor>
              <Name>UnequalDryNofert</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Specifications>
                <string>[OnOffFertiliser].Script.FertOn = 0</string>
                <string>[OnOffIrrigation].Script.IrrigOn = 0</string>
                <string>[Rye2].RootDepthMaximum = 150</string>
                <string>[Rye2].InitialRootDepth = 150</string>
              </Specifications>
            </Factor>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <Specifications />
          </Factor>
          <IncludeInDocumentation>true</IncludeInDocumentation>
        </Factors>
        <Simulation>
          <Name>AgPastureDeepSoilTest</Name>
          <Clock>
            <Name>Clock</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <StartDate>1971-07-01T00:00:00</StartDate>
            <EndDate>1972-06-30T00:00:00</EndDate>
          </Clock>
          <Weather>
            <Name>Weather</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <FileName>%root%\Examples\WeatherFiles\lincoln.met</FileName>
            <ExcelWorkSheetName />
          </Weather>
          <Summary>
            <Name>Summary</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </Summary>
          <SoilArbitrator>
            <Name>SoilArbitrator</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </SoilArbitrator>
          <Zone>
            <Name>Field</Name>
            <Folder>
              <Name>Managers</Name>
              <Manager>
                <Name>OnOffFertiliser</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <AllowFertiliser>yes</AllowFertiliser>
                  <FertOn>1</FertOn>
                  <Depth2SoilN>200</Depth2SoilN>
                  <CriticalSoilN>15</CriticalSoilN>
                  <FertNAmount>25</FertNAmount>
                  <FertType>UreaN</FertType>
                  <FertApplicationDepth>1</FertApplicationDepth>
                  <FertMinimumDays>14</FertMinimumDays>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using APSIM.Shared.Utilities;
using System.Xml.Serialization;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		[Link] Soil Soil;

		//User inputs from properties tab
		[Description("Turn fertiliser applications on? ")]
		public yesnoType AllowFertiliser { get; set; }
		
		[Description("Temporary variable to turn fertiliser on (1) or off (0): ")] public int FertOn { get; set; }

		[Description("Depth to calculate available soil N (mm): ")]
		public double Depth2SoilN { get; set; }

		[Description("Minimum available N, triggers an application (kgN/ha): ")]
		public double CriticalSoilN { get; set; }

		[Description("Amount of N fertiliser for each application (kgN/ha): ")]
		public double FertNAmount { get; set; }

		[Description("Type of N fertiliser to apply: ")]
		public Fertiliser.Types FertType { get; set; }

		[Description("Depth at which to apply the fertiliser (mm): ")]
		public double FertApplicationDepth { get; set; }
	   
		[Description("Minimum period between applications (days): ")]
		public double FertMinimumDays { get; set; }
	   
		public enum yesnoType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		[XmlIgnore] public double TopMineralN { get; set; }
		
		private DateTime lastApplicationDate;
		private bool fertiliserIsAllowed;
		private int nLayers;

		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{
			fertiliserIsAllowed = (AllowFertiliser == yesnoType.yes);
			nLayers = Soil.SoilWater.Thickness.Length;
		}

		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			double daysSinceLastApplication = (Clock.Today - lastApplicationDate).TotalDays;
			
			// get the N stored in the soil
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopMineralN = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (Depth2SoilN - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopMineralN += (Soil.SoilNitrogen.NO3[layer]
				+ Soil.SoilNitrogen.NH4[layer]
				+ Soil.SoilNitrogen.urea[layer])
				* fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= Depth2SoilN)
					layer = nLayers;
			}

			if (fertiliserIsAllowed && (daysSinceLastApplication >= FertMinimumDays) && (TopMineralN <= CriticalSoilN))
			{
				fertiliser.Apply(FertNAmount * FertOn, FertType, FertApplicationDepth);
				lastApplicationDate = Clock.Today;
			}
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>OnOffIrrigation</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <allowIrrigation>yes</allowIrrigation>
                  <IrrigOn>1</IrrigOn>
                  <seasonStart>15-Aug</seasonStart>
                  <seasonEnd>30-May</seasonEnd>
                  <seasonsAllocation>10000</seasonsAllocation>
                  <triggerDeficit>75</triggerDeficit>
                  <targetDeficit>99</targetDeficit>
                  <returndays>1</returndays>
                  <maximumAmount>30</maximumAmount>
                  <depthPAWC>300</depthPAWC>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using System.Xml.Serialization;
using Models.PMF;
using APSIM.Shared.Utilities;

        
namespace Models
{
	[Serializable] 
	[System.Xml.Serialization.XmlInclude(typeof(Model))]
	public class Script : Model
	{
		//Communication to other modules
		[Link] ISummary summary = null;
		[Link] Irrigation Irrigation;
		[Link] Clock Clock;
		[Link] Soil Soil;
		[Link(IsOptional = true)] ICrop existingCrop;
	   
		//User inputs from properties tab
		[Description("Turn irrigation on?")]
		public answerType allowIrrigation { get; set; }
		
		[Description("Temporary variable to turn fertiliser on (1) or off (0): ")] public int IrrigOn { get; set; }


		[Description("Start of irrigation season (dd-MMM)")]
		public string seasonStart { get; set; }
		[Description("End of irrigation season (dd-MMM)")]
		public string seasonEnd { get; set; }
		[Description("Season allocation (mm)")]
		public double seasonsAllocation { get; set; }
		[Description("Deficit to trigger irrigation (% PAWC)")]
		public double triggerDeficit { get; set; }
		[Description("Deficit to stop irrigaton (% PAWC)")]
		public double targetDeficit { get; set; }
		[Description("Minimum days for irrigation to return")]
		public double returndays { get; set; }
		[Description("Maximum irrigation application (mm/day)")]
		public double maximumAmount { get; set; }
		[Description("Depth to calculate PAWC (mm)")]
		public double depthPAWC { get; set; }
	   
		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		//Class members
		[XmlIgnore] public double TopSWdeficit { get; set; }
		[XmlIgnore] public double TopSWC { get; set; }
		[XmlIgnore] public double DaysSinceIrrigation { get; set; }
		[XmlIgnore] public double AmountToApply { get; set; }
		[XmlIgnore] public double SeasonAppliedAmount { get; set; }
		
		private bool IrrigationIsAllowed { get; set; }
		private bool SeasonIsOpen { get; set; }
		private bool CropIsActive { get; set; }
		private bool IrrigatorIsAvailable { get; set; }
		private bool SoilIsDry { get; set; }

		private DateTime StartDate;
		private DateTime EndDate;
		private double TopDUL;
		private double TopLL;
		private int nLayers;
	
		//Calculate static soil variables
		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{   
			//Set the season dates
			StartDate = DateTime.Parse(seasonStart + "-" + Clock.Today.Year.ToString());
			EndDate = DateTime.Parse(seasonEnd + "-" + Clock.Today.Year.ToString());
			
			//Can we irrigate at all?
			IrrigationIsAllowed = false; 
			if (allowIrrigation == answerType.yes)
				IrrigationIsAllowed = true; 

			//Calculate soil water variables
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			nLayers = Soil.SoilWater.Thickness.Length;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopLL += Soil.SoilWater.LL15mm[layer] * fracLayer;
				TopDUL += Soil.SoilWater.DULmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
		}
	   	  
		//Determine daily requirement for irrigation
		[EventSubscribe("StartOfDay")]
		private void OnStartOfDay(object sender, EventArgs e)
		{
			//Can we irrigate today?		  
			SeasonIsOpen = isBetween(Clock.Today, StartDate, EndDate);

			//Is there a crop in the ground that needs irrigation?
			CropIsActive = false;
			if ((existingCrop != null) && (existingCrop.IsAlive))
				CropIsActive = true;
	      
			//Is the irrigator available?
			IrrigatorIsAvailable = false;
			DaysSinceIrrigation += 1;
			if (DaysSinceIrrigation >= returndays)
				IrrigatorIsAvailable = true;
	      
			//Is the soil dry enough to require irrigation?
			SoilIsDry = false;
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopSWC = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			//for (int layer = 0; depthFromSurface < depthPAWC + Soil.SoilWater.Thickness[layer]; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopSWC += Soil.SoilWater.SWmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
			
			TopSWdeficit = TopSWC - TopDUL;
			if (Math.Max(0.0, -TopSWdeficit) >= (TopDUL - TopLL) * (100 - triggerDeficit) / 100)
				SoilIsDry = true;
	            
			//Are all the conditions ratifying irrigation
			if (IrrigationIsAllowed && SeasonIsOpen && CropIsActive && IrrigatorIsAvailable && SoilIsDry)
			{
				//Lets bloody well irrigate then!!!!
				AmountToApply = TopDUL * targetDeficit / 100 - TopSWC;
				AmountToApply = Math.Max(0.0, Math.Min(AmountToApply, seasonsAllocation - SeasonAppliedAmount));
				Irrigation.Apply(AmountToApply * IrrigOn);
				DaysSinceIrrigation = 0;
				SeasonAppliedAmount += AmountToApply;
			}
		}
		
		///Checks whether theDate is between iniDate and endDate (non-year specific)
		private bool isBetween(DateTime theDay, DateTime iniDate, DateTime endDate)
		{
			bool result = false;
			if (iniDate.DayOfYear < endDate.DayOfYear)
			{
				// period is within one year, ex: summer in the northern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) && (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			else
			{
				// period goes over the end of the year, ex: summer in the southern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) || (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			
			return result;
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>CutRotation</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <rotationAllowed>True</rotationAllowed>
                  <CutRotationStartDate>1900-07-01</CutRotationStartDate>
                  <CutRotationEndDate>2100-12-31</CutRotationEndDate>
                  <CutInterval>21</CutInterval>
                  <IntervalType>FixedInterval</IntervalType>
                  <DurationOfCut>1</DurationOfCut>
                  <RemoveAmountType>ResidualDM</RemoveAmountType>
                  <AmountGiven>1000</AmountGiven>
                  <DMRemoveType>RemoveAll</DMRemoveType>
                  <FractionN2Remove>1</FractionN2Remove>
                  <ProportionN2Dung>0</ProportionN2Dung>
                </Script>
                <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Do the grazing/cutting?: ")] public bool rotationAllowed { get; set; }
		[Description("Date to begin the rotation: ")] public DateTime CutRotationStartDate { get; set; }
		[Description("Date to finish the rotation: ")] public DateTime CutRotationEndDate { get; set; }
		[Description("Rotation interval (days): ")] public int CutInterval { get; set; }
		[Description("How the interval is defined: ")] public rotationIntervalTypes IntervalType { get; set; }
		[Description("Duration of each event (days): ")] public int DurationOfCut { get; set; }
		[Description("What amount is being defined: ")] public removeAmountTypes RemoveAmountType { get; set; }
		[Description("Amount to use (kg/ha): ")] public double AmountGiven { get; set; }
		[Description("Fraction of DM that is removed from the field:")] public removeDMTypes DMRemoveType { get; set; }
		[Description("Fraction of N that is removed from the field (0-1):")] public double FractionN2Remove { get; set; }
		[Description("Proportion of N returned in dung (0-1):")] public double ProportionN2Dung { get; set; }

		// - Outputs from this manager
		[XmlIgnore][Units("g/m2")] public double DefoliatedWt { get; set; }
		// Description: Pasture DM defoliated today
		[XmlIgnore][Units("g/m2")] public double DefoliatedN { get; set; }
		// Description: Pasture N defoliate today
		[XmlIgnore][Units("g/m2")] public double HarvestedWt { get; set; }
		// Description: Pasture DM harvested today
		[XmlIgnore][Units("g/m2")] public double HarvestedN { get; set; }
		// Description: Pasture N harvested today
		[XmlIgnore][Units("g/m2")] public double RemovedWt { get; set; }
		// Description: Pasture DM removed from the field
		[XmlIgnore][Units("g/m2")] public double RemovedN { get; set; }
		// Description: Pasture N removed from the field
		[XmlIgnore][Units("g/m2")] public double ReturnedWt { get; set; }
		// Description: Residue DM returned to the field
		[XmlIgnore][Units("g/m2")] public double ReturnedN { get; set; }
		// Description: Residue N returned to the field
		[XmlIgnore][Units("g/m2")] public double NReturnedInDung { get; set; }
		// Description: Harvested N returned as dung (SurfaceOM)
		[XmlIgnore][Units("g/m2")] public double NReturnedInUrine { get; set; }
		// Description: Harvested N returned as urine (urea)
		[XmlIgnore][Units("day")] public int DaysAfterCut { get; set; }
		// Description: Number of days after last defoliation
		[XmlIgnore][Units("g/m2")] public double PreHarvestDM { get; set; }
		// Description: Total standing DM (Leaf + Stem/Sheath) before cut
		[XmlIgnore][Units("g/m2")] public double PostHarvestDM { get; set; }
		// Description: Total standing DM (Leaf + Stem/Sheath) after cut
		
		// - Internal variables
		// fraction of harvested Dm to actually remove from field
		private double fractionDM2Remove = 1.0;
		// flag whether defoliation is allowed
		//private bool rotationAllowed = true;
		// number of days for each defoliation event
		private int cuttingDuration = 0;
		// counter for day within each defoliation
		private int daysCutting = 0;
		// type of interval (Fixed or target)
		private string intervalType;
		// total herbage to remove in g/m2 per day
		private double herbageToRemove;
		// type of DM amount (ResidualDM or DMToRemove)
		private string amountType;
		// auxiliary flag for defoliation
		private bool aCutHasHappened = false;

		// - Event to add residue or dung to surface OM
		public event BiomassRemovedDelegate BiomassRemoved;

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				Pasture.Add(species);
			}

			// reset variables
			DaysAfterCut = 0;
			resetVariables();
			cuttingDuration = DurationOfCut;
			
			// get the type of amount given
			if (RemoveAmountType == removeAmountTypes.ResidualDM)
				amountType = "SetResidueAmount";
			else
				amountType = "SetRemoveAmount";

			// get the type of amount given
			if (IntervalType == rotationIntervalTypes.FixedInterval)
				intervalType = "Fixed";
			else
				intervalType = "Target";

			// make sure that rotation starts when startDate < simulationStartDay
			if ((Clock.Today > CutRotationStartDate) && (Clock.Today < CutRotationEndDate))
				CutRotationStartDate = Clock.Today;
		}
		
		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			if (rotationAllowed)
			{
				if (Clock.Today == CutRotationStartDate)
					DaysAfterCut = CutInterval;

				bool SwardIsAlive = false;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				{
					if (species.IsAlive)
						SwardIsAlive = true;
				}
				
				// Check whether we can defoliate
				if ((Clock.Today >= CutRotationStartDate) && (Clock.Today <= CutRotationEndDate) && (SwardIsAlive))
				{
					// Check whether we should start a defoliation
					if (DaysAfterCut >= (CutInterval - 1))
					{
						Graze(AmountGiven, amountType, DurationOfCut);
					}
				}
			}

			// Check whether we need to continue cutting
			if ((daysCutting > 0) && (daysCutting < cuttingDuration))
			{
				// reset outputs
				resetVariables();

				removeDM(herbageToRemove);
				returnExcreta();
				daysCutting += 1;
				if (daysCutting == cuttingDuration)
				{
					PostHarvestDM = 0.0;
					foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
						PostHarvestDM += species.StandingHerbageWt;
				}
			}

			// reset outputs
			if (daysCutting < 0)
			{
				resetVariables();
				daysCutting = 0;
			}
		}

		[EventSubscribe("DoManagementCalculations")]
		private void OnDoManagementCalculations(object sender, EventArgs e)
		{
			// Check whether a cutting has finished
			if (daysCutting == cuttingDuration)
			{
				aCutHasHappened = true;
				daysCutting = -1;
			}

			// Increase the counter for days after cutting
			if (aCutHasHappened && (daysCutting == 0))
				DaysAfterCut += 1;
		}

		public enum removeAmountTypes
		{
			/// <summary>Setting DM amount to remove</summary>
			DMToRemove,
			/// <summary>Setting residual DM amount</summary>
			ResidualDM
		}

		public enum rotationIntervalTypes
		{
			/// <summary>Setting a fixed interval</summary>
			FixedInterval,
			/// <summary>Setting a target (minimum) inteval</summary>
			TargetInterval
		}

		public enum removeDMTypes
		{
			/// <summary>Remove all DM</summary>
			RemoveAll,
			/// <summary>Remove no DM</summary>
			RemoveNone,
			/// <summary>Remove a fraction based on digestibility</summary>
			BasedOnDigestibility
		}

		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}
		
				
		// Resets the values of all outputs
		private void resetVariables()
		{
			DefoliatedWt = 0.0;
			DefoliatedN = 0.0;
			HarvestedWt = 0.0;
			HarvestedN = 0.0;
			RemovedWt = 0.0;
			RemovedN = 0.0;
			ReturnedWt = 0.0;
			ReturnedN = 0.0;
			NReturnedInDung = 0.0;
			NReturnedInUrine = 0.0;
		}

		// Description: Perform the basic calculations for defoliation
		public void Graze(double amountDM, string amountType, int duration)
		{
			// Get the existing plant amount
			PreHarvestDM = 0.0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				PreHarvestDM += species.StandingHerbageWt;
			
			// Check the amount to remove and print some info
			if ((amountType == "SetRemoveAmount") && (PreHarvestDM >= amountDM / duration))
			{
				summary.WriteMessage(this, "   Defoliating " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = amountDM / duration;
			}
			else if ((amountType == "SetResidueAmount") && (PreHarvestDM >= amountDM))
			{
				summary.WriteMessage(this, "   Defoliating down to approximately " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = (PreHarvestDM - amountDM) / duration;
			}
			else
			{
				summary.WriteMessage(this, "   Defoliation will not happend because there is not enough plant material");
				if (intervalType == "Fixed")
					DaysAfterCut = -duration;
				return;
			}

			cuttingDuration = duration;
			// Preform first defoliation
			removeDM(herbageToRemove);
			returnExcreta();
			daysCutting = 1;
			DaysAfterCut = 0;
			if (daysCutting == cuttingDuration)
			{
				PostHarvestDM = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					PostHarvestDM += species.StandingHerbageWt;
			}
		}

		// Do the DM removal
		private void removeDM(double removeAmount)
		{
			double existingWt = 0.0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				existingWt += species.HarvestableWt;


			// Check whether we harvest anything
			if (existingWt >= removeAmount)
			{
				foreach (AgPasture.PastureSpecies species in Pasture)
				{
					double amountToRemove = removeAmount * species.HarvestableWt / existingWt;
					species.Graze(amount: amountToRemove, type: "SetRemoveAmount");
				}
				
				// get total harvested
				DefoliatedWt = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					DefoliatedWt += species.HarvestedWt;
				DefoliatedN = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					DefoliatedN += species.HarvestedN;
				HarvestedWt = DefoliatedWt;
				HarvestedN = DefoliatedN;

				// get amounts actually removed from field and that to be returned (dung/urine)
				if (DMRemoveType == removeDMTypes.RemoveAll)
					fractionDM2Remove = 1.0;
				else if (DMRemoveType == removeDMTypes.RemoveNone)
					fractionDM2Remove = 0.0;
				else
				{
					fractionDM2Remove = 0.0;
					foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
						fractionDM2Remove += species.HarvestedDigestibility * species.HarvestedWt;
					fractionDM2Remove /= removeAmount;
				}
				
				RemovedWt = HarvestedWt * fractionDM2Remove;
				RemovedN = HarvestedN * FractionN2Remove;
				ReturnedWt = HarvestedWt - RemovedWt;
				ReturnedN = HarvestedN - RemovedN;
				NReturnedInDung = ReturnedN * ProportionN2Dung;
				NReturnedInUrine = ReturnedN - NReturnedInDung;
			}
		}

		// Return dung and urine
		private void returnExcreta()
		{
			if ((ReturnedWt > 0.0) || (NReturnedInDung > 0.0))
			{
				PMF.BiomassRemovedType BiomassDung = new PMF.BiomassRemovedType();
				string[] type = new string[] { "RuminantDung_PastureFed" };
				float[] dltdm = new float[] { (Single)ReturnedWt };
				float[] dltn = new float[] { (Single)NReturnedInDung };
				float[] dltp = new float[] { 0 };
				float[] fraction = new float[] { 1 };     // fraction is always 1.0 here

				BiomassDung.crop_type = "RuminantDung_PastureFed";
				BiomassDung.dm_type = type;
				BiomassDung.dlt_crop_dm = dltdm;
				BiomassDung.dlt_dm_n = dltn;
				BiomassDung.dlt_dm_p = dltp;
				BiomassDung.fraction_to_residue = fraction;
				BiomassRemoved.Invoke(BiomassDung);
			}

			if (NReturnedInUrine > 0.0)
			{
				fertiliser.Apply(NReturnedInUrine * 10, Fertiliser.Types.UreaN, 1.0);
			}
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>PropRye1</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script />
                <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager

		// - Outputs from this manager
		[XmlIgnore][Units("kg/kg")] public double PropYieldRye1 { get; set; }
		[XmlIgnore][Units("kg/ha")] public double YieldRye1 { get; set; }
		[XmlIgnore][Units("kg/ha")] public double YieldRye2 { get; set; }
		
		// - Internal variables
		//private double fractionDM2Remove = 1.0;

		// - Event to add residue or dung to surface OM
		//public event BiomassRemovedDelegate BiomassRemoved;

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				Pasture.Add(species);
			}
			YieldRye1 = 0.0;
			YieldRye2 = 0.0;
			PropYieldRye1 = 0.0;
		}
		


		[EventSubscribe("DoManagementCalculations")]
		private void OnDoManagementCalculations(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				//Pasture.Add(species);
			}
			YieldRye1 += Pasture[0].HarvestedWt;
			YieldRye2 += Pasture[1].HarvestedWt;
			if ((YieldRye1 + YieldRye2) > 0.0)
				PropYieldRye1 = YieldRye1 / (YieldRye1 + YieldRye2);
		}

	}
}
]]></Code>
              </Manager>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ShowPageOfGraphs>true</ShowPageOfGraphs>
            </Folder>
            <MicroClimate>
              <Name>MicroClimate</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <a_interception>0</a_interception>
              <b_interception>0</b_interception>
              <c_interception>0</c_interception>
              <d_interception>0</d_interception>
              <soil_albedo>0.23</soil_albedo>
              <sun_angle>15</sun_angle>
              <soil_heat_flux_fraction>0.4</soil_heat_flux_fraction>
              <night_interception_fraction>0.5</night_interception_fraction>
              <refheight>2</refheight>
              <albedo>0.29366217672824863</albedo>
              <emissivity>0.96</emissivity>
              <RadIntTotal>0</RadIntTotal>
            </MicroClimate>
            <Irrigation>
              <Name>Irrigation</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Irrigation>
            <Fertiliser>
              <Name>Fertiliser</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Fertiliser>
            <SurfaceOrganicMatter>
              <Name>SurfaceOrganicMatter</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ReportAdditions>no</ReportAdditions>
              <ReportRemovals>no</ReportRemovals>
              <ResidueTypes>
                <Name>ResidueTypes</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LoadFromResource>ResidueTypes</LoadFromResource>
              </ResidueTypes>
              <TillageTypes>
                <Name>TillageTypesList</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <TillageType />
              </TillageTypes>
              <Pools>
                <Pool>
                  <PoolName>Sward</PoolName>
                  <ResidueType>grass</ResidueType>
                  <Mass>1000</Mass>
                  <CNRatio>15</CNRatio>
                  <CPRatio>NaN</CPRatio>
                  <StandingFraction>0</StandingFraction>
                </Pool>
              </Pools>
              <PoolName>Sward</PoolName>
              <type>grass</type>
              <mass>1000</mass>
              <standing_fraction>0</standing_fraction>
              <cpr />
              <cnr>15</cnr>
              <CriticalResidueWeight>2000</CriticalResidueWeight>
              <OptimumDecompTemp>20</OptimumDecompTemp>
              <MaxCumulativeEOS>20</MaxCumulativeEOS>
              <CNRatioDecompCoeff>0.277</CNRatioDecompCoeff>
              <CNRatioDecompThreshold>25</CNRatioDecompThreshold>
              <TotalLeachRain>25</TotalLeachRain>
              <MinRainToLeach>10</MinRainToLeach>
              <CriticalMinimumOrganicC>0.004</CriticalMinimumOrganicC>
              <DefaultCPRatio>0</DefaultCPRatio>
              <DefaultStandingFraction>0</DefaultStandingFraction>
              <StandingExtinctCoeff>0.5</StandingExtinctCoeff>
              <FractionFaecesAdded>0.5</FractionFaecesAdded>
            </SurfaceOrganicMatter>
            <SoluteManager>
              <Name>SoluteManager</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </SoluteManager>
            <PastureSpecies>
              <Name>Rye1</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <MaximumNUptake>10</MaximumNUptake>
              <Albedo>0.26</Albedo>
              <Gsmax>0.011</Gsmax>
              <R50>200</R50>
              <SpeciesFamily>Grass</SpeciesFamily>
              <PhotosyntheticPathway>C3</PhotosyntheticPathway>
              <InitialShootDM>750</InitialShootDM>
              <InitialRootDM>450</InitialRootDM>
              <InitialRootDepth>750</InitialRootDepth>
              <ReferencePhotosyntheticRate>1</ReferencePhotosyntheticRate>
              <LightExtinctionCoefficient>0.5</LightExtinctionCoefficient>
              <GrowthTminimum>1</GrowthTminimum>
              <GrowthToptimum>20</GrowthToptimum>
              <GrowthTEffectExponent>1.7</GrowthTEffectExponent>
              <UseHeatStressFactor>yes</UseHeatStressFactor>
              <HeatOnsetTemperature>28</HeatOnsetTemperature>
              <HeatFullTemperature>35</HeatFullTemperature>
              <HeatRecoverySumDD>30</HeatRecoverySumDD>
              <HeatRecoveryTReference>25</HeatRecoveryTReference>
              <UseColdStressFactor>yes</UseColdStressFactor>
              <ColdOnsetTemperature>1</ColdOnsetTemperature>
              <ColdFullTemperature>-5</ColdFullTemperature>
              <ColdRecoverySumDD>25</ColdRecoverySumDD>
              <ColdRecoveryTReference>0</ColdRecoveryTReference>
              <MaintenanceRespirationCoefficient>0.03</MaintenanceRespirationCoefficient>
              <GrowthRespirationCoefficient>0.25</GrowthRespirationCoefficient>
              <RespirationTReference>20</RespirationTReference>
              <RespirationExponent>1.5</RespirationExponent>
              <NThresholdsForLeaves>
                <double>0.04</double>
                <double>0.012</double>
                <double>0.05</double>
              </NThresholdsForLeaves>
              <NThresholdsForStems>
                <double>0.02</double>
                <double>0.006</double>
                <double>0.025</double>
              </NThresholdsForStems>
              <NThresholdsForStolons>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </NThresholdsForStolons>
              <NThresholdsForRoots>
                <double>0.02</double>
                <double>0.006</double>
                <double>0.025</double>
              </NThresholdsForRoots>
              <DegreesDayForGermination>125</DegreesDayForGermination>
              <TargetShootRootRatio>4</TargetShootRootRatio>
              <MaxRootAllocation>0.25</MaxRootAllocation>
              <ShootRootGlfFactor>0.5</ShootRootGlfFactor>
              <UseReproSeasonFactor>yes</UseReproSeasonFactor>
              <ReproSeasonReferenceLatitude>41</ReproSeasonReferenceLatitude>
              <ReproSeasonTimingCoeff>0.14</ReproSeasonTimingCoeff>
              <ReproSeasonMaxAllocationIncrease>0.5</ReproSeasonMaxAllocationIncrease>
              <ReproSeasonAllocationCoeff>0.1</ReproSeasonAllocationCoeff>
              <FractionLeafMaximum>0.7</FractionLeafMaximum>
              <FractionLeafMinimum>0.7</FractionLeafMinimum>
              <FractionLeafDMThreshold>500</FractionLeafDMThreshold>
              <FractionLeafDMFactor>2000</FractionLeafDMFactor>
              <FractionLeafExponent>3</FractionLeafExponent>
              <FractionToStolon>0</FractionToStolon>
              <SpecificLeafArea>25</SpecificLeafArea>
              <SpecificRootLength>100</SpecificRootLength>
              <StolonEffectOnLAI>0</StolonEffectOnLAI>
              <ShootMaxEffectOnLAI>1000</ShootMaxEffectOnLAI>
              <MaxStemEffectOnLAI>1</MaxStemEffectOnLAI>
              <LiveLeavesPerTiller>3</LiveLeavesPerTiller>
              <TissueTurnoverRateShoot>0.05</TissueTurnoverRateShoot>
              <TissueTurnoverRateRoot>0.02</TissueTurnoverRateRoot>
              <DetachmentRateShoot>0.08</DetachmentRateShoot>
              <TurnoverTemperatureMin>2</TurnoverTemperatureMin>
              <TurnoverTemperatureRef>20</TurnoverTemperatureRef>
              <TurnoverTemperatureExponent>1</TurnoverTemperatureExponent>
              <TurnoverDroughtEffectMax>1</TurnoverDroughtEffectMax>
              <TurnoverDroughtThreshold>0.5</TurnoverDroughtThreshold>
              <TurnoverDefoliationCoefficient>0.5</TurnoverDefoliationCoefficient>
              <TurnoverDefoliationRootEffect>0.1</TurnoverDefoliationRootEffect>
              <FractionNLuxuryRemobilisable>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </FractionNLuxuryRemobilisable>
              <MinimumNFixation>0</MinimumNFixation>
              <MaximumNFixation>0</MaximumNFixation>
              <SoilSaturationEffectMax>0.1</SoilSaturationEffectMax>
              <MinimumWaterFreePorosity>-1</MinimumWaterFreePorosity>
              <SoilSaturationRecoveryFactor>0.25</SoilSaturationRecoveryFactor>
              <NDillutionCoefficient>0.25</NDillutionCoefficient>
              <GlfGeneric>1</GlfGeneric>
              <GlfSoilFertility>1</GlfSoilFertility>
              <PlantHeightMinimum>350</PlantHeightMinimum>
              <PlantHeightMaximum>350</PlantHeightMaximum>
              <PlantHeightMassForMax>10000</PlantHeightMassForMax>
              <PlantHeightExponent>2.8</PlantHeightExponent>
              <RootDepthMinimum>50</RootDepthMinimum>
              <RootDepthMaximum>750</RootDepthMaximum>
              <RootElongationRate>25</RootElongationRate>
              <RootDistributionDepthParam>90</RootDistributionDepthParam>
              <RootDistributionExponent>3.2</RootDistributionExponent>
              <DigestibilitiesCellWall>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.2</double>
              </DigestibilitiesCellWall>
              <MinimumGreenWt>100</MinimumGreenWt>
              <FractionStolonStanding>0</FractionStolonStanding>
              <PreferenceForGreenOverDead>1</PreferenceForGreenOverDead>
              <PreferenceForLeafOverStems>1</PreferenceForLeafOverStems>
              <WaterAvailableMethod>DefaultAPSIM</WaterAvailableMethod>
              <NitrogenAvailableMethod>BasicAgPasture</NitrogenAvailableMethod>
            </PastureSpecies>
            <PastureSpecies>
              <Name>Rye2</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <MaximumNUptake>10</MaximumNUptake>
              <Albedo>0.26</Albedo>
              <Gsmax>0.011</Gsmax>
              <R50>200</R50>
              <SpeciesFamily>Grass</SpeciesFamily>
              <PhotosyntheticPathway>C3</PhotosyntheticPathway>
              <InitialShootDM>750</InitialShootDM>
              <InitialRootDM>450</InitialRootDM>
              <InitialRootDepth>750</InitialRootDepth>
              <ReferencePhotosyntheticRate>1</ReferencePhotosyntheticRate>
              <LightExtinctionCoefficient>0.5</LightExtinctionCoefficient>
              <GrowthTminimum>1</GrowthTminimum>
              <GrowthToptimum>20</GrowthToptimum>
              <GrowthTEffectExponent>1.7</GrowthTEffectExponent>
              <UseHeatStressFactor>yes</UseHeatStressFactor>
              <HeatOnsetTemperature>28</HeatOnsetTemperature>
              <HeatFullTemperature>35</HeatFullTemperature>
              <HeatRecoverySumDD>30</HeatRecoverySumDD>
              <HeatRecoveryTReference>25</HeatRecoveryTReference>
              <UseColdStressFactor>yes</UseColdStressFactor>
              <ColdOnsetTemperature>1</ColdOnsetTemperature>
              <ColdFullTemperature>-5</ColdFullTemperature>
              <ColdRecoverySumDD>25</ColdRecoverySumDD>
              <ColdRecoveryTReference>0</ColdRecoveryTReference>
              <MaintenanceRespirationCoefficient>0.03</MaintenanceRespirationCoefficient>
              <GrowthRespirationCoefficient>0.25</GrowthRespirationCoefficient>
              <RespirationTReference>20</RespirationTReference>
              <RespirationExponent>1.5</RespirationExponent>
              <NThresholdsForLeaves>
                <double>0.04</double>
                <double>0.012</double>
                <double>0.05</double>
              </NThresholdsForLeaves>
              <NThresholdsForStems>
                <double>0.02</double>
                <double>0.006</double>
                <double>0.025</double>
              </NThresholdsForStems>
              <NThresholdsForStolons>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </NThresholdsForStolons>
              <NThresholdsForRoots>
                <double>0.02</double>
                <double>0.006</double>
                <double>0.025</double>
              </NThresholdsForRoots>
              <DegreesDayForGermination>125</DegreesDayForGermination>
              <TargetShootRootRatio>4</TargetShootRootRatio>
              <MaxRootAllocation>0.25</MaxRootAllocation>
              <ShootRootGlfFactor>0.5</ShootRootGlfFactor>
              <UseReproSeasonFactor>yes</UseReproSeasonFactor>
              <ReproSeasonReferenceLatitude>41</ReproSeasonReferenceLatitude>
              <ReproSeasonTimingCoeff>0.14</ReproSeasonTimingCoeff>
              <ReproSeasonMaxAllocationIncrease>0.5</ReproSeasonMaxAllocationIncrease>
              <ReproSeasonAllocationCoeff>0.1</ReproSeasonAllocationCoeff>
              <FractionLeafMaximum>0.7</FractionLeafMaximum>
              <FractionLeafMinimum>0.7</FractionLeafMinimum>
              <FractionLeafDMThreshold>500</FractionLeafDMThreshold>
              <FractionLeafDMFactor>2000</FractionLeafDMFactor>
              <FractionLeafExponent>3</FractionLeafExponent>
              <FractionToStolon>0</FractionToStolon>
              <SpecificLeafArea>25</SpecificLeafArea>
              <SpecificRootLength>100</SpecificRootLength>
              <StolonEffectOnLAI>0</StolonEffectOnLAI>
              <ShootMaxEffectOnLAI>1000</ShootMaxEffectOnLAI>
              <MaxStemEffectOnLAI>1</MaxStemEffectOnLAI>
              <LiveLeavesPerTiller>3</LiveLeavesPerTiller>
              <TissueTurnoverRateShoot>0.05</TissueTurnoverRateShoot>
              <TissueTurnoverRateRoot>0.02</TissueTurnoverRateRoot>
              <DetachmentRateShoot>0.08</DetachmentRateShoot>
              <TurnoverTemperatureMin>2</TurnoverTemperatureMin>
              <TurnoverTemperatureRef>20</TurnoverTemperatureRef>
              <TurnoverTemperatureExponent>1</TurnoverTemperatureExponent>
              <TurnoverDroughtEffectMax>1</TurnoverDroughtEffectMax>
              <TurnoverDroughtThreshold>0.5</TurnoverDroughtThreshold>
              <TurnoverDefoliationCoefficient>0.5</TurnoverDefoliationCoefficient>
              <TurnoverDefoliationRootEffect>0.1</TurnoverDefoliationRootEffect>
              <FractionNLuxuryRemobilisable>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </FractionNLuxuryRemobilisable>
              <MinimumNFixation>0</MinimumNFixation>
              <MaximumNFixation>0</MaximumNFixation>
              <SoilSaturationEffectMax>0.1</SoilSaturationEffectMax>
              <MinimumWaterFreePorosity>-1</MinimumWaterFreePorosity>
              <SoilSaturationRecoveryFactor>0.25</SoilSaturationRecoveryFactor>
              <NDillutionCoefficient>0.25</NDillutionCoefficient>
              <GlfGeneric>1</GlfGeneric>
              <GlfSoilFertility>1</GlfSoilFertility>
              <PlantHeightMinimum>350</PlantHeightMinimum>
              <PlantHeightMaximum>350</PlantHeightMaximum>
              <PlantHeightMassForMax>10000</PlantHeightMassForMax>
              <PlantHeightExponent>2.8</PlantHeightExponent>
              <RootDepthMinimum>50</RootDepthMinimum>
              <RootDepthMaximum>750</RootDepthMaximum>
              <RootElongationRate>25</RootElongationRate>
              <RootDistributionDepthParam>90</RootDistributionDepthParam>
              <RootDistributionExponent>3.2</RootDistributionExponent>
              <DigestibilitiesCellWall>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.2</double>
              </DigestibilitiesCellWall>
              <MinimumGreenWt>100</MinimumGreenWt>
              <FractionStolonStanding>0</FractionStolonStanding>
              <PreferenceForGreenOverDead>1</PreferenceForGreenOverDead>
              <PreferenceForLeafOverStems>1</PreferenceForLeafOverStems>
              <WaterAvailableMethod>DefaultAPSIM</WaterAvailableMethod>
              <NitrogenAvailableMethod>BasicAgPasture</NitrogenAvailableMethod>
            </PastureSpecies>
            <Soil>
              <Name>TempletonABlock</Name>
              <Analysis>
                <Name>Analysis</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>100</double>
                  <double>200</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <PH>
                  <double>6.6</double>
                  <double>6.2</double>
                  <double>5.7</double>
                  <double>5.5</double>
                  <double>5.5</double>
                  <double>5.5</double>
                </PH>
                <PHUnits>Water</PHUnits>
                <BoronUnits>HotWater</BoronUnits>
              </Analysis>
              <InitialWater>
                <Name>Initial water</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <PercentMethod>EvenlyDistributed</PercentMethod>
                <FractionFull>1</FractionFull>
                <DepthWetSoil>NaN</DepthWetSoil>
              </InitialWater>
              <Water>
                <Name>Water</Name>
                <SoilCrop>
                  <Name>RyegrassSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.13</double>
                    <double>0.13</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.11</double>
                    <double>0.11</double>
                  </LL>
                  <KL>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>WhiteCloverSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.13</double>
                    <double>0.13</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.11</double>
                    <double>0.11</double>
                  </LL>
                  <KL>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>Rye1Soil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.13</double>
                    <double>0.13</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.11</double>
                    <double>0.11</double>
                  </LL>
                  <KL>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>Rye2Soil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.13</double>
                    <double>0.13</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.11</double>
                    <double>0.11</double>
                  </LL>
                  <KL>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>100</double>
                  <double>200</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <BD>
                  <double>1</double>
                  <double>1</double>
                  <double>1.59</double>
                  <double>1.57</double>
                  <double>1.6</double>
                  <double>1.6</double>
                </BD>
                <AirDry>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.16</double>
                  <double>0.17</double>
                  <double>0.17</double>
                  <double>0.12</double>
                </AirDry>
                <LL15>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.16</double>
                  <double>0.17</double>
                  <double>0.17</double>
                  <double>0.12</double>
                </LL15>
                <DUL>
                  <double>0.27</double>
                  <double>0.27</double>
                  <double>0.29</double>
                  <double>0.3</double>
                  <double>0.3</double>
                  <double>0.3</double>
                </DUL>
                <SAT>
                  <double>0.42</double>
                  <double>0.4</double>
                  <double>0.36</double>
                  <double>0.37</double>
                  <double>0.37</double>
                  <double>0.32</double>
                </SAT>
                <KS>
                  <double>4832</double>
                  <double>389</double>
                  <double>16</double>
                  <double>16</double>
                  <double>98</double>
                </KS>
              </Water>
              <SoilWater>
                <Name>SoilWater</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <SummerDate>1-Nov</SummerDate>
                <SummerU>9</SummerU>
                <SummerCona>4.4</SummerCona>
                <WinterDate>1-Apr</WinterDate>
                <WinterU>9</WinterU>
                <WinterCona>4.4</WinterCona>
                <DiffusConst>88</DiffusConst>
                <DiffusSlope>35.4</DiffusSlope>
                <Salb>0.18</Salb>
                <CN2Bare>68</CN2Bare>
                <CNRed>20</CNRed>
                <CNCov>0.8</CNCov>
                <slope>NaN</slope>
                <discharge_width>NaN</discharge_width>
                <catchment_area>NaN</catchment_area>
                <max_pond>0</max_pond>
                <Thickness>
                  <double>100</double>
                  <double>200</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <SWCON>
                  <double>0.55</double>
                  <double>0.55</double>
                  <double>0.55</double>
                  <double>0.55</double>
                  <double>0.55</double>
                  <double>0.55</double>
                </SWCON>
                <residueinterception>0</residueinterception>
              </SoilWater>
              <SoilNitrogen>
                <Name>SoilNitrogen</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <fom_type>
                  <string>default</string>
                  <string>manure</string>
                  <string>mucuna</string>
                  <string>lablab</string>
                  <string>shemp</string>
                  <string>stable</string>
                </fom_type>
                <fract_carb>
                  <double>0.2</double>
                  <double>0.3</double>
                  <double>0.54</double>
                  <double>0.57</double>
                  <double>0.45</double>
                  <double>0</double>
                </fract_carb>
                <fract_cell>
                  <double>0.7</double>
                  <double>0.3</double>
                  <double>0.37</double>
                  <double>0.37</double>
                  <double>0.47</double>
                  <double>0.1</double>
                </fract_cell>
                <fract_lign>
                  <double>0.1</double>
                  <double>0.4</double>
                  <double>0.09</double>
                  <double>0.06</double>
                  <double>0.08</double>
                  <double>0.9</double>
                </fract_lign>
                <wfpsN2N2O_x>
                  <double>22</double>
                  <double>88</double>
                </wfpsN2N2O_x>
                <wfpsN2N2O_y>
                  <double>0.1</double>
                  <double>1</double>
                </wfpsN2N2O_y>
              </SoilNitrogen>
              <SoilOrganicMatter>
                <Name>SoilOrganicMatter</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <RootCN>30</RootCN>
                <RootWt>3000</RootWt>
                <SoilCN>11.5</SoilCN>
                <EnrACoeff>7.4</EnrACoeff>
                <EnrBCoeff>0.2</EnrBCoeff>
                <Thickness>
                  <double>100</double>
                  <double>200</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <Depth>
                  <string>0-10</string>
                  <string>10-30</string>
                  <string>30-60</string>
                  <string>60-90</string>
                  <string>90-120</string>
                  <string>120-150</string>
                </Depth>
                <OC>
                  <double>1.82</double>
                  <double>1.47</double>
                  <double>1.2</double>
                  <double>1.03</double>
                  <double>0.47</double>
                  <double>0.47</double>
                </OC>
                <FBiom>
                  <double>0.025</double>
                  <double>0.025</double>
                  <double>0.015</double>
                  <double>0.01</double>
                  <double>0.01</double>
                  <double>0.01</double>
                </FBiom>
                <FInert>
                  <double>0.3</double>
                  <double>0.4</double>
                  <double>0.75</double>
                  <double>0.9</double>
                  <double>0.96</double>
                  <double>0.96</double>
                </FInert>
                <OCUnits>Total</OCUnits>
              </SoilOrganicMatter>
              <Sample>
                <Name>Sample</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>100</double>
                  <double>200</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <NO3>
                  <double>27.3</double>
                  <double>22.8</double>
                  <double>1.2</double>
                  <double>9.2</double>
                  <double>9.2</double>
                  <double>1</double>
                </NO3>
                <NH4>
                  <double>4.3</double>
                  <double>7.6</double>
                  <double>4.1</double>
                  <double>2.7</double>
                  <double>2.4</double>
                  <double>0.1</double>
                </NH4>
                <NO3Units>kgha</NO3Units>
                <NH4Units>ppm</NH4Units>
                <SWUnits>Volumetric</SWUnits>
                <OCUnits>Total</OCUnits>
                <PHUnits>Water</PHUnits>
              </Sample>
              <CERESSoilTemperature>
                <Name>CERESSoilTemperature</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
              </CERESSoilTemperature>
              <Graph>
                <Name>Graph</Name>
                <Series>
                  <Name>LL15</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <Type>Area</Type>
                  <XAxis>Top</XAxis>
                  <YAxis>Left</YAxis>
                  <ColourArgb>-3479297</ColourArgb>
                  <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
                  <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
                  <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
                  <Marker>None</Marker>
                  <MarkerSize>Normal</MarkerSize>
                  <Line>Solid</Line>
                  <LineThickness>Normal</LineThickness>
                  <XFieldName>[Soil].LL15</XFieldName>
                  <YFieldName>[Soil].DepthMidPoints</YFieldName>
                  <X2FieldName>[Soil].DUL</X2FieldName>
                  <Y2FieldName>[Soil].DepthMidPoints</Y2FieldName>
                  <ShowInLegend>false</ShowInLegend>
                  <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
                  <Cumulative>false</Cumulative>
                  <CumulativeX>false</CumulativeX>
                </Series>
                <Series>
                  <Name>Air dry</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <Type>Scatter</Type>
                  <XAxis>Top</XAxis>
                  <YAxis>Left</YAxis>
                  <ColourArgb>-65536</ColourArgb>
                  <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
                  <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
                  <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
                  <Marker>None</Marker>
                  <MarkerSize>Normal</MarkerSize>
                  <Line>Solid</Line>
                  <LineThickness>Normal</LineThickness>
                  <XFieldName>[Soil].AirDry</XFieldName>
                  <YFieldName>[Soil].DepthMidPoints</YFieldName>
                  <ShowInLegend>true</ShowInLegend>
                  <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
                  <Cumulative>false</Cumulative>
                  <CumulativeX>false</CumulativeX>
                </Series>
                <Series>
                  <Name>LL15</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <Type>Scatter</Type>
                  <XAxis>Top</XAxis>
                  <YAxis>Left</YAxis>
                  <ColourArgb>-16711681</ColourArgb>
                  <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
                  <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
                  <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
                  <Marker>None</Marker>
                  <MarkerSize>Normal</MarkerSize>
                  <Line>Solid</Line>
                  <LineThickness>Normal</LineThickness>
                  <XFieldName>[Soil].LL15</XFieldName>
                  <YFieldName>[Soil].DepthMidPoints</YFieldName>
                  <ShowInLegend>true</ShowInLegend>
                  <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
                  <Cumulative>false</Cumulative>
                  <CumulativeX>false</CumulativeX>
                </Series>
                <Series>
                  <Name>DUL</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <Type>Scatter</Type>
                  <XAxis>Top</XAxis>
                  <YAxis>Left</YAxis>
                  <ColourArgb>-16776961</ColourArgb>
                  <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
                  <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
                  <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
                  <Marker>None</Marker>
                  <MarkerSize>Normal</MarkerSize>
                  <Line>Solid</Line>
                  <LineThickness>Normal</LineThickness>
                  <XFieldName>[Soil].DUL</XFieldName>
                  <YFieldName>[Soil].DepthMidPoints</YFieldName>
                  <ShowInLegend>true</ShowInLegend>
                  <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
                  <Cumulative>false</Cumulative>
                  <CumulativeX>false</CumulativeX>
                </Series>
                <Series>
                  <Name>SAT</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <Type>Scatter</Type>
                  <XAxis>Top</XAxis>
                  <YAxis>Left</YAxis>
                  <ColourArgb>-16760704</ColourArgb>
                  <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
                  <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
                  <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
                  <Marker>None</Marker>
                  <MarkerSize>Normal</MarkerSize>
                  <Line>Solid</Line>
                  <LineThickness>Normal</LineThickness>
                  <XFieldName>[Soil].SAT</XFieldName>
                  <YFieldName>[Soil].DepthMidPoints</YFieldName>
                  <ShowInLegend>true</ShowInLegend>
                  <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
                  <Cumulative>false</Cumulative>
                  <CumulativeX>false</CumulativeX>
                </Series>
                <Series>
                  <Name>LL15</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <Type>Scatter</Type>
                  <XAxis>Top</XAxis>
                  <YAxis>Left</YAxis>
                  <ColourArgb>-32768</ColourArgb>
                  <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
                  <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
                  <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
                  <Marker>None</Marker>
                  <MarkerSize>Normal</MarkerSize>
                  <Line>Solid</Line>
                  <LineThickness>Normal</LineThickness>
                  <XFieldName>[Soil].LL15</XFieldName>
                  <YFieldName>[Soil]l.DepthMidPoints</YFieldName>
                  <ShowInLegend>false</ShowInLegend>
                  <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
                  <Cumulative>false</Cumulative>
                  <CumulativeX>false</CumulativeX>
                </Series>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Axis>
                  <Type>Left</Type>
                  <Title>Depth (mm)</Title>
                  <Inverted>true</Inverted>
                  <Minimum>NaN</Minimum>
                  <Maximum>NaN</Maximum>
                  <Interval>NaN</Interval>
                </Axis>
                <Axis>
                  <Type>Top</Type>
                  <Title>Volumetric water (mm/mm)</Title>
                  <Inverted>false</Inverted>
                  <Minimum>NaN</Minimum>
                  <Maximum>NaN</Maximum>
                  <Interval>NaN</Interval>
                </Axis>
                <LegendPosition>BottomRight</LegendPosition>
                <DisabledSeries />
              </Graph>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <RecordNumber>0</RecordNumber>
              <SoilType />
              <Site />
              <NearestTown />
              <Region />
              <NaturalVegetation />
              <Latitude>0</Latitude>
              <Longitude>0</Longitude>
            </Soil>
            <Report>
              <Name>AgPastureDeepSoilTest</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ExperimentFactorNames />
              <ExperimentFactorValues />
              <VariableNames>
                <string>[Clock].Today as Date</string>
                <string>sum([TempletonABlock].SoilNitrogen.NO3) as NO3</string>
                <string>sum([TempletonABlock].SoilWater.SWmm) as SWDep</string>
                <string>[Rye1].AboveGroundWt</string>
                <string>[Rye2].AboveGroundWt</string>
                <string>[Rye1].HarvestedWt</string>
                <string>[Rye2].HarvestedWt</string>
                <string>([Rye1].HarvestedWt + [Rye2].HarvestedWt) as Yield</string>
                <string>[PropRye1].Script.PropYieldRye1 as PropYieldRye1</string>
                <string>([Fertiliser].NitrogenApplied-( 10.0 * [CutRotation].Script.NReturnedInUrine)) as RealFert</string>
                <string>[Rye2].RootDepth</string>
              </VariableNames>
              <EventNames>
                <string>[Clock].EndOfDay</string>
              </EventNames>
            </Report>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <Area>1</Area>
            <Slope>0</Slope>
          </Zone>
          <IncludeInDocumentation>true</IncludeInDocumentation>
        </Simulation>
        <IncludeInDocumentation>true</IncludeInDocumentation>
      </Experiment>
      <IncludeInDocumentation>true</IncludeInDocumentation>
      <ShowPageOfGraphs>true</ShowPageOfGraphs>
    </Folder>
    <Folder>
      <Name>AgPasture Shallow Soil Test</Name>
      <Memo>
        <Name>Memo AgPastureShallowSoilTest</Name>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <MemoText><![CDATA[This series of simulations is as for “AgPasture Deep Soil Test” but substituting a soil with a lower soil water storage - 60 mm to 750 mm deep.  The graphs of the simulations with equal ryegrasses are not repeated but the standing herbage from the equal ryegrass simulations are shown as a reference on the first two graphs.  

Under conditions of no irrigation or fertiliser the differences between Rye1 and Rye2 are intensified under the shallow soil compared to the earlier simulations with the deep soil.  The proportion of the total yield from Rye1 is greater in the shallow than the deep soil but still reaches a maximum of 0.67.  The dominance of Rye1 seems limited by the couple of months (in winter) at the beginning of the simulation in which the shallow-rooted Rye2 is not much constrained by its shallow root depth.
]]></MemoText>
      </Memo>
      <Graph>
        <Name>StandingHerbage UnequalIrrigFert</Name>
        <Series>
          <Name>Rye1</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureShallowSoilTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Rye1.AboveGroundWt</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Factor] = 'UnequalIrrigFert'</Filter>
        </Series>
        <Series>
          <Name>Rye2</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16777216</ColourArgb>
          <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureShallowSoilTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Rye2.AboveGroundWt</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Factor] = 'UnequalIrrigFert'</Filter>
        </Series>
        <Series>
          <Name>RyeEqualForReference</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-3376729</ColourArgb>
          <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureShallowSoilTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Rye1.AboveGroundWt</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Factor] = 'EqualIrrigFert'</Filter>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>StandingHerbage UnequalDryNofert</Name>
        <Series>
          <Name>Rye1</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureShallowSoilTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Rye1.AboveGroundWt</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Factor] = 'UnequalDryNofert'</Filter>
        </Series>
        <Series>
          <Name>Rye2</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16777216</ColourArgb>
          <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureShallowSoilTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Rye2.AboveGroundWt</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Factor] = 'UnequalDryNofert'</Filter>
        </Series>
        <Series>
          <Name>RyeEqualForReference</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-3376729</ColourArgb>
          <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureShallowSoilTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Rye1.AboveGroundWt</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Factor] = 'EqualDryNofert'</Filter>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>Yield</Name>
        <Series>
          <Name>Yield</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Right</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureShallowSoilTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Yield</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Right</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>PropRye1</Name>
        <Series>
          <Name>PropRye1</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>0</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>0</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureShallowSoilTest</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>PropYieldRye1</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>0.45</Minimum>
          <Maximum>0.75</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Experiment>
        <Name>Experiment</Name>
        <Factors>
          <Name>Factors</Name>
          <Factor>
            <Name>Factor</Name>
            <Factor>
              <Name>EqualIrrigFert</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Specifications>
                <string>[OnOffFertiliser].Script.FertOn = 1</string>
                <string>[OnOffIrrigation].Script.IrrigOn = 1</string>
              </Specifications>
            </Factor>
            <Factor>
              <Name>EqualDryNofert</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Specifications>
                <string>[OnOffFertiliser].Script.FertOn = 0</string>
                <string>[OnOffIrrigation].Script.IrrigOn = 0</string>
              </Specifications>
            </Factor>
            <Factor>
              <Name>UnequalIrrigFert</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Specifications>
                <string>[OnOffFertiliser].Script.FertOn = 1</string>
                <string>[OnOffIrrigation].Script.IrrigOn = 1</string>
                <string>[Rye2].RootDepthMaximum = 150</string>
                <string>[Rye2].InitialRootDepth = 150</string>
              </Specifications>
            </Factor>
            <Factor>
              <Name>UnequalDryNofert</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Specifications>
                <string>[OnOffFertiliser].Script.FertOn = 0</string>
                <string>[OnOffIrrigation].Script.IrrigOn = 0</string>
                <string>[Rye2].RootDepthMaximum = 150</string>
                <string>[Rye2].InitialRootDepth = 150</string>
              </Specifications>
            </Factor>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <Specifications />
          </Factor>
          <IncludeInDocumentation>true</IncludeInDocumentation>
        </Factors>
        <Simulation>
          <Name>AgPastureShallowSoilTest</Name>
          <Clock>
            <Name>Clock</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <StartDate>1971-07-01T00:00:00</StartDate>
            <EndDate>1972-06-30T00:00:00</EndDate>
          </Clock>
          <Weather>
            <Name>Weather</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <FileName>%root%\Examples\WeatherFiles\lincoln.met</FileName>
            <ExcelWorkSheetName />
          </Weather>
          <Summary>
            <Name>Summary</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </Summary>
          <SoilArbitrator>
            <Name>SoilArbitrator</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </SoilArbitrator>
          <Zone>
            <Name>Field</Name>
            <Folder>
              <Name>Managers</Name>
              <Manager>
                <Name>OnOffFertiliser</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <AllowFertiliser>yes</AllowFertiliser>
                  <FertOn>1</FertOn>
                  <Depth2SoilN>200</Depth2SoilN>
                  <CriticalSoilN>15</CriticalSoilN>
                  <FertNAmount>25</FertNAmount>
                  <FertType>UreaN</FertType>
                  <FertApplicationDepth>1</FertApplicationDepth>
                  <FertMinimumDays>14</FertMinimumDays>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using APSIM.Shared.Utilities;
using System.Xml.Serialization;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		[Link] Soil Soil;

		//User inputs from properties tab
		[Description("Turn fertiliser applications on? ")]
		public yesnoType AllowFertiliser { get; set; }
		
		[Description("Temporary variable to turn fertiliser on (1) or off (0): ")] public int FertOn { get; set; }

		[Description("Depth to calculate available soil N (mm): ")]
		public double Depth2SoilN { get; set; }

		[Description("Minimum available N, triggers an application (kgN/ha): ")]
		public double CriticalSoilN { get; set; }

		[Description("Amount of N fertiliser for each application (kgN/ha): ")]
		public double FertNAmount { get; set; }

		[Description("Type of N fertiliser to apply: ")]
		public Fertiliser.Types FertType { get; set; }

		[Description("Depth at which to apply the fertiliser (mm): ")]
		public double FertApplicationDepth { get; set; }
	   
		[Description("Minimum period between applications (days): ")]
		public double FertMinimumDays { get; set; }
	   
		public enum yesnoType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		[XmlIgnore] public double TopMineralN { get; set; }
		
		private DateTime lastApplicationDate;
		private bool fertiliserIsAllowed;
		private int nLayers;

		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{
			fertiliserIsAllowed = (AllowFertiliser == yesnoType.yes);
			nLayers = Soil.SoilWater.Thickness.Length;
		}

		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			double daysSinceLastApplication = (Clock.Today - lastApplicationDate).TotalDays;
			
			// get the N stored in the soil
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopMineralN = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (Depth2SoilN - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopMineralN += (Soil.SoilNitrogen.NO3[layer]
				+ Soil.SoilNitrogen.NH4[layer]
				+ Soil.SoilNitrogen.urea[layer])
				* fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= Depth2SoilN)
					layer = nLayers;
			}

			if (fertiliserIsAllowed && (daysSinceLastApplication >= FertMinimumDays) && (TopMineralN <= CriticalSoilN))
			{
				fertiliser.Apply(FertNAmount * FertOn, FertType, FertApplicationDepth);
				lastApplicationDate = Clock.Today;
			}
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>OnOffIrrigation</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <allowIrrigation>yes</allowIrrigation>
                  <IrrigOn>1</IrrigOn>
                  <seasonStart>15-Aug</seasonStart>
                  <seasonEnd>30-May</seasonEnd>
                  <seasonsAllocation>10000</seasonsAllocation>
                  <triggerDeficit>75</triggerDeficit>
                  <targetDeficit>99</targetDeficit>
                  <returndays>1</returndays>
                  <maximumAmount>30</maximumAmount>
                  <depthPAWC>300</depthPAWC>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using System.Xml.Serialization;
using Models.PMF;
using APSIM.Shared.Utilities;

        
namespace Models
{
	[Serializable] 
	[System.Xml.Serialization.XmlInclude(typeof(Model))]
	public class Script : Model
	{
		//Communication to other modules
		[Link] ISummary summary = null;
		[Link] Irrigation Irrigation;
		[Link] Clock Clock;
		[Link] Soil Soil;
		[Link(IsOptional = true)] ICrop existingCrop;
	   
		//User inputs from properties tab
		[Description("Turn irrigation on?")]
		public answerType allowIrrigation { get; set; }
		
		[Description("Temporary variable to turn fertiliser on (1) or off (0): ")] public int IrrigOn { get; set; }


		[Description("Start of irrigation season (dd-MMM)")]
		public string seasonStart { get; set; }
		[Description("End of irrigation season (dd-MMM)")]
		public string seasonEnd { get; set; }
		[Description("Season allocation (mm)")]
		public double seasonsAllocation { get; set; }
		[Description("Deficit to trigger irrigation (% PAWC)")]
		public double triggerDeficit { get; set; }
		[Description("Deficit to stop irrigaton (% PAWC)")]
		public double targetDeficit { get; set; }
		[Description("Minimum days for irrigation to return")]
		public double returndays { get; set; }
		[Description("Maximum irrigation application (mm/day)")]
		public double maximumAmount { get; set; }
		[Description("Depth to calculate PAWC (mm)")]
		public double depthPAWC { get; set; }
	   
		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		//Class members
		[XmlIgnore] public double TopSWdeficit { get; set; }
		[XmlIgnore] public double TopSWC { get; set; }
		[XmlIgnore] public double DaysSinceIrrigation { get; set; }
		[XmlIgnore] public double AmountToApply { get; set; }
		[XmlIgnore] public double SeasonAppliedAmount { get; set; }
		
		private bool IrrigationIsAllowed { get; set; }
		private bool SeasonIsOpen { get; set; }
		private bool CropIsActive { get; set; }
		private bool IrrigatorIsAvailable { get; set; }
		private bool SoilIsDry { get; set; }

		private DateTime StartDate;
		private DateTime EndDate;
		private double TopDUL;
		private double TopLL;
		private int nLayers;
	
		//Calculate static soil variables
		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{   
			//Set the season dates
			StartDate = DateTime.Parse(seasonStart + "-" + Clock.Today.Year.ToString());
			EndDate = DateTime.Parse(seasonEnd + "-" + Clock.Today.Year.ToString());
			
			//Can we irrigate at all?
			IrrigationIsAllowed = false; 
			if (allowIrrigation == answerType.yes)
				IrrigationIsAllowed = true; 

			//Calculate soil water variables
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			nLayers = Soil.SoilWater.Thickness.Length;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopLL += Soil.SoilWater.LL15mm[layer] * fracLayer;
				TopDUL += Soil.SoilWater.DULmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
		}
	   	  
		//Determine daily requirement for irrigation
		[EventSubscribe("StartOfDay")]
		private void OnStartOfDay(object sender, EventArgs e)
		{
			//Can we irrigate today?		  
			SeasonIsOpen = isBetween(Clock.Today, StartDate, EndDate);

			//Is there a crop in the ground that needs irrigation?
			CropIsActive = false;
			if ((existingCrop != null) && (existingCrop.IsAlive))
				CropIsActive = true;
	      
			//Is the irrigator available?
			IrrigatorIsAvailable = false;
			DaysSinceIrrigation += 1;
			if (DaysSinceIrrigation >= returndays)
				IrrigatorIsAvailable = true;
	      
			//Is the soil dry enough to require irrigation?
			SoilIsDry = false;
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopSWC = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			//for (int layer = 0; depthFromSurface < depthPAWC + Soil.SoilWater.Thickness[layer]; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopSWC += Soil.SoilWater.SWmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
			
			TopSWdeficit = TopSWC - TopDUL;
			if (Math.Max(0.0, -TopSWdeficit) >= (TopDUL - TopLL) * (100 - triggerDeficit) / 100)
				SoilIsDry = true;
	            
			//Are all the conditions ratifying irrigation
			if (IrrigationIsAllowed && SeasonIsOpen && CropIsActive && IrrigatorIsAvailable && SoilIsDry)
			{
				//Lets bloody well irrigate then!!!!
				AmountToApply = TopDUL * targetDeficit / 100 - TopSWC;
				AmountToApply = Math.Max(0.0, Math.Min(AmountToApply, seasonsAllocation - SeasonAppliedAmount));
				Irrigation.Apply(AmountToApply * IrrigOn);
				DaysSinceIrrigation = 0;
				SeasonAppliedAmount += AmountToApply;
			}
		}
		
		///Checks whether theDate is between iniDate and endDate (non-year specific)
		private bool isBetween(DateTime theDay, DateTime iniDate, DateTime endDate)
		{
			bool result = false;
			if (iniDate.DayOfYear < endDate.DayOfYear)
			{
				// period is within one year, ex: summer in the northern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) && (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			else
			{
				// period goes over the end of the year, ex: summer in the southern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) || (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			
			return result;
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>CutRotation</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <rotationAllowed>True</rotationAllowed>
                  <CutRotationStartDate>1900-07-01</CutRotationStartDate>
                  <CutRotationEndDate>2100-12-31</CutRotationEndDate>
                  <CutInterval>21</CutInterval>
                  <IntervalType>FixedInterval</IntervalType>
                  <DurationOfCut>1</DurationOfCut>
                  <RemoveAmountType>ResidualDM</RemoveAmountType>
                  <AmountGiven>1000</AmountGiven>
                  <DMRemoveType>RemoveAll</DMRemoveType>
                  <FractionN2Remove>1</FractionN2Remove>
                  <ProportionN2Dung>0</ProportionN2Dung>
                </Script>
                <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Do the grazing/cutting?: ")] public bool rotationAllowed { get; set; }
		[Description("Date to begin the rotation: ")] public DateTime CutRotationStartDate { get; set; }
		[Description("Date to finish the rotation: ")] public DateTime CutRotationEndDate { get; set; }
		[Description("Rotation interval (days): ")] public int CutInterval { get; set; }
		[Description("How the interval is defined: ")] public rotationIntervalTypes IntervalType { get; set; }
		[Description("Duration of each event (days): ")] public int DurationOfCut { get; set; }
		[Description("What amount is being defined: ")] public removeAmountTypes RemoveAmountType { get; set; }
		[Description("Amount to use (kg/ha): ")] public double AmountGiven { get; set; }
		[Description("Fraction of DM that is removed from the field:")] public removeDMTypes DMRemoveType { get; set; }
		[Description("Fraction of N that is removed from the field (0-1):")] public double FractionN2Remove { get; set; }
		[Description("Proportion of N returned in dung (0-1):")] public double ProportionN2Dung { get; set; }

		// - Outputs from this manager
		[XmlIgnore][Units("g/m2")] public double DefoliatedWt { get; set; }
		// Description: Pasture DM defoliated today
		[XmlIgnore][Units("g/m2")] public double DefoliatedN { get; set; }
		// Description: Pasture N defoliate today
		[XmlIgnore][Units("g/m2")] public double HarvestedWt { get; set; }
		// Description: Pasture DM harvested today
		[XmlIgnore][Units("g/m2")] public double HarvestedN { get; set; }
		// Description: Pasture N harvested today
		[XmlIgnore][Units("g/m2")] public double RemovedWt { get; set; }
		// Description: Pasture DM removed from the field
		[XmlIgnore][Units("g/m2")] public double RemovedN { get; set; }
		// Description: Pasture N removed from the field
		[XmlIgnore][Units("g/m2")] public double ReturnedWt { get; set; }
		// Description: Residue DM returned to the field
		[XmlIgnore][Units("g/m2")] public double ReturnedN { get; set; }
		// Description: Residue N returned to the field
		[XmlIgnore][Units("g/m2")] public double NReturnedInDung { get; set; }
		// Description: Harvested N returned as dung (SurfaceOM)
		[XmlIgnore][Units("g/m2")] public double NReturnedInUrine { get; set; }
		// Description: Harvested N returned as urine (urea)
		[XmlIgnore][Units("day")] public int DaysAfterCut { get; set; }
		// Description: Number of days after last defoliation
		[XmlIgnore][Units("g/m2")] public double PreHarvestDM { get; set; }
		// Description: Total standing DM (Leaf + Stem/Sheath) before cut
		[XmlIgnore][Units("g/m2")] public double PostHarvestDM { get; set; }
		// Description: Total standing DM (Leaf + Stem/Sheath) after cut
		
		// - Internal variables
		// fraction of harvested Dm to actually remove from field
		private double fractionDM2Remove = 1.0;
		// flag whether defoliation is allowed
		//private bool rotationAllowed = true;
		// number of days for each defoliation event
		private int cuttingDuration = 0;
		// counter for day within each defoliation
		private int daysCutting = 0;
		// type of interval (Fixed or target)
		private string intervalType;
		// total herbage to remove in g/m2 per day
		private double herbageToRemove;
		// type of DM amount (ResidualDM or DMToRemove)
		private string amountType;
		// auxiliary flag for defoliation
		private bool aCutHasHappened = false;

		// - Event to add residue or dung to surface OM
		public event BiomassRemovedDelegate BiomassRemoved;

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				Pasture.Add(species);
			}

			// reset variables
			DaysAfterCut = 0;
			resetVariables();
			cuttingDuration = DurationOfCut;
			
			// get the type of amount given
			if (RemoveAmountType == removeAmountTypes.ResidualDM)
				amountType = "SetResidueAmount";
			else
				amountType = "SetRemoveAmount";

			// get the type of amount given
			if (IntervalType == rotationIntervalTypes.FixedInterval)
				intervalType = "Fixed";
			else
				intervalType = "Target";

			// make sure that rotation starts when startDate < simulationStartDay
			if ((Clock.Today > CutRotationStartDate) && (Clock.Today < CutRotationEndDate))
				CutRotationStartDate = Clock.Today;
		}
		
		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			if (rotationAllowed)
			{
				if (Clock.Today == CutRotationStartDate)
					DaysAfterCut = CutInterval;

				bool SwardIsAlive = false;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				{
					if (species.IsAlive)
						SwardIsAlive = true;
				}
				
				// Check whether we can defoliate
				if ((Clock.Today >= CutRotationStartDate) && (Clock.Today <= CutRotationEndDate) && (SwardIsAlive))
				{
					// Check whether we should start a defoliation
					if (DaysAfterCut >= (CutInterval - 1))
					{
						Graze(AmountGiven, amountType, DurationOfCut);
					}
				}
			}

			// Check whether we need to continue cutting
			if ((daysCutting > 0) && (daysCutting < cuttingDuration))
			{
				// reset outputs
				resetVariables();

				removeDM(herbageToRemove);
				returnExcreta();
				daysCutting += 1;
				if (daysCutting == cuttingDuration)
				{
					PostHarvestDM = 0.0;
					foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
						PostHarvestDM += species.StandingHerbageWt;
				}
			}

			// reset outputs
			if (daysCutting < 0)
			{
				resetVariables();
				daysCutting = 0;
			}
		}

		[EventSubscribe("DoManagementCalculations")]
		private void OnDoManagementCalculations(object sender, EventArgs e)
		{
			// Check whether a cutting has finished
			if (daysCutting == cuttingDuration)
			{
				aCutHasHappened = true;
				daysCutting = -1;
			}

			// Increase the counter for days after cutting
			if (aCutHasHappened && (daysCutting == 0))
				DaysAfterCut += 1;
		}

		public enum removeAmountTypes
		{
			/// <summary>Setting DM amount to remove</summary>
			DMToRemove,
			/// <summary>Setting residual DM amount</summary>
			ResidualDM
		}

		public enum rotationIntervalTypes
		{
			/// <summary>Setting a fixed interval</summary>
			FixedInterval,
			/// <summary>Setting a target (minimum) inteval</summary>
			TargetInterval
		}

		public enum removeDMTypes
		{
			/// <summary>Remove all DM</summary>
			RemoveAll,
			/// <summary>Remove no DM</summary>
			RemoveNone,
			/// <summary>Remove a fraction based on digestibility</summary>
			BasedOnDigestibility
		}

		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}
		
				
		// Resets the values of all outputs
		private void resetVariables()
		{
			DefoliatedWt = 0.0;
			DefoliatedN = 0.0;
			HarvestedWt = 0.0;
			HarvestedN = 0.0;
			RemovedWt = 0.0;
			RemovedN = 0.0;
			ReturnedWt = 0.0;
			ReturnedN = 0.0;
			NReturnedInDung = 0.0;
			NReturnedInUrine = 0.0;
		}

		// Description: Perform the basic calculations for defoliation
		public void Graze(double amountDM, string amountType, int duration)
		{
			// Get the existing plant amount
			PreHarvestDM = 0.0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				PreHarvestDM += species.StandingHerbageWt;
			
			// Check the amount to remove and print some info
			if ((amountType == "SetRemoveAmount") && (PreHarvestDM >= amountDM / duration))
			{
				summary.WriteMessage(this, "   Defoliating " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = amountDM / duration;
			}
			else if ((amountType == "SetResidueAmount") && (PreHarvestDM >= amountDM))
			{
				summary.WriteMessage(this, "   Defoliating down to approximately " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = (PreHarvestDM - amountDM) / duration;
			}
			else
			{
				summary.WriteMessage(this, "   Defoliation will not happend because there is not enough plant material");
				if (intervalType == "Fixed")
					DaysAfterCut = -duration;
				return;
			}

			cuttingDuration = duration;
			// Preform first defoliation
			removeDM(herbageToRemove);
			returnExcreta();
			daysCutting = 1;
			DaysAfterCut = 0;
			if (daysCutting == cuttingDuration)
			{
				PostHarvestDM = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					PostHarvestDM += species.StandingHerbageWt;
			}
		}

		// Do the DM removal
		private void removeDM(double removeAmount)
		{
			double existingWt = 0.0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				existingWt += species.HarvestableWt;


			// Check whether we harvest anything
			if (existingWt >= removeAmount)
			{
				foreach (AgPasture.PastureSpecies species in Pasture)
				{
					double amountToRemove = removeAmount * species.HarvestableWt / existingWt;
					species.Graze(amount: amountToRemove, type: "SetRemoveAmount");
				}
				
				// get total harvested
				DefoliatedWt = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					DefoliatedWt += species.HarvestedWt;
				DefoliatedN = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					DefoliatedN += species.HarvestedN;
				HarvestedWt = DefoliatedWt;
				HarvestedN = DefoliatedN;

				// get amounts actually removed from field and that to be returned (dung/urine)
				if (DMRemoveType == removeDMTypes.RemoveAll)
					fractionDM2Remove = 1.0;
				else if (DMRemoveType == removeDMTypes.RemoveNone)
					fractionDM2Remove = 0.0;
				else
				{
					fractionDM2Remove = 0.0;
					foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
						fractionDM2Remove += species.HarvestedDigestibility * species.HarvestedWt;
					fractionDM2Remove /= removeAmount;
				}
				
				RemovedWt = HarvestedWt * fractionDM2Remove;
				RemovedN = HarvestedN * FractionN2Remove;
				ReturnedWt = HarvestedWt - RemovedWt;
				ReturnedN = HarvestedN - RemovedN;
				NReturnedInDung = ReturnedN * ProportionN2Dung;
				NReturnedInUrine = ReturnedN - NReturnedInDung;
			}
		}

		// Return dung and urine
		private void returnExcreta()
		{
			if ((ReturnedWt > 0.0) || (NReturnedInDung > 0.0))
			{
				PMF.BiomassRemovedType BiomassDung = new PMF.BiomassRemovedType();
				string[] type = new string[] { "RuminantDung_PastureFed" };
				float[] dltdm = new float[] { (Single)ReturnedWt };
				float[] dltn = new float[] { (Single)NReturnedInDung };
				float[] dltp = new float[] { 0 };
				float[] fraction = new float[] { 1 };     // fraction is always 1.0 here

				BiomassDung.crop_type = "RuminantDung_PastureFed";
				BiomassDung.dm_type = type;
				BiomassDung.dlt_crop_dm = dltdm;
				BiomassDung.dlt_dm_n = dltn;
				BiomassDung.dlt_dm_p = dltp;
				BiomassDung.fraction_to_residue = fraction;
				BiomassRemoved.Invoke(BiomassDung);
			}

			if (NReturnedInUrine > 0.0)
			{
				fertiliser.Apply(NReturnedInUrine * 10, Fertiliser.Types.UreaN, 1.0);
			}
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>PropRye1</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script />
                <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager

		// - Outputs from this manager
		[XmlIgnore][Units("kg/kg")] public double PropYieldRye1 { get; set; }
		[XmlIgnore][Units("kg/ha")] public double YieldRye1 { get; set; }
		[XmlIgnore][Units("kg/ha")] public double YieldRye2 { get; set; }
		
		// - Internal variables
		//private double fractionDM2Remove = 1.0;

		// - Event to add residue or dung to surface OM
		//public event BiomassRemovedDelegate BiomassRemoved;

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				Pasture.Add(species);
			}
			YieldRye1 = 0.0;
			YieldRye2 = 0.0;
			PropYieldRye1 = 0.0;
		}
		


		[EventSubscribe("DoManagementCalculations")]
		private void OnDoManagementCalculations(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				//Pasture.Add(species);
			}
			YieldRye1 += Pasture[0].HarvestedWt;
			YieldRye2 += Pasture[1].HarvestedWt;
			if ((YieldRye1 + YieldRye2) > 0.0)
				PropYieldRye1 = YieldRye1 / (YieldRye1 + YieldRye2);
		}

	}
}
]]></Code>
              </Manager>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ShowPageOfGraphs>true</ShowPageOfGraphs>
            </Folder>
            <MicroClimate>
              <Name>MicroClimate</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <a_interception>0</a_interception>
              <b_interception>0</b_interception>
              <c_interception>0</c_interception>
              <d_interception>0</d_interception>
              <soil_albedo>0.23</soil_albedo>
              <sun_angle>15</sun_angle>
              <soil_heat_flux_fraction>0.4</soil_heat_flux_fraction>
              <night_interception_fraction>0.5</night_interception_fraction>
              <refheight>2</refheight>
              <albedo>0.29366217672824863</albedo>
              <emissivity>0.96</emissivity>
              <RadIntTotal>0</RadIntTotal>
            </MicroClimate>
            <Irrigation>
              <Name>Irrigation</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Irrigation>
            <Fertiliser>
              <Name>Fertiliser</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Fertiliser>
            <SurfaceOrganicMatter>
              <Name>SurfaceOrganicMatter</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ReportAdditions>no</ReportAdditions>
              <ReportRemovals>no</ReportRemovals>
              <ResidueTypes>
                <Name>ResidueTypes</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LoadFromResource>ResidueTypes</LoadFromResource>
              </ResidueTypes>
              <TillageTypes>
                <Name>TillageTypesList</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <TillageType />
              </TillageTypes>
              <Pools>
                <Pool>
                  <PoolName>Sward</PoolName>
                  <ResidueType>grass</ResidueType>
                  <Mass>1000</Mass>
                  <CNRatio>15</CNRatio>
                  <CPRatio>NaN</CPRatio>
                  <StandingFraction>0</StandingFraction>
                </Pool>
              </Pools>
              <PoolName>Sward</PoolName>
              <type>grass</type>
              <mass>1000</mass>
              <standing_fraction>0</standing_fraction>
              <cpr />
              <cnr>15</cnr>
              <CriticalResidueWeight>2000</CriticalResidueWeight>
              <OptimumDecompTemp>20</OptimumDecompTemp>
              <MaxCumulativeEOS>20</MaxCumulativeEOS>
              <CNRatioDecompCoeff>0.277</CNRatioDecompCoeff>
              <CNRatioDecompThreshold>25</CNRatioDecompThreshold>
              <TotalLeachRain>25</TotalLeachRain>
              <MinRainToLeach>10</MinRainToLeach>
              <CriticalMinimumOrganicC>0.004</CriticalMinimumOrganicC>
              <DefaultCPRatio>0</DefaultCPRatio>
              <DefaultStandingFraction>0</DefaultStandingFraction>
              <StandingExtinctCoeff>0.5</StandingExtinctCoeff>
              <FractionFaecesAdded>0.5</FractionFaecesAdded>
            </SurfaceOrganicMatter>
            <SoluteManager>
              <Name>SoluteManager</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </SoluteManager>
            <PastureSpecies>
              <Name>Rye1</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <MaximumNUptake>10</MaximumNUptake>
              <Albedo>0.26</Albedo>
              <Gsmax>0.011</Gsmax>
              <R50>200</R50>
              <SpeciesFamily>Grass</SpeciesFamily>
              <PhotosyntheticPathway>C3</PhotosyntheticPathway>
              <InitialShootDM>750</InitialShootDM>
              <InitialRootDM>450</InitialRootDM>
              <InitialRootDepth>750</InitialRootDepth>
              <ReferencePhotosyntheticRate>1</ReferencePhotosyntheticRate>
              <LightExtinctionCoefficient>0.5</LightExtinctionCoefficient>
              <GrowthTminimum>1</GrowthTminimum>
              <GrowthToptimum>20</GrowthToptimum>
              <GrowthTEffectExponent>1.7</GrowthTEffectExponent>
              <UseHeatStressFactor>yes</UseHeatStressFactor>
              <HeatOnsetTemperature>28</HeatOnsetTemperature>
              <HeatFullTemperature>35</HeatFullTemperature>
              <HeatRecoverySumDD>30</HeatRecoverySumDD>
              <HeatRecoveryTReference>25</HeatRecoveryTReference>
              <UseColdStressFactor>yes</UseColdStressFactor>
              <ColdOnsetTemperature>1</ColdOnsetTemperature>
              <ColdFullTemperature>-5</ColdFullTemperature>
              <ColdRecoverySumDD>25</ColdRecoverySumDD>
              <ColdRecoveryTReference>0</ColdRecoveryTReference>
              <MaintenanceRespirationCoefficient>0.03</MaintenanceRespirationCoefficient>
              <GrowthRespirationCoefficient>0.25</GrowthRespirationCoefficient>
              <RespirationTReference>20</RespirationTReference>
              <RespirationExponent>1.5</RespirationExponent>
              <NThresholdsForLeaves>
                <double>0.04</double>
                <double>0.012</double>
                <double>0.05</double>
              </NThresholdsForLeaves>
              <NThresholdsForStems>
                <double>0.02</double>
                <double>0.006</double>
                <double>0.025</double>
              </NThresholdsForStems>
              <NThresholdsForStolons>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </NThresholdsForStolons>
              <NThresholdsForRoots>
                <double>0.02</double>
                <double>0.006</double>
                <double>0.025</double>
              </NThresholdsForRoots>
              <DegreesDayForGermination>125</DegreesDayForGermination>
              <TargetShootRootRatio>4</TargetShootRootRatio>
              <MaxRootAllocation>0.25</MaxRootAllocation>
              <ShootRootGlfFactor>0.5</ShootRootGlfFactor>
              <UseReproSeasonFactor>yes</UseReproSeasonFactor>
              <ReproSeasonReferenceLatitude>41</ReproSeasonReferenceLatitude>
              <ReproSeasonTimingCoeff>0.14</ReproSeasonTimingCoeff>
              <ReproSeasonMaxAllocationIncrease>0.5</ReproSeasonMaxAllocationIncrease>
              <ReproSeasonAllocationCoeff>0.1</ReproSeasonAllocationCoeff>
              <FractionLeafMaximum>0.7</FractionLeafMaximum>
              <FractionLeafMinimum>0.7</FractionLeafMinimum>
              <FractionLeafDMThreshold>500</FractionLeafDMThreshold>
              <FractionLeafDMFactor>2000</FractionLeafDMFactor>
              <FractionLeafExponent>3</FractionLeafExponent>
              <FractionToStolon>0</FractionToStolon>
              <SpecificLeafArea>25</SpecificLeafArea>
              <SpecificRootLength>100</SpecificRootLength>
              <StolonEffectOnLAI>0</StolonEffectOnLAI>
              <ShootMaxEffectOnLAI>1000</ShootMaxEffectOnLAI>
              <MaxStemEffectOnLAI>1</MaxStemEffectOnLAI>
              <LiveLeavesPerTiller>3</LiveLeavesPerTiller>
              <TissueTurnoverRateShoot>0.05</TissueTurnoverRateShoot>
              <TissueTurnoverRateRoot>0.02</TissueTurnoverRateRoot>
              <DetachmentRateShoot>0.08</DetachmentRateShoot>
              <TurnoverTemperatureMin>2</TurnoverTemperatureMin>
              <TurnoverTemperatureRef>20</TurnoverTemperatureRef>
              <TurnoverTemperatureExponent>1</TurnoverTemperatureExponent>
              <TurnoverDroughtEffectMax>1</TurnoverDroughtEffectMax>
              <TurnoverDroughtThreshold>0.5</TurnoverDroughtThreshold>
              <TurnoverDefoliationCoefficient>0.5</TurnoverDefoliationCoefficient>
              <TurnoverDefoliationRootEffect>0.1</TurnoverDefoliationRootEffect>
              <FractionNLuxuryRemobilisable>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </FractionNLuxuryRemobilisable>
              <MinimumNFixation>0</MinimumNFixation>
              <MaximumNFixation>0</MaximumNFixation>
              <SoilSaturationEffectMax>0.1</SoilSaturationEffectMax>
              <MinimumWaterFreePorosity>-1</MinimumWaterFreePorosity>
              <SoilSaturationRecoveryFactor>0.25</SoilSaturationRecoveryFactor>
              <NDillutionCoefficient>0.25</NDillutionCoefficient>
              <GlfGeneric>1</GlfGeneric>
              <GlfSoilFertility>1</GlfSoilFertility>
              <PlantHeightMinimum>350</PlantHeightMinimum>
              <PlantHeightMaximum>350</PlantHeightMaximum>
              <PlantHeightMassForMax>10000</PlantHeightMassForMax>
              <PlantHeightExponent>2.8</PlantHeightExponent>
              <RootDepthMinimum>50</RootDepthMinimum>
              <RootDepthMaximum>750</RootDepthMaximum>
              <RootElongationRate>25</RootElongationRate>
              <RootDistributionDepthParam>90</RootDistributionDepthParam>
              <RootDistributionExponent>3.2</RootDistributionExponent>
              <DigestibilitiesCellWall>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.2</double>
              </DigestibilitiesCellWall>
              <MinimumGreenWt>100</MinimumGreenWt>
              <FractionStolonStanding>0</FractionStolonStanding>
              <PreferenceForGreenOverDead>1</PreferenceForGreenOverDead>
              <PreferenceForLeafOverStems>1</PreferenceForLeafOverStems>
              <WaterAvailableMethod>DefaultAPSIM</WaterAvailableMethod>
              <NitrogenAvailableMethod>BasicAgPasture</NitrogenAvailableMethod>
            </PastureSpecies>
            <PastureSpecies>
              <Name>Rye2</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <MaximumNUptake>10</MaximumNUptake>
              <Albedo>0.26</Albedo>
              <Gsmax>0.011</Gsmax>
              <R50>200</R50>
              <SpeciesFamily>Grass</SpeciesFamily>
              <PhotosyntheticPathway>C3</PhotosyntheticPathway>
              <InitialShootDM>750</InitialShootDM>
              <InitialRootDM>450</InitialRootDM>
              <InitialRootDepth>750</InitialRootDepth>
              <ReferencePhotosyntheticRate>1</ReferencePhotosyntheticRate>
              <LightExtinctionCoefficient>0.5</LightExtinctionCoefficient>
              <GrowthTminimum>1</GrowthTminimum>
              <GrowthToptimum>20</GrowthToptimum>
              <GrowthTEffectExponent>1.7</GrowthTEffectExponent>
              <UseHeatStressFactor>yes</UseHeatStressFactor>
              <HeatOnsetTemperature>28</HeatOnsetTemperature>
              <HeatFullTemperature>35</HeatFullTemperature>
              <HeatRecoverySumDD>30</HeatRecoverySumDD>
              <HeatRecoveryTReference>25</HeatRecoveryTReference>
              <UseColdStressFactor>yes</UseColdStressFactor>
              <ColdOnsetTemperature>1</ColdOnsetTemperature>
              <ColdFullTemperature>-5</ColdFullTemperature>
              <ColdRecoverySumDD>25</ColdRecoverySumDD>
              <ColdRecoveryTReference>0</ColdRecoveryTReference>
              <MaintenanceRespirationCoefficient>0.03</MaintenanceRespirationCoefficient>
              <GrowthRespirationCoefficient>0.25</GrowthRespirationCoefficient>
              <RespirationTReference>20</RespirationTReference>
              <RespirationExponent>1.5</RespirationExponent>
              <NThresholdsForLeaves>
                <double>0.04</double>
                <double>0.012</double>
                <double>0.05</double>
              </NThresholdsForLeaves>
              <NThresholdsForStems>
                <double>0.02</double>
                <double>0.006</double>
                <double>0.025</double>
              </NThresholdsForStems>
              <NThresholdsForStolons>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </NThresholdsForStolons>
              <NThresholdsForRoots>
                <double>0.02</double>
                <double>0.006</double>
                <double>0.025</double>
              </NThresholdsForRoots>
              <DegreesDayForGermination>125</DegreesDayForGermination>
              <TargetShootRootRatio>4</TargetShootRootRatio>
              <MaxRootAllocation>0.25</MaxRootAllocation>
              <ShootRootGlfFactor>0.5</ShootRootGlfFactor>
              <UseReproSeasonFactor>yes</UseReproSeasonFactor>
              <ReproSeasonReferenceLatitude>41</ReproSeasonReferenceLatitude>
              <ReproSeasonTimingCoeff>0.14</ReproSeasonTimingCoeff>
              <ReproSeasonMaxAllocationIncrease>0.5</ReproSeasonMaxAllocationIncrease>
              <ReproSeasonAllocationCoeff>0.1</ReproSeasonAllocationCoeff>
              <FractionLeafMaximum>0.7</FractionLeafMaximum>
              <FractionLeafMinimum>0.7</FractionLeafMinimum>
              <FractionLeafDMThreshold>500</FractionLeafDMThreshold>
              <FractionLeafDMFactor>2000</FractionLeafDMFactor>
              <FractionLeafExponent>3</FractionLeafExponent>
              <FractionToStolon>0</FractionToStolon>
              <SpecificLeafArea>25</SpecificLeafArea>
              <SpecificRootLength>100</SpecificRootLength>
              <StolonEffectOnLAI>0</StolonEffectOnLAI>
              <ShootMaxEffectOnLAI>1000</ShootMaxEffectOnLAI>
              <MaxStemEffectOnLAI>1</MaxStemEffectOnLAI>
              <LiveLeavesPerTiller>3</LiveLeavesPerTiller>
              <TissueTurnoverRateShoot>0.05</TissueTurnoverRateShoot>
              <TissueTurnoverRateRoot>0.02</TissueTurnoverRateRoot>
              <DetachmentRateShoot>0.08</DetachmentRateShoot>
              <TurnoverTemperatureMin>2</TurnoverTemperatureMin>
              <TurnoverTemperatureRef>20</TurnoverTemperatureRef>
              <TurnoverTemperatureExponent>1</TurnoverTemperatureExponent>
              <TurnoverDroughtEffectMax>1</TurnoverDroughtEffectMax>
              <TurnoverDroughtThreshold>0.5</TurnoverDroughtThreshold>
              <TurnoverDefoliationCoefficient>0.5</TurnoverDefoliationCoefficient>
              <TurnoverDefoliationRootEffect>0.1</TurnoverDefoliationRootEffect>
              <FractionNLuxuryRemobilisable>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </FractionNLuxuryRemobilisable>
              <MinimumNFixation>0</MinimumNFixation>
              <MaximumNFixation>0</MaximumNFixation>
              <SoilSaturationEffectMax>0.1</SoilSaturationEffectMax>
              <MinimumWaterFreePorosity>-1</MinimumWaterFreePorosity>
              <SoilSaturationRecoveryFactor>0.25</SoilSaturationRecoveryFactor>
              <NDillutionCoefficient>0.25</NDillutionCoefficient>
              <GlfGeneric>1</GlfGeneric>
              <GlfSoilFertility>1</GlfSoilFertility>
              <PlantHeightMinimum>350</PlantHeightMinimum>
              <PlantHeightMaximum>350</PlantHeightMaximum>
              <PlantHeightMassForMax>10000</PlantHeightMassForMax>
              <PlantHeightExponent>2.8</PlantHeightExponent>
              <RootDepthMinimum>50</RootDepthMinimum>
              <RootDepthMaximum>750</RootDepthMaximum>
              <RootElongationRate>25</RootElongationRate>
              <RootDistributionDepthParam>90</RootDistributionDepthParam>
              <RootDistributionExponent>3.2</RootDistributionExponent>
              <DigestibilitiesCellWall>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.2</double>
              </DigestibilitiesCellWall>
              <MinimumGreenWt>100</MinimumGreenWt>
              <FractionStolonStanding>0</FractionStolonStanding>
              <PreferenceForGreenOverDead>1</PreferenceForGreenOverDead>
              <PreferenceForLeafOverStems>1</PreferenceForLeafOverStems>
              <WaterAvailableMethod>DefaultAPSIM</WaterAvailableMethod>
              <NitrogenAvailableMethod>BasicAgPasture</NitrogenAvailableMethod>
            </PastureSpecies>
            <Soil>
              <Name>ShallowSoil</Name>
              <Analysis>
                <Name>Analysis</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>200</double>
                  <double>150</double>
                  <double>250</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <Rocks>
                  <double>0</double>
                  <double>0</double>
                  <double>10</double>
                  <double>40</double>
                  <double>60</double>
                  <double>70</double>
                  <double>70</double>
                </Rocks>
                <Texture />
                <MunsellColour />
                <PH>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                </PH>
                <CEC>
                  <double>12.5</double>
                  <double>10</double>
                  <double>9</double>
                  <double>5</double>
                  <double>4</double>
                  <double>4</double>
                  <double>4</double>
                </CEC>
                <ParticleSizeSand>
                  <double>15</double>
                  <double>20</double>
                  <double>25</double>
                  <double>35</double>
                  <double>40</double>
                  <double>40</double>
                  <double>40</double>
                </ParticleSizeSand>
                <ParticleSizeSilt>
                  <double>65</double>
                  <double>65</double>
                  <double>63</double>
                  <double>57</double>
                  <double>54</double>
                  <double>55</double>
                  <double>55</double>
                </ParticleSizeSilt>
                <ParticleSizeClay>
                  <double>20</double>
                  <double>15</double>
                  <double>12</double>
                  <double>8</double>
                  <double>6</double>
                  <double>5</double>
                  <double>5</double>
                </ParticleSizeClay>
                <PHUnits>Water</PHUnits>
                <BoronUnits>HotWater</BoronUnits>
              </Analysis>
              <Water>
                <Name>Water</Name>
                <SoilCrop>
                  <Name>SwardSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.15</double>
                    <double>0.14</double>
                    <double>0.06</double>
                    <double>0.02</double>
                    <double>0.01</double>
                    <double>0.01</double>
                    <double>0.01</double>
                  </LL>
                  <KL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.04</double>
                    <double>0.01</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>RyegrassSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.15</double>
                    <double>0.14</double>
                    <double>0.06</double>
                    <double>0.02</double>
                    <double>0.01</double>
                    <double>0.01</double>
                    <double>0.01</double>
                  </LL>
                  <KL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.04</double>
                    <double>0.01</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>WhiteCloverSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.15</double>
                    <double>0.14</double>
                    <double>0.06</double>
                    <double>0.02</double>
                    <double>0.01</double>
                    <double>0.01</double>
                    <double>0.01</double>
                  </LL>
                  <KL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.04</double>
                    <double>0.01</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>Slurp1Soil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.15</double>
                    <double>0.14</double>
                    <double>0.06</double>
                    <double>0.02</double>
                    <double>0.01</double>
                    <double>0.01</double>
                    <double>0.01</double>
                  </LL>
                  <KL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.04</double>
                    <double>0.01</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>Slurp2Soil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.15</double>
                    <double>0.14</double>
                    <double>0.06</double>
                    <double>0.02</double>
                    <double>0.01</double>
                    <double>0.01</double>
                    <double>0.01</double>
                  </LL>
                  <KL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.04</double>
                    <double>0.01</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>Rye1Soil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.15</double>
                    <double>0.14</double>
                    <double>0.06</double>
                    <double>0.02</double>
                    <double>0.01</double>
                    <double>0.01</double>
                    <double>0.01</double>
                  </LL>
                  <KL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.04</double>
                    <double>0.01</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>Rye2Soil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.15</double>
                    <double>0.14</double>
                    <double>0.06</double>
                    <double>0.02</double>
                    <double>0.01</double>
                    <double>0.01</double>
                    <double>0.01</double>
                  </LL>
                  <KL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.04</double>
                    <double>0.01</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>200</double>
                  <double>150</double>
                  <double>250</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <BD>
                  <double>1.3</double>
                  <double>1.35</double>
                  <double>1</double>
                  <double>0.53</double>
                  <double>0.31</double>
                  <double>0.3</double>
                  <double>0.3</double>
                </BD>
                <AirDry>
                  <double>0.05</double>
                  <double>0.12</double>
                  <double>0.055</double>
                  <double>0.015</double>
                  <double>0.01</double>
                  <double>0.01</double>
                  <double>0.01</double>
                </AirDry>
                <LL15>
                  <double>0.15</double>
                  <double>0.14</double>
                  <double>0.055</double>
                  <double>0.015</double>
                  <double>0.01</double>
                  <double>0.01</double>
                  <double>0.01</double>
                </LL15>
                <DUL>
                  <double>0.25</double>
                  <double>0.22</double>
                  <double>0.15</double>
                  <double>0.05</double>
                  <double>0.03</double>
                  <double>0.03</double>
                  <double>0.03</double>
                </DUL>
                <SAT>
                  <double>0.45</double>
                  <double>0.43</double>
                  <double>0.25</double>
                  <double>0.15</double>
                  <double>0.11</double>
                  <double>0.11</double>
                  <double>0.11</double>
                </SAT>
                <KS>
                  <double>5000</double>
                  <double>2500</double>
                  <double>3000</double>
                  <double>10000</double>
                  <double>17500</double>
                  <double>20000</double>
                  <double>20000</double>
                </KS>
              </Water>
              <SoilWater>
                <Name>SoilWater</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <SummerDate>1-Nov</SummerDate>
                <SummerU>6</SummerU>
                <SummerCona>3.5</SummerCona>
                <WinterDate>1-apr</WinterDate>
                <WinterU>2</WinterU>
                <WinterCona>2</WinterCona>
                <DiffusConst>88</DiffusConst>
                <DiffusSlope>35</DiffusSlope>
                <Salb>0.13</Salb>
                <CN2Bare>73</CN2Bare>
                <CNRed>20</CNRed>
                <CNCov>0.8</CNCov>
                <slope>0</slope>
                <discharge_width>0</discharge_width>
                <catchment_area>0</catchment_area>
                <max_pond>0</max_pond>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>200</double>
                  <double>150</double>
                  <double>250</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <SWCON>
                  <double>0.5</double>
                  <double>0.52</double>
                  <double>0.55</double>
                  <double>0.6</double>
                  <double>0.65</double>
                  <double>0.65</double>
                  <double>0.65</double>
                </SWCON>
                <KLAT>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </KLAT>
                <residueinterception>0</residueinterception>
              </SoilWater>
              <SoilNitrogen>
                <Name>SoilNitrogen</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <fom_type>
                  <string>default</string>
                  <string>manure</string>
                  <string>mucuna</string>
                  <string>lablab</string>
                  <string>shemp</string>
                  <string>stable</string>
                </fom_type>
                <fract_carb>
                  <double>0.2</double>
                  <double>0.3</double>
                  <double>0.54</double>
                  <double>0.57</double>
                  <double>0.45</double>
                  <double>0</double>
                </fract_carb>
                <fract_cell>
                  <double>0.7</double>
                  <double>0.3</double>
                  <double>0.37</double>
                  <double>0.37</double>
                  <double>0.47</double>
                  <double>0.1</double>
                </fract_cell>
                <fract_lign>
                  <double>0.1</double>
                  <double>0.4</double>
                  <double>0.09</double>
                  <double>0.06</double>
                  <double>0.08</double>
                  <double>0.9</double>
                </fract_lign>
                <wfpsN2N2O_x>
                  <double>22</double>
                  <double>88</double>
                </wfpsN2N2O_x>
                <wfpsN2N2O_y>
                  <double>0.1</double>
                  <double>1</double>
                </wfpsN2N2O_y>
                <oc>
                  <double>3.7136764881329496</double>
                  <double>2.4698281813043792</double>
                  <double>1.2383961716086014</double>
                  <double>0.49836009167083023</double>
                  <double>0.25025052330473485</double>
                  <double>0.15035274660681502</double>
                  <double>0.10019396267774858</double>
                </oc>
              </SoilNitrogen>
              <SoilOrganicMatter>
                <Name>SoilOrganicMatter</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <RootCN>40</RootCN>
                <RootWt>1000</RootWt>
                <SoilCN>12</SoilCN>
                <EnrACoeff>7.4</EnrACoeff>
                <EnrBCoeff>0.2</EnrBCoeff>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>200</double>
                  <double>150</double>
                  <double>250</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <Depth>
                  <string>0-15</string>
                  <string>15-30</string>
                  <string>30-50</string>
                  <string>50-65</string>
                  <string>65-90</string>
                  <string>90-120</string>
                  <string>120-150</string>
                </Depth>
                <OC>
                  <double>3</double>
                  <double>1</double>
                  <double>0.6</double>
                  <double>0.4</double>
                  <double>0.25</double>
                  <double>0.15</double>
                  <double>0.1</double>
                </OC>
                <FBiom>
                  <double>0.04</double>
                  <double>0.02</double>
                  <double>0.02</double>
                  <double>0.01</double>
                  <double>0.01</double>
                  <double>0</double>
                  <double>0</double>
                </FBiom>
                <FInert>
                  <double>0.5</double>
                  <double>0.7</double>
                  <double>0.83</double>
                  <double>0.9</double>
                  <double>0.95</double>
                  <double>0.99</double>
                  <double>0.99</double>
                </FInert>
                <OCUnits>Total</OCUnits>
              </SoilOrganicMatter>
              <InitialWater>
                <Name>Initial water</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <PercentMethod>EvenlyDistributed</PercentMethod>
                <FractionFull>0.95</FractionFull>
                <DepthWetSoil>NaN</DepthWetSoil>
              </InitialWater>
              <Sample>
                <Name>Initial nitrogen</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>200</double>
                  <double>150</double>
                  <double>250</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <NO3>
                  <double>50</double>
                  <double>50</double>
                  <double>50</double>
                  <double>50</double>
                  <double>50</double>
                  <double>50</double>
                  <double>50</double>
                </NO3>
                <NH4>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </NH4>
                <NO3Units>ppm</NO3Units>
                <NH4Units>ppm</NH4Units>
                <SWUnits>Volumetric</SWUnits>
                <OCUnits>Total</OCUnits>
                <PHUnits>Water</PHUnits>
              </Sample>
              <CERESSoilTemperature>
                <Name>CERESSoilTemperature</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
              </CERESSoilTemperature>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <RecordNumber>0</RecordNumber>
              <SoilType>NZ_Sedimentary</SoilType>
              <LocalName>Lismore</LocalName>
              <Site>Winchmore</Site>
              <NearestTown>Ashburton</NearestTown>
              <Region>Canterbury</Region>
              <Country>New Zealand</Country>
              <NaturalVegetation />
              <Latitude>-48.48</Latitude>
              <Longitude>0</Longitude>
            </Soil>
            <Report>
              <Name>AgPastureShallowSoilTest</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ExperimentFactorNames />
              <ExperimentFactorValues />
              <VariableNames>
                <string>[Clock].Today as Date</string>
                <string>sum([ShallowSoil].SoilNitrogen.NO3) as NO3</string>
                <string>sum([ShallowSoil].SoilWater.SWmm) as SWDep</string>
                <string>[Rye1].AboveGroundWt</string>
                <string>[Rye2].AboveGroundWt</string>
                <string>[Rye1].HarvestedWt</string>
                <string>[Rye2].HarvestedWt</string>
                <string>([Rye1].HarvestedWt + [Rye2].HarvestedWt) as Yield</string>
                <string>[PropRye1].Script.PropYieldRye1 as PropYieldRye1</string>
                <string>([Fertiliser].NitrogenApplied-( 10.0 * [CutRotation].Script.NReturnedInUrine)) as RealFert</string>
                <string>[Rye2].RootDepth</string>
              </VariableNames>
              <EventNames>
                <string>[Clock].EndOfDay</string>
              </EventNames>
            </Report>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <Area>1</Area>
            <Slope>0</Slope>
          </Zone>
          <IncludeInDocumentation>true</IncludeInDocumentation>
        </Simulation>
        <IncludeInDocumentation>true</IncludeInDocumentation>
      </Experiment>
      <IncludeInDocumentation>true</IncludeInDocumentation>
      <ShowPageOfGraphs>true</ShowPageOfGraphs>
    </Folder>
    <Folder>
      <Name>AgPasture Test Root Depth Differential</Name>
      <Memo>
        <Name>Memo AgPastureTestRootDepthDifferential</Name>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <MemoText><![CDATA[This series of simulations is as for “AgPasture Deep Soil Test” but applying a range of rooting depths to Rye2 while leaving Rye1 at a rooting depth of 750 mm.  The simulations use a soil with 132 mm of PAW to 750 mm deep in the Lincoln environment and are not fertilised or irrigated. 

Total yield (first graph) again shows the small yield penalty as the root systems become more unequal.  Against this trend the total yield (Rye1 + Rye2) when Rye2 has a 100 mm rooting depth is slightly higher (~ 50 kg DM /ha or < 1 % of the total yield) than when Rye2 has a rooting depth of 225 mm.  The most likely explanation is that of less competition effect from the shallowest-rooting Rye2.  The proportion of the total yield arising from the deeper-rooted Rye1 (second graph) ranges from 0.5 for the equal root depth scenario to 0.7 for the scenario with the shallowest Rye2.  Graphs 3 and 4 show the cumulative harvested yield from each of the grasses – the patterns are sensible given the changes in rooting depth.

The final two graphs show the degree of water stress (1 is no stress) in December and January for each of the grasses.  As the root depth of Rye2 decreases, water stress in Rye1 shows a slower onset and a reduction in magnitude.  Again, these patterns meet expectations.
]]></MemoText>
      </Memo>
      <Graph>
        <Name>Yield</Name>
        <Series>
          <Name>Yield</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Right</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureTestRootDepthDifferential</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Yield</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Right</Type>
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>PropRye1</Name>
        <Series>
          <Name>PropRye1</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>0</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>0</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureTestRootDepthDifferential</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>PropYieldRye1</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>YieldRye1</Name>
        <Series>
          <Name>Yield</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Right</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureTestRootDepthDifferential</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Rye1.HarvestedWt</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Right</Type>
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>4500</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>YieldRye2</Name>
        <Series>
          <Name>Yield</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Right</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureTestRootDepthDifferential</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Rye2.HarvestedWt</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Right</Type>
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>4500</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>WaterStressRye1</Name>
        <Series>
          <Name>WaterStressRye1</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureTestRootDepthDifferential</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Rye1.GlfWaterSupply</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Clock.Today.Month] IN (12, 1)</Filter>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>WaterStressRye2</Name>
        <Series>
          <Name>WaterStressRye2</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>AgPastureTestRootDepthDifferential</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Rye2.GlfWaterSupply</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Clock.Today.Month] IN (12, 1)</Filter>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Experiment>
        <Name>Experiment</Name>
        <Factors>
          <Name>Factors</Name>
          <Factor>
            <Name>Factor</Name>
            <Factor>
              <Name>750mm</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Specifications>
                <string>[OnOffFertiliser].Script.FertOn = 0</string>
                <string>[OnOffIrrigation].Script.IrrigOn = 0</string>
                <string>[Rye2].RootDepthMaximum = 750</string>
                <string>[Rye2].InitialRootDepth = 750</string>
              </Specifications>
            </Factor>
            <Factor>
              <Name>500mm</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Specifications>
                <string>[OnOffFertiliser].Script.FertOn = 0</string>
                <string>[OnOffIrrigation].Script.IrrigOn = 0</string>
                <string>[Rye2].RootDepthMaximum = 500</string>
                <string>[Rye2].InitialRootDepth = 500</string>
              </Specifications>
            </Factor>
            <Factor>
              <Name>350mm</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Specifications>
                <string>[OnOffFertiliser].Script.FertOn = 0</string>
                <string>[OnOffIrrigation].Script.IrrigOn = 0</string>
                <string>[Rye2].RootDepthMaximum = 350</string>
                <string>[Rye2].InitialRootDepth = 350</string>
              </Specifications>
            </Factor>
            <Factor>
              <Name>225mm</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Specifications>
                <string>[OnOffFertiliser].Script.FertOn = 0</string>
                <string>[OnOffIrrigation].Script.IrrigOn = 0</string>
                <string>[Rye2].RootDepthMaximum = 225</string>
                <string>[Rye2].InitialRootDepth = 225</string>
              </Specifications>
            </Factor>
            <Factor>
              <Name>100mm</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Specifications>
                <string>[OnOffFertiliser].Script.FertOn = 0</string>
                <string>[OnOffIrrigation].Script.IrrigOn = 0</string>
                <string>[Rye2].RootDepthMaximum = 100</string>
                <string>[Rye2].InitialRootDepth = 100</string>
              </Specifications>
            </Factor>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <Specifications />
          </Factor>
          <IncludeInDocumentation>true</IncludeInDocumentation>
        </Factors>
        <Simulation>
          <Name>AgPastureTestRootDepthDifferential</Name>
          <Clock>
            <Name>Clock</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <StartDate>1971-07-01T00:00:00</StartDate>
            <EndDate>1972-06-30T00:00:00</EndDate>
          </Clock>
          <Weather>
            <Name>Weather</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <FileName>%root%\Examples\WeatherFiles\lincoln.met</FileName>
            <ExcelWorkSheetName />
          </Weather>
          <Summary>
            <Name>Summary</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </Summary>
          <SoilArbitrator>
            <Name>SoilArbitrator</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </SoilArbitrator>
          <Zone>
            <Name>Field</Name>
            <Folder>
              <Name>Managers</Name>
              <Manager>
                <Name>OnOffFertiliser</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <AllowFertiliser>yes</AllowFertiliser>
                  <FertOn>1</FertOn>
                  <Depth2SoilN>200</Depth2SoilN>
                  <CriticalSoilN>15</CriticalSoilN>
                  <FertNAmount>25</FertNAmount>
                  <FertType>UreaN</FertType>
                  <FertApplicationDepth>1</FertApplicationDepth>
                  <FertMinimumDays>14</FertMinimumDays>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using APSIM.Shared.Utilities;
using System.Xml.Serialization;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		[Link] Soil Soil;

		//User inputs from properties tab
		[Description("Turn fertiliser applications on? ")]
		public yesnoType AllowFertiliser { get; set; }
		
		[Description("Temporary variable to turn fertiliser on (1) or off (0): ")] public int FertOn { get; set; }

		[Description("Depth to calculate available soil N (mm): ")]
		public double Depth2SoilN { get; set; }

		[Description("Minimum available N, triggers an application (kgN/ha): ")]
		public double CriticalSoilN { get; set; }

		[Description("Amount of N fertiliser for each application (kgN/ha): ")]
		public double FertNAmount { get; set; }

		[Description("Type of N fertiliser to apply: ")]
		public Fertiliser.Types FertType { get; set; }

		[Description("Depth at which to apply the fertiliser (mm): ")]
		public double FertApplicationDepth { get; set; }
	   
		[Description("Minimum period between applications (days): ")]
		public double FertMinimumDays { get; set; }
	   
		public enum yesnoType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		[XmlIgnore] public double TopMineralN { get; set; }
		
		private DateTime lastApplicationDate;
		private bool fertiliserIsAllowed;
		private int nLayers;

		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{
			fertiliserIsAllowed = (AllowFertiliser == yesnoType.yes);
			nLayers = Soil.SoilWater.Thickness.Length;
		}

		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			double daysSinceLastApplication = (Clock.Today - lastApplicationDate).TotalDays;
			
			// get the N stored in the soil
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopMineralN = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (Depth2SoilN - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopMineralN += (Soil.SoilNitrogen.NO3[layer]
				+ Soil.SoilNitrogen.NH4[layer]
				+ Soil.SoilNitrogen.urea[layer])
				* fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= Depth2SoilN)
					layer = nLayers;
			}

			if (fertiliserIsAllowed && (daysSinceLastApplication >= FertMinimumDays) && (TopMineralN <= CriticalSoilN))
			{
				fertiliser.Apply(FertNAmount * FertOn, FertType, FertApplicationDepth);
				lastApplicationDate = Clock.Today;
			}
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>OnOffIrrigation</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <allowIrrigation>yes</allowIrrigation>
                  <IrrigOn>1</IrrigOn>
                  <seasonStart>15-Aug</seasonStart>
                  <seasonEnd>30-May</seasonEnd>
                  <seasonsAllocation>10000</seasonsAllocation>
                  <triggerDeficit>75</triggerDeficit>
                  <targetDeficit>99</targetDeficit>
                  <returndays>1</returndays>
                  <maximumAmount>30</maximumAmount>
                  <depthPAWC>300</depthPAWC>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using System.Xml.Serialization;
using Models.PMF;
using APSIM.Shared.Utilities;

        
namespace Models
{
	[Serializable] 
	[System.Xml.Serialization.XmlInclude(typeof(Model))]
	public class Script : Model
	{
		//Communication to other modules
		[Link] ISummary summary = null;
		[Link] Irrigation Irrigation;
		[Link] Clock Clock;
		[Link] Soil Soil;
		[Link(IsOptional = true)] ICrop existingCrop;
	   
		//User inputs from properties tab
		[Description("Turn irrigation on?")]
		public answerType allowIrrigation { get; set; }
		
		[Description("Temporary variable to turn fertiliser on (1) or off (0): ")] public int IrrigOn { get; set; }


		[Description("Start of irrigation season (dd-MMM)")]
		public string seasonStart { get; set; }
		[Description("End of irrigation season (dd-MMM)")]
		public string seasonEnd { get; set; }
		[Description("Season allocation (mm)")]
		public double seasonsAllocation { get; set; }
		[Description("Deficit to trigger irrigation (% PAWC)")]
		public double triggerDeficit { get; set; }
		[Description("Deficit to stop irrigaton (% PAWC)")]
		public double targetDeficit { get; set; }
		[Description("Minimum days for irrigation to return")]
		public double returndays { get; set; }
		[Description("Maximum irrigation application (mm/day)")]
		public double maximumAmount { get; set; }
		[Description("Depth to calculate PAWC (mm)")]
		public double depthPAWC { get; set; }
	   
		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		//Class members
		[XmlIgnore] public double TopSWdeficit { get; set; }
		[XmlIgnore] public double TopSWC { get; set; }
		[XmlIgnore] public double DaysSinceIrrigation { get; set; }
		[XmlIgnore] public double AmountToApply { get; set; }
		[XmlIgnore] public double SeasonAppliedAmount { get; set; }
		
		private bool IrrigationIsAllowed { get; set; }
		private bool SeasonIsOpen { get; set; }
		private bool CropIsActive { get; set; }
		private bool IrrigatorIsAvailable { get; set; }
		private bool SoilIsDry { get; set; }

		private DateTime StartDate;
		private DateTime EndDate;
		private double TopDUL;
		private double TopLL;
		private int nLayers;
	
		//Calculate static soil variables
		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{   
			//Set the season dates
			StartDate = DateTime.Parse(seasonStart + "-" + Clock.Today.Year.ToString());
			EndDate = DateTime.Parse(seasonEnd + "-" + Clock.Today.Year.ToString());
			
			//Can we irrigate at all?
			IrrigationIsAllowed = false; 
			if (allowIrrigation == answerType.yes)
				IrrigationIsAllowed = true; 

			//Calculate soil water variables
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			nLayers = Soil.SoilWater.Thickness.Length;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopLL += Soil.SoilWater.LL15mm[layer] * fracLayer;
				TopDUL += Soil.SoilWater.DULmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
		}
	   	  
		//Determine daily requirement for irrigation
		[EventSubscribe("StartOfDay")]
		private void OnStartOfDay(object sender, EventArgs e)
		{
			//Can we irrigate today?		  
			SeasonIsOpen = isBetween(Clock.Today, StartDate, EndDate);

			//Is there a crop in the ground that needs irrigation?
			CropIsActive = false;
			if ((existingCrop != null) && (existingCrop.IsAlive))
				CropIsActive = true;
	      
			//Is the irrigator available?
			IrrigatorIsAvailable = false;
			DaysSinceIrrigation += 1;
			if (DaysSinceIrrigation >= returndays)
				IrrigatorIsAvailable = true;
	      
			//Is the soil dry enough to require irrigation?
			SoilIsDry = false;
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopSWC = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			//for (int layer = 0; depthFromSurface < depthPAWC + Soil.SoilWater.Thickness[layer]; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopSWC += Soil.SoilWater.SWmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
			
			TopSWdeficit = TopSWC - TopDUL;
			if (Math.Max(0.0, -TopSWdeficit) >= (TopDUL - TopLL) * (100 - triggerDeficit) / 100)
				SoilIsDry = true;
	            
			//Are all the conditions ratifying irrigation
			if (IrrigationIsAllowed && SeasonIsOpen && CropIsActive && IrrigatorIsAvailable && SoilIsDry)
			{
				//Lets bloody well irrigate then!!!!
				AmountToApply = TopDUL * targetDeficit / 100 - TopSWC;
				AmountToApply = Math.Max(0.0, Math.Min(AmountToApply, seasonsAllocation - SeasonAppliedAmount));
				Irrigation.Apply(AmountToApply * IrrigOn);
				DaysSinceIrrigation = 0;
				SeasonAppliedAmount += AmountToApply;
			}
		}
		
		///Checks whether theDate is between iniDate and endDate (non-year specific)
		private bool isBetween(DateTime theDay, DateTime iniDate, DateTime endDate)
		{
			bool result = false;
			if (iniDate.DayOfYear < endDate.DayOfYear)
			{
				// period is within one year, ex: summer in the northern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) && (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			else
			{
				// period goes over the end of the year, ex: summer in the southern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) || (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			
			return result;
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>CutRotation</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <rotationAllowed>True</rotationAllowed>
                  <CutRotationStartDate>1900-07-01</CutRotationStartDate>
                  <CutRotationEndDate>2100-12-31</CutRotationEndDate>
                  <CutInterval>21</CutInterval>
                  <IntervalType>FixedInterval</IntervalType>
                  <DurationOfCut>1</DurationOfCut>
                  <RemoveAmountType>ResidualDM</RemoveAmountType>
                  <AmountGiven>1000</AmountGiven>
                  <DMRemoveType>RemoveAll</DMRemoveType>
                  <FractionN2Remove>1</FractionN2Remove>
                  <ProportionN2Dung>0</ProportionN2Dung>
                </Script>
                <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Do the grazing/cutting?: ")] public bool rotationAllowed { get; set; }
		[Description("Date to begin the rotation: ")] public DateTime CutRotationStartDate { get; set; }
		[Description("Date to finish the rotation: ")] public DateTime CutRotationEndDate { get; set; }
		[Description("Rotation interval (days): ")] public int CutInterval { get; set; }
		[Description("How the interval is defined: ")] public rotationIntervalTypes IntervalType { get; set; }
		[Description("Duration of each event (days): ")] public int DurationOfCut { get; set; }
		[Description("What amount is being defined: ")] public removeAmountTypes RemoveAmountType { get; set; }
		[Description("Amount to use (kg/ha): ")] public double AmountGiven { get; set; }
		[Description("Fraction of DM that is removed from the field:")] public removeDMTypes DMRemoveType { get; set; }
		[Description("Fraction of N that is removed from the field (0-1):")] public double FractionN2Remove { get; set; }
		[Description("Proportion of N returned in dung (0-1):")] public double ProportionN2Dung { get; set; }

		// - Outputs from this manager
		[XmlIgnore][Units("g/m2")] public double DefoliatedWt { get; set; }
		// Description: Pasture DM defoliated today
		[XmlIgnore][Units("g/m2")] public double DefoliatedN { get; set; }
		// Description: Pasture N defoliate today
		[XmlIgnore][Units("g/m2")] public double HarvestedWt { get; set; }
		// Description: Pasture DM harvested today
		[XmlIgnore][Units("g/m2")] public double HarvestedN { get; set; }
		// Description: Pasture N harvested today
		[XmlIgnore][Units("g/m2")] public double RemovedWt { get; set; }
		// Description: Pasture DM removed from the field
		[XmlIgnore][Units("g/m2")] public double RemovedN { get; set; }
		// Description: Pasture N removed from the field
		[XmlIgnore][Units("g/m2")] public double ReturnedWt { get; set; }
		// Description: Residue DM returned to the field
		[XmlIgnore][Units("g/m2")] public double ReturnedN { get; set; }
		// Description: Residue N returned to the field
		[XmlIgnore][Units("g/m2")] public double NReturnedInDung { get; set; }
		// Description: Harvested N returned as dung (SurfaceOM)
		[XmlIgnore][Units("g/m2")] public double NReturnedInUrine { get; set; }
		// Description: Harvested N returned as urine (urea)
		[XmlIgnore][Units("day")] public int DaysAfterCut { get; set; }
		// Description: Number of days after last defoliation
		[XmlIgnore][Units("g/m2")] public double PreHarvestDM { get; set; }
		// Description: Total standing DM (Leaf + Stem/Sheath) before cut
		[XmlIgnore][Units("g/m2")] public double PostHarvestDM { get; set; }
		// Description: Total standing DM (Leaf + Stem/Sheath) after cut
		
		// - Internal variables
		// fraction of harvested Dm to actually remove from field
		private double fractionDM2Remove = 1.0;
		// flag whether defoliation is allowed
		//private bool rotationAllowed = true;
		// number of days for each defoliation event
		private int cuttingDuration = 0;
		// counter for day within each defoliation
		private int daysCutting = 0;
		// type of interval (Fixed or target)
		private string intervalType;
		// total herbage to remove in g/m2 per day
		private double herbageToRemove;
		// type of DM amount (ResidualDM or DMToRemove)
		private string amountType;
		// auxiliary flag for defoliation
		private bool aCutHasHappened = false;

		// - Event to add residue or dung to surface OM
		public event BiomassRemovedDelegate BiomassRemoved;

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				Pasture.Add(species);
			}

			// reset variables
			DaysAfterCut = 0;
			resetVariables();
			cuttingDuration = DurationOfCut;
			
			// get the type of amount given
			if (RemoveAmountType == removeAmountTypes.ResidualDM)
				amountType = "SetResidueAmount";
			else
				amountType = "SetRemoveAmount";

			// get the type of amount given
			if (IntervalType == rotationIntervalTypes.FixedInterval)
				intervalType = "Fixed";
			else
				intervalType = "Target";

			// make sure that rotation starts when startDate < simulationStartDay
			if ((Clock.Today > CutRotationStartDate) && (Clock.Today < CutRotationEndDate))
				CutRotationStartDate = Clock.Today;
		}
		
		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			if (rotationAllowed)
			{
				if (Clock.Today == CutRotationStartDate)
					DaysAfterCut = CutInterval;

				bool SwardIsAlive = false;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				{
					if (species.IsAlive)
						SwardIsAlive = true;
				}
				
				// Check whether we can defoliate
				if ((Clock.Today >= CutRotationStartDate) && (Clock.Today <= CutRotationEndDate) && (SwardIsAlive))
				{
					// Check whether we should start a defoliation
					if (DaysAfterCut >= (CutInterval - 1))
					{
						Graze(AmountGiven, amountType, DurationOfCut);
					}
				}
			}

			// Check whether we need to continue cutting
			if ((daysCutting > 0) && (daysCutting < cuttingDuration))
			{
				// reset outputs
				resetVariables();

				removeDM(herbageToRemove);
				returnExcreta();
				daysCutting += 1;
				if (daysCutting == cuttingDuration)
				{
					PostHarvestDM = 0.0;
					foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
						PostHarvestDM += species.StandingHerbageWt;
				}
			}

			// reset outputs
			if (daysCutting < 0)
			{
				resetVariables();
				daysCutting = 0;
			}
		}

		[EventSubscribe("DoManagementCalculations")]
		private void OnDoManagementCalculations(object sender, EventArgs e)
		{
			// Check whether a cutting has finished
			if (daysCutting == cuttingDuration)
			{
				aCutHasHappened = true;
				daysCutting = -1;
			}

			// Increase the counter for days after cutting
			if (aCutHasHappened && (daysCutting == 0))
				DaysAfterCut += 1;
		}

		public enum removeAmountTypes
		{
			/// <summary>Setting DM amount to remove</summary>
			DMToRemove,
			/// <summary>Setting residual DM amount</summary>
			ResidualDM
		}

		public enum rotationIntervalTypes
		{
			/// <summary>Setting a fixed interval</summary>
			FixedInterval,
			/// <summary>Setting a target (minimum) inteval</summary>
			TargetInterval
		}

		public enum removeDMTypes
		{
			/// <summary>Remove all DM</summary>
			RemoveAll,
			/// <summary>Remove no DM</summary>
			RemoveNone,
			/// <summary>Remove a fraction based on digestibility</summary>
			BasedOnDigestibility
		}

		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}
		
				
		// Resets the values of all outputs
		private void resetVariables()
		{
			DefoliatedWt = 0.0;
			DefoliatedN = 0.0;
			HarvestedWt = 0.0;
			HarvestedN = 0.0;
			RemovedWt = 0.0;
			RemovedN = 0.0;
			ReturnedWt = 0.0;
			ReturnedN = 0.0;
			NReturnedInDung = 0.0;
			NReturnedInUrine = 0.0;
		}

		// Description: Perform the basic calculations for defoliation
		public void Graze(double amountDM, string amountType, int duration)
		{
			// Get the existing plant amount
			PreHarvestDM = 0.0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				PreHarvestDM += species.StandingHerbageWt;
			
			// Check the amount to remove and print some info
			if ((amountType == "SetRemoveAmount") && (PreHarvestDM >= amountDM / duration))
			{
				summary.WriteMessage(this, "   Defoliating " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = amountDM / duration;
			}
			else if ((amountType == "SetResidueAmount") && (PreHarvestDM >= amountDM))
			{
				summary.WriteMessage(this, "   Defoliating down to approximately " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = (PreHarvestDM - amountDM) / duration;
			}
			else
			{
				summary.WriteMessage(this, "   Defoliation will not happend because there is not enough plant material");
				if (intervalType == "Fixed")
					DaysAfterCut = -duration;
				return;
			}

			cuttingDuration = duration;
			// Preform first defoliation
			removeDM(herbageToRemove);
			returnExcreta();
			daysCutting = 1;
			DaysAfterCut = 0;
			if (daysCutting == cuttingDuration)
			{
				PostHarvestDM = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					PostHarvestDM += species.StandingHerbageWt;
			}
		}

		// Do the DM removal
		private void removeDM(double removeAmount)
		{
			double existingWt = 0.0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				existingWt += species.HarvestableWt;


			// Check whether we harvest anything
			if (existingWt >= removeAmount)
			{
				foreach (AgPasture.PastureSpecies species in Pasture)
				{
					double amountToRemove = removeAmount * species.HarvestableWt / existingWt;
					species.Graze(amount: amountToRemove, type: "SetRemoveAmount");
				}
				
				// get total harvested
				DefoliatedWt = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					DefoliatedWt += species.HarvestedWt;
				DefoliatedN = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					DefoliatedN += species.HarvestedN;
				HarvestedWt = DefoliatedWt;
				HarvestedN = DefoliatedN;

				// get amounts actually removed from field and that to be returned (dung/urine)
				if (DMRemoveType == removeDMTypes.RemoveAll)
					fractionDM2Remove = 1.0;
				else if (DMRemoveType == removeDMTypes.RemoveNone)
					fractionDM2Remove = 0.0;
				else
				{
					fractionDM2Remove = 0.0;
					foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
						fractionDM2Remove += species.HarvestedDigestibility * species.HarvestedWt;
					fractionDM2Remove /= removeAmount;
				}
				
				RemovedWt = HarvestedWt * fractionDM2Remove;
				RemovedN = HarvestedN * FractionN2Remove;
				ReturnedWt = HarvestedWt - RemovedWt;
				ReturnedN = HarvestedN - RemovedN;
				NReturnedInDung = ReturnedN * ProportionN2Dung;
				NReturnedInUrine = ReturnedN - NReturnedInDung;
			}
		}

		// Return dung and urine
		private void returnExcreta()
		{
			if ((ReturnedWt > 0.0) || (NReturnedInDung > 0.0))
			{
				PMF.BiomassRemovedType BiomassDung = new PMF.BiomassRemovedType();
				string[] type = new string[] { "RuminantDung_PastureFed" };
				float[] dltdm = new float[] { (Single)ReturnedWt };
				float[] dltn = new float[] { (Single)NReturnedInDung };
				float[] dltp = new float[] { 0 };
				float[] fraction = new float[] { 1 };     // fraction is always 1.0 here

				BiomassDung.crop_type = "RuminantDung_PastureFed";
				BiomassDung.dm_type = type;
				BiomassDung.dlt_crop_dm = dltdm;
				BiomassDung.dlt_dm_n = dltn;
				BiomassDung.dlt_dm_p = dltp;
				BiomassDung.fraction_to_residue = fraction;
				BiomassRemoved.Invoke(BiomassDung);
			}

			if (NReturnedInUrine > 0.0)
			{
				fertiliser.Apply(NReturnedInUrine * 10, Fertiliser.Types.UreaN, 1.0);
			}
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>PropRye1</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script />
                <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager

		// - Outputs from this manager
		[XmlIgnore][Units("kg/kg")] public double PropYieldRye1 { get; set; }
		[XmlIgnore][Units("kg/ha")] public double YieldRye1 { get; set; }
		[XmlIgnore][Units("kg/ha")] public double YieldRye2 { get; set; }
		
		// - Internal variables
		//private double fractionDM2Remove = 1.0;

		// - Event to add residue or dung to surface OM
		//public event BiomassRemovedDelegate BiomassRemoved;

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				Pasture.Add(species);
			}
			YieldRye1 = 0.0;
			YieldRye2 = 0.0;
			PropYieldRye1 = 0.0;
		}
		


		[EventSubscribe("DoManagementCalculations")]
		private void OnDoManagementCalculations(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				//Pasture.Add(species);
			}
			YieldRye1 += Pasture[0].HarvestedWt;
			YieldRye2 += Pasture[1].HarvestedWt;
			if ((YieldRye1 + YieldRye2) > 0.0)
				PropYieldRye1 = YieldRye1 / (YieldRye1 + YieldRye2);
		}

	}
}
]]></Code>
              </Manager>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ShowPageOfGraphs>true</ShowPageOfGraphs>
            </Folder>
            <SurfaceOrganicMatter>
              <Name>SurfaceOrganicMatter</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ReportAdditions>no</ReportAdditions>
              <ReportRemovals>no</ReportRemovals>
              <ResidueTypes>
                <Name>ResidueTypes</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LoadFromResource>ResidueTypes</LoadFromResource>
              </ResidueTypes>
              <TillageTypes>
                <Name>TillageTypesList</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <TillageType />
              </TillageTypes>
              <Pools>
                <Pool>
                  <PoolName>Sward</PoolName>
                  <ResidueType>grass</ResidueType>
                  <Mass>1000</Mass>
                  <CNRatio>15</CNRatio>
                  <CPRatio>NaN</CPRatio>
                  <StandingFraction>0</StandingFraction>
                </Pool>
              </Pools>
              <PoolName>Sward</PoolName>
              <type>grass</type>
              <mass>1000</mass>
              <standing_fraction>0</standing_fraction>
              <cpr />
              <cnr>15</cnr>
              <CriticalResidueWeight>2000</CriticalResidueWeight>
              <OptimumDecompTemp>20</OptimumDecompTemp>
              <MaxCumulativeEOS>20</MaxCumulativeEOS>
              <CNRatioDecompCoeff>0.277</CNRatioDecompCoeff>
              <CNRatioDecompThreshold>25</CNRatioDecompThreshold>
              <TotalLeachRain>25</TotalLeachRain>
              <MinRainToLeach>10</MinRainToLeach>
              <CriticalMinimumOrganicC>0.004</CriticalMinimumOrganicC>
              <DefaultCPRatio>0</DefaultCPRatio>
              <DefaultStandingFraction>0</DefaultStandingFraction>
              <StandingExtinctCoeff>0.5</StandingExtinctCoeff>
              <FractionFaecesAdded>0.5</FractionFaecesAdded>
            </SurfaceOrganicMatter>
            <MicroClimate>
              <Name>MicroClimate</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <a_interception>0</a_interception>
              <b_interception>0</b_interception>
              <c_interception>0</c_interception>
              <d_interception>0</d_interception>
              <soil_albedo>0.23</soil_albedo>
              <sun_angle>15</sun_angle>
              <soil_heat_flux_fraction>0.4</soil_heat_flux_fraction>
              <night_interception_fraction>0.5</night_interception_fraction>
              <refheight>2</refheight>
              <albedo>0.29366217672824863</albedo>
              <emissivity>0.96</emissivity>
              <RadIntTotal>0</RadIntTotal>
            </MicroClimate>
            <Irrigation>
              <Name>Irrigation</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Irrigation>
            <Fertiliser>
              <Name>Fertiliser</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Fertiliser>
            <SoluteManager>
              <Name>SoluteManager</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </SoluteManager>
            <PastureSpecies>
              <Name>Rye1</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <MaximumNUptake>10</MaximumNUptake>
              <Albedo>0.26</Albedo>
              <Gsmax>0.011</Gsmax>
              <R50>200</R50>
              <SpeciesFamily>Grass</SpeciesFamily>
              <PhotosyntheticPathway>C3</PhotosyntheticPathway>
              <InitialShootDM>750</InitialShootDM>
              <InitialRootDM>450</InitialRootDM>
              <InitialRootDepth>750</InitialRootDepth>
              <ReferencePhotosyntheticRate>1</ReferencePhotosyntheticRate>
              <LightExtinctionCoefficient>0.5</LightExtinctionCoefficient>
              <GrowthTminimum>1</GrowthTminimum>
              <GrowthToptimum>20</GrowthToptimum>
              <GrowthTEffectExponent>1.7</GrowthTEffectExponent>
              <UseHeatStressFactor>yes</UseHeatStressFactor>
              <HeatOnsetTemperature>28</HeatOnsetTemperature>
              <HeatFullTemperature>35</HeatFullTemperature>
              <HeatRecoverySumDD>30</HeatRecoverySumDD>
              <HeatRecoveryTReference>25</HeatRecoveryTReference>
              <UseColdStressFactor>yes</UseColdStressFactor>
              <ColdOnsetTemperature>1</ColdOnsetTemperature>
              <ColdFullTemperature>-5</ColdFullTemperature>
              <ColdRecoverySumDD>25</ColdRecoverySumDD>
              <ColdRecoveryTReference>0</ColdRecoveryTReference>
              <MaintenanceRespirationCoefficient>0.03</MaintenanceRespirationCoefficient>
              <GrowthRespirationCoefficient>0.25</GrowthRespirationCoefficient>
              <RespirationTReference>20</RespirationTReference>
              <RespirationExponent>1.5</RespirationExponent>
              <NThresholdsForLeaves>
                <double>0.04</double>
                <double>0.012</double>
                <double>0.05</double>
              </NThresholdsForLeaves>
              <NThresholdsForStems>
                <double>0.02</double>
                <double>0.006</double>
                <double>0.025</double>
              </NThresholdsForStems>
              <NThresholdsForStolons>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </NThresholdsForStolons>
              <NThresholdsForRoots>
                <double>0.02</double>
                <double>0.006</double>
                <double>0.025</double>
              </NThresholdsForRoots>
              <DegreesDayForGermination>125</DegreesDayForGermination>
              <TargetShootRootRatio>4</TargetShootRootRatio>
              <MaxRootAllocation>0.25</MaxRootAllocation>
              <ShootRootGlfFactor>0.5</ShootRootGlfFactor>
              <UseReproSeasonFactor>yes</UseReproSeasonFactor>
              <ReproSeasonReferenceLatitude>41</ReproSeasonReferenceLatitude>
              <ReproSeasonTimingCoeff>0.14</ReproSeasonTimingCoeff>
              <ReproSeasonMaxAllocationIncrease>0.5</ReproSeasonMaxAllocationIncrease>
              <ReproSeasonAllocationCoeff>0.1</ReproSeasonAllocationCoeff>
              <FractionLeafMaximum>0.7</FractionLeafMaximum>
              <FractionLeafMinimum>0.7</FractionLeafMinimum>
              <FractionLeafDMThreshold>500</FractionLeafDMThreshold>
              <FractionLeafDMFactor>2000</FractionLeafDMFactor>
              <FractionLeafExponent>3</FractionLeafExponent>
              <FractionToStolon>0</FractionToStolon>
              <SpecificLeafArea>25</SpecificLeafArea>
              <SpecificRootLength>100</SpecificRootLength>
              <StolonEffectOnLAI>0</StolonEffectOnLAI>
              <ShootMaxEffectOnLAI>1000</ShootMaxEffectOnLAI>
              <MaxStemEffectOnLAI>1</MaxStemEffectOnLAI>
              <LiveLeavesPerTiller>3</LiveLeavesPerTiller>
              <TissueTurnoverRateShoot>0.05</TissueTurnoverRateShoot>
              <TissueTurnoverRateRoot>0.02</TissueTurnoverRateRoot>
              <DetachmentRateShoot>0.08</DetachmentRateShoot>
              <TurnoverTemperatureMin>2</TurnoverTemperatureMin>
              <TurnoverTemperatureRef>20</TurnoverTemperatureRef>
              <TurnoverTemperatureExponent>1</TurnoverTemperatureExponent>
              <TurnoverDroughtEffectMax>1</TurnoverDroughtEffectMax>
              <TurnoverDroughtThreshold>0.5</TurnoverDroughtThreshold>
              <TurnoverDefoliationCoefficient>0.5</TurnoverDefoliationCoefficient>
              <TurnoverDefoliationRootEffect>0.1</TurnoverDefoliationRootEffect>
              <FractionNLuxuryRemobilisable>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </FractionNLuxuryRemobilisable>
              <MinimumNFixation>0</MinimumNFixation>
              <MaximumNFixation>0</MaximumNFixation>
              <SoilSaturationEffectMax>0.1</SoilSaturationEffectMax>
              <MinimumWaterFreePorosity>-1</MinimumWaterFreePorosity>
              <SoilSaturationRecoveryFactor>0.25</SoilSaturationRecoveryFactor>
              <NDillutionCoefficient>0.25</NDillutionCoefficient>
              <GlfGeneric>1</GlfGeneric>
              <GlfSoilFertility>1</GlfSoilFertility>
              <PlantHeightMinimum>350</PlantHeightMinimum>
              <PlantHeightMaximum>350</PlantHeightMaximum>
              <PlantHeightMassForMax>10000</PlantHeightMassForMax>
              <PlantHeightExponent>2.8</PlantHeightExponent>
              <RootDepthMinimum>50</RootDepthMinimum>
              <RootDepthMaximum>750</RootDepthMaximum>
              <RootElongationRate>25</RootElongationRate>
              <RootDistributionDepthParam>90</RootDistributionDepthParam>
              <RootDistributionExponent>3.2</RootDistributionExponent>
              <DigestibilitiesCellWall>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.2</double>
              </DigestibilitiesCellWall>
              <MinimumGreenWt>100</MinimumGreenWt>
              <FractionStolonStanding>0</FractionStolonStanding>
              <PreferenceForGreenOverDead>1</PreferenceForGreenOverDead>
              <PreferenceForLeafOverStems>1</PreferenceForLeafOverStems>
              <WaterAvailableMethod>DefaultAPSIM</WaterAvailableMethod>
              <NitrogenAvailableMethod>BasicAgPasture</NitrogenAvailableMethod>
            </PastureSpecies>
            <PastureSpecies>
              <Name>Rye2</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <MaximumNUptake>10</MaximumNUptake>
              <Albedo>0.26</Albedo>
              <Gsmax>0.011</Gsmax>
              <R50>200</R50>
              <SpeciesFamily>Grass</SpeciesFamily>
              <PhotosyntheticPathway>C3</PhotosyntheticPathway>
              <InitialShootDM>750</InitialShootDM>
              <InitialRootDM>450</InitialRootDM>
              <InitialRootDepth>750</InitialRootDepth>
              <ReferencePhotosyntheticRate>1</ReferencePhotosyntheticRate>
              <LightExtinctionCoefficient>0.5</LightExtinctionCoefficient>
              <GrowthTminimum>1</GrowthTminimum>
              <GrowthToptimum>20</GrowthToptimum>
              <GrowthTEffectExponent>1.7</GrowthTEffectExponent>
              <UseHeatStressFactor>yes</UseHeatStressFactor>
              <HeatOnsetTemperature>28</HeatOnsetTemperature>
              <HeatFullTemperature>35</HeatFullTemperature>
              <HeatRecoverySumDD>30</HeatRecoverySumDD>
              <HeatRecoveryTReference>25</HeatRecoveryTReference>
              <UseColdStressFactor>yes</UseColdStressFactor>
              <ColdOnsetTemperature>1</ColdOnsetTemperature>
              <ColdFullTemperature>-5</ColdFullTemperature>
              <ColdRecoverySumDD>25</ColdRecoverySumDD>
              <ColdRecoveryTReference>0</ColdRecoveryTReference>
              <MaintenanceRespirationCoefficient>0.03</MaintenanceRespirationCoefficient>
              <GrowthRespirationCoefficient>0.25</GrowthRespirationCoefficient>
              <RespirationTReference>20</RespirationTReference>
              <RespirationExponent>1.5</RespirationExponent>
              <NThresholdsForLeaves>
                <double>0.04</double>
                <double>0.012</double>
                <double>0.05</double>
              </NThresholdsForLeaves>
              <NThresholdsForStems>
                <double>0.02</double>
                <double>0.006</double>
                <double>0.025</double>
              </NThresholdsForStems>
              <NThresholdsForStolons>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </NThresholdsForStolons>
              <NThresholdsForRoots>
                <double>0.02</double>
                <double>0.006</double>
                <double>0.025</double>
              </NThresholdsForRoots>
              <DegreesDayForGermination>125</DegreesDayForGermination>
              <TargetShootRootRatio>4</TargetShootRootRatio>
              <MaxRootAllocation>0.25</MaxRootAllocation>
              <ShootRootGlfFactor>0.5</ShootRootGlfFactor>
              <UseReproSeasonFactor>yes</UseReproSeasonFactor>
              <ReproSeasonReferenceLatitude>41</ReproSeasonReferenceLatitude>
              <ReproSeasonTimingCoeff>0.14</ReproSeasonTimingCoeff>
              <ReproSeasonMaxAllocationIncrease>0.5</ReproSeasonMaxAllocationIncrease>
              <ReproSeasonAllocationCoeff>0.1</ReproSeasonAllocationCoeff>
              <FractionLeafMaximum>0.7</FractionLeafMaximum>
              <FractionLeafMinimum>0.7</FractionLeafMinimum>
              <FractionLeafDMThreshold>500</FractionLeafDMThreshold>
              <FractionLeafDMFactor>2000</FractionLeafDMFactor>
              <FractionLeafExponent>3</FractionLeafExponent>
              <FractionToStolon>0</FractionToStolon>
              <SpecificLeafArea>25</SpecificLeafArea>
              <SpecificRootLength>100</SpecificRootLength>
              <StolonEffectOnLAI>0</StolonEffectOnLAI>
              <ShootMaxEffectOnLAI>1000</ShootMaxEffectOnLAI>
              <MaxStemEffectOnLAI>1</MaxStemEffectOnLAI>
              <LiveLeavesPerTiller>3</LiveLeavesPerTiller>
              <TissueTurnoverRateShoot>0.05</TissueTurnoverRateShoot>
              <TissueTurnoverRateRoot>0.02</TissueTurnoverRateRoot>
              <DetachmentRateShoot>0.08</DetachmentRateShoot>
              <TurnoverTemperatureMin>2</TurnoverTemperatureMin>
              <TurnoverTemperatureRef>20</TurnoverTemperatureRef>
              <TurnoverTemperatureExponent>1</TurnoverTemperatureExponent>
              <TurnoverDroughtEffectMax>1</TurnoverDroughtEffectMax>
              <TurnoverDroughtThreshold>0.5</TurnoverDroughtThreshold>
              <TurnoverDefoliationCoefficient>0.5</TurnoverDefoliationCoefficient>
              <TurnoverDefoliationRootEffect>0.1</TurnoverDefoliationRootEffect>
              <FractionNLuxuryRemobilisable>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </FractionNLuxuryRemobilisable>
              <MinimumNFixation>0</MinimumNFixation>
              <MaximumNFixation>0</MaximumNFixation>
              <SoilSaturationEffectMax>0.1</SoilSaturationEffectMax>
              <MinimumWaterFreePorosity>-1</MinimumWaterFreePorosity>
              <SoilSaturationRecoveryFactor>0.25</SoilSaturationRecoveryFactor>
              <NDillutionCoefficient>0.25</NDillutionCoefficient>
              <GlfGeneric>1</GlfGeneric>
              <GlfSoilFertility>1</GlfSoilFertility>
              <PlantHeightMinimum>350</PlantHeightMinimum>
              <PlantHeightMaximum>350</PlantHeightMaximum>
              <PlantHeightMassForMax>10000</PlantHeightMassForMax>
              <PlantHeightExponent>2.8</PlantHeightExponent>
              <RootDepthMinimum>50</RootDepthMinimum>
              <RootDepthMaximum>750</RootDepthMaximum>
              <RootElongationRate>25</RootElongationRate>
              <RootDistributionDepthParam>90</RootDistributionDepthParam>
              <RootDistributionExponent>3.2</RootDistributionExponent>
              <DigestibilitiesCellWall>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.2</double>
              </DigestibilitiesCellWall>
              <MinimumGreenWt>100</MinimumGreenWt>
              <FractionStolonStanding>0</FractionStolonStanding>
              <PreferenceForGreenOverDead>1</PreferenceForGreenOverDead>
              <PreferenceForLeafOverStems>1</PreferenceForLeafOverStems>
              <WaterAvailableMethod>DefaultAPSIM</WaterAvailableMethod>
              <NitrogenAvailableMethod>BasicAgPasture</NitrogenAvailableMethod>
            </PastureSpecies>
            <Soil>
              <Name>Soil</Name>
              <Analysis>
                <Name>Analysis</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>100</double>
                  <double>200</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <PH>
                  <double>6.6</double>
                  <double>6.2</double>
                  <double>5.7</double>
                  <double>5.5</double>
                  <double>5.5</double>
                  <double>5.5</double>
                </PH>
                <PHUnits>Water</PHUnits>
                <BoronUnits>HotWater</BoronUnits>
              </Analysis>
              <InitialWater>
                <Name>Initial water</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <PercentMethod>EvenlyDistributed</PercentMethod>
                <FractionFull>1</FractionFull>
                <DepthWetSoil>NaN</DepthWetSoil>
              </InitialWater>
              <Water>
                <Name>Water</Name>
                <SoilCrop>
                  <Name>RyegrassSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.13</double>
                    <double>0.13</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.11</double>
                    <double>0.11</double>
                  </LL>
                  <KL>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>WhiteCloverSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.13</double>
                    <double>0.13</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.11</double>
                    <double>0.11</double>
                  </LL>
                  <KL>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>Rye1Soil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.13</double>
                    <double>0.13</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.11</double>
                    <double>0.11</double>
                  </LL>
                  <KL>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>Rye2Soil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.13</double>
                    <double>0.13</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.11</double>
                    <double>0.11</double>
                  </LL>
                  <KL>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>100</double>
                  <double>200</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <BD>
                  <double>1</double>
                  <double>1</double>
                  <double>1.59</double>
                  <double>1.57</double>
                  <double>1.6</double>
                  <double>1.6</double>
                </BD>
                <AirDry>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.16</double>
                  <double>0.17</double>
                  <double>0.17</double>
                  <double>0.12</double>
                </AirDry>
                <LL15>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.16</double>
                  <double>0.17</double>
                  <double>0.17</double>
                  <double>0.12</double>
                </LL15>
                <DUL>
                  <double>0.27</double>
                  <double>0.27</double>
                  <double>0.29</double>
                  <double>0.3</double>
                  <double>0.3</double>
                  <double>0.3</double>
                </DUL>
                <SAT>
                  <double>0.42</double>
                  <double>0.4</double>
                  <double>0.36</double>
                  <double>0.37</double>
                  <double>0.37</double>
                  <double>0.32</double>
                </SAT>
                <KS>
                  <double>4832</double>
                  <double>389</double>
                  <double>16</double>
                  <double>16</double>
                  <double>98</double>
                </KS>
              </Water>
              <SoilWater>
                <Name>SoilWater</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <SummerDate>1-Nov</SummerDate>
                <SummerU>9</SummerU>
                <SummerCona>4.4</SummerCona>
                <WinterDate>1-Apr</WinterDate>
                <WinterU>9</WinterU>
                <WinterCona>4.4</WinterCona>
                <DiffusConst>88</DiffusConst>
                <DiffusSlope>35.4</DiffusSlope>
                <Salb>0.18</Salb>
                <CN2Bare>68</CN2Bare>
                <CNRed>20</CNRed>
                <CNCov>0.8</CNCov>
                <slope>NaN</slope>
                <discharge_width>NaN</discharge_width>
                <catchment_area>NaN</catchment_area>
                <max_pond>0</max_pond>
                <Thickness>
                  <double>100</double>
                  <double>200</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <SWCON>
                  <double>0.55</double>
                  <double>0.55</double>
                  <double>0.55</double>
                  <double>0.55</double>
                  <double>0.55</double>
                  <double>0.55</double>
                </SWCON>
                <residueinterception>0</residueinterception>
              </SoilWater>
              <SoilNitrogen>
                <Name>SoilNitrogen</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <fom_type>
                  <string>default</string>
                  <string>manure</string>
                  <string>mucuna</string>
                  <string>lablab</string>
                  <string>shemp</string>
                  <string>stable</string>
                </fom_type>
                <fract_carb>
                  <double>0.2</double>
                  <double>0.3</double>
                  <double>0.54</double>
                  <double>0.57</double>
                  <double>0.45</double>
                  <double>0</double>
                </fract_carb>
                <fract_cell>
                  <double>0.7</double>
                  <double>0.3</double>
                  <double>0.37</double>
                  <double>0.37</double>
                  <double>0.47</double>
                  <double>0.1</double>
                </fract_cell>
                <fract_lign>
                  <double>0.1</double>
                  <double>0.4</double>
                  <double>0.09</double>
                  <double>0.06</double>
                  <double>0.08</double>
                  <double>0.9</double>
                </fract_lign>
                <wfpsN2N2O_x>
                  <double>22</double>
                  <double>88</double>
                </wfpsN2N2O_x>
                <wfpsN2N2O_y>
                  <double>0.1</double>
                  <double>1</double>
                </wfpsN2N2O_y>
              </SoilNitrogen>
              <SoilOrganicMatter>
                <Name>SoilOrganicMatter</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <RootCN>30</RootCN>
                <RootWt>3000</RootWt>
                <SoilCN>11.5</SoilCN>
                <EnrACoeff>7.4</EnrACoeff>
                <EnrBCoeff>0.2</EnrBCoeff>
                <Thickness>
                  <double>100</double>
                  <double>200</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <Depth>
                  <string>0-10</string>
                  <string>10-30</string>
                  <string>30-60</string>
                  <string>60-90</string>
                  <string>90-120</string>
                  <string>120-150</string>
                </Depth>
                <OC>
                  <double>1.82</double>
                  <double>1.47</double>
                  <double>1.2</double>
                  <double>1.03</double>
                  <double>0.47</double>
                  <double>0.47</double>
                </OC>
                <FBiom>
                  <double>0.025</double>
                  <double>0.025</double>
                  <double>0.015</double>
                  <double>0.01</double>
                  <double>0.01</double>
                  <double>0.01</double>
                </FBiom>
                <FInert>
                  <double>0.3</double>
                  <double>0.4</double>
                  <double>0.75</double>
                  <double>0.9</double>
                  <double>0.96</double>
                  <double>0.96</double>
                </FInert>
                <OCUnits>Total</OCUnits>
              </SoilOrganicMatter>
              <Sample>
                <Name>Sample</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>100</double>
                  <double>200</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <NO3>
                  <double>27.3</double>
                  <double>22.8</double>
                  <double>1.2</double>
                  <double>9.2</double>
                  <double>9.2</double>
                  <double>1</double>
                </NO3>
                <NH4>
                  <double>4.3</double>
                  <double>7.6</double>
                  <double>4.1</double>
                  <double>2.7</double>
                  <double>2.4</double>
                  <double>0.1</double>
                </NH4>
                <NO3Units>kgha</NO3Units>
                <NH4Units>ppm</NH4Units>
                <SWUnits>Volumetric</SWUnits>
                <OCUnits>Total</OCUnits>
                <PHUnits>Water</PHUnits>
              </Sample>
              <CERESSoilTemperature>
                <Name>CERESSoilTemperature</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
              </CERESSoilTemperature>
              <Graph>
                <Name>Graph</Name>
                <Series>
                  <Name>LL15</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <Type>Area</Type>
                  <XAxis>Top</XAxis>
                  <YAxis>Left</YAxis>
                  <ColourArgb>-3479297</ColourArgb>
                  <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
                  <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
                  <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
                  <Marker>None</Marker>
                  <MarkerSize>Normal</MarkerSize>
                  <Line>Solid</Line>
                  <LineThickness>Normal</LineThickness>
                  <XFieldName>[Soil].LL15</XFieldName>
                  <YFieldName>[Soil].DepthMidPoints</YFieldName>
                  <X2FieldName>[Soil].DUL</X2FieldName>
                  <Y2FieldName>[Soil].DepthMidPoints</Y2FieldName>
                  <ShowInLegend>false</ShowInLegend>
                  <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
                  <Cumulative>false</Cumulative>
                  <CumulativeX>false</CumulativeX>
                </Series>
                <Series>
                  <Name>Air dry</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <Type>Scatter</Type>
                  <XAxis>Top</XAxis>
                  <YAxis>Left</YAxis>
                  <ColourArgb>-65536</ColourArgb>
                  <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
                  <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
                  <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
                  <Marker>None</Marker>
                  <MarkerSize>Normal</MarkerSize>
                  <Line>Solid</Line>
                  <LineThickness>Normal</LineThickness>
                  <XFieldName>[Soil].AirDry</XFieldName>
                  <YFieldName>[Soil].DepthMidPoints</YFieldName>
                  <ShowInLegend>true</ShowInLegend>
                  <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
                  <Cumulative>false</Cumulative>
                  <CumulativeX>false</CumulativeX>
                </Series>
                <Series>
                  <Name>LL15</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <Type>Scatter</Type>
                  <XAxis>Top</XAxis>
                  <YAxis>Left</YAxis>
                  <ColourArgb>-16711681</ColourArgb>
                  <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
                  <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
                  <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
                  <Marker>None</Marker>
                  <MarkerSize>Normal</MarkerSize>
                  <Line>Solid</Line>
                  <LineThickness>Normal</LineThickness>
                  <XFieldName>[Soil].LL15</XFieldName>
                  <YFieldName>[Soil].DepthMidPoints</YFieldName>
                  <ShowInLegend>true</ShowInLegend>
                  <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
                  <Cumulative>false</Cumulative>
                  <CumulativeX>false</CumulativeX>
                </Series>
                <Series>
                  <Name>DUL</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <Type>Scatter</Type>
                  <XAxis>Top</XAxis>
                  <YAxis>Left</YAxis>
                  <ColourArgb>-16776961</ColourArgb>
                  <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
                  <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
                  <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
                  <Marker>None</Marker>
                  <MarkerSize>Normal</MarkerSize>
                  <Line>Solid</Line>
                  <LineThickness>Normal</LineThickness>
                  <XFieldName>[Soil].DUL</XFieldName>
                  <YFieldName>[Soil].DepthMidPoints</YFieldName>
                  <ShowInLegend>true</ShowInLegend>
                  <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
                  <Cumulative>false</Cumulative>
                  <CumulativeX>false</CumulativeX>
                </Series>
                <Series>
                  <Name>SAT</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <Type>Scatter</Type>
                  <XAxis>Top</XAxis>
                  <YAxis>Left</YAxis>
                  <ColourArgb>-16760704</ColourArgb>
                  <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
                  <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
                  <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
                  <Marker>None</Marker>
                  <MarkerSize>Normal</MarkerSize>
                  <Line>Solid</Line>
                  <LineThickness>Normal</LineThickness>
                  <XFieldName>[Soil].SAT</XFieldName>
                  <YFieldName>[Soil].DepthMidPoints</YFieldName>
                  <ShowInLegend>true</ShowInLegend>
                  <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
                  <Cumulative>false</Cumulative>
                  <CumulativeX>false</CumulativeX>
                </Series>
                <Series>
                  <Name>LL15</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <Type>Scatter</Type>
                  <XAxis>Top</XAxis>
                  <YAxis>Left</YAxis>
                  <ColourArgb>-32768</ColourArgb>
                  <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
                  <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
                  <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
                  <Marker>None</Marker>
                  <MarkerSize>Normal</MarkerSize>
                  <Line>Solid</Line>
                  <LineThickness>Normal</LineThickness>
                  <XFieldName>[Soil].LL15</XFieldName>
                  <YFieldName>[Soil]l.DepthMidPoints</YFieldName>
                  <ShowInLegend>false</ShowInLegend>
                  <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
                  <Cumulative>false</Cumulative>
                  <CumulativeX>false</CumulativeX>
                </Series>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Axis>
                  <Type>Left</Type>
                  <Title>Depth (mm)</Title>
                  <Inverted>true</Inverted>
                  <Minimum>NaN</Minimum>
                  <Maximum>NaN</Maximum>
                  <Interval>NaN</Interval>
                </Axis>
                <Axis>
                  <Type>Top</Type>
                  <Title>Volumetric water (mm/mm)</Title>
                  <Inverted>false</Inverted>
                  <Minimum>NaN</Minimum>
                  <Maximum>NaN</Maximum>
                  <Interval>NaN</Interval>
                </Axis>
                <LegendPosition>BottomRight</LegendPosition>
                <DisabledSeries />
              </Graph>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <RecordNumber>0</RecordNumber>
              <SoilType />
              <Site />
              <NearestTown />
              <Region />
              <NaturalVegetation />
              <Latitude>0</Latitude>
              <Longitude>0</Longitude>
            </Soil>
            <Report>
              <Name>AgPastureTestRootDepthDifferential</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ExperimentFactorNames />
              <ExperimentFactorValues />
              <VariableNames>
                <string>[Clock].Today as Date</string>
                <string>[Clock].Today.Month</string>
                <string>[Clock].Today.Year</string>
                <string>sum([Soil].SoilNitrogen.NO3) as NO3</string>
                <string>sum([Soil].SoilWater.SWmm) as SWDep</string>
                <string>[Rye1].AboveGroundWt</string>
                <string>[Rye2].AboveGroundWt</string>
                <string>[Rye1].HarvestedWt</string>
                <string>[Rye2].HarvestedWt</string>
                <string>([Rye1].HarvestedWt + [Rye2].HarvestedWt) as Yield</string>
                <string>[PropRye1].Script.PropYieldRye1 as PropYieldRye1</string>
                <string>([Fertiliser].NitrogenApplied-( 10.0 * [CutRotation].Script.NReturnedInUrine)) as RealFert</string>
                <string>[Rye2].RootDepth</string>
                <string>[Rye2].GlfWaterSupply</string>
                <string>sum([Rye2].WaterAvailable)</string>
                <string>sum([Rye2].WaterUptake)</string>
                <string>[Rye1].GlfWaterSupply</string>
              </VariableNames>
              <EventNames>
                <string>[Clock].EndOfDay</string>
              </EventNames>
            </Report>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <Area>1</Area>
            <Slope>0</Slope>
          </Zone>
          <IncludeInDocumentation>true</IncludeInDocumentation>
        </Simulation>
        <IncludeInDocumentation>true</IncludeInDocumentation>
      </Experiment>
      <IncludeInDocumentation>true</IncludeInDocumentation>
      <ShowPageOfGraphs>true</ShowPageOfGraphs>
    </Folder>
    <Folder>
      <Name>A Ryegrass and White Clover Example</Name>
      <Memo>
        <Name>Memo RyegrassWhiteCloverExample</Name>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <MemoText><![CDATA[The final test in the single zone set is of a typical ryegrass and white clover pasture.  The white clover has a rooting depth of 150 mm and the ryegrass has roots down to 750 mm deep.  The simulations use a soil with 132 mm of PAW to 750 mm deep in the Lincoln environment which the pasture harvested by cutting down to 1000 kg DM /ha every 21 days with all herbage removed from the paddock. The simulation is run for ten years and in three combinations: no irrigation or fertiliser, irrigation but no fertiliser, and both irrigation and fertiliser. 

The first graph shows the proportion of the total harvested dry matter that was ryegrass and the next three graphs show the standing dry matter of the white clover (pink) and the total (clover plus ryegrass) sward.  In this deep soil with no irrigation or fertiliser and under a cutting regime, the grass and clover stabilise to about 35% grass and 65% clover.  The soil here allows for reasonable growth in the shallow-rooted clover and the poor nutrient status of the soil (no nutrient returns at all) gives the clover a competitive advantage.  When fertiliser is added to the dry simulation the sward becomes 90% grass (not shown).  With irrigation but no fertiliser, the sward becomes clover dominant (about 70%) but when fertilised the sward swaps to grass-dominant (about 20% clover).  These patterns make sense given the physiological characteristics of the individual plants and suggests that the Runge-Kutta method is a reasonable representation of the competitive processes in the soil.
]]></MemoText>
      </Memo>
      <Graph>
        <Name>PropGrass</Name>
        <Series>
          <Name>Both</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>RyegrassWhiteCloverExample</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>PropYieldRyegrass</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>Standing_DryNone</Name>
        <Series>
          <Name>Clover</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-3376729</ColourArgb>
          <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>RyegrassWhiteCloverExample</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>WhiteClover.AboveGroundWt</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Factor] = '0_DryNone'</Filter>
        </Series>
        <Series>
          <Name>Total</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16777216</ColourArgb>
          <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>RyegrassWhiteCloverExample</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>TotalAboveGround</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Factor] = '0_DryNone'</Filter>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>Standing_IrrigNone</Name>
        <Series>
          <Name>Clover</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-3376729</ColourArgb>
          <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>RyegrassWhiteCloverExample</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>WhiteClover.AboveGroundWt</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Factor] = '1_IrrigNone'</Filter>
        </Series>
        <Series>
          <Name>Total</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>RyegrassWhiteCloverExample</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>TotalAboveGround</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Factor] = '1_IrrigNone'</Filter>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>Standing_IrrigFert</Name>
        <Series>
          <Name>Clover</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-3376729</ColourArgb>
          <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>RyegrassWhiteCloverExample</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>WhiteClover.AboveGroundWt</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Factor] = '2_IrrigFert'</Filter>
        </Series>
        <Series>
          <Name>Total</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-11094807</ColourArgb>
          <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>RyegrassWhiteCloverExample</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>TotalAboveGround</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>true</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Factor] = '2_IrrigFert'</Filter>
        </Series>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Left</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopLeft</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Experiment>
        <Name>Experiment</Name>
        <Factors>
          <Name>Factors</Name>
          <Factor>
            <Name>Factor</Name>
            <Factor>
              <Name>0_DryNone</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Specifications>
                <string>[OnOffFertiliser].Script.FertOn = 0</string>
                <string>[OnOffIrrigation].Script.IrrigOn = 0</string>
              </Specifications>
            </Factor>
            <Factor>
              <Name>1_IrrigNone</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Specifications>
                <string>[OnOffFertiliser].Script.FertOn = 0</string>
                <string>[OnOffIrrigation].Script.IrrigOn = 1</string>
              </Specifications>
            </Factor>
            <Factor>
              <Name>2_IrrigFert</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Specifications>
                <string>[OnOffFertiliser].Script.FertOn = 1</string>
                <string>[OnOffIrrigation].Script.IrrigOn = 1</string>
              </Specifications>
            </Factor>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <Specifications />
          </Factor>
          <IncludeInDocumentation>true</IncludeInDocumentation>
        </Factors>
        <Simulation>
          <Name>RyegrassWhiteCloverExample</Name>
          <Clock>
            <Name>Clock</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <StartDate>2000-07-01T00:00:00</StartDate>
            <EndDate>2010-06-30T00:00:00</EndDate>
          </Clock>
          <Weather>
            <Name>Weather</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <FileName>%root%\Examples\WeatherFiles\lincoln.met</FileName>
            <ExcelWorkSheetName />
          </Weather>
          <Summary>
            <Name>Summary</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </Summary>
          <SoilArbitrator>
            <Name>SoilArbitrator</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </SoilArbitrator>
          <Zone>
            <Name>Field</Name>
            <Folder>
              <Name>Managers</Name>
              <Manager>
                <Name>OnOffFertiliser</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <AllowFertiliser>yes</AllowFertiliser>
                  <FertOn>1</FertOn>
                  <Depth2SoilN>200</Depth2SoilN>
                  <CriticalSoilN>15</CriticalSoilN>
                  <FertNAmount>25</FertNAmount>
                  <FertType>UreaN</FertType>
                  <FertApplicationDepth>1</FertApplicationDepth>
                  <FertMinimumDays>14</FertMinimumDays>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using APSIM.Shared.Utilities;
using System.Xml.Serialization;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		[Link] Soil Soil;

		//User inputs from properties tab
		[Description("Turn fertiliser applications on? ")]
		public yesnoType AllowFertiliser { get; set; }
		
		[Description("Temporary variable to turn fertiliser on (1) or off (0): ")] public int FertOn { get; set; }

		[Description("Depth to calculate available soil N (mm): ")]
		public double Depth2SoilN { get; set; }

		[Description("Minimum available N, triggers an application (kgN/ha): ")]
		public double CriticalSoilN { get; set; }

		[Description("Amount of N fertiliser for each application (kgN/ha): ")]
		public double FertNAmount { get; set; }

		[Description("Type of N fertiliser to apply: ")]
		public Fertiliser.Types FertType { get; set; }

		[Description("Depth at which to apply the fertiliser (mm): ")]
		public double FertApplicationDepth { get; set; }
	   
		[Description("Minimum period between applications (days): ")]
		public double FertMinimumDays { get; set; }
	   
		public enum yesnoType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		[XmlIgnore] public double TopMineralN { get; set; }
		
		private DateTime lastApplicationDate;
		private bool fertiliserIsAllowed;
		private int nLayers;

		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{
			fertiliserIsAllowed = (AllowFertiliser == yesnoType.yes);
			nLayers = Soil.SoilWater.Thickness.Length;
		}

		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			double daysSinceLastApplication = (Clock.Today - lastApplicationDate).TotalDays;
			
			// get the N stored in the soil
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopMineralN = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (Depth2SoilN - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopMineralN += (Soil.SoilNitrogen.NO3[layer]
				+ Soil.SoilNitrogen.NH4[layer]
				+ Soil.SoilNitrogen.urea[layer])
				* fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= Depth2SoilN)
					layer = nLayers;
			}

			if (fertiliserIsAllowed && (daysSinceLastApplication >= FertMinimumDays) && (TopMineralN <= CriticalSoilN))
			{
				fertiliser.Apply(FertNAmount * FertOn, FertType, FertApplicationDepth);
				lastApplicationDate = Clock.Today;
			}
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>OnOffIrrigation</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <allowIrrigation>yes</allowIrrigation>
                  <IrrigOn>1</IrrigOn>
                  <seasonStart>15-Aug</seasonStart>
                  <seasonEnd>30-May</seasonEnd>
                  <seasonsAllocation>10000</seasonsAllocation>
                  <triggerDeficit>75</triggerDeficit>
                  <targetDeficit>99</targetDeficit>
                  <returndays>1</returndays>
                  <maximumAmount>30</maximumAmount>
                  <depthPAWC>300</depthPAWC>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using System.Xml.Serialization;
using Models.PMF;
using APSIM.Shared.Utilities;

        
namespace Models
{
	[Serializable] 
	[System.Xml.Serialization.XmlInclude(typeof(Model))]
	public class Script : Model
	{
		//Communication to other modules
		[Link] ISummary summary = null;
		[Link] Irrigation Irrigation;
		[Link] Clock Clock;
		[Link] Soil Soil;
		[Link(IsOptional = true)] ICrop existingCrop;
	   
		//User inputs from properties tab
		[Description("Turn irrigation on?")]
		public answerType allowIrrigation { get; set; }
		
		[Description("Temporary variable to turn fertiliser on (1) or off (0): ")] public int IrrigOn { get; set; }


		[Description("Start of irrigation season (dd-MMM)")]
		public string seasonStart { get; set; }
		[Description("End of irrigation season (dd-MMM)")]
		public string seasonEnd { get; set; }
		[Description("Season allocation (mm)")]
		public double seasonsAllocation { get; set; }
		[Description("Deficit to trigger irrigation (% PAWC)")]
		public double triggerDeficit { get; set; }
		[Description("Deficit to stop irrigaton (% PAWC)")]
		public double targetDeficit { get; set; }
		[Description("Minimum days for irrigation to return")]
		public double returndays { get; set; }
		[Description("Maximum irrigation application (mm/day)")]
		public double maximumAmount { get; set; }
		[Description("Depth to calculate PAWC (mm)")]
		public double depthPAWC { get; set; }
	   
		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		//Class members
		[XmlIgnore] public double TopSWdeficit { get; set; }
		[XmlIgnore] public double TopSWC { get; set; }
		[XmlIgnore] public double DaysSinceIrrigation { get; set; }
		[XmlIgnore] public double AmountToApply { get; set; }
		[XmlIgnore] public double SeasonAppliedAmount { get; set; }
		
		private bool IrrigationIsAllowed { get; set; }
		private bool SeasonIsOpen { get; set; }
		private bool CropIsActive { get; set; }
		private bool IrrigatorIsAvailable { get; set; }
		private bool SoilIsDry { get; set; }

		private DateTime StartDate;
		private DateTime EndDate;
		private double TopDUL;
		private double TopLL;
		private int nLayers;
	
		//Calculate static soil variables
		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{   
			//Set the season dates
			StartDate = DateTime.Parse(seasonStart + "-" + Clock.Today.Year.ToString());
			EndDate = DateTime.Parse(seasonEnd + "-" + Clock.Today.Year.ToString());
			
			//Can we irrigate at all?
			IrrigationIsAllowed = false; 
			if (allowIrrigation == answerType.yes)
				IrrigationIsAllowed = true; 

			//Calculate soil water variables
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			nLayers = Soil.SoilWater.Thickness.Length;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopLL += Soil.SoilWater.LL15mm[layer] * fracLayer;
				TopDUL += Soil.SoilWater.DULmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
		}
	   	  
		//Determine daily requirement for irrigation
		[EventSubscribe("StartOfDay")]
		private void OnStartOfDay(object sender, EventArgs e)
		{
			//Can we irrigate today?		  
			SeasonIsOpen = isBetween(Clock.Today, StartDate, EndDate);

			//Is there a crop in the ground that needs irrigation?
			CropIsActive = false;
			if ((existingCrop != null) && (existingCrop.IsAlive))
				CropIsActive = true;
	      
			//Is the irrigator available?
			IrrigatorIsAvailable = false;
			DaysSinceIrrigation += 1;
			if (DaysSinceIrrigation >= returndays)
				IrrigatorIsAvailable = true;
	      
			//Is the soil dry enough to require irrigation?
			SoilIsDry = false;
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopSWC = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			//for (int layer = 0; depthFromSurface < depthPAWC + Soil.SoilWater.Thickness[layer]; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopSWC += Soil.SoilWater.SWmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
			
			TopSWdeficit = TopSWC - TopDUL;
			if (Math.Max(0.0, -TopSWdeficit) >= (TopDUL - TopLL) * (100 - triggerDeficit) / 100)
				SoilIsDry = true;
	            
			//Are all the conditions ratifying irrigation
			if (IrrigationIsAllowed && SeasonIsOpen && CropIsActive && IrrigatorIsAvailable && SoilIsDry)
			{
				//Lets bloody well irrigate then!!!!
				AmountToApply = TopDUL * targetDeficit / 100 - TopSWC;
				AmountToApply = Math.Max(0.0, Math.Min(AmountToApply, seasonsAllocation - SeasonAppliedAmount));
				Irrigation.Apply(AmountToApply * IrrigOn);
				DaysSinceIrrigation = 0;
				SeasonAppliedAmount += AmountToApply;
			}
		}
		
		///Checks whether theDate is between iniDate and endDate (non-year specific)
		private bool isBetween(DateTime theDay, DateTime iniDate, DateTime endDate)
		{
			bool result = false;
			if (iniDate.DayOfYear < endDate.DayOfYear)
			{
				// period is within one year, ex: summer in the northern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) && (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			else
			{
				// period goes over the end of the year, ex: summer in the southern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) || (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			
			return result;
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>CutRotation</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <rotationAllowed>True</rotationAllowed>
                  <CutRotationStartDate>1900-07-01</CutRotationStartDate>
                  <CutRotationEndDate>2100-12-31</CutRotationEndDate>
                  <CutInterval>21</CutInterval>
                  <IntervalType>FixedInterval</IntervalType>
                  <DurationOfCut>1</DurationOfCut>
                  <RemoveAmountType>ResidualDM</RemoveAmountType>
                  <AmountGiven>1000</AmountGiven>
                  <DMRemoveType>RemoveAll</DMRemoveType>
                  <FractionN2Remove>1</FractionN2Remove>
                  <ProportionN2Dung>0</ProportionN2Dung>
                </Script>
                <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Do the grazing/cutting?: ")] public bool rotationAllowed { get; set; }
		[Description("Date to begin the rotation: ")] public DateTime CutRotationStartDate { get; set; }
		[Description("Date to finish the rotation: ")] public DateTime CutRotationEndDate { get; set; }
		[Description("Rotation interval (days): ")] public int CutInterval { get; set; }
		[Description("How the interval is defined: ")] public rotationIntervalTypes IntervalType { get; set; }
		[Description("Duration of each event (days): ")] public int DurationOfCut { get; set; }
		[Description("What amount is being defined: ")] public removeAmountTypes RemoveAmountType { get; set; }
		[Description("Amount to use (kg/ha): ")] public double AmountGiven { get; set; }
		[Description("Fraction of DM that is removed from the field:")] public removeDMTypes DMRemoveType { get; set; }
		[Description("Fraction of N that is removed from the field (0-1):")] public double FractionN2Remove { get; set; }
		[Description("Proportion of N returned in dung (0-1):")] public double ProportionN2Dung { get; set; }

		// - Outputs from this manager
		[XmlIgnore][Units("g/m2")] public double DefoliatedWt { get; set; }
		// Description: Pasture DM defoliated today
		[XmlIgnore][Units("g/m2")] public double DefoliatedN { get; set; }
		// Description: Pasture N defoliate today
		[XmlIgnore][Units("g/m2")] public double HarvestedWt { get; set; }
		// Description: Pasture DM harvested today
		[XmlIgnore][Units("g/m2")] public double HarvestedN { get; set; }
		// Description: Pasture N harvested today
		[XmlIgnore][Units("g/m2")] public double RemovedWt { get; set; }
		// Description: Pasture DM removed from the field
		[XmlIgnore][Units("g/m2")] public double RemovedN { get; set; }
		// Description: Pasture N removed from the field
		[XmlIgnore][Units("g/m2")] public double ReturnedWt { get; set; }
		// Description: Residue DM returned to the field
		[XmlIgnore][Units("g/m2")] public double ReturnedN { get; set; }
		// Description: Residue N returned to the field
		[XmlIgnore][Units("g/m2")] public double NReturnedInDung { get; set; }
		// Description: Harvested N returned as dung (SurfaceOM)
		[XmlIgnore][Units("g/m2")] public double NReturnedInUrine { get; set; }
		// Description: Harvested N returned as urine (urea)
		[XmlIgnore][Units("day")] public int DaysAfterCut { get; set; }
		// Description: Number of days after last defoliation
		[XmlIgnore][Units("g/m2")] public double PreHarvestDM { get; set; }
		// Description: Total standing DM (Leaf + Stem/Sheath) before cut
		[XmlIgnore][Units("g/m2")] public double PostHarvestDM { get; set; }
		// Description: Total standing DM (Leaf + Stem/Sheath) after cut
		
		// - Internal variables
		// fraction of harvested Dm to actually remove from field
		private double fractionDM2Remove = 1.0;
		// flag whether defoliation is allowed
		//private bool rotationAllowed = true;
		// number of days for each defoliation event
		private int cuttingDuration = 0;
		// counter for day within each defoliation
		private int daysCutting = 0;
		// type of interval (Fixed or target)
		private string intervalType;
		// total herbage to remove in g/m2 per day
		private double herbageToRemove;
		// type of DM amount (ResidualDM or DMToRemove)
		private string amountType;
		// auxiliary flag for defoliation
		private bool aCutHasHappened = false;

		// - Event to add residue or dung to surface OM
		public event BiomassRemovedDelegate BiomassRemoved;

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				Pasture.Add(species);
			}

			// reset variables
			DaysAfterCut = 0;
			resetVariables();
			cuttingDuration = DurationOfCut;
			
			// get the type of amount given
			if (RemoveAmountType == removeAmountTypes.ResidualDM)
				amountType = "SetResidueAmount";
			else
				amountType = "SetRemoveAmount";

			// get the type of amount given
			if (IntervalType == rotationIntervalTypes.FixedInterval)
				intervalType = "Fixed";
			else
				intervalType = "Target";

			// make sure that rotation starts when startDate < simulationStartDay
			if ((Clock.Today > CutRotationStartDate) && (Clock.Today < CutRotationEndDate))
				CutRotationStartDate = Clock.Today;
		}
		
		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			if (rotationAllowed)
			{
				if (Clock.Today == CutRotationStartDate)
					DaysAfterCut = CutInterval;

				bool SwardIsAlive = false;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				{
					if (species.IsAlive)
						SwardIsAlive = true;
				}
				
				// Check whether we can defoliate
				if ((Clock.Today >= CutRotationStartDate) && (Clock.Today <= CutRotationEndDate) && (SwardIsAlive))
				{
					// Check whether we should start a defoliation
					if (DaysAfterCut >= (CutInterval - 1))
					{
						Graze(AmountGiven, amountType, DurationOfCut);
					}
				}
			}

			// Check whether we need to continue cutting
			if ((daysCutting > 0) && (daysCutting < cuttingDuration))
			{
				// reset outputs
				resetVariables();

				removeDM(herbageToRemove);
				returnExcreta();
				daysCutting += 1;
				if (daysCutting == cuttingDuration)
				{
					PostHarvestDM = 0.0;
					foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
						PostHarvestDM += species.StandingHerbageWt;
				}
			}

			// reset outputs
			if (daysCutting < 0)
			{
				resetVariables();
				daysCutting = 0;
			}
		}

		[EventSubscribe("DoManagementCalculations")]
		private void OnDoManagementCalculations(object sender, EventArgs e)
		{
			// Check whether a cutting has finished
			if (daysCutting == cuttingDuration)
			{
				aCutHasHappened = true;
				daysCutting = -1;
			}

			// Increase the counter for days after cutting
			if (aCutHasHappened && (daysCutting == 0))
				DaysAfterCut += 1;
		}

		public enum removeAmountTypes
		{
			/// <summary>Setting DM amount to remove</summary>
			DMToRemove,
			/// <summary>Setting residual DM amount</summary>
			ResidualDM
		}

		public enum rotationIntervalTypes
		{
			/// <summary>Setting a fixed interval</summary>
			FixedInterval,
			/// <summary>Setting a target (minimum) inteval</summary>
			TargetInterval
		}

		public enum removeDMTypes
		{
			/// <summary>Remove all DM</summary>
			RemoveAll,
			/// <summary>Remove no DM</summary>
			RemoveNone,
			/// <summary>Remove a fraction based on digestibility</summary>
			BasedOnDigestibility
		}

		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}
		
				
		// Resets the values of all outputs
		private void resetVariables()
		{
			DefoliatedWt = 0.0;
			DefoliatedN = 0.0;
			HarvestedWt = 0.0;
			HarvestedN = 0.0;
			RemovedWt = 0.0;
			RemovedN = 0.0;
			ReturnedWt = 0.0;
			ReturnedN = 0.0;
			NReturnedInDung = 0.0;
			NReturnedInUrine = 0.0;
		}

		// Description: Perform the basic calculations for defoliation
		public void Graze(double amountDM, string amountType, int duration)
		{
			// Get the existing plant amount
			PreHarvestDM = 0.0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				PreHarvestDM += species.StandingHerbageWt;
			
			// Check the amount to remove and print some info
			if ((amountType == "SetRemoveAmount") && (PreHarvestDM >= amountDM / duration))
			{
				summary.WriteMessage(this, "   Defoliating " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = amountDM / duration;
			}
			else if ((amountType == "SetResidueAmount") && (PreHarvestDM >= amountDM))
			{
				summary.WriteMessage(this, "   Defoliating down to approximately " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = (PreHarvestDM - amountDM) / duration;
			}
			else
			{
				summary.WriteMessage(this, "   Defoliation will not happend because there is not enough plant material");
				if (intervalType == "Fixed")
					DaysAfterCut = -duration;
				return;
			}

			cuttingDuration = duration;
			// Preform first defoliation
			removeDM(herbageToRemove);
			returnExcreta();
			daysCutting = 1;
			DaysAfterCut = 0;
			if (daysCutting == cuttingDuration)
			{
				PostHarvestDM = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					PostHarvestDM += species.StandingHerbageWt;
			}
		}

		// Do the DM removal
		private void removeDM(double removeAmount)
		{
			double existingWt = 0.0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				existingWt += species.HarvestableWt;


			// Check whether we harvest anything
			if (existingWt >= removeAmount)
			{
				foreach (AgPasture.PastureSpecies species in Pasture)
				{
					double amountToRemove = removeAmount * species.HarvestableWt / existingWt;
					species.Graze(amount: amountToRemove, type: "SetRemoveAmount");
				}
				
				// get total harvested
				DefoliatedWt = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					DefoliatedWt += species.HarvestedWt;
				DefoliatedN = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					DefoliatedN += species.HarvestedN;
				HarvestedWt = DefoliatedWt;
				HarvestedN = DefoliatedN;

				// get amounts actually removed from field and that to be returned (dung/urine)
				if (DMRemoveType == removeDMTypes.RemoveAll)
					fractionDM2Remove = 1.0;
				else if (DMRemoveType == removeDMTypes.RemoveNone)
					fractionDM2Remove = 0.0;
				else
				{
					fractionDM2Remove = 0.0;
					foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
						fractionDM2Remove += species.HarvestedDigestibility * species.HarvestedWt;
					fractionDM2Remove /= removeAmount;
				}
				
				RemovedWt = HarvestedWt * fractionDM2Remove;
				RemovedN = HarvestedN * FractionN2Remove;
				ReturnedWt = HarvestedWt - RemovedWt;
				ReturnedN = HarvestedN - RemovedN;
				NReturnedInDung = ReturnedN * ProportionN2Dung;
				NReturnedInUrine = ReturnedN - NReturnedInDung;
			}
		}

		// Return dung and urine
		private void returnExcreta()
		{
			if ((ReturnedWt > 0.0) || (NReturnedInDung > 0.0))
			{
				PMF.BiomassRemovedType BiomassDung = new PMF.BiomassRemovedType();
				string[] type = new string[] { "RuminantDung_PastureFed" };
				float[] dltdm = new float[] { (Single)ReturnedWt };
				float[] dltn = new float[] { (Single)NReturnedInDung };
				float[] dltp = new float[] { 0 };
				float[] fraction = new float[] { 1 };     // fraction is always 1.0 here

				BiomassDung.crop_type = "RuminantDung_PastureFed";
				BiomassDung.dm_type = type;
				BiomassDung.dlt_crop_dm = dltdm;
				BiomassDung.dlt_dm_n = dltn;
				BiomassDung.dlt_dm_p = dltp;
				BiomassDung.fraction_to_residue = fraction;
				BiomassRemoved.Invoke(BiomassDung);
			}

			if (NReturnedInUrine > 0.0)
			{
				fertiliser.Apply(NReturnedInUrine * 10, Fertiliser.Types.UreaN, 1.0);
			}
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>PropRye1</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script />
                <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager

		// - Outputs from this manager
		[XmlIgnore][Units("kg/kg")] public double PropYieldRye1 { get; set; }
		[XmlIgnore][Units("kg/ha")] public double YieldRye1 { get; set; }
		[XmlIgnore][Units("kg/ha")] public double YieldRye2 { get; set; }
		
		// - Internal variables
		//private double fractionDM2Remove = 1.0;

		// - Event to add residue or dung to surface OM
		//public event BiomassRemovedDelegate BiomassRemoved;

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				Pasture.Add(species);
			}
			YieldRye1 = 0.0;
			YieldRye2 = 0.0;
			PropYieldRye1 = 0.0;
		}
		


		[EventSubscribe("DoManagementCalculations")]
		private void OnDoManagementCalculations(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				//Pasture.Add(species);
			}
			YieldRye1 += Pasture[0].HarvestedWt;
			YieldRye2 += Pasture[1].HarvestedWt;
			if ((YieldRye1 + YieldRye2) > 0.0)
				PropYieldRye1 = YieldRye1 / (YieldRye1 + YieldRye2);
		}

	}
}
]]></Code>
              </Manager>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ShowPageOfGraphs>true</ShowPageOfGraphs>
            </Folder>
            <SurfaceOrganicMatter>
              <Name>SurfaceOrganicMatter</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ReportAdditions>no</ReportAdditions>
              <ReportRemovals>no</ReportRemovals>
              <ResidueTypes>
                <Name>ResidueTypes</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LoadFromResource>ResidueTypes</LoadFromResource>
              </ResidueTypes>
              <TillageTypes>
                <Name>TillageTypesList</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <TillageType />
              </TillageTypes>
              <Pools>
                <Pool>
                  <PoolName>Sward</PoolName>
                  <ResidueType>grass</ResidueType>
                  <Mass>1000</Mass>
                  <CNRatio>15</CNRatio>
                  <CPRatio>NaN</CPRatio>
                  <StandingFraction>0</StandingFraction>
                </Pool>
              </Pools>
              <PoolName>Sward</PoolName>
              <type>grass</type>
              <mass>1000</mass>
              <standing_fraction>0</standing_fraction>
              <cpr />
              <cnr>15</cnr>
              <CriticalResidueWeight>2000</CriticalResidueWeight>
              <OptimumDecompTemp>20</OptimumDecompTemp>
              <MaxCumulativeEOS>20</MaxCumulativeEOS>
              <CNRatioDecompCoeff>0.277</CNRatioDecompCoeff>
              <CNRatioDecompThreshold>25</CNRatioDecompThreshold>
              <TotalLeachRain>25</TotalLeachRain>
              <MinRainToLeach>10</MinRainToLeach>
              <CriticalMinimumOrganicC>0.004</CriticalMinimumOrganicC>
              <DefaultCPRatio>0</DefaultCPRatio>
              <DefaultStandingFraction>0</DefaultStandingFraction>
              <StandingExtinctCoeff>0.5</StandingExtinctCoeff>
              <FractionFaecesAdded>0.5</FractionFaecesAdded>
            </SurfaceOrganicMatter>
            <MicroClimate>
              <Name>MicroClimate</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <a_interception>0</a_interception>
              <b_interception>0</b_interception>
              <c_interception>0</c_interception>
              <d_interception>0</d_interception>
              <soil_albedo>0.23</soil_albedo>
              <sun_angle>15</sun_angle>
              <soil_heat_flux_fraction>0.4</soil_heat_flux_fraction>
              <night_interception_fraction>0.5</night_interception_fraction>
              <refheight>2</refheight>
              <albedo>0.29366217672824863</albedo>
              <emissivity>0.96</emissivity>
              <RadIntTotal>0</RadIntTotal>
            </MicroClimate>
            <Irrigation>
              <Name>Irrigation</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Irrigation>
            <Fertiliser>
              <Name>Fertiliser</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Fertiliser>
            <SoluteManager>
              <Name>SoluteManager</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </SoluteManager>
            <PastureSpecies>
              <Name>Ryegrass</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <MaximumNUptake>10</MaximumNUptake>
              <Albedo>0.26</Albedo>
              <Gsmax>0.011</Gsmax>
              <R50>200</R50>
              <SpeciesFamily>Grass</SpeciesFamily>
              <PhotosyntheticPathway>C3</PhotosyntheticPathway>
              <InitialShootDM>750</InitialShootDM>
              <InitialRootDM>450</InitialRootDM>
              <InitialRootDepth>750</InitialRootDepth>
              <ReferencePhotosyntheticRate>1</ReferencePhotosyntheticRate>
              <LightExtinctionCoefficient>0.5</LightExtinctionCoefficient>
              <GrowthTminimum>1</GrowthTminimum>
              <GrowthToptimum>20</GrowthToptimum>
              <GrowthTEffectExponent>1.7</GrowthTEffectExponent>
              <UseHeatStressFactor>yes</UseHeatStressFactor>
              <HeatOnsetTemperature>28</HeatOnsetTemperature>
              <HeatFullTemperature>35</HeatFullTemperature>
              <HeatRecoverySumDD>30</HeatRecoverySumDD>
              <HeatRecoveryTReference>25</HeatRecoveryTReference>
              <UseColdStressFactor>yes</UseColdStressFactor>
              <ColdOnsetTemperature>1</ColdOnsetTemperature>
              <ColdFullTemperature>-5</ColdFullTemperature>
              <ColdRecoverySumDD>25</ColdRecoverySumDD>
              <ColdRecoveryTReference>0</ColdRecoveryTReference>
              <MaintenanceRespirationCoefficient>0.03</MaintenanceRespirationCoefficient>
              <GrowthRespirationCoefficient>0.25</GrowthRespirationCoefficient>
              <RespirationTReference>20</RespirationTReference>
              <RespirationExponent>1.5</RespirationExponent>
              <NThresholdsForLeaves>
                <double>0.04</double>
                <double>0.012</double>
                <double>0.05</double>
              </NThresholdsForLeaves>
              <NThresholdsForStems>
                <double>0.02</double>
                <double>0.006</double>
                <double>0.025</double>
              </NThresholdsForStems>
              <NThresholdsForStolons>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </NThresholdsForStolons>
              <NThresholdsForRoots>
                <double>0.02</double>
                <double>0.006</double>
                <double>0.025</double>
              </NThresholdsForRoots>
              <DegreesDayForGermination>125</DegreesDayForGermination>
              <TargetShootRootRatio>4</TargetShootRootRatio>
              <MaxRootAllocation>0.25</MaxRootAllocation>
              <ShootRootGlfFactor>0.5</ShootRootGlfFactor>
              <UseReproSeasonFactor>yes</UseReproSeasonFactor>
              <ReproSeasonReferenceLatitude>41</ReproSeasonReferenceLatitude>
              <ReproSeasonTimingCoeff>0.14</ReproSeasonTimingCoeff>
              <ReproSeasonMaxAllocationIncrease>0.5</ReproSeasonMaxAllocationIncrease>
              <ReproSeasonAllocationCoeff>0.1</ReproSeasonAllocationCoeff>
              <FractionLeafMaximum>0.7</FractionLeafMaximum>
              <FractionLeafMinimum>0.7</FractionLeafMinimum>
              <FractionLeafDMThreshold>500</FractionLeafDMThreshold>
              <FractionLeafDMFactor>2000</FractionLeafDMFactor>
              <FractionLeafExponent>3</FractionLeafExponent>
              <FractionToStolon>0</FractionToStolon>
              <SpecificLeafArea>25</SpecificLeafArea>
              <SpecificRootLength>100</SpecificRootLength>
              <StolonEffectOnLAI>0</StolonEffectOnLAI>
              <ShootMaxEffectOnLAI>1000</ShootMaxEffectOnLAI>
              <MaxStemEffectOnLAI>1</MaxStemEffectOnLAI>
              <LiveLeavesPerTiller>3</LiveLeavesPerTiller>
              <TissueTurnoverRateShoot>0.05</TissueTurnoverRateShoot>
              <TissueTurnoverRateRoot>0.02</TissueTurnoverRateRoot>
              <DetachmentRateShoot>0.08</DetachmentRateShoot>
              <TurnoverTemperatureMin>2</TurnoverTemperatureMin>
              <TurnoverTemperatureRef>20</TurnoverTemperatureRef>
              <TurnoverTemperatureExponent>1</TurnoverTemperatureExponent>
              <TurnoverDroughtEffectMax>1</TurnoverDroughtEffectMax>
              <TurnoverDroughtThreshold>0.5</TurnoverDroughtThreshold>
              <TurnoverDefoliationCoefficient>0.5</TurnoverDefoliationCoefficient>
              <TurnoverDefoliationRootEffect>0.1</TurnoverDefoliationRootEffect>
              <FractionNLuxuryRemobilisable>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </FractionNLuxuryRemobilisable>
              <MinimumNFixation>0</MinimumNFixation>
              <MaximumNFixation>0</MaximumNFixation>
              <SoilSaturationEffectMax>0.1</SoilSaturationEffectMax>
              <MinimumWaterFreePorosity>-1</MinimumWaterFreePorosity>
              <SoilSaturationRecoveryFactor>0.25</SoilSaturationRecoveryFactor>
              <NDillutionCoefficient>0.25</NDillutionCoefficient>
              <GlfGeneric>1</GlfGeneric>
              <GlfSoilFertility>1</GlfSoilFertility>
              <PlantHeightMinimum>25</PlantHeightMinimum>
              <PlantHeightMaximum>600</PlantHeightMaximum>
              <PlantHeightMassForMax>10000</PlantHeightMassForMax>
              <PlantHeightExponent>2.8</PlantHeightExponent>
              <RootDepthMinimum>50</RootDepthMinimum>
              <RootDepthMaximum>750</RootDepthMaximum>
              <RootElongationRate>25</RootElongationRate>
              <RootDistributionDepthParam>90</RootDistributionDepthParam>
              <RootDistributionExponent>3.2</RootDistributionExponent>
              <DigestibilitiesCellWall>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.2</double>
              </DigestibilitiesCellWall>
              <MinimumGreenWt>100</MinimumGreenWt>
              <FractionStolonStanding>0</FractionStolonStanding>
              <PreferenceForGreenOverDead>1</PreferenceForGreenOverDead>
              <PreferenceForLeafOverStems>1</PreferenceForLeafOverStems>
              <WaterAvailableMethod>DefaultAPSIM</WaterAvailableMethod>
              <NitrogenAvailableMethod>BasicAgPasture</NitrogenAvailableMethod>
            </PastureSpecies>
            <PastureSpecies>
              <Name>WhiteClover</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <MaximumNUptake>10</MaximumNUptake>
              <Albedo>0.26</Albedo>
              <Gsmax>0.011</Gsmax>
              <R50>200</R50>
              <SpeciesFamily>Legume</SpeciesFamily>
              <PhotosyntheticPathway>C3</PhotosyntheticPathway>
              <InitialShootDM>500</InitialShootDM>
              <InitialRootDM>150</InitialRootDM>
              <InitialRootDepth>150</InitialRootDepth>
              <ReferencePhotosyntheticRate>1</ReferencePhotosyntheticRate>
              <LightExtinctionCoefficient>0.8</LightExtinctionCoefficient>
              <GrowthTminimum>2</GrowthTminimum>
              <GrowthToptimum>22</GrowthToptimum>
              <GrowthTEffectExponent>1.7</GrowthTEffectExponent>
              <UseHeatStressFactor>yes</UseHeatStressFactor>
              <HeatOnsetTemperature>30</HeatOnsetTemperature>
              <HeatFullTemperature>36</HeatFullTemperature>
              <HeatRecoverySumDD>20</HeatRecoverySumDD>
              <HeatRecoveryTReference>25</HeatRecoveryTReference>
              <UseColdStressFactor>yes</UseColdStressFactor>
              <ColdOnsetTemperature>2</ColdOnsetTemperature>
              <ColdFullTemperature>-5</ColdFullTemperature>
              <ColdRecoverySumDD>30</ColdRecoverySumDD>
              <ColdRecoveryTReference>0</ColdRecoveryTReference>
              <MaintenanceRespirationCoefficient>0.04</MaintenanceRespirationCoefficient>
              <GrowthRespirationCoefficient>0.25</GrowthRespirationCoefficient>
              <RespirationTReference>20</RespirationTReference>
              <RespirationExponent>1.5</RespirationExponent>
              <NThresholdsForLeaves>
                <double>0.045</double>
                <double>0.02</double>
                <double>0.055</double>
              </NThresholdsForLeaves>
              <NThresholdsForStems>
                <double>0.0225</double>
                <double>0.01</double>
                <double>0.0275</double>
              </NThresholdsForStems>
              <NThresholdsForStolons>
                <double>0.0225</double>
                <double>0.01</double>
                <double>0.0275</double>
              </NThresholdsForStolons>
              <NThresholdsForRoots>
                <double>0.0225</double>
                <double>0.01</double>
                <double>0.0275</double>
              </NThresholdsForRoots>
              <DegreesDayForGermination>125</DegreesDayForGermination>
              <TargetShootRootRatio>4</TargetShootRootRatio>
              <MaxRootAllocation>0.25</MaxRootAllocation>
              <ShootRootGlfFactor>0.5</ShootRootGlfFactor>
              <UseReproSeasonFactor>yes</UseReproSeasonFactor>
              <ReproSeasonReferenceLatitude>41</ReproSeasonReferenceLatitude>
              <ReproSeasonTimingCoeff>0.14</ReproSeasonTimingCoeff>
              <ReproSeasonMaxAllocationIncrease>0.5</ReproSeasonMaxAllocationIncrease>
              <ReproSeasonAllocationCoeff>0.1</ReproSeasonAllocationCoeff>
              <FractionLeafMaximum>0.56</FractionLeafMaximum>
              <FractionLeafMinimum>0.28</FractionLeafMinimum>
              <FractionLeafDMThreshold>500</FractionLeafDMThreshold>
              <FractionLeafDMFactor>2000</FractionLeafDMFactor>
              <FractionLeafExponent>3</FractionLeafExponent>
              <FractionToStolon>0.2</FractionToStolon>
              <SpecificLeafArea>30</SpecificLeafArea>
              <SpecificRootLength>45</SpecificRootLength>
              <StolonEffectOnLAI>0.3</StolonEffectOnLAI>
              <ShootMaxEffectOnLAI>500</ShootMaxEffectOnLAI>
              <MaxStemEffectOnLAI>0.5</MaxStemEffectOnLAI>
              <LiveLeavesPerTiller>3</LiveLeavesPerTiller>
              <TissueTurnoverRateShoot>0.05</TissueTurnoverRateShoot>
              <TissueTurnoverRateRoot>0.02</TissueTurnoverRateRoot>
              <DetachmentRateShoot>0.11</DetachmentRateShoot>
              <TurnoverTemperatureMin>2</TurnoverTemperatureMin>
              <TurnoverTemperatureRef>20</TurnoverTemperatureRef>
              <TurnoverTemperatureExponent>1</TurnoverTemperatureExponent>
              <TurnoverDroughtEffectMax>1</TurnoverDroughtEffectMax>
              <TurnoverDroughtThreshold>0.5</TurnoverDroughtThreshold>
              <TurnoverDefoliationCoefficient>0.5</TurnoverDefoliationCoefficient>
              <TurnoverDefoliationRootEffect>0.1</TurnoverDefoliationRootEffect>
              <FractionNLuxuryRemobilisable>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </FractionNLuxuryRemobilisable>
              <MinimumNFixation>0.2</MinimumNFixation>
              <MaximumNFixation>0.6</MaximumNFixation>
              <SoilSaturationEffectMax>0.1</SoilSaturationEffectMax>
              <MinimumWaterFreePorosity>-1</MinimumWaterFreePorosity>
              <SoilSaturationRecoveryFactor>0.25</SoilSaturationRecoveryFactor>
              <NDillutionCoefficient>1</NDillutionCoefficient>
              <GlfGeneric>1</GlfGeneric>
              <GlfSoilFertility>1</GlfSoilFertility>
              <PlantHeightMinimum>25</PlantHeightMinimum>
              <PlantHeightMaximum>350</PlantHeightMaximum>
              <PlantHeightMassForMax>7500</PlantHeightMassForMax>
              <PlantHeightExponent>2.5</PlantHeightExponent>
              <RootDepthMinimum>30</RootDepthMinimum>
              <RootDepthMaximum>150</RootDepthMaximum>
              <RootElongationRate>25</RootElongationRate>
              <RootDistributionDepthParam>70</RootDistributionDepthParam>
              <RootDistributionExponent>2.5</RootDistributionExponent>
              <DigestibilitiesCellWall>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.2</double>
              </DigestibilitiesCellWall>
              <MinimumGreenWt>50</MinimumGreenWt>
              <FractionStolonStanding>0</FractionStolonStanding>
              <PreferenceForGreenOverDead>1</PreferenceForGreenOverDead>
              <PreferenceForLeafOverStems>1</PreferenceForLeafOverStems>
              <WaterAvailableMethod>DefaultAPSIM</WaterAvailableMethod>
              <NitrogenAvailableMethod>BasicAgPasture</NitrogenAvailableMethod>
            </PastureSpecies>
            <Soil>
              <Name>Soil</Name>
              <Analysis>
                <Name>Analysis</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>100</double>
                  <double>200</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <PH>
                  <double>6.6</double>
                  <double>6.2</double>
                  <double>5.7</double>
                  <double>5.5</double>
                  <double>5.5</double>
                  <double>5.5</double>
                </PH>
                <PHUnits>Water</PHUnits>
                <BoronUnits>HotWater</BoronUnits>
              </Analysis>
              <InitialWater>
                <Name>Initial water</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <PercentMethod>EvenlyDistributed</PercentMethod>
                <FractionFull>1</FractionFull>
                <DepthWetSoil>NaN</DepthWetSoil>
              </InitialWater>
              <Water>
                <Name>Water</Name>
                <SoilCrop>
                  <Name>RyegrassSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.13</double>
                    <double>0.13</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.11</double>
                    <double>0.11</double>
                  </LL>
                  <KL>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>WhiteCloverSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.13</double>
                    <double>0.13</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.11</double>
                    <double>0.11</double>
                  </LL>
                  <KL>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>Rye1Soil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.13</double>
                    <double>0.13</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.11</double>
                    <double>0.11</double>
                  </LL>
                  <KL>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>Rye2Soil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.13</double>
                    <double>0.13</double>
                    <double>0.1</double>
                    <double>0.08</double>
                    <double>0.11</double>
                    <double>0.11</double>
                  </LL>
                  <KL>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0.06</double>
                    <double>0</double>
                    <double>0</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>0</double>
                    <double>0</double>
                  </XF>
                </SoilCrop>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>100</double>
                  <double>200</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <BD>
                  <double>1</double>
                  <double>1</double>
                  <double>1.59</double>
                  <double>1.57</double>
                  <double>1.6</double>
                  <double>1.6</double>
                </BD>
                <AirDry>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.16</double>
                  <double>0.17</double>
                  <double>0.17</double>
                  <double>0.12</double>
                </AirDry>
                <LL15>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.16</double>
                  <double>0.17</double>
                  <double>0.17</double>
                  <double>0.12</double>
                </LL15>
                <DUL>
                  <double>0.27</double>
                  <double>0.27</double>
                  <double>0.29</double>
                  <double>0.3</double>
                  <double>0.3</double>
                  <double>0.3</double>
                </DUL>
                <SAT>
                  <double>0.42</double>
                  <double>0.4</double>
                  <double>0.36</double>
                  <double>0.37</double>
                  <double>0.37</double>
                  <double>0.32</double>
                </SAT>
                <KS>
                  <double>4832</double>
                  <double>389</double>
                  <double>16</double>
                  <double>16</double>
                  <double>98</double>
                </KS>
              </Water>
              <SoilWater>
                <Name>SoilWater</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <SummerDate>1-Nov</SummerDate>
                <SummerU>9</SummerU>
                <SummerCona>4.4</SummerCona>
                <WinterDate>1-Apr</WinterDate>
                <WinterU>9</WinterU>
                <WinterCona>4.4</WinterCona>
                <DiffusConst>88</DiffusConst>
                <DiffusSlope>35.4</DiffusSlope>
                <Salb>0.18</Salb>
                <CN2Bare>68</CN2Bare>
                <CNRed>20</CNRed>
                <CNCov>0.8</CNCov>
                <slope>NaN</slope>
                <discharge_width>NaN</discharge_width>
                <catchment_area>NaN</catchment_area>
                <max_pond>0</max_pond>
                <Thickness>
                  <double>100</double>
                  <double>200</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <SWCON>
                  <double>0.55</double>
                  <double>0.55</double>
                  <double>0.55</double>
                  <double>0.55</double>
                  <double>0.55</double>
                  <double>0.55</double>
                </SWCON>
                <residueinterception>0</residueinterception>
              </SoilWater>
              <SoilNitrogen>
                <Name>SoilNitrogen</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <fom_type>
                  <string>default</string>
                  <string>manure</string>
                  <string>mucuna</string>
                  <string>lablab</string>
                  <string>shemp</string>
                  <string>stable</string>
                </fom_type>
                <fract_carb>
                  <double>0.2</double>
                  <double>0.3</double>
                  <double>0.54</double>
                  <double>0.57</double>
                  <double>0.45</double>
                  <double>0</double>
                </fract_carb>
                <fract_cell>
                  <double>0.7</double>
                  <double>0.3</double>
                  <double>0.37</double>
                  <double>0.37</double>
                  <double>0.47</double>
                  <double>0.1</double>
                </fract_cell>
                <fract_lign>
                  <double>0.1</double>
                  <double>0.4</double>
                  <double>0.09</double>
                  <double>0.06</double>
                  <double>0.08</double>
                  <double>0.9</double>
                </fract_lign>
                <wfpsN2N2O_x>
                  <double>22</double>
                  <double>88</double>
                </wfpsN2N2O_x>
                <wfpsN2N2O_y>
                  <double>0.1</double>
                  <double>1</double>
                </wfpsN2N2O_y>
              </SoilNitrogen>
              <SoilOrganicMatter>
                <Name>SoilOrganicMatter</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <RootCN>30</RootCN>
                <RootWt>3000</RootWt>
                <SoilCN>11.5</SoilCN>
                <EnrACoeff>7.4</EnrACoeff>
                <EnrBCoeff>0.2</EnrBCoeff>
                <Thickness>
                  <double>100</double>
                  <double>200</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <Depth>
                  <string>0-10</string>
                  <string>10-30</string>
                  <string>30-60</string>
                  <string>60-90</string>
                  <string>90-120</string>
                  <string>120-150</string>
                </Depth>
                <OC>
                  <double>1.82</double>
                  <double>1.47</double>
                  <double>1.2</double>
                  <double>1.03</double>
                  <double>0.47</double>
                  <double>0.47</double>
                </OC>
                <FBiom>
                  <double>0.025</double>
                  <double>0.025</double>
                  <double>0.015</double>
                  <double>0.01</double>
                  <double>0.01</double>
                  <double>0.01</double>
                </FBiom>
                <FInert>
                  <double>0.3</double>
                  <double>0.4</double>
                  <double>0.75</double>
                  <double>0.9</double>
                  <double>0.96</double>
                  <double>0.96</double>
                </FInert>
                <OCUnits>Total</OCUnits>
              </SoilOrganicMatter>
              <Sample>
                <Name>Sample</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>100</double>
                  <double>200</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                  <double>300</double>
                </Thickness>
                <NO3>
                  <double>27.3</double>
                  <double>22.8</double>
                  <double>1.2</double>
                  <double>9.2</double>
                  <double>9.2</double>
                  <double>1</double>
                </NO3>
                <NH4>
                  <double>4.3</double>
                  <double>7.6</double>
                  <double>4.1</double>
                  <double>2.7</double>
                  <double>2.4</double>
                  <double>0.1</double>
                </NH4>
                <NO3Units>kgha</NO3Units>
                <NH4Units>ppm</NH4Units>
                <SWUnits>Volumetric</SWUnits>
                <OCUnits>Total</OCUnits>
                <PHUnits>Water</PHUnits>
              </Sample>
              <CERESSoilTemperature>
                <Name>CERESSoilTemperature</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
              </CERESSoilTemperature>
              <Graph>
                <Name>Graph</Name>
                <Series>
                  <Name>LL15</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <Type>Area</Type>
                  <XAxis>Top</XAxis>
                  <YAxis>Left</YAxis>
                  <ColourArgb>-3479297</ColourArgb>
                  <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
                  <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
                  <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
                  <Marker>None</Marker>
                  <MarkerSize>Normal</MarkerSize>
                  <Line>Solid</Line>
                  <LineThickness>Normal</LineThickness>
                  <XFieldName>[Soil].LL15</XFieldName>
                  <YFieldName>[Soil].DepthMidPoints</YFieldName>
                  <X2FieldName>[Soil].DUL</X2FieldName>
                  <Y2FieldName>[Soil].DepthMidPoints</Y2FieldName>
                  <ShowInLegend>false</ShowInLegend>
                  <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
                  <Cumulative>false</Cumulative>
                  <CumulativeX>false</CumulativeX>
                </Series>
                <Series>
                  <Name>Air dry</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <Type>Scatter</Type>
                  <XAxis>Top</XAxis>
                  <YAxis>Left</YAxis>
                  <ColourArgb>-65536</ColourArgb>
                  <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
                  <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
                  <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
                  <Marker>None</Marker>
                  <MarkerSize>Normal</MarkerSize>
                  <Line>Solid</Line>
                  <LineThickness>Normal</LineThickness>
                  <XFieldName>[Soil].AirDry</XFieldName>
                  <YFieldName>[Soil].DepthMidPoints</YFieldName>
                  <ShowInLegend>true</ShowInLegend>
                  <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
                  <Cumulative>false</Cumulative>
                  <CumulativeX>false</CumulativeX>
                </Series>
                <Series>
                  <Name>LL15</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <Type>Scatter</Type>
                  <XAxis>Top</XAxis>
                  <YAxis>Left</YAxis>
                  <ColourArgb>-16711681</ColourArgb>
                  <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
                  <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
                  <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
                  <Marker>None</Marker>
                  <MarkerSize>Normal</MarkerSize>
                  <Line>Solid</Line>
                  <LineThickness>Normal</LineThickness>
                  <XFieldName>[Soil].LL15</XFieldName>
                  <YFieldName>[Soil].DepthMidPoints</YFieldName>
                  <ShowInLegend>true</ShowInLegend>
                  <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
                  <Cumulative>false</Cumulative>
                  <CumulativeX>false</CumulativeX>
                </Series>
                <Series>
                  <Name>DUL</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <Type>Scatter</Type>
                  <XAxis>Top</XAxis>
                  <YAxis>Left</YAxis>
                  <ColourArgb>-16776961</ColourArgb>
                  <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
                  <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
                  <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
                  <Marker>None</Marker>
                  <MarkerSize>Normal</MarkerSize>
                  <Line>Solid</Line>
                  <LineThickness>Normal</LineThickness>
                  <XFieldName>[Soil].DUL</XFieldName>
                  <YFieldName>[Soil].DepthMidPoints</YFieldName>
                  <ShowInLegend>true</ShowInLegend>
                  <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
                  <Cumulative>false</Cumulative>
                  <CumulativeX>false</CumulativeX>
                </Series>
                <Series>
                  <Name>SAT</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <Type>Scatter</Type>
                  <XAxis>Top</XAxis>
                  <YAxis>Left</YAxis>
                  <ColourArgb>-16760704</ColourArgb>
                  <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
                  <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
                  <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
                  <Marker>None</Marker>
                  <MarkerSize>Normal</MarkerSize>
                  <Line>Solid</Line>
                  <LineThickness>Normal</LineThickness>
                  <XFieldName>[Soil].SAT</XFieldName>
                  <YFieldName>[Soil].DepthMidPoints</YFieldName>
                  <ShowInLegend>true</ShowInLegend>
                  <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
                  <Cumulative>false</Cumulative>
                  <CumulativeX>false</CumulativeX>
                </Series>
                <Series>
                  <Name>LL15</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <Type>Scatter</Type>
                  <XAxis>Top</XAxis>
                  <YAxis>Left</YAxis>
                  <ColourArgb>-32768</ColourArgb>
                  <FactorIndexToVaryColours>-1</FactorIndexToVaryColours>
                  <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
                  <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
                  <Marker>None</Marker>
                  <MarkerSize>Normal</MarkerSize>
                  <Line>Solid</Line>
                  <LineThickness>Normal</LineThickness>
                  <XFieldName>[Soil].LL15</XFieldName>
                  <YFieldName>[Soil]l.DepthMidPoints</YFieldName>
                  <ShowInLegend>false</ShowInLegend>
                  <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
                  <Cumulative>false</Cumulative>
                  <CumulativeX>false</CumulativeX>
                </Series>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Axis>
                  <Type>Left</Type>
                  <Title>Depth (mm)</Title>
                  <Inverted>true</Inverted>
                  <Minimum>NaN</Minimum>
                  <Maximum>NaN</Maximum>
                  <Interval>NaN</Interval>
                </Axis>
                <Axis>
                  <Type>Top</Type>
                  <Title>Volumetric water (mm/mm)</Title>
                  <Inverted>false</Inverted>
                  <Minimum>NaN</Minimum>
                  <Maximum>NaN</Maximum>
                  <Interval>NaN</Interval>
                </Axis>
                <LegendPosition>BottomRight</LegendPosition>
                <DisabledSeries />
              </Graph>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <RecordNumber>0</RecordNumber>
              <SoilType />
              <Site />
              <NearestTown />
              <Region />
              <NaturalVegetation />
              <Latitude>0</Latitude>
              <Longitude>0</Longitude>
            </Soil>
            <Report>
              <Name>RyegrassWhiteCloverExample</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ExperimentFactorNames />
              <ExperimentFactorValues />
              <VariableNames>
                <string>[Clock].Today as Date</string>
                <string>sum([Soil].SoilNitrogen.NO3) as NO3</string>
                <string>sum([Soil].SoilWater.SWmm) as SWDep</string>
                <string>[Ryegrass].AboveGroundWt</string>
                <string>[WhiteClover].AboveGroundWt</string>
                <string>[Ryegrass].AboveGroundWt + [WhiteClover].AboveGroundWt as TotalAboveGround</string>
                <string>[Ryegrass].HarvestedWt</string>
                <string>[WhiteClover].HarvestedWt</string>
                <string>([Ryegrass].HarvestedWt + [WhiteClover].HarvestedWt) as Yield</string>
                <string>[PropRye1].Script.PropYieldRye1 as PropYieldRyegrass</string>
                <string>([Fertiliser].NitrogenApplied-( 10.0 * [CutRotation].Script.NReturnedInUrine)) as RealFert</string>
              </VariableNames>
              <EventNames>
                <string>[Clock].EndOfDay</string>
              </EventNames>
            </Report>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <Area>1</Area>
            <Slope>0</Slope>
          </Zone>
          <IncludeInDocumentation>true</IncludeInDocumentation>
        </Simulation>
        <IncludeInDocumentation>true</IncludeInDocumentation>
      </Experiment>
      <IncludeInDocumentation>true</IncludeInDocumentation>
      <ShowPageOfGraphs>true</ShowPageOfGraphs>
    </Folder>
    <IncludeInDocumentation>true</IncludeInDocumentation>
    <ShowPageOfGraphs>true</ShowPageOfGraphs>
  </Folder>
  <Folder>
    <Name>Tests of Crops with Roots Across Zones</Name>
    <Memo>
      <Name>Description</Name>
      <IncludeInDocumentation>true</IncludeInDocumentation>
      <MemoText><![CDATA[The series of test and simulations in this section test the performance of SoilArbitrator when there are plants with roots spread across zones.  All of these tests are in a uniform soil with lots of soil water storage but no source of organic N.  The climate is a uniform or controlled environment.  The plant is a ryegrass.

The first three series demonstrate two-zone simulations with the ryegrass in Zone0 and a bare soil in Zone1.  The Zone0 ryegrass can spread a variable proportion of its roots into Zone1.

The last two simulations are each three zones and a ryegrass in each zone.  The ryegrass in the central zone can spread roots into its neighbours but the ryegrasses in the outer zones can access only their ‘home’ zones.  The simulations start with either uniform mineral N across the zones or with increased N in Zone0.
]]></MemoText>
    </Memo>
    <Folder>
      <Name>Test With No Stress</Name>
      <Memo>
        <Name>Memo TestWithNoStress</Name>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <MemoText><![CDATA[The conditions for this series of simulations are: 

•	a controlled environment with 25 MJ /m2 solar radiation, 15 C minimum and 25 C maximum air temperature, no rainfall; 

•	a uniform soil with 210 mm of PAW to 600 mm deep; 

•	the soil has no organic matter and there is no surface organic matter;

•	Zone0 has a ryegrass with roots to 600 mm deep; 

•	Zone 1 has no plant in the zone;

•	the ryegrass is trimmed every day to maintain 2250 kg DM /ha with all herbage removed from the simulation; and

•	water and fertiliser are applied every day sufficient to maintain conditions of no water or N stress.


The series of simulations add some roots from the ryegrass in Zone0 into Zone1 such that Zone1 contains 0, 0.25, 0.5, 0.75 or 1.0 of the roots in Zone0 so that the ryegrass can meet its water and N demand from some combination of the resources in the two zones.  Note that there is no canopy cover in Zone1 and therefore evaporation from the soil surface will be greater than that in Zone0.  The expectation is that as a greater proportion of the roots are in Zone1, that:

•	the irrigation need in Zone0 will decrease and that in Zone 1 will increase and possibly exceed that in Zone0 when there is an even spread of roots (because of the expected additional evaporation of soil water without canopy cover in Zone1)

•	the amount of fertiliser added should decrease in Zone0 and increase in Zone1 as more rots are spread into Zone1

The graphs show that these expectations are met.
]]></MemoText>
      </Memo>
      <Experiment>
        <Name>Experiment</Name>
        <Factors>
          <Name>Factors</Name>
          <Factor>
            <Name>NumOfZones</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <Specifications>
              <string>[DoRootsSingle].Script.Zone1Prop=0.0,0.25,0.5,0.75,1.0</string>
            </Specifications>
          </Factor>
          <IncludeInDocumentation>true</IncludeInDocumentation>
        </Factors>
        <Simulation>
          <Name>TestWithNoStress</Name>
          <Clock>
            <Name>Clock</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <StartDate>2000-01-01T00:00:00</StartDate>
            <EndDate>2000-12-31T00:00:00</EndDate>
          </Clock>
          <ControlledEnvironment>
            <Name>ControlledEnvironment</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <MaxT>25</MaxT>
            <MinT>15</MinT>
            <Rain>0</Rain>
            <Radn>25</Radn>
            <PanEvap>0</PanEvap>
            <VP>17</VP>
            <Wind>3</Wind>
            <CO2>350</CO2>
            <AirPressure>1010</AirPressure>
            <Latitude>0</Latitude>
            <DayLength>12</DayLength>
          </ControlledEnvironment>
          <SoilArbitrator>
            <Name>SoilArbitrator</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </SoilArbitrator>
          <Summary>
            <Name>Summary</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </Summary>
          <Zone>
            <Name>Zone0</Name>
            <Folder>
              <Name>Managers</Name>
              <Manager>
                <Name>DoRootsSingle</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <Zone0Depth>600</Zone0Depth>
                  <Zone0Mass>500</Zone0Mass>
                  <Zone1Name>Zone1</Zone1Name>
                  <Zone1Prop>0</Zone1Prop>
                  <Zone2Name>Zone2</Zone2Name>
                  <Zone2Prop>0</Zone2Prop>
                  <Zone3Name>Zone3</Zone3Name>
                  <Zone3Prop>0</Zone3Prop>
                </Script>
                <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Root depth in the plant's zone (mm): ")]  public double Zone0Depth { get; set; }
		[Description("Root mass  in the plant's zone (mm): ")]  public double Zone0Mass { get; set; }

		[Description("Name of the first zone: ")] public string Zone1Name { get; set; }
		[Description("Proportionate depth and mass in the first zone (-): ")]  public double Zone1Prop { get; set; }

		[Description("Name of the second zone: ")] public string Zone2Name { get; set; }
		[Description("Proportionate depth and mass in the first zone (-): ")]  public double Zone2Prop { get; set; }

		[Description("Name of the third zone: ")] public string Zone3Name { get; set; }
		[Description("Proportionate depth and mass in the first zone (-): ")]  public double Zone3Prop { get; set; }

		// - Outputs from this manager

		// - Internal variables

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			int SpeciesNum = 0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				SpeciesNum += 1;
				if (SpeciesNum == 1)
				{
					//double test = species.RootWt;
					if (Zone1Prop > 0)
						species.AddZone(zoneName: Zone1Name, rootDepth: Zone1Prop * Zone0Depth, rootDM: Zone1Prop * Zone0Mass, specificRootLength: 100);
					if (Zone2Prop > 0)
						species.AddZone(zoneName: Zone1Name, rootDepth: Zone2Prop * Zone0Depth, rootDM: Zone2Prop * Zone0Mass, specificRootLength: 100);
					if (Zone3Prop > 0)
						species.AddZone(zoneName: Zone1Name, rootDepth: Zone3Prop * Zone0Depth, rootDM: Zone3Prop * Zone0Mass, specificRootLength: 100);
				}
			}

			//Pasture[1].AddZone(zoneName: "Zone1", rootDepth: 100, rootDM: 1000, specificRootLength: 100);
			//Pasture[1].AddZone(zoneName: "Zone2", rootDepth: 50, rootDM: 500, specificRootLength: 100);
		}
	}
}]]></Code>
              </Manager>
              <Manager>
                <Name>AutomaticFertiliser</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <AllowFertiliser>yes</AllowFertiliser>
                  <Depth2SoilN>600</Depth2SoilN>
                  <CriticalSoilN>100</CriticalSoilN>
                  <FertNAmount>50</FertNAmount>
                  <FertType>UreaN</FertType>
                  <FertApplicationDepth>1</FertApplicationDepth>
                  <FertMinimumDays>1</FertMinimumDays>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using APSIM.Shared.Utilities;
using System.Xml.Serialization;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		[Link] Soil Soil;

		//User inputs from properties tab
		[Description("Turn ferliser applications on? ")]
		public yesnoType AllowFertiliser { get; set; }
		
		[Description("Depth to calculate available soil N (mm): ")]
		public double Depth2SoilN { get; set; }

		[Description("Minimum available N, triggers an application (kgN/ha): ")]
		public double CriticalSoilN { get; set; }

		[Description("Amount of N fertiliser for each application (kgN/ha): ")]
		public double FertNAmount { get; set; }

		[Description("Type of N fertiliser to apply: ")]
		public Fertiliser.Types FertType { get; set; }

		[Description("Depth at which to apply the fertiliser (mm): ")]
		public double FertApplicationDepth { get; set; }
	   
		[Description("Minimum period between applications (days): ")]
		public double FertMinimumDays { get; set; }
	   
		public enum yesnoType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		[XmlIgnore] public double TopMineralN { get; set; }
		
		private DateTime lastApplicationDate;
		private bool fertiliserIsAllowed;
		private int nLayers;

		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{
			fertiliserIsAllowed = (AllowFertiliser == yesnoType.yes);
			nLayers = Soil.SoilWater.Thickness.Length;
		}

		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			double daysSinceLastApplication = (Clock.Today - lastApplicationDate).TotalDays;
			
			// get the N stored in the soil
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopMineralN = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (Depth2SoilN - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopMineralN += (Soil.SoilNitrogen.NO3[layer]
				+ Soil.SoilNitrogen.NH4[layer]
				+ Soil.SoilNitrogen.urea[layer])
				* fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= Depth2SoilN)
					layer = nLayers;
			}

			if (fertiliserIsAllowed && (daysSinceLastApplication >= FertMinimumDays) && (TopMineralN <= CriticalSoilN))
			{
				fertiliser.Apply(FertNAmount, FertType, FertApplicationDepth);
				lastApplicationDate = Clock.Today;
			}
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>AutomaticIrrigation</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <allowIrrigation>yes</allowIrrigation>
                  <allowIrrigationAll>yes</allowIrrigationAll>
                  <seasonStart>1-Jan</seasonStart>
                  <seasonEnd>31-Dec</seasonEnd>
                  <seasonsAllocation>10000</seasonsAllocation>
                  <triggerDeficit>99</triggerDeficit>
                  <targetDeficit>100</targetDeficit>
                  <returndays>1</returndays>
                  <maximumAmount>5</maximumAmount>
                  <depthPAWC>600</depthPAWC>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using System.Xml.Serialization;
using Models.PMF;
using APSIM.Shared.Utilities;

        
namespace Models
{
	[Serializable] 
	[System.Xml.Serialization.XmlInclude(typeof(Model))]
	public class Script : Model
	{
		//Communication to other modules
		[Link] ISummary summary = null;
		[Link] Irrigation Irrigation;
		[Link] Clock Clock;
		[Link] Soil Soil;
		[Link(IsOptional = true)] ICrop existingCrop;
	   
		//User inputs from properties tab
		[Description("Turn irrigation on?")] public answerType allowIrrigation { get; set; }
		[Description("Irrigate regardless of crop state?")] public answerType allowIrrigationAll { get; set; }
		[Description("Start of irrigation season (dd-MMM)")]
		public string seasonStart { get; set; }
		[Description("End of irrigation season (dd-MMM)")]
		public string seasonEnd { get; set; }
		[Description("Season allocation (mm)")]
		public double seasonsAllocation { get; set; }
		[Description("Deficit to trigger irrigation (% PAWC)")]
		public double triggerDeficit { get; set; }
		[Description("Deficit to stop irrigaton (% PAWC)")]
		public double targetDeficit { get; set; }
		[Description("Minimum days for irrigation to return")]
		public double returndays { get; set; }
		[Description("Maximum irrigation application (mm/day)")]
		public double maximumAmount { get; set; }
		[Description("Depth to calculate PAWC (mm)")]
		public double depthPAWC { get; set; }
	   
		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		//Class members
		[XmlIgnore] public double TopSWdeficit { get; set; }
		[XmlIgnore] public double TopSWC { get; set; }
		[XmlIgnore] public double DaysSinceIrrigation { get; set; }
		[XmlIgnore] public double AmountToApply { get; set; }
		[XmlIgnore] public double SeasonAppliedAmount { get; set; }
		
		private bool IrrigationIsAllowed { get; set; }
		private bool IrrigationIsAlwaysAllowed { get; set; }
		
		private bool SeasonIsOpen { get; set; }
		private bool CropIsActive { get; set; }
		private bool IrrigatorIsAvailable { get; set; }
		private bool SoilIsDry { get; set; }

		private DateTime StartDate;
		private DateTime EndDate;
		private double TopDUL;
		private double TopLL;
		private int nLayers;
	
		//Calculate static soil variables
		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{   
			//Set the season dates
			StartDate = DateTime.Parse(seasonStart + "-" + Clock.Today.Year.ToString());
			EndDate = DateTime.Parse(seasonEnd + "-" + Clock.Today.Year.ToString());
			
			//Can we irrigate at all?
			IrrigationIsAllowed = false; 
			if (allowIrrigation == answerType.yes)
				IrrigationIsAllowed = true; 
			if (allowIrrigationAll == answerType.yes)
				IrrigationIsAlwaysAllowed = true; 





			//Calculate soil water variables
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			nLayers = Soil.SoilWater.Thickness.Length;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopLL += Soil.SoilWater.LL15mm[layer] * fracLayer;
				TopDUL += Soil.SoilWater.DULmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
		}
	   	  
		//Determine daily requirement for irrigation
		[EventSubscribe("StartOfDay")]
		private void OnStartOfDay(object sender, EventArgs e)
		{
			//Can we irrigate today?		  
			SeasonIsOpen = isBetween(Clock.Today, StartDate, EndDate);

			//Is there a crop in the ground that needs irrigation?
			CropIsActive = false;
			if (IrrigationIsAlwaysAllowed)
				CropIsActive = true;  // might not be but we don't care
			else if ((existingCrop != null) && (existingCrop.IsAlive))
				CropIsActive = true;
			//if ((existingCrop.Phenology.Stage >= 3.0) && (existingCrop.Phenology.Stage < 6.0))
	      
			//Is the irrigator available?
			IrrigatorIsAvailable = false;
			DaysSinceIrrigation += 1;
			if (DaysSinceIrrigation >= returndays)
				IrrigatorIsAvailable = true;
	      
			//Is the soil dry enough to require irrigation?
			SoilIsDry = false;
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopSWC = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			//for (int layer = 0; depthFromSurface < depthPAWC + Soil.SoilWater.Thickness[layer]; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopSWC += Soil.SoilWater.SWmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
			
			TopSWdeficit = TopSWC - TopDUL;
			if (Math.Max(0.0, -TopSWdeficit) >= (TopDUL - TopLL) * (100 - triggerDeficit) / 100)
				SoilIsDry = true;
	            
			//Are all the conditions ratifying irrigation
			if (IrrigationIsAllowed && SeasonIsOpen && CropIsActive && IrrigatorIsAvailable && SoilIsDry)
			{
				//Lets bloody well irrigate then!!!!
				AmountToApply = TopDUL * targetDeficit / 100 - TopSWC;
				AmountToApply = Math.Max(0.0, Math.Min(AmountToApply, seasonsAllocation - SeasonAppliedAmount));
				Irrigation.Apply(AmountToApply);
				DaysSinceIrrigation = 0;
				SeasonAppliedAmount += AmountToApply;
			}
		}
		
		///Checks whether theDate is between iniDate and endDate (non-year specific)
		private bool isBetween(DateTime theDay, DateTime iniDate, DateTime endDate)
		{
			bool result = false;
			if (iniDate.DayOfYear < endDate.DayOfYear)
			{
				// period is within one year, ex: summer in the northern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) && (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			else
			{
				// period goes over the end of the year, ex: summer in the southern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) || (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			
			return result;
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>CutRotation</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <rotationAllowed>True</rotationAllowed>
                  <CutRotationStartDate>1900-07-01</CutRotationStartDate>
                  <CutRotationEndDate>2100-12-31</CutRotationEndDate>
                  <CutInterval>1</CutInterval>
                  <IntervalType>FixedInterval</IntervalType>
                  <DurationOfCut>1</DurationOfCut>
                  <RemoveAmountType>ResidualDM</RemoveAmountType>
                  <AmountGiven>2250</AmountGiven>
                  <DMRemoveType>RemoveAll</DMRemoveType>
                  <FractionN2Remove>1</FractionN2Remove>
                  <ProportionN2Dung>0</ProportionN2Dung>
                </Script>
                <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Do the grazing/cutting?: ")] public bool rotationAllowed { get; set; }
		[Description("Date to begin the rotation: ")] public DateTime CutRotationStartDate { get; set; }
		[Description("Date to finish the rotation: ")] public DateTime CutRotationEndDate { get; set; }
		[Description("Rotation interval (days): ")] public int CutInterval { get; set; }
		[Description("How the interval is defined: ")] public rotationIntervalTypes IntervalType { get; set; }
		[Description("Duration of each event (days): ")] public int DurationOfCut { get; set; }
		[Description("What amount is being defined: ")] public removeAmountTypes RemoveAmountType { get; set; }
		[Description("Amount to use (kg/ha): ")] public double AmountGiven { get; set; }
		[Description("Fraction of DM that is removed from the field:")] public removeDMTypes DMRemoveType { get; set; }
		[Description("Fraction of N that is removed from the field (0-1):")] public double FractionN2Remove { get; set; }
		[Description("Proportion of N returned in dung (0-1):")] public double ProportionN2Dung { get; set; }

		// - Outputs from this manager
		[XmlIgnore][Units("g/m2")] public double DefoliatedWt { get; set; }
		// Description: Pasture DM defoliated today
		[XmlIgnore][Units("g/m2")] public double DefoliatedN { get; set; }
		// Description: Pasture N defoliate today
		[XmlIgnore][Units("g/m2")] public double HarvestedWt { get; set; }
		// Description: Pasture DM harvested today
		[XmlIgnore][Units("g/m2")] public double HarvestedN { get; set; }
		// Description: Pasture N harvested today
		[XmlIgnore][Units("g/m2")] public double RemovedWt { get; set; }
		// Description: Pasture DM removed from the field
		[XmlIgnore][Units("g/m2")] public double RemovedN { get; set; }
		// Description: Pasture N removed from the field
		[XmlIgnore][Units("g/m2")] public double ReturnedWt { get; set; }
		// Description: Residue DM returned to the field
		[XmlIgnore][Units("g/m2")] public double ReturnedN { get; set; }
		// Description: Residue N returned to the field
		[XmlIgnore][Units("g/m2")] public double NReturnedInDung { get; set; }
		// Description: Harvested N returned as dung (SurfaceOM)
		[XmlIgnore][Units("g/m2")] public double NReturnedInUrine { get; set; }
		// Description: Harvested N returned as urine (urea)
		[XmlIgnore][Units("day")] public int DaysAfterCut { get; set; }
		// Description: Number of days after last defoliation
		[XmlIgnore][Units("g/m2")] public double PreHarvestDM { get; set; }
		// Description: Total standing DM (Leaf + Stem/Sheath) before cut
		[XmlIgnore][Units("g/m2")] public double PostHarvestDM { get; set; }
		// Description: Total standing DM (Leaf + Stem/Sheath) after cut
		
		// - Internal variables
		// fraction of harvested Dm to actually remove from field
		private double fractionDM2Remove = 1.0;
		// flag whether defoliation is allowed
		//private bool rotationAllowed = true;
		// number of days for each defoliation event
		private int cuttingDuration = 0;
		// counter for day within each defoliation
		private int daysCutting = 0;
		// type of interval (Fixed or target)
		private string intervalType;
		// total herbage to remove in g/m2 per day
		private double herbageToRemove;
		// type of DM amount (ResidualDM or DMToRemove)
		private string amountType;
		// auxiliary flag for defoliation
		private bool aCutHasHappened = false;

		// - Event to add residue or dung to surface OM
		public event BiomassRemovedDelegate BiomassRemoved;

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				Pasture.Add(species);
			}

			// reset variables
			DaysAfterCut = 0;
			resetVariables();
			cuttingDuration = DurationOfCut;
			
			// get the type of amount given
			if (RemoveAmountType == removeAmountTypes.ResidualDM)
				amountType = "SetResidueAmount";
			else
				amountType = "SetRemoveAmount";

			// get the type of amount given
			if (IntervalType == rotationIntervalTypes.FixedInterval)
				intervalType = "Fixed";
			else
				intervalType = "Target";

			// make sure that rotation starts when startDate < simulationStartDay
			if ((Clock.Today > CutRotationStartDate) && (Clock.Today < CutRotationEndDate))
				CutRotationStartDate = Clock.Today;
		}
		
		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			if (rotationAllowed)
			{
				if (Clock.Today == CutRotationStartDate)
					DaysAfterCut = CutInterval;

				bool SwardIsAlive = false;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				{
					if (species.IsAlive)
						SwardIsAlive = true;
				}
				
				// Check whether we can defoliate
				if ((Clock.Today >= CutRotationStartDate) && (Clock.Today <= CutRotationEndDate) && (SwardIsAlive))
				{
					// Check whether we should start a defoliation
					if (DaysAfterCut >= (CutInterval - 1))
					{
						Graze(AmountGiven, amountType, DurationOfCut);
					}
				}
			}

			// Check whether we need to continue cutting
			if ((daysCutting > 0) && (daysCutting < cuttingDuration))
			{
				// reset outputs
				resetVariables();

				removeDM(herbageToRemove);
				returnExcreta();
				daysCutting += 1;
				if (daysCutting == cuttingDuration)
				{
					PostHarvestDM = 0.0;
					foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
						PostHarvestDM += species.StandingHerbageWt;
				}
			}

			// reset outputs
			if (daysCutting < 0)
			{
				resetVariables();
				daysCutting = 0;
			}
		}

		[EventSubscribe("DoManagementCalculations")]
		private void OnDoManagementCalculations(object sender, EventArgs e)
		{
			// Check whether a cutting has finished
			if (daysCutting == cuttingDuration)
			{
				aCutHasHappened = true;
				daysCutting = -1;
			}

			// Increase the counter for days after cutting
			if (aCutHasHappened && (daysCutting == 0))
				DaysAfterCut += 1;
		}

		public enum removeAmountTypes
		{
			/// <summary>Setting DM amount to remove</summary>
			DMToRemove,
			/// <summary>Setting residual DM amount</summary>
			ResidualDM
		}

		public enum rotationIntervalTypes
		{
			/// <summary>Setting a fixed interval</summary>
			FixedInterval,
			/// <summary>Setting a target (minimum) inteval</summary>
			TargetInterval
		}

		public enum removeDMTypes
		{
			/// <summary>Remove all DM</summary>
			RemoveAll,
			/// <summary>Remove no DM</summary>
			RemoveNone,
			/// <summary>Remove a fraction based on digestibility</summary>
			BasedOnDigestibility
		}

		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}
		
				
		// Resets the values of all outputs
		private void resetVariables()
		{
			DefoliatedWt = 0.0;
			DefoliatedN = 0.0;
			HarvestedWt = 0.0;
			HarvestedN = 0.0;
			RemovedWt = 0.0;
			RemovedN = 0.0;
			ReturnedWt = 0.0;
			ReturnedN = 0.0;
			NReturnedInDung = 0.0;
			NReturnedInUrine = 0.0;
		}

		// Description: Perform the basic calculations for defoliation
		public void Graze(double amountDM, string amountType, int duration)
		{
			// Get the existing plant amount
			PreHarvestDM = 0.0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				PreHarvestDM += species.StandingHerbageWt;
			
			// Check the amount to remove and print some info
			if ((amountType == "SetRemoveAmount") && (PreHarvestDM >= amountDM / duration))
			{
				summary.WriteMessage(this, "   Defoliating " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = amountDM / duration;
			}
			else if ((amountType == "SetResidueAmount") && (PreHarvestDM >= amountDM))
			{
				summary.WriteMessage(this, "   Defoliating down to approximately " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = (PreHarvestDM - amountDM) / duration;
			}
			else
			{
				summary.WriteMessage(this, "   Defoliation will not happend because there is not enough plant material");
				if (intervalType == "Fixed")
					DaysAfterCut = -duration;
				return;
			}

			cuttingDuration = duration;
			// Preform first defoliation
			removeDM(herbageToRemove);
			returnExcreta();
			daysCutting = 1;
			DaysAfterCut = 0;
			if (daysCutting == cuttingDuration)
			{
				PostHarvestDM = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					PostHarvestDM += species.StandingHerbageWt;
			}
		}

		// Do the DM removal
		private void removeDM(double removeAmount)
		{
			double existingWt = 0.0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				existingWt += species.HarvestableWt;


			// Check whether we harvest anything
			if (existingWt >= removeAmount)
			{
				foreach (AgPasture.PastureSpecies species in Pasture)
				{
					double amountToRemove = removeAmount * species.HarvestableWt / existingWt;
					species.Graze(amount: amountToRemove, type: "SetRemoveAmount");
				}
				
				// get total harvested
				DefoliatedWt = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					DefoliatedWt += species.HarvestedWt;
				DefoliatedN = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					DefoliatedN += species.HarvestedN;
				HarvestedWt = DefoliatedWt;
				HarvestedN = DefoliatedN;

				// get amounts actually removed from field and that to be returned (dung/urine)
				if (DMRemoveType == removeDMTypes.RemoveAll)
					fractionDM2Remove = 1.0;
				else if (DMRemoveType == removeDMTypes.RemoveNone)
					fractionDM2Remove = 0.0;
				else
				{
					fractionDM2Remove = 0.0;
					foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
						fractionDM2Remove += species.HarvestedDigestibility * species.HarvestedWt;
					fractionDM2Remove /= removeAmount;
				}
				
				RemovedWt = HarvestedWt * fractionDM2Remove;
				RemovedN = HarvestedN * FractionN2Remove;
				ReturnedWt = HarvestedWt - RemovedWt;
				ReturnedN = HarvestedN - RemovedN;
				NReturnedInDung = ReturnedN * ProportionN2Dung;
				NReturnedInUrine = ReturnedN - NReturnedInDung;
			}
		}

		// Return dung and urine
		private void returnExcreta()
		{
			if ((ReturnedWt > 0.0) || (NReturnedInDung > 0.0))
			{
				PMF.BiomassRemovedType BiomassDung = new PMF.BiomassRemovedType();
				string[] type = new string[] { "RuminantDung_PastureFed" };
				float[] dltdm = new float[] { (Single)ReturnedWt };
				float[] dltn = new float[] { (Single)NReturnedInDung };
				float[] dltp = new float[] { 0 };
				float[] fraction = new float[] { 1 };     // fraction is always 1.0 here

				BiomassDung.crop_type = "RuminantDung_PastureFed";
				BiomassDung.dm_type = type;
				BiomassDung.dlt_crop_dm = dltdm;
				BiomassDung.dlt_dm_n = dltn;
				BiomassDung.dlt_dm_p = dltp;
				BiomassDung.fraction_to_residue = fraction;
				BiomassRemoved.Invoke(BiomassDung);
			}

			if (NReturnedInUrine > 0.0)
			{
				fertiliser.Apply(NReturnedInUrine * 10, Fertiliser.Types.UreaN, 1.0);
			}
		}
	}
}
]]></Code>
              </Manager>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ShowPageOfGraphs>true</ShowPageOfGraphs>
            </Folder>
            <MicroClimate>
              <Name>MicroClimate</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <a_interception>0</a_interception>
              <b_interception>1</b_interception>
              <c_interception>0</c_interception>
              <d_interception>0</d_interception>
              <soil_albedo>0.23</soil_albedo>
              <sun_angle>15</sun_angle>
              <soil_heat_flux_fraction>0.4</soil_heat_flux_fraction>
              <night_interception_fraction>0.5</night_interception_fraction>
              <refheight>2</refheight>
              <albedo>0.15</albedo>
              <emissivity>0.96</emissivity>
              <RadIntTotal>0</RadIntTotal>
            </MicroClimate>
            <Irrigation>
              <Name>Irrigation</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Irrigation>
            <Fertiliser>
              <Name>Fertiliser</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Fertiliser>
            <SurfaceOrganicMatter>
              <Name>SurfaceOrganicMatter</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <PondActive>no</PondActive>
              <ReportAdditions>no</ReportAdditions>
              <ReportRemovals>no</ReportRemovals>
              <ResidueTypes>
                <Name>ResidueTypes</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LoadFromResource>ResidueTypes</LoadFromResource>
              </ResidueTypes>
              <TillageTypes>
                <Name>TillageTypesList</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <TillageType />
              </TillageTypes>
              <Pools>
                <Pool>
                  <PoolName>Sward</PoolName>
                  <ResidueType>grass</ResidueType>
                  <Mass>0</Mass>
                  <CNRatio>15</CNRatio>
                  <CPRatio>NaN</CPRatio>
                  <StandingFraction>0</StandingFraction>
                </Pool>
              </Pools>
              <PoolName>Sward</PoolName>
              <type>grass</type>
              <mass>0</mass>
              <standing_fraction>0</standing_fraction>
              <cpr />
              <cnr>15</cnr>
              <CriticalResidueWeight>2000</CriticalResidueWeight>
              <OptimumDecompTemp>20</OptimumDecompTemp>
              <MaxCumulativeEOS>20</MaxCumulativeEOS>
              <CNRatioDecompCoeff>0.277</CNRatioDecompCoeff>
              <CNRatioDecompThreshold>25</CNRatioDecompThreshold>
              <TotalLeachRain>25</TotalLeachRain>
              <MinRainToLeach>10</MinRainToLeach>
              <CriticalMinimumOrganicC>0.004</CriticalMinimumOrganicC>
              <DefaultCPRatio>0</DefaultCPRatio>
              <DefaultStandingFraction>0</DefaultStandingFraction>
              <StandingExtinctCoeff>0.5</StandingExtinctCoeff>
              <FractionFaecesAdded>0.5</FractionFaecesAdded>
            </SurfaceOrganicMatter>
            <Soil>
              <Name>Soil</Name>
              <Analysis>
                <Name>Analysis</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <Rocks>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </Rocks>
                <Texture />
                <MunsellColour />
                <PH>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                </PH>
                <CEC>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                </CEC>
                <ParticleSizeSand>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                </ParticleSizeSand>
                <ParticleSizeSilt>
                  <double>30</double>
                  <double>30</double>
                  <double>30</double>
                  <double>30</double>
                </ParticleSizeSilt>
                <ParticleSizeClay>
                  <double>60</double>
                  <double>60</double>
                  <double>60</double>
                  <double>60</double>
                </ParticleSizeClay>
                <PHUnits>Water</PHUnits>
                <BoronUnits>HotWater</BoronUnits>
              </Analysis>
              <Water>
                <Name>Water</Name>
                <SoilCrop>
                  <Name>RyegrassSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                  </LL>
                  <KL>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>WhiteCloverSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                  </LL>
                  <KL>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                  </XF>
                </SoilCrop>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <BD>
                  <double>1.3</double>
                  <double>1.3</double>
                  <double>1.3</double>
                  <double>1.3</double>
                </BD>
                <AirDry>
                  <double>0.05</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </AirDry>
                <LL15>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </LL15>
                <DUL>
                  <double>0.45</double>
                  <double>0.45</double>
                  <double>0.45</double>
                  <double>0.45</double>
                </DUL>
                <SAT>
                  <double>0.5</double>
                  <double>0.5</double>
                  <double>0.5</double>
                  <double>0.5</double>
                </SAT>
                <KS>
                  <double>500</double>
                  <double>500</double>
                  <double>500</double>
                  <double>500</double>
                </KS>
              </Water>
              <SoilWater>
                <Name>SoilWater</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <SummerDate>1-Nov</SummerDate>
                <SummerU>6</SummerU>
                <SummerCona>3.5</SummerCona>
                <WinterDate>1-apr</WinterDate>
                <WinterU>6</WinterU>
                <WinterCona>3.5</WinterCona>
                <DiffusConst>88</DiffusConst>
                <DiffusSlope>35</DiffusSlope>
                <Salb>0.13</Salb>
                <CN2Bare>73</CN2Bare>
                <CNRed>20</CNRed>
                <CNCov>0.8</CNCov>
                <slope>0</slope>
                <discharge_width>0</discharge_width>
                <catchment_area>0</catchment_area>
                <max_pond>0</max_pond>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <SWCON>
                  <double>0.3</double>
                  <double>0.3</double>
                  <double>0.3</double>
                  <double>0.3</double>
                </SWCON>
                <KLAT>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </KLAT>
                <residueinterception>0</residueinterception>
              </SoilWater>
              <SoilNitrogen>
                <Name>SoilNitrogen</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <fom_type>
                  <string>default</string>
                  <string>manure</string>
                  <string>mucuna</string>
                  <string>lablab</string>
                  <string>shemp</string>
                  <string>stable</string>
                </fom_type>
                <fract_carb>
                  <double>0.2</double>
                  <double>0.3</double>
                  <double>0.54</double>
                  <double>0.57</double>
                  <double>0.45</double>
                  <double>0</double>
                </fract_carb>
                <fract_cell>
                  <double>0.7</double>
                  <double>0.3</double>
                  <double>0.37</double>
                  <double>0.37</double>
                  <double>0.47</double>
                  <double>0.1</double>
                </fract_cell>
                <fract_lign>
                  <double>0.1</double>
                  <double>0.4</double>
                  <double>0.09</double>
                  <double>0.06</double>
                  <double>0.08</double>
                  <double>0.9</double>
                </fract_lign>
                <wfpsN2N2O_x>
                  <double>22</double>
                  <double>88</double>
                </wfpsN2N2O_x>
                <wfpsN2N2O_y>
                  <double>0.1</double>
                  <double>1</double>
                </wfpsN2N2O_y>
                <oc>
                  <double>3.7136764881329496</double>
                  <double>2.4698281813043792</double>
                  <double>1.2383961716086014</double>
                  <double>0.49836009167083023</double>
                </oc>
              </SoilNitrogen>
              <SoilOrganicMatter>
                <Name>SoilOrganicMatter</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <RootCN>40</RootCN>
                <RootWt>0</RootWt>
                <SoilCN>12</SoilCN>
                <EnrACoeff>7.4</EnrACoeff>
                <EnrBCoeff>0.2</EnrBCoeff>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <Depth>
                  <string>0-15</string>
                  <string>15-30</string>
                  <string>30-45</string>
                  <string>45-60</string>
                </Depth>
                <OC>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </OC>
                <FBiom>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </FBiom>
                <FInert>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </FInert>
                <OCUnits>Total</OCUnits>
              </SoilOrganicMatter>
              <InitialWater>
                <Name>Initial water</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <PercentMethod>EvenlyDistributed</PercentMethod>
                <FractionFull>0.95</FractionFull>
                <DepthWetSoil>NaN</DepthWetSoil>
              </InitialWater>
              <Sample>
                <Name>Initial nitrogen</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <NO3>
                  <double>15</double>
                  <double>15</double>
                  <double>15</double>
                  <double>15</double>
                </NO3>
                <NH4>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </NH4>
                <NO3Units>ppm</NO3Units>
                <NH4Units>ppm</NH4Units>
                <SWUnits>Volumetric</SWUnits>
                <OCUnits>Total</OCUnits>
                <PHUnits>Water</PHUnits>
              </Sample>
              <CERESSoilTemperature>
                <Name>CERESSoilTemperature</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
              </CERESSoilTemperature>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <RecordNumber>0</RecordNumber>
              <SoilType />
              <LocalName>Stores lots of water</LocalName>
              <Site>Made up</Site>
              <NearestTown />
              <Region />
              <Country />
              <NaturalVegetation />
              <Latitude>0</Latitude>
              <Longitude>0</Longitude>
            </Soil>
            <SoluteManager>
              <Name>SoluteManager</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </SoluteManager>
            <PastureSpecies>
              <Name>Ryegrass</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <MaximumNUptake>10</MaximumNUptake>
              <Albedo>0.26</Albedo>
              <Gsmax>0.011</Gsmax>
              <R50>200</R50>
              <SpeciesFamily>Grass</SpeciesFamily>
              <PhotosyntheticPathway>C3</PhotosyntheticPathway>
              <InitialShootDM>2500</InitialShootDM>
              <InitialRootDM>500</InitialRootDM>
              <InitialRootDepth>600</InitialRootDepth>
              <ReferencePhotosyntheticRate>1</ReferencePhotosyntheticRate>
              <LightExtinctionCoefficient>0.5</LightExtinctionCoefficient>
              <GrowthTminimum>1</GrowthTminimum>
              <GrowthToptimum>20</GrowthToptimum>
              <GrowthTEffectExponent>1.7</GrowthTEffectExponent>
              <UseHeatStressFactor>yes</UseHeatStressFactor>
              <HeatOnsetTemperature>28</HeatOnsetTemperature>
              <HeatFullTemperature>35</HeatFullTemperature>
              <HeatRecoverySumDD>30</HeatRecoverySumDD>
              <HeatRecoveryTReference>25</HeatRecoveryTReference>
              <UseColdStressFactor>yes</UseColdStressFactor>
              <ColdOnsetTemperature>1</ColdOnsetTemperature>
              <ColdFullTemperature>-5</ColdFullTemperature>
              <ColdRecoverySumDD>25</ColdRecoverySumDD>
              <ColdRecoveryTReference>0</ColdRecoveryTReference>
              <MaintenanceRespirationCoefficient>0.03</MaintenanceRespirationCoefficient>
              <GrowthRespirationCoefficient>0.25</GrowthRespirationCoefficient>
              <RespirationTReference>20</RespirationTReference>
              <RespirationExponent>1.5</RespirationExponent>
              <NThresholdsForLeaves>
                <double>0.04</double>
                <double>0.012</double>
                <double>0.05</double>
              </NThresholdsForLeaves>
              <NThresholdsForStems>
                <double>0.02</double>
                <double>0.006</double>
                <double>0.025</double>
              </NThresholdsForStems>
              <NThresholdsForStolons>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </NThresholdsForStolons>
              <NThresholdsForRoots>
                <double>0.02</double>
                <double>0.006</double>
                <double>0.025</double>
              </NThresholdsForRoots>
              <DegreesDayForGermination>125</DegreesDayForGermination>
              <TargetShootRootRatio>4</TargetShootRootRatio>
              <MaxRootAllocation>0.25</MaxRootAllocation>
              <ShootRootGlfFactor>0.5</ShootRootGlfFactor>
              <UseReproSeasonFactor>yes</UseReproSeasonFactor>
              <ReproSeasonReferenceLatitude>41</ReproSeasonReferenceLatitude>
              <ReproSeasonTimingCoeff>0.14</ReproSeasonTimingCoeff>
              <ReproSeasonMaxAllocationIncrease>0.5</ReproSeasonMaxAllocationIncrease>
              <ReproSeasonAllocationCoeff>0.1</ReproSeasonAllocationCoeff>
              <FractionLeafMaximum>0.7</FractionLeafMaximum>
              <FractionLeafMinimum>0.7</FractionLeafMinimum>
              <FractionLeafDMThreshold>500</FractionLeafDMThreshold>
              <FractionLeafDMFactor>2000</FractionLeafDMFactor>
              <FractionLeafExponent>3</FractionLeafExponent>
              <FractionToStolon>0</FractionToStolon>
              <SpecificLeafArea>25</SpecificLeafArea>
              <SpecificRootLength>100</SpecificRootLength>
              <StolonEffectOnLAI>0</StolonEffectOnLAI>
              <ShootMaxEffectOnLAI>1000</ShootMaxEffectOnLAI>
              <MaxStemEffectOnLAI>1</MaxStemEffectOnLAI>
              <LiveLeavesPerTiller>3</LiveLeavesPerTiller>
              <TissueTurnoverRateShoot>0.05</TissueTurnoverRateShoot>
              <TissueTurnoverRateRoot>0.02</TissueTurnoverRateRoot>
              <DetachmentRateShoot>0.08</DetachmentRateShoot>
              <TurnoverTemperatureMin>2</TurnoverTemperatureMin>
              <TurnoverTemperatureRef>20</TurnoverTemperatureRef>
              <TurnoverTemperatureExponent>1</TurnoverTemperatureExponent>
              <TurnoverDroughtEffectMax>1</TurnoverDroughtEffectMax>
              <TurnoverDroughtThreshold>0.5</TurnoverDroughtThreshold>
              <TurnoverDefoliationCoefficient>0.5</TurnoverDefoliationCoefficient>
              <TurnoverDefoliationRootEffect>0.1</TurnoverDefoliationRootEffect>
              <FractionNLuxuryRemobilisable>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </FractionNLuxuryRemobilisable>
              <MinimumNFixation>0</MinimumNFixation>
              <MaximumNFixation>0</MaximumNFixation>
              <SoilSaturationEffectMax>0.1</SoilSaturationEffectMax>
              <MinimumWaterFreePorosity>-1</MinimumWaterFreePorosity>
              <SoilSaturationRecoveryFactor>0.25</SoilSaturationRecoveryFactor>
              <NDillutionCoefficient>0.25</NDillutionCoefficient>
              <GlfGeneric>1</GlfGeneric>
              <GlfSoilFertility>1</GlfSoilFertility>
              <PlantHeightMinimum>25</PlantHeightMinimum>
              <PlantHeightMaximum>600</PlantHeightMaximum>
              <PlantHeightMassForMax>10000</PlantHeightMassForMax>
              <PlantHeightExponent>2.8</PlantHeightExponent>
              <RootDepthMinimum>50</RootDepthMinimum>
              <RootDepthMaximum>750</RootDepthMaximum>
              <RootElongationRate>25</RootElongationRate>
              <RootDistributionDepthParam>90</RootDistributionDepthParam>
              <RootDistributionExponent>3.2</RootDistributionExponent>
              <DigestibilitiesCellWall>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.2</double>
              </DigestibilitiesCellWall>
              <MinimumGreenWt>100</MinimumGreenWt>
              <FractionStolonStanding>0</FractionStolonStanding>
              <PreferenceForGreenOverDead>1</PreferenceForGreenOverDead>
              <PreferenceForLeafOverStems>1</PreferenceForLeafOverStems>
              <WaterAvailableMethod>DefaultAPSIM</WaterAvailableMethod>
              <NitrogenAvailableMethod>BasicAgPasture</NitrogenAvailableMethod>
            </PastureSpecies>
            <Report>
              <Name>TestWithNoStress</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ExperimentFactorNames />
              <ExperimentFactorValues />
              <VariableNames>
                <string>[Clock].Today as Date</string>
                <string>[Ryegrass].AboveGroundWt as PlantMass</string>
                <string>[Ryegrass].HarvestedWt as Harvested</string>
                <string>[Ryegrass].WaterDemand as SW_Demand</string>
                <string>sum([Ryegrass].WaterUptake) as SW_Uptake</string>
                <string>[Ryegrass].GlfWaterSupply as glfWater</string>
                <string>[Ryegrass].GlfNSupply as glfNitrogen</string>
                <string>sum([Soil].SoilWater.SWmm) as SoilWater</string>
                <string>sum([Soil].SoilNitrogen.NH4)+sum([Soil].SoilNitrogen.NO3) as SoilNitrogen</string>
                <string>[Irrigation].IrrigationApplied as Irrigation</string>
                <string>[Fertiliser].NitrogenApplied as Fertiliser</string>
              </VariableNames>
              <EventNames>
                <string>[Clock].EndOfDay</string>
              </EventNames>
            </Report>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <Area>1</Area>
            <Slope>0</Slope>
          </Zone>
          <Zone>
            <Name>Zone1</Name>
            <Folder>
              <Name>Managers</Name>
              <Manager>
                <Name>AutomaticFertiliser</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <AllowFertiliser>yes</AllowFertiliser>
                  <Depth2SoilN>600</Depth2SoilN>
                  <CriticalSoilN>100</CriticalSoilN>
                  <FertNAmount>50</FertNAmount>
                  <FertType>UreaN</FertType>
                  <FertApplicationDepth>1</FertApplicationDepth>
                  <FertMinimumDays>1</FertMinimumDays>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using APSIM.Shared.Utilities;
using System.Xml.Serialization;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		[Link] Soil Soil;

		//User inputs from properties tab
		[Description("Turn ferliser applications on? ")]
		public yesnoType AllowFertiliser { get; set; }
		
		[Description("Depth to calculate available soil N (mm): ")]
		public double Depth2SoilN { get; set; }

		[Description("Minimum available N, triggers an application (kgN/ha): ")]
		public double CriticalSoilN { get; set; }

		[Description("Amount of N fertiliser for each application (kgN/ha): ")]
		public double FertNAmount { get; set; }

		[Description("Type of N fertiliser to apply: ")]
		public Fertiliser.Types FertType { get; set; }

		[Description("Depth at which to apply the fertiliser (mm): ")]
		public double FertApplicationDepth { get; set; }
	   
		[Description("Minimum period between applications (days): ")]
		public double FertMinimumDays { get; set; }
	   
		public enum yesnoType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		[XmlIgnore] public double TopMineralN { get; set; }
		
		private DateTime lastApplicationDate;
		private bool fertiliserIsAllowed;
		private int nLayers;

		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{
			fertiliserIsAllowed = (AllowFertiliser == yesnoType.yes);
			nLayers = Soil.SoilWater.Thickness.Length;
		}

		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			double daysSinceLastApplication = (Clock.Today - lastApplicationDate).TotalDays;
			
			// get the N stored in the soil
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopMineralN = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (Depth2SoilN - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopMineralN += (Soil.SoilNitrogen.NO3[layer]
				+ Soil.SoilNitrogen.NH4[layer]
				+ Soil.SoilNitrogen.urea[layer])
				* fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= Depth2SoilN)
					layer = nLayers;
			}

			if (fertiliserIsAllowed && (daysSinceLastApplication >= FertMinimumDays) && (TopMineralN <= CriticalSoilN))
			{
				fertiliser.Apply(FertNAmount, FertType, FertApplicationDepth);
				lastApplicationDate = Clock.Today;
			}
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>AutomaticIrrigation</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <allowIrrigation>yes</allowIrrigation>
                  <allowIrrigationAll>yes</allowIrrigationAll>
                  <seasonStart>1-Jan</seasonStart>
                  <seasonEnd>31-Dec</seasonEnd>
                  <seasonsAllocation>10000</seasonsAllocation>
                  <triggerDeficit>99</triggerDeficit>
                  <targetDeficit>100</targetDeficit>
                  <returndays>1</returndays>
                  <maximumAmount>5</maximumAmount>
                  <depthPAWC>600</depthPAWC>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using System.Xml.Serialization;
using Models.PMF;
using APSIM.Shared.Utilities;

        
namespace Models
{
	[Serializable] 
	[System.Xml.Serialization.XmlInclude(typeof(Model))]
	public class Script : Model
	{
		//Communication to other modules
		[Link] ISummary summary = null;
		[Link] Irrigation Irrigation;
		[Link] Clock Clock;
		[Link] Soil Soil;
		[Link(IsOptional = true)] ICrop existingCrop;
	   
		//User inputs from properties tab
		[Description("Turn irrigation on?")] public answerType allowIrrigation { get; set; }
		[Description("Irrigate regardless of crop state?")] public answerType allowIrrigationAll { get; set; }
		[Description("Start of irrigation season (dd-MMM)")]
		public string seasonStart { get; set; }
		[Description("End of irrigation season (dd-MMM)")]
		public string seasonEnd { get; set; }
		[Description("Season allocation (mm)")]
		public double seasonsAllocation { get; set; }
		[Description("Deficit to trigger irrigation (% PAWC)")]
		public double triggerDeficit { get; set; }
		[Description("Deficit to stop irrigaton (% PAWC)")]
		public double targetDeficit { get; set; }
		[Description("Minimum days for irrigation to return")]
		public double returndays { get; set; }
		[Description("Maximum irrigation application (mm/day)")]
		public double maximumAmount { get; set; }
		[Description("Depth to calculate PAWC (mm)")]
		public double depthPAWC { get; set; }
	   
		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		//Class members
		[XmlIgnore] public double TopSWdeficit { get; set; }
		[XmlIgnore] public double TopSWC { get; set; }
		[XmlIgnore] public double DaysSinceIrrigation { get; set; }
		[XmlIgnore] public double AmountToApply { get; set; }
		[XmlIgnore] public double SeasonAppliedAmount { get; set; }
		
		private bool IrrigationIsAllowed { get; set; }
		private bool IrrigationIsAlwaysAllowed { get; set; }
		
		private bool SeasonIsOpen { get; set; }
		private bool CropIsActive { get; set; }
		private bool IrrigatorIsAvailable { get; set; }
		private bool SoilIsDry { get; set; }

		private DateTime StartDate;
		private DateTime EndDate;
		private double TopDUL;
		private double TopLL;
		private int nLayers;
	
		//Calculate static soil variables
		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{   
			//Set the season dates
			StartDate = DateTime.Parse(seasonStart + "-" + Clock.Today.Year.ToString());
			EndDate = DateTime.Parse(seasonEnd + "-" + Clock.Today.Year.ToString());
			
			//Can we irrigate at all?
			IrrigationIsAllowed = false; 
			if (allowIrrigation == answerType.yes)
				IrrigationIsAllowed = true; 
			if (allowIrrigationAll == answerType.yes)
				IrrigationIsAlwaysAllowed = true; 





			//Calculate soil water variables
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			nLayers = Soil.SoilWater.Thickness.Length;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopLL += Soil.SoilWater.LL15mm[layer] * fracLayer;
				TopDUL += Soil.SoilWater.DULmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
		}
	   	  
		//Determine daily requirement for irrigation
		[EventSubscribe("StartOfDay")]
		private void OnStartOfDay(object sender, EventArgs e)
		{
			//Can we irrigate today?		  
			SeasonIsOpen = isBetween(Clock.Today, StartDate, EndDate);

			//Is there a crop in the ground that needs irrigation?
			CropIsActive = false;
			if (IrrigationIsAlwaysAllowed)
				CropIsActive = true;  // might not be but we don't care
			else if ((existingCrop != null) && (existingCrop.IsAlive))
				CropIsActive = true;
			//if ((existingCrop.Phenology.Stage >= 3.0) && (existingCrop.Phenology.Stage < 6.0))
	      
			//Is the irrigator available?
			IrrigatorIsAvailable = false;
			DaysSinceIrrigation += 1;
			if (DaysSinceIrrigation >= returndays)
				IrrigatorIsAvailable = true;
	      
			//Is the soil dry enough to require irrigation?
			SoilIsDry = false;
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopSWC = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			//for (int layer = 0; depthFromSurface < depthPAWC + Soil.SoilWater.Thickness[layer]; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopSWC += Soil.SoilWater.SWmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
			
			TopSWdeficit = TopSWC - TopDUL;
			if (Math.Max(0.0, -TopSWdeficit) >= (TopDUL - TopLL) * (100 - triggerDeficit) / 100)
				SoilIsDry = true;
	            
			//Are all the conditions ratifying irrigation
			if (IrrigationIsAllowed && SeasonIsOpen && CropIsActive && IrrigatorIsAvailable && SoilIsDry)
			{
				//Lets bloody well irrigate then!!!!
				AmountToApply = TopDUL * targetDeficit / 100 - TopSWC;
				AmountToApply = Math.Max(0.0, Math.Min(AmountToApply, seasonsAllocation - SeasonAppliedAmount));
				Irrigation.Apply(AmountToApply);
				DaysSinceIrrigation = 0;
				SeasonAppliedAmount += AmountToApply;
			}
		}
		
		///Checks whether theDate is between iniDate and endDate (non-year specific)
		private bool isBetween(DateTime theDay, DateTime iniDate, DateTime endDate)
		{
			bool result = false;
			if (iniDate.DayOfYear < endDate.DayOfYear)
			{
				// period is within one year, ex: summer in the northern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) && (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			else
			{
				// period goes over the end of the year, ex: summer in the southern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) || (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			
			return result;
		}
	}
}
]]></Code>
              </Manager>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ShowPageOfGraphs>true</ShowPageOfGraphs>
            </Folder>
            <MicroClimate>
              <Name>MicroClimate</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <a_interception>0</a_interception>
              <b_interception>1</b_interception>
              <c_interception>0</c_interception>
              <d_interception>0</d_interception>
              <soil_albedo>0.23</soil_albedo>
              <sun_angle>15</sun_angle>
              <soil_heat_flux_fraction>0.4</soil_heat_flux_fraction>
              <night_interception_fraction>0.5</night_interception_fraction>
              <refheight>2</refheight>
              <albedo>0.15</albedo>
              <emissivity>0.96</emissivity>
              <RadIntTotal>0</RadIntTotal>
            </MicroClimate>
            <Irrigation>
              <Name>Irrigation</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Irrigation>
            <Fertiliser>
              <Name>Fertiliser</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Fertiliser>
            <SurfaceOrganicMatter>
              <Name>SurfaceOrganicMatter</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <PondActive>no</PondActive>
              <ReportAdditions>no</ReportAdditions>
              <ReportRemovals>no</ReportRemovals>
              <ResidueTypes>
                <Name>ResidueTypes</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LoadFromResource>ResidueTypes</LoadFromResource>
              </ResidueTypes>
              <TillageTypes>
                <Name>TillageTypesList</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <TillageType />
              </TillageTypes>
              <Pools>
                <Pool>
                  <PoolName>Sward</PoolName>
                  <ResidueType>grass</ResidueType>
                  <Mass>0</Mass>
                  <CNRatio>15</CNRatio>
                  <CPRatio>NaN</CPRatio>
                  <StandingFraction>0</StandingFraction>
                </Pool>
              </Pools>
              <PoolName>Sward</PoolName>
              <type>grass</type>
              <mass>0</mass>
              <standing_fraction>0</standing_fraction>
              <cpr />
              <cnr>15</cnr>
              <CriticalResidueWeight>2000</CriticalResidueWeight>
              <OptimumDecompTemp>20</OptimumDecompTemp>
              <MaxCumulativeEOS>20</MaxCumulativeEOS>
              <CNRatioDecompCoeff>0.277</CNRatioDecompCoeff>
              <CNRatioDecompThreshold>25</CNRatioDecompThreshold>
              <TotalLeachRain>25</TotalLeachRain>
              <MinRainToLeach>10</MinRainToLeach>
              <CriticalMinimumOrganicC>0.004</CriticalMinimumOrganicC>
              <DefaultCPRatio>0</DefaultCPRatio>
              <DefaultStandingFraction>0</DefaultStandingFraction>
              <StandingExtinctCoeff>0.5</StandingExtinctCoeff>
              <FractionFaecesAdded>0.5</FractionFaecesAdded>
            </SurfaceOrganicMatter>
            <Soil>
              <Name>Soil</Name>
              <Analysis>
                <Name>Analysis</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <Rocks>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </Rocks>
                <Texture />
                <MunsellColour />
                <PH>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                </PH>
                <CEC>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                </CEC>
                <ParticleSizeSand>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                </ParticleSizeSand>
                <ParticleSizeSilt>
                  <double>30</double>
                  <double>30</double>
                  <double>30</double>
                  <double>30</double>
                </ParticleSizeSilt>
                <ParticleSizeClay>
                  <double>60</double>
                  <double>60</double>
                  <double>60</double>
                  <double>60</double>
                </ParticleSizeClay>
                <PHUnits>Water</PHUnits>
                <BoronUnits>HotWater</BoronUnits>
              </Analysis>
              <Water>
                <Name>Water</Name>
                <SoilCrop>
                  <Name>RyegrassSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                  </LL>
                  <KL>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>WhiteCloverSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                  </LL>
                  <KL>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                  </XF>
                </SoilCrop>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <BD>
                  <double>1.3</double>
                  <double>1.3</double>
                  <double>1.3</double>
                  <double>1.3</double>
                </BD>
                <AirDry>
                  <double>0.05</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </AirDry>
                <LL15>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </LL15>
                <DUL>
                  <double>0.45</double>
                  <double>0.45</double>
                  <double>0.45</double>
                  <double>0.45</double>
                </DUL>
                <SAT>
                  <double>0.5</double>
                  <double>0.5</double>
                  <double>0.5</double>
                  <double>0.5</double>
                </SAT>
                <KS>
                  <double>500</double>
                  <double>500</double>
                  <double>500</double>
                  <double>500</double>
                </KS>
              </Water>
              <SoilWater>
                <Name>SoilWater</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <SummerDate>1-Nov</SummerDate>
                <SummerU>6</SummerU>
                <SummerCona>3.5</SummerCona>
                <WinterDate>1-apr</WinterDate>
                <WinterU>6</WinterU>
                <WinterCona>3.5</WinterCona>
                <DiffusConst>88</DiffusConst>
                <DiffusSlope>35</DiffusSlope>
                <Salb>0.13</Salb>
                <CN2Bare>73</CN2Bare>
                <CNRed>20</CNRed>
                <CNCov>0.8</CNCov>
                <slope>0</slope>
                <discharge_width>0</discharge_width>
                <catchment_area>0</catchment_area>
                <max_pond>0</max_pond>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <SWCON>
                  <double>0.3</double>
                  <double>0.3</double>
                  <double>0.3</double>
                  <double>0.3</double>
                </SWCON>
                <KLAT>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </KLAT>
                <residueinterception>0</residueinterception>
              </SoilWater>
              <SoilNitrogen>
                <Name>SoilNitrogen</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <fom_type>
                  <string>default</string>
                  <string>manure</string>
                  <string>mucuna</string>
                  <string>lablab</string>
                  <string>shemp</string>
                  <string>stable</string>
                </fom_type>
                <fract_carb>
                  <double>0.2</double>
                  <double>0.3</double>
                  <double>0.54</double>
                  <double>0.57</double>
                  <double>0.45</double>
                  <double>0</double>
                </fract_carb>
                <fract_cell>
                  <double>0.7</double>
                  <double>0.3</double>
                  <double>0.37</double>
                  <double>0.37</double>
                  <double>0.47</double>
                  <double>0.1</double>
                </fract_cell>
                <fract_lign>
                  <double>0.1</double>
                  <double>0.4</double>
                  <double>0.09</double>
                  <double>0.06</double>
                  <double>0.08</double>
                  <double>0.9</double>
                </fract_lign>
                <wfpsN2N2O_x>
                  <double>22</double>
                  <double>88</double>
                </wfpsN2N2O_x>
                <wfpsN2N2O_y>
                  <double>0.1</double>
                  <double>1</double>
                </wfpsN2N2O_y>
                <oc>
                  <double>3.7136764881329496</double>
                  <double>2.4698281813043792</double>
                  <double>1.2383961716086014</double>
                  <double>0.49836009167083023</double>
                </oc>
              </SoilNitrogen>
              <SoilOrganicMatter>
                <Name>SoilOrganicMatter</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <RootCN>40</RootCN>
                <RootWt>0</RootWt>
                <SoilCN>12</SoilCN>
                <EnrACoeff>7.4</EnrACoeff>
                <EnrBCoeff>0.2</EnrBCoeff>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <Depth>
                  <string>0-15</string>
                  <string>15-30</string>
                  <string>30-45</string>
                  <string>45-60</string>
                </Depth>
                <OC>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </OC>
                <FBiom>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </FBiom>
                <FInert>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </FInert>
                <OCUnits>Total</OCUnits>
              </SoilOrganicMatter>
              <InitialWater>
                <Name>Initial water</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <PercentMethod>EvenlyDistributed</PercentMethod>
                <FractionFull>0.95</FractionFull>
                <DepthWetSoil>NaN</DepthWetSoil>
              </InitialWater>
              <Sample>
                <Name>Initial nitrogen</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <NO3>
                  <double>15</double>
                  <double>15</double>
                  <double>15</double>
                  <double>15</double>
                </NO3>
                <NH4>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </NH4>
                <NO3Units>ppm</NO3Units>
                <NH4Units>ppm</NH4Units>
                <SWUnits>Volumetric</SWUnits>
                <OCUnits>Total</OCUnits>
                <PHUnits>Water</PHUnits>
              </Sample>
              <CERESSoilTemperature>
                <Name>CERESSoilTemperature</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
              </CERESSoilTemperature>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <RecordNumber>0</RecordNumber>
              <SoilType />
              <LocalName>Stores lots of water</LocalName>
              <Site>Made up</Site>
              <NearestTown />
              <Region />
              <Country />
              <NaturalVegetation />
              <Latitude>0</Latitude>
              <Longitude>0</Longitude>
            </Soil>
            <SoluteManager>
              <Name>SoluteManager</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </SoluteManager>
            <Report>
              <Name>TestWithNoStress</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ExperimentFactorNames />
              <ExperimentFactorValues />
              <VariableNames>
                <string>[Clock].Today as Date</string>
                <string>sum([Soil].SoilWater.SWmm) as SoilWater</string>
                <string>sum([Soil].SoilNitrogen.NH4)+sum([Soil].SoilNitrogen.NO3) as SoilNitrogen</string>
                <string>[Irrigation].IrrigationApplied as Irrigation</string>
                <string>[Fertiliser].NitrogenApplied as Fertiliser</string>
              </VariableNames>
              <EventNames>
                <string>[Clock].EndOfDay</string>
              </EventNames>
            </Report>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <Area>1</Area>
            <Slope>0</Slope>
          </Zone>
          <IncludeInDocumentation>true</IncludeInDocumentation>
        </Simulation>
        <IncludeInDocumentation>true</IncludeInDocumentation>
      </Experiment>
      <Graph>
        <Name>PlantWt</Name>
        <Series>
          <Name>Ryegrass</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNoStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>PlantMass</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>2600</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>Harvested</Name>
        <Series>
          <Name>Ryegrass</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNoStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Harvested</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>WaterDemand</Name>
        <Series>
          <Name>Demand</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNoStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SW_Demand</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>5</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>WaterUptake</Name>
        <Series>
          <Name>Uptake</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNoStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SW_Uptake</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>5</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>WaterStress</Name>
        <Series>
          <Name>Ryegrass</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNoStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>glfWater</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>1.05</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>NStress</Name>
        <Series>
          <Name>Ryegrass</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNoStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>glfNitrogen</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>1.05</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>SoilWaterZone0</Name>
        <Series>
          <Name>Water</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNoStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SoilWater</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone0'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>50</Minimum>
          <Maximum>275</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>SoilWaterZone1</Name>
        <Series>
          <Name>Water</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNoStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SoilWater</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone1'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>50</Minimum>
          <Maximum>275</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>SoilNitrogenZone1</Name>
        <Series>
          <Name>Nitrogen</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNoStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SoilNitrogen</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone1'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>150</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>SoilNitrogenZone0</Name>
        <Series>
          <Name>Nitrogen</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNoStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SoilNitrogen</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone0'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>150</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>IrrigationAppliedZone0</Name>
        <Series>
          <Name>Irrigation</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNoStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Irrigation</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone0'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>2000</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>IrrigationAppliedZone1</Name>
        <Series>
          <Name>Irrigation</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNoStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Irrigation</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone1'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>2000</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>FertiliserAppliedZone0</Name>
        <Series>
          <Name>Fertiliser</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNoStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Fertiliser</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone0'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>2300</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>FertiliserAppliedZone1</Name>
        <Series>
          <Name>Fertiliser</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNoStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Fertiliser</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone1'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>2300</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <IncludeInDocumentation>true</IncludeInDocumentation>
      <ShowPageOfGraphs>true</ShowPageOfGraphs>
    </Folder>
    <Folder>
      <Name>Test With Water Stress</Name>
      <Memo>
        <Name>Memo TestWithWaterStress</Name>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <MemoText><![CDATA[This series of simulations are as for the ‘No Stress’ series except there is no irrigation (fertiliser remains turned on).  There is also no rainfall so this is a run-down experiment.  The expectation is that as more roots are spread into Zone1 that:
•	The plant can access more water so more dry matter will be harvested and, later on when there is insufficient stored soil water, senescence will be slower;

•	Water demand and water uptake will be maintained for longer;

•	Water stress will be later and less severe for a while;

•	There will be no N stress because fertiliser is applied as needed;

•	The soil water in Zone0 will be depleted more slowly while the soil water in Zone1 will be depleted more quickly;

•	Soil nitrogen will be unaffected; and 

•	Less fertiliser will be applied in Zone0 and more in Zone1.

These expectations are met.  It seems likely that the fluctuations in soil N storage are due to the size of each fertiliser addition (50 kg N /ha).
]]></MemoText>
      </Memo>
      <Experiment>
        <Name>Experiment</Name>
        <Factors>
          <Name>Factors</Name>
          <Factor>
            <Name>NumOfZones</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <Specifications>
              <string>[DoRootsSingle].Script.Zone1Prop=0.0,0.25,0.5,0.75,1.0</string>
            </Specifications>
          </Factor>
          <IncludeInDocumentation>true</IncludeInDocumentation>
        </Factors>
        <Simulation>
          <Name>TestWithWaterStress</Name>
          <Clock>
            <Name>Clock</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <StartDate>2000-01-01T00:00:00</StartDate>
            <EndDate>2000-12-31T00:00:00</EndDate>
          </Clock>
          <ControlledEnvironment>
            <Name>ControlledEnvironment</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <MaxT>25</MaxT>
            <MinT>15</MinT>
            <Rain>0</Rain>
            <Radn>25</Radn>
            <PanEvap>0</PanEvap>
            <VP>17</VP>
            <Wind>3</Wind>
            <CO2>350</CO2>
            <AirPressure>1010</AirPressure>
            <Latitude>0</Latitude>
            <DayLength>12</DayLength>
          </ControlledEnvironment>
          <SoilArbitrator>
            <Name>SoilArbitrator</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </SoilArbitrator>
          <Summary>
            <Name>Summary</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </Summary>
          <Zone>
            <Name>Zone0</Name>
            <Folder>
              <Name>Managers</Name>
              <Manager>
                <Name>DoRootsSingle</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <Zone0Depth>600</Zone0Depth>
                  <Zone0Mass>500</Zone0Mass>
                  <Zone1Name>Zone1</Zone1Name>
                  <Zone1Prop>0</Zone1Prop>
                  <Zone2Name>Zone2</Zone2Name>
                  <Zone2Prop>0</Zone2Prop>
                  <Zone3Name>Zone3</Zone3Name>
                  <Zone3Prop>0</Zone3Prop>
                </Script>
                <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Root depth in the plant's zone (mm): ")]  public double Zone0Depth { get; set; }
		[Description("Root mass  in the plant's zone (mm): ")]  public double Zone0Mass { get; set; }

		[Description("Name of the first zone: ")] public string Zone1Name { get; set; }
		[Description("Proportionate depth and mass in the first zone (-): ")]  public double Zone1Prop { get; set; }

		[Description("Name of the second zone: ")] public string Zone2Name { get; set; }
		[Description("Proportionate depth and mass in the first zone (-): ")]  public double Zone2Prop { get; set; }

		[Description("Name of the third zone: ")] public string Zone3Name { get; set; }
		[Description("Proportionate depth and mass in the first zone (-): ")]  public double Zone3Prop { get; set; }

		// - Outputs from this manager

		// - Internal variables

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			int SpeciesNum = 0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				SpeciesNum += 1;
				if (SpeciesNum == 1)
				{
					//double test = species.RootWt;
					if (Zone1Prop > 0)
						species.AddZone(zoneName: Zone1Name, rootDepth: Zone1Prop * Zone0Depth, rootDM: Zone1Prop * Zone0Mass, specificRootLength: 100);
					if (Zone2Prop > 0)
						species.AddZone(zoneName: Zone1Name, rootDepth: Zone2Prop * Zone0Depth, rootDM: Zone2Prop * Zone0Mass, specificRootLength: 100);
					if (Zone3Prop > 0)
						species.AddZone(zoneName: Zone1Name, rootDepth: Zone3Prop * Zone0Depth, rootDM: Zone3Prop * Zone0Mass, specificRootLength: 100);
				}
			}

			//Pasture[1].AddZone(zoneName: "Zone1", rootDepth: 100, rootDM: 1000, specificRootLength: 100);
			//Pasture[1].AddZone(zoneName: "Zone2", rootDepth: 50, rootDM: 500, specificRootLength: 100);
		}
	}
}]]></Code>
              </Manager>
              <Manager>
                <Name>AutomaticFertiliser</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <AllowFertiliser>yes</AllowFertiliser>
                  <Depth2SoilN>600</Depth2SoilN>
                  <CriticalSoilN>100</CriticalSoilN>
                  <FertNAmount>50</FertNAmount>
                  <FertType>UreaN</FertType>
                  <FertApplicationDepth>1</FertApplicationDepth>
                  <FertMinimumDays>1</FertMinimumDays>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using APSIM.Shared.Utilities;
using System.Xml.Serialization;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		[Link] Soil Soil;

		//User inputs from properties tab
		[Description("Turn ferliser applications on? ")]
		public yesnoType AllowFertiliser { get; set; }
		
		[Description("Depth to calculate available soil N (mm): ")]
		public double Depth2SoilN { get; set; }

		[Description("Minimum available N, triggers an application (kgN/ha): ")]
		public double CriticalSoilN { get; set; }

		[Description("Amount of N fertiliser for each application (kgN/ha): ")]
		public double FertNAmount { get; set; }

		[Description("Type of N fertiliser to apply: ")]
		public Fertiliser.Types FertType { get; set; }

		[Description("Depth at which to apply the fertiliser (mm): ")]
		public double FertApplicationDepth { get; set; }
	   
		[Description("Minimum period between applications (days): ")]
		public double FertMinimumDays { get; set; }
	   
		public enum yesnoType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		[XmlIgnore] public double TopMineralN { get; set; }
		
		private DateTime lastApplicationDate;
		private bool fertiliserIsAllowed;
		private int nLayers;

		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{
			fertiliserIsAllowed = (AllowFertiliser == yesnoType.yes);
			nLayers = Soil.SoilWater.Thickness.Length;
		}

		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			double daysSinceLastApplication = (Clock.Today - lastApplicationDate).TotalDays;
			
			// get the N stored in the soil
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopMineralN = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (Depth2SoilN - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopMineralN += (Soil.SoilNitrogen.NO3[layer]
				+ Soil.SoilNitrogen.NH4[layer]
				+ Soil.SoilNitrogen.urea[layer])
				* fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= Depth2SoilN)
					layer = nLayers;
			}

			if (fertiliserIsAllowed && (daysSinceLastApplication >= FertMinimumDays) && (TopMineralN <= CriticalSoilN))
			{
				fertiliser.Apply(FertNAmount, FertType, FertApplicationDepth);
				lastApplicationDate = Clock.Today;
			}
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>AutomaticIrrigation</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <allowIrrigation>no</allowIrrigation>
                  <allowIrrigationAll>yes</allowIrrigationAll>
                  <seasonStart>1-Jan</seasonStart>
                  <seasonEnd>31-Dec</seasonEnd>
                  <seasonsAllocation>10000</seasonsAllocation>
                  <triggerDeficit>99</triggerDeficit>
                  <targetDeficit>100</targetDeficit>
                  <returndays>1</returndays>
                  <maximumAmount>5</maximumAmount>
                  <depthPAWC>600</depthPAWC>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using System.Xml.Serialization;
using Models.PMF;
using APSIM.Shared.Utilities;

        
namespace Models
{
	[Serializable] 
	[System.Xml.Serialization.XmlInclude(typeof(Model))]
	public class Script : Model
	{
		//Communication to other modules
		[Link] ISummary summary = null;
		[Link] Irrigation Irrigation;
		[Link] Clock Clock;
		[Link] Soil Soil;
		[Link(IsOptional = true)] ICrop existingCrop;
	   
		//User inputs from properties tab
		[Description("Turn irrigation on?")] public answerType allowIrrigation { get; set; }
		[Description("Irrigate regardless of crop state?")] public answerType allowIrrigationAll { get; set; }
		[Description("Start of irrigation season (dd-MMM)")]
		public string seasonStart { get; set; }
		[Description("End of irrigation season (dd-MMM)")]
		public string seasonEnd { get; set; }
		[Description("Season allocation (mm)")]
		public double seasonsAllocation { get; set; }
		[Description("Deficit to trigger irrigation (% PAWC)")]
		public double triggerDeficit { get; set; }
		[Description("Deficit to stop irrigaton (% PAWC)")]
		public double targetDeficit { get; set; }
		[Description("Minimum days for irrigation to return")]
		public double returndays { get; set; }
		[Description("Maximum irrigation application (mm/day)")]
		public double maximumAmount { get; set; }
		[Description("Depth to calculate PAWC (mm)")]
		public double depthPAWC { get; set; }
	   
		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		//Class members
		[XmlIgnore] public double TopSWdeficit { get; set; }
		[XmlIgnore] public double TopSWC { get; set; }
		[XmlIgnore] public double DaysSinceIrrigation { get; set; }
		[XmlIgnore] public double AmountToApply { get; set; }
		[XmlIgnore] public double SeasonAppliedAmount { get; set; }
		
		private bool IrrigationIsAllowed { get; set; }
		private bool IrrigationIsAlwaysAllowed { get; set; }
		
		private bool SeasonIsOpen { get; set; }
		private bool CropIsActive { get; set; }
		private bool IrrigatorIsAvailable { get; set; }
		private bool SoilIsDry { get; set; }

		private DateTime StartDate;
		private DateTime EndDate;
		private double TopDUL;
		private double TopLL;
		private int nLayers;
	
		//Calculate static soil variables
		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{   
			//Set the season dates
			StartDate = DateTime.Parse(seasonStart + "-" + Clock.Today.Year.ToString());
			EndDate = DateTime.Parse(seasonEnd + "-" + Clock.Today.Year.ToString());
			
			//Can we irrigate at all?
			IrrigationIsAllowed = false; 
			if (allowIrrigation == answerType.yes)
				IrrigationIsAllowed = true; 
			if (allowIrrigationAll == answerType.yes)
				IrrigationIsAlwaysAllowed = true; 





			//Calculate soil water variables
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			nLayers = Soil.SoilWater.Thickness.Length;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopLL += Soil.SoilWater.LL15mm[layer] * fracLayer;
				TopDUL += Soil.SoilWater.DULmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
		}
	   	  
		//Determine daily requirement for irrigation
		[EventSubscribe("StartOfDay")]
		private void OnStartOfDay(object sender, EventArgs e)
		{
			//Can we irrigate today?		  
			SeasonIsOpen = isBetween(Clock.Today, StartDate, EndDate);

			//Is there a crop in the ground that needs irrigation?
			CropIsActive = false;
			if (IrrigationIsAlwaysAllowed)
				CropIsActive = true;  // might not be but we don't care
			else if ((existingCrop != null) && (existingCrop.IsAlive))
				CropIsActive = true;
			//if ((existingCrop.Phenology.Stage >= 3.0) && (existingCrop.Phenology.Stage < 6.0))
	      
			//Is the irrigator available?
			IrrigatorIsAvailable = false;
			DaysSinceIrrigation += 1;
			if (DaysSinceIrrigation >= returndays)
				IrrigatorIsAvailable = true;
	      
			//Is the soil dry enough to require irrigation?
			SoilIsDry = false;
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopSWC = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			//for (int layer = 0; depthFromSurface < depthPAWC + Soil.SoilWater.Thickness[layer]; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopSWC += Soil.SoilWater.SWmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
			
			TopSWdeficit = TopSWC - TopDUL;
			if (Math.Max(0.0, -TopSWdeficit) >= (TopDUL - TopLL) * (100 - triggerDeficit) / 100)
				SoilIsDry = true;
	            
			//Are all the conditions ratifying irrigation
			if (IrrigationIsAllowed && SeasonIsOpen && CropIsActive && IrrigatorIsAvailable && SoilIsDry)
			{
				//Lets bloody well irrigate then!!!!
				AmountToApply = TopDUL * targetDeficit / 100 - TopSWC;
				AmountToApply = Math.Max(0.0, Math.Min(AmountToApply, seasonsAllocation - SeasonAppliedAmount));
				Irrigation.Apply(AmountToApply);
				DaysSinceIrrigation = 0;
				SeasonAppliedAmount += AmountToApply;
			}
		}
		
		///Checks whether theDate is between iniDate and endDate (non-year specific)
		private bool isBetween(DateTime theDay, DateTime iniDate, DateTime endDate)
		{
			bool result = false;
			if (iniDate.DayOfYear < endDate.DayOfYear)
			{
				// period is within one year, ex: summer in the northern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) && (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			else
			{
				// period goes over the end of the year, ex: summer in the southern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) || (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			
			return result;
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>CutRotation</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <rotationAllowed>True</rotationAllowed>
                  <CutRotationStartDate>1900-07-01</CutRotationStartDate>
                  <CutRotationEndDate>2100-12-31</CutRotationEndDate>
                  <CutInterval>1</CutInterval>
                  <IntervalType>FixedInterval</IntervalType>
                  <DurationOfCut>1</DurationOfCut>
                  <RemoveAmountType>ResidualDM</RemoveAmountType>
                  <AmountGiven>2250</AmountGiven>
                  <DMRemoveType>RemoveAll</DMRemoveType>
                  <FractionN2Remove>1</FractionN2Remove>
                  <ProportionN2Dung>0</ProportionN2Dung>
                </Script>
                <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Do the grazing/cutting?: ")] public bool rotationAllowed { get; set; }
		[Description("Date to begin the rotation: ")] public DateTime CutRotationStartDate { get; set; }
		[Description("Date to finish the rotation: ")] public DateTime CutRotationEndDate { get; set; }
		[Description("Rotation interval (days): ")] public int CutInterval { get; set; }
		[Description("How the interval is defined: ")] public rotationIntervalTypes IntervalType { get; set; }
		[Description("Duration of each event (days): ")] public int DurationOfCut { get; set; }
		[Description("What amount is being defined: ")] public removeAmountTypes RemoveAmountType { get; set; }
		[Description("Amount to use (kg/ha): ")] public double AmountGiven { get; set; }
		[Description("Fraction of DM that is removed from the field:")] public removeDMTypes DMRemoveType { get; set; }
		[Description("Fraction of N that is removed from the field (0-1):")] public double FractionN2Remove { get; set; }
		[Description("Proportion of N returned in dung (0-1):")] public double ProportionN2Dung { get; set; }

		// - Outputs from this manager
		[XmlIgnore][Units("g/m2")] public double DefoliatedWt { get; set; }
		// Description: Pasture DM defoliated today
		[XmlIgnore][Units("g/m2")] public double DefoliatedN { get; set; }
		// Description: Pasture N defoliate today
		[XmlIgnore][Units("g/m2")] public double HarvestedWt { get; set; }
		// Description: Pasture DM harvested today
		[XmlIgnore][Units("g/m2")] public double HarvestedN { get; set; }
		// Description: Pasture N harvested today
		[XmlIgnore][Units("g/m2")] public double RemovedWt { get; set; }
		// Description: Pasture DM removed from the field
		[XmlIgnore][Units("g/m2")] public double RemovedN { get; set; }
		// Description: Pasture N removed from the field
		[XmlIgnore][Units("g/m2")] public double ReturnedWt { get; set; }
		// Description: Residue DM returned to the field
		[XmlIgnore][Units("g/m2")] public double ReturnedN { get; set; }
		// Description: Residue N returned to the field
		[XmlIgnore][Units("g/m2")] public double NReturnedInDung { get; set; }
		// Description: Harvested N returned as dung (SurfaceOM)
		[XmlIgnore][Units("g/m2")] public double NReturnedInUrine { get; set; }
		// Description: Harvested N returned as urine (urea)
		[XmlIgnore][Units("day")] public int DaysAfterCut { get; set; }
		// Description: Number of days after last defoliation
		[XmlIgnore][Units("g/m2")] public double PreHarvestDM { get; set; }
		// Description: Total standing DM (Leaf + Stem/Sheath) before cut
		[XmlIgnore][Units("g/m2")] public double PostHarvestDM { get; set; }
		// Description: Total standing DM (Leaf + Stem/Sheath) after cut
		
		// - Internal variables
		// fraction of harvested Dm to actually remove from field
		private double fractionDM2Remove = 1.0;
		// flag whether defoliation is allowed
		//private bool rotationAllowed = true;
		// number of days for each defoliation event
		private int cuttingDuration = 0;
		// counter for day within each defoliation
		private int daysCutting = 0;
		// type of interval (Fixed or target)
		private string intervalType;
		// total herbage to remove in g/m2 per day
		private double herbageToRemove;
		// type of DM amount (ResidualDM or DMToRemove)
		private string amountType;
		// auxiliary flag for defoliation
		private bool aCutHasHappened = false;

		// - Event to add residue or dung to surface OM
		public event BiomassRemovedDelegate BiomassRemoved;

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				Pasture.Add(species);
			}

			// reset variables
			DaysAfterCut = 0;
			resetVariables();
			cuttingDuration = DurationOfCut;
			
			// get the type of amount given
			if (RemoveAmountType == removeAmountTypes.ResidualDM)
				amountType = "SetResidueAmount";
			else
				amountType = "SetRemoveAmount";

			// get the type of amount given
			if (IntervalType == rotationIntervalTypes.FixedInterval)
				intervalType = "Fixed";
			else
				intervalType = "Target";

			// make sure that rotation starts when startDate < simulationStartDay
			if ((Clock.Today > CutRotationStartDate) && (Clock.Today < CutRotationEndDate))
				CutRotationStartDate = Clock.Today;
		}
		
		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			if (rotationAllowed)
			{
				if (Clock.Today == CutRotationStartDate)
					DaysAfterCut = CutInterval;

				bool SwardIsAlive = false;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				{
					if (species.IsAlive)
						SwardIsAlive = true;
				}
				
				// Check whether we can defoliate
				if ((Clock.Today >= CutRotationStartDate) && (Clock.Today <= CutRotationEndDate) && (SwardIsAlive))
				{
					// Check whether we should start a defoliation
					if (DaysAfterCut >= (CutInterval - 1))
					{
						Graze(AmountGiven, amountType, DurationOfCut);
					}
				}
			}

			// Check whether we need to continue cutting
			if ((daysCutting > 0) && (daysCutting < cuttingDuration))
			{
				// reset outputs
				resetVariables();

				removeDM(herbageToRemove);
				returnExcreta();
				daysCutting += 1;
				if (daysCutting == cuttingDuration)
				{
					PostHarvestDM = 0.0;
					foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
						PostHarvestDM += species.StandingHerbageWt;
				}
			}

			// reset outputs
			if (daysCutting < 0)
			{
				resetVariables();
				daysCutting = 0;
			}
		}

		[EventSubscribe("DoManagementCalculations")]
		private void OnDoManagementCalculations(object sender, EventArgs e)
		{
			// Check whether a cutting has finished
			if (daysCutting == cuttingDuration)
			{
				aCutHasHappened = true;
				daysCutting = -1;
			}

			// Increase the counter for days after cutting
			if (aCutHasHappened && (daysCutting == 0))
				DaysAfterCut += 1;
		}

		public enum removeAmountTypes
		{
			/// <summary>Setting DM amount to remove</summary>
			DMToRemove,
			/// <summary>Setting residual DM amount</summary>
			ResidualDM
		}

		public enum rotationIntervalTypes
		{
			/// <summary>Setting a fixed interval</summary>
			FixedInterval,
			/// <summary>Setting a target (minimum) inteval</summary>
			TargetInterval
		}

		public enum removeDMTypes
		{
			/// <summary>Remove all DM</summary>
			RemoveAll,
			/// <summary>Remove no DM</summary>
			RemoveNone,
			/// <summary>Remove a fraction based on digestibility</summary>
			BasedOnDigestibility
		}

		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}
		
				
		// Resets the values of all outputs
		private void resetVariables()
		{
			DefoliatedWt = 0.0;
			DefoliatedN = 0.0;
			HarvestedWt = 0.0;
			HarvestedN = 0.0;
			RemovedWt = 0.0;
			RemovedN = 0.0;
			ReturnedWt = 0.0;
			ReturnedN = 0.0;
			NReturnedInDung = 0.0;
			NReturnedInUrine = 0.0;
		}

		// Description: Perform the basic calculations for defoliation
		public void Graze(double amountDM, string amountType, int duration)
		{
			// Get the existing plant amount
			PreHarvestDM = 0.0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				PreHarvestDM += species.StandingHerbageWt;
			
			// Check the amount to remove and print some info
			if ((amountType == "SetRemoveAmount") && (PreHarvestDM >= amountDM / duration))
			{
				summary.WriteMessage(this, "   Defoliating " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = amountDM / duration;
			}
			else if ((amountType == "SetResidueAmount") && (PreHarvestDM >= amountDM))
			{
				summary.WriteMessage(this, "   Defoliating down to approximately " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = (PreHarvestDM - amountDM) / duration;
			}
			else
			{
				summary.WriteMessage(this, "   Defoliation will not happend because there is not enough plant material");
				if (intervalType == "Fixed")
					DaysAfterCut = -duration;
				return;
			}

			cuttingDuration = duration;
			// Preform first defoliation
			removeDM(herbageToRemove);
			returnExcreta();
			daysCutting = 1;
			DaysAfterCut = 0;
			if (daysCutting == cuttingDuration)
			{
				PostHarvestDM = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					PostHarvestDM += species.StandingHerbageWt;
			}
		}

		// Do the DM removal
		private void removeDM(double removeAmount)
		{
			double existingWt = 0.0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				existingWt += species.HarvestableWt;


			// Check whether we harvest anything
			if (existingWt >= removeAmount)
			{
				foreach (AgPasture.PastureSpecies species in Pasture)
				{
					double amountToRemove = removeAmount * species.HarvestableWt / existingWt;
					species.Graze(amount: amountToRemove, type: "SetRemoveAmount");
				}
				
				// get total harvested
				DefoliatedWt = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					DefoliatedWt += species.HarvestedWt;
				DefoliatedN = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					DefoliatedN += species.HarvestedN;
				HarvestedWt = DefoliatedWt;
				HarvestedN = DefoliatedN;

				// get amounts actually removed from field and that to be returned (dung/urine)
				if (DMRemoveType == removeDMTypes.RemoveAll)
					fractionDM2Remove = 1.0;
				else if (DMRemoveType == removeDMTypes.RemoveNone)
					fractionDM2Remove = 0.0;
				else
				{
					fractionDM2Remove = 0.0;
					foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
						fractionDM2Remove += species.HarvestedDigestibility * species.HarvestedWt;
					fractionDM2Remove /= removeAmount;
				}
				
				RemovedWt = HarvestedWt * fractionDM2Remove;
				RemovedN = HarvestedN * FractionN2Remove;
				ReturnedWt = HarvestedWt - RemovedWt;
				ReturnedN = HarvestedN - RemovedN;
				NReturnedInDung = ReturnedN * ProportionN2Dung;
				NReturnedInUrine = ReturnedN - NReturnedInDung;
			}
		}

		// Return dung and urine
		private void returnExcreta()
		{
			if ((ReturnedWt > 0.0) || (NReturnedInDung > 0.0))
			{
				PMF.BiomassRemovedType BiomassDung = new PMF.BiomassRemovedType();
				string[] type = new string[] { "RuminantDung_PastureFed" };
				float[] dltdm = new float[] { (Single)ReturnedWt };
				float[] dltn = new float[] { (Single)NReturnedInDung };
				float[] dltp = new float[] { 0 };
				float[] fraction = new float[] { 1 };     // fraction is always 1.0 here

				BiomassDung.crop_type = "RuminantDung_PastureFed";
				BiomassDung.dm_type = type;
				BiomassDung.dlt_crop_dm = dltdm;
				BiomassDung.dlt_dm_n = dltn;
				BiomassDung.dlt_dm_p = dltp;
				BiomassDung.fraction_to_residue = fraction;
				BiomassRemoved.Invoke(BiomassDung);
			}

			if (NReturnedInUrine > 0.0)
			{
				fertiliser.Apply(NReturnedInUrine * 10, Fertiliser.Types.UreaN, 1.0);
			}
		}
	}
}
]]></Code>
              </Manager>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ShowPageOfGraphs>true</ShowPageOfGraphs>
            </Folder>
            <MicroClimate>
              <Name>MicroClimate</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <a_interception>0</a_interception>
              <b_interception>1</b_interception>
              <c_interception>0</c_interception>
              <d_interception>0</d_interception>
              <soil_albedo>0.23</soil_albedo>
              <sun_angle>15</sun_angle>
              <soil_heat_flux_fraction>0.4</soil_heat_flux_fraction>
              <night_interception_fraction>0.5</night_interception_fraction>
              <refheight>2</refheight>
              <albedo>0.15</albedo>
              <emissivity>0.96</emissivity>
              <RadIntTotal>0</RadIntTotal>
            </MicroClimate>
            <Irrigation>
              <Name>Irrigation</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Irrigation>
            <Fertiliser>
              <Name>Fertiliser</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Fertiliser>
            <SurfaceOrganicMatter>
              <Name>SurfaceOrganicMatter</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <PondActive>no</PondActive>
              <ReportAdditions>no</ReportAdditions>
              <ReportRemovals>no</ReportRemovals>
              <ResidueTypes>
                <Name>ResidueTypes</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LoadFromResource>ResidueTypes</LoadFromResource>
              </ResidueTypes>
              <TillageTypes>
                <Name>TillageTypesList</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <TillageType />
              </TillageTypes>
              <Pools>
                <Pool>
                  <PoolName>Sward</PoolName>
                  <ResidueType>grass</ResidueType>
                  <Mass>0</Mass>
                  <CNRatio>15</CNRatio>
                  <CPRatio>NaN</CPRatio>
                  <StandingFraction>0</StandingFraction>
                </Pool>
              </Pools>
              <PoolName>Sward</PoolName>
              <type>grass</type>
              <mass>0</mass>
              <standing_fraction>0</standing_fraction>
              <cpr />
              <cnr>15</cnr>
              <CriticalResidueWeight>2000</CriticalResidueWeight>
              <OptimumDecompTemp>20</OptimumDecompTemp>
              <MaxCumulativeEOS>20</MaxCumulativeEOS>
              <CNRatioDecompCoeff>0.277</CNRatioDecompCoeff>
              <CNRatioDecompThreshold>25</CNRatioDecompThreshold>
              <TotalLeachRain>25</TotalLeachRain>
              <MinRainToLeach>10</MinRainToLeach>
              <CriticalMinimumOrganicC>0.004</CriticalMinimumOrganicC>
              <DefaultCPRatio>0</DefaultCPRatio>
              <DefaultStandingFraction>0</DefaultStandingFraction>
              <StandingExtinctCoeff>0.5</StandingExtinctCoeff>
              <FractionFaecesAdded>0.5</FractionFaecesAdded>
            </SurfaceOrganicMatter>
            <Soil>
              <Name>Soil</Name>
              <Analysis>
                <Name>Analysis</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <Rocks>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </Rocks>
                <Texture />
                <MunsellColour />
                <PH>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                </PH>
                <CEC>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                </CEC>
                <ParticleSizeSand>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                </ParticleSizeSand>
                <ParticleSizeSilt>
                  <double>30</double>
                  <double>30</double>
                  <double>30</double>
                  <double>30</double>
                </ParticleSizeSilt>
                <ParticleSizeClay>
                  <double>60</double>
                  <double>60</double>
                  <double>60</double>
                  <double>60</double>
                </ParticleSizeClay>
                <PHUnits>Water</PHUnits>
                <BoronUnits>HotWater</BoronUnits>
              </Analysis>
              <Water>
                <Name>Water</Name>
                <SoilCrop>
                  <Name>RyegrassSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                  </LL>
                  <KL>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>WhiteCloverSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                  </LL>
                  <KL>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                  </XF>
                </SoilCrop>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <BD>
                  <double>1.3</double>
                  <double>1.3</double>
                  <double>1.3</double>
                  <double>1.3</double>
                </BD>
                <AirDry>
                  <double>0.05</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </AirDry>
                <LL15>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </LL15>
                <DUL>
                  <double>0.45</double>
                  <double>0.45</double>
                  <double>0.45</double>
                  <double>0.45</double>
                </DUL>
                <SAT>
                  <double>0.5</double>
                  <double>0.5</double>
                  <double>0.5</double>
                  <double>0.5</double>
                </SAT>
                <KS>
                  <double>500</double>
                  <double>500</double>
                  <double>500</double>
                  <double>500</double>
                </KS>
              </Water>
              <SoilWater>
                <Name>SoilWater</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <SummerDate>1-Nov</SummerDate>
                <SummerU>6</SummerU>
                <SummerCona>3.5</SummerCona>
                <WinterDate>1-apr</WinterDate>
                <WinterU>6</WinterU>
                <WinterCona>3.5</WinterCona>
                <DiffusConst>88</DiffusConst>
                <DiffusSlope>35</DiffusSlope>
                <Salb>0.13</Salb>
                <CN2Bare>73</CN2Bare>
                <CNRed>20</CNRed>
                <CNCov>0.8</CNCov>
                <slope>0</slope>
                <discharge_width>0</discharge_width>
                <catchment_area>0</catchment_area>
                <max_pond>0</max_pond>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <SWCON>
                  <double>0.3</double>
                  <double>0.3</double>
                  <double>0.3</double>
                  <double>0.3</double>
                </SWCON>
                <KLAT>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </KLAT>
                <residueinterception>0</residueinterception>
              </SoilWater>
              <SoilNitrogen>
                <Name>SoilNitrogen</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <fom_type>
                  <string>default</string>
                  <string>manure</string>
                  <string>mucuna</string>
                  <string>lablab</string>
                  <string>shemp</string>
                  <string>stable</string>
                </fom_type>
                <fract_carb>
                  <double>0.2</double>
                  <double>0.3</double>
                  <double>0.54</double>
                  <double>0.57</double>
                  <double>0.45</double>
                  <double>0</double>
                </fract_carb>
                <fract_cell>
                  <double>0.7</double>
                  <double>0.3</double>
                  <double>0.37</double>
                  <double>0.37</double>
                  <double>0.47</double>
                  <double>0.1</double>
                </fract_cell>
                <fract_lign>
                  <double>0.1</double>
                  <double>0.4</double>
                  <double>0.09</double>
                  <double>0.06</double>
                  <double>0.08</double>
                  <double>0.9</double>
                </fract_lign>
                <wfpsN2N2O_x>
                  <double>22</double>
                  <double>88</double>
                </wfpsN2N2O_x>
                <wfpsN2N2O_y>
                  <double>0.1</double>
                  <double>1</double>
                </wfpsN2N2O_y>
                <oc>
                  <double>3.7136764881329496</double>
                  <double>2.4698281813043792</double>
                  <double>1.2383961716086014</double>
                  <double>0.49836009167083023</double>
                </oc>
              </SoilNitrogen>
              <SoilOrganicMatter>
                <Name>SoilOrganicMatter</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <RootCN>40</RootCN>
                <RootWt>0</RootWt>
                <SoilCN>12</SoilCN>
                <EnrACoeff>7.4</EnrACoeff>
                <EnrBCoeff>0.2</EnrBCoeff>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <Depth>
                  <string>0-15</string>
                  <string>15-30</string>
                  <string>30-45</string>
                  <string>45-60</string>
                </Depth>
                <OC>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </OC>
                <FBiom>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </FBiom>
                <FInert>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </FInert>
                <OCUnits>Total</OCUnits>
              </SoilOrganicMatter>
              <InitialWater>
                <Name>Initial water</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <PercentMethod>EvenlyDistributed</PercentMethod>
                <FractionFull>0.95</FractionFull>
                <DepthWetSoil>NaN</DepthWetSoil>
              </InitialWater>
              <Sample>
                <Name>Initial nitrogen</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <NO3>
                  <double>15</double>
                  <double>15</double>
                  <double>15</double>
                  <double>15</double>
                </NO3>
                <NH4>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </NH4>
                <NO3Units>ppm</NO3Units>
                <NH4Units>ppm</NH4Units>
                <SWUnits>Volumetric</SWUnits>
                <OCUnits>Total</OCUnits>
                <PHUnits>Water</PHUnits>
              </Sample>
              <CERESSoilTemperature>
                <Name>CERESSoilTemperature</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
              </CERESSoilTemperature>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <RecordNumber>0</RecordNumber>
              <SoilType />
              <LocalName>Stores lots of water</LocalName>
              <Site>Made up</Site>
              <NearestTown />
              <Region />
              <Country />
              <NaturalVegetation />
              <Latitude>0</Latitude>
              <Longitude>0</Longitude>
            </Soil>
            <SoluteManager>
              <Name>SoluteManager</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </SoluteManager>
            <PastureSpecies>
              <Name>Ryegrass</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <MaximumNUptake>10</MaximumNUptake>
              <Albedo>0.26</Albedo>
              <Gsmax>0.011</Gsmax>
              <R50>200</R50>
              <SpeciesFamily>Grass</SpeciesFamily>
              <PhotosyntheticPathway>C3</PhotosyntheticPathway>
              <InitialShootDM>2500</InitialShootDM>
              <InitialRootDM>500</InitialRootDM>
              <InitialRootDepth>600</InitialRootDepth>
              <ReferencePhotosyntheticRate>1</ReferencePhotosyntheticRate>
              <LightExtinctionCoefficient>0.5</LightExtinctionCoefficient>
              <GrowthTminimum>1</GrowthTminimum>
              <GrowthToptimum>20</GrowthToptimum>
              <GrowthTEffectExponent>1.7</GrowthTEffectExponent>
              <UseHeatStressFactor>yes</UseHeatStressFactor>
              <HeatOnsetTemperature>28</HeatOnsetTemperature>
              <HeatFullTemperature>35</HeatFullTemperature>
              <HeatRecoverySumDD>30</HeatRecoverySumDD>
              <HeatRecoveryTReference>25</HeatRecoveryTReference>
              <UseColdStressFactor>yes</UseColdStressFactor>
              <ColdOnsetTemperature>1</ColdOnsetTemperature>
              <ColdFullTemperature>-5</ColdFullTemperature>
              <ColdRecoverySumDD>25</ColdRecoverySumDD>
              <ColdRecoveryTReference>0</ColdRecoveryTReference>
              <MaintenanceRespirationCoefficient>0.03</MaintenanceRespirationCoefficient>
              <GrowthRespirationCoefficient>0.25</GrowthRespirationCoefficient>
              <RespirationTReference>20</RespirationTReference>
              <RespirationExponent>1.5</RespirationExponent>
              <NThresholdsForLeaves>
                <double>0.04</double>
                <double>0.012</double>
                <double>0.05</double>
              </NThresholdsForLeaves>
              <NThresholdsForStems>
                <double>0.02</double>
                <double>0.006</double>
                <double>0.025</double>
              </NThresholdsForStems>
              <NThresholdsForStolons>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </NThresholdsForStolons>
              <NThresholdsForRoots>
                <double>0.02</double>
                <double>0.006</double>
                <double>0.025</double>
              </NThresholdsForRoots>
              <DegreesDayForGermination>125</DegreesDayForGermination>
              <TargetShootRootRatio>4</TargetShootRootRatio>
              <MaxRootAllocation>0.25</MaxRootAllocation>
              <ShootRootGlfFactor>0.5</ShootRootGlfFactor>
              <UseReproSeasonFactor>yes</UseReproSeasonFactor>
              <ReproSeasonReferenceLatitude>41</ReproSeasonReferenceLatitude>
              <ReproSeasonTimingCoeff>0.14</ReproSeasonTimingCoeff>
              <ReproSeasonMaxAllocationIncrease>0.5</ReproSeasonMaxAllocationIncrease>
              <ReproSeasonAllocationCoeff>0.1</ReproSeasonAllocationCoeff>
              <FractionLeafMaximum>0.7</FractionLeafMaximum>
              <FractionLeafMinimum>0.7</FractionLeafMinimum>
              <FractionLeafDMThreshold>500</FractionLeafDMThreshold>
              <FractionLeafDMFactor>2000</FractionLeafDMFactor>
              <FractionLeafExponent>3</FractionLeafExponent>
              <FractionToStolon>0</FractionToStolon>
              <SpecificLeafArea>25</SpecificLeafArea>
              <SpecificRootLength>100</SpecificRootLength>
              <StolonEffectOnLAI>0</StolonEffectOnLAI>
              <ShootMaxEffectOnLAI>1000</ShootMaxEffectOnLAI>
              <MaxStemEffectOnLAI>1</MaxStemEffectOnLAI>
              <LiveLeavesPerTiller>3</LiveLeavesPerTiller>
              <TissueTurnoverRateShoot>0.05</TissueTurnoverRateShoot>
              <TissueTurnoverRateRoot>0.02</TissueTurnoverRateRoot>
              <DetachmentRateShoot>0.08</DetachmentRateShoot>
              <TurnoverTemperatureMin>2</TurnoverTemperatureMin>
              <TurnoverTemperatureRef>20</TurnoverTemperatureRef>
              <TurnoverTemperatureExponent>1</TurnoverTemperatureExponent>
              <TurnoverDroughtEffectMax>1</TurnoverDroughtEffectMax>
              <TurnoverDroughtThreshold>0.5</TurnoverDroughtThreshold>
              <TurnoverDefoliationCoefficient>0.5</TurnoverDefoliationCoefficient>
              <TurnoverDefoliationRootEffect>0.1</TurnoverDefoliationRootEffect>
              <FractionNLuxuryRemobilisable>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </FractionNLuxuryRemobilisable>
              <MinimumNFixation>0</MinimumNFixation>
              <MaximumNFixation>0</MaximumNFixation>
              <SoilSaturationEffectMax>0.1</SoilSaturationEffectMax>
              <MinimumWaterFreePorosity>-1</MinimumWaterFreePorosity>
              <SoilSaturationRecoveryFactor>0.25</SoilSaturationRecoveryFactor>
              <NDillutionCoefficient>0.25</NDillutionCoefficient>
              <GlfGeneric>1</GlfGeneric>
              <GlfSoilFertility>1</GlfSoilFertility>
              <PlantHeightMinimum>25</PlantHeightMinimum>
              <PlantHeightMaximum>600</PlantHeightMaximum>
              <PlantHeightMassForMax>10000</PlantHeightMassForMax>
              <PlantHeightExponent>2.8</PlantHeightExponent>
              <RootDepthMinimum>50</RootDepthMinimum>
              <RootDepthMaximum>750</RootDepthMaximum>
              <RootElongationRate>25</RootElongationRate>
              <RootDistributionDepthParam>90</RootDistributionDepthParam>
              <RootDistributionExponent>3.2</RootDistributionExponent>
              <DigestibilitiesCellWall>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.2</double>
              </DigestibilitiesCellWall>
              <MinimumGreenWt>100</MinimumGreenWt>
              <FractionStolonStanding>0</FractionStolonStanding>
              <PreferenceForGreenOverDead>1</PreferenceForGreenOverDead>
              <PreferenceForLeafOverStems>1</PreferenceForLeafOverStems>
              <WaterAvailableMethod>DefaultAPSIM</WaterAvailableMethod>
              <NitrogenAvailableMethod>BasicAgPasture</NitrogenAvailableMethod>
            </PastureSpecies>
            <Report>
              <Name>TestWithWaterStress</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ExperimentFactorNames />
              <ExperimentFactorValues />
              <VariableNames>
                <string>[Clock].Today as Date</string>
                <string>[Ryegrass].AboveGroundWt as PlantMass</string>
                <string>[Ryegrass].HarvestedWt as Harvested</string>
                <string>[Ryegrass].WaterDemand as SW_Demand</string>
                <string>sum([Ryegrass].WaterUptake) as SW_Uptake</string>
                <string>[Ryegrass].GlfWaterSupply as glfWater</string>
                <string>[Ryegrass].GlfNSupply as glfNitrogen</string>
                <string>sum([Soil].SoilWater.SWmm) as SoilWater</string>
                <string>sum([Soil].SoilNitrogen.NH4)+sum([Soil].SoilNitrogen.NO3) as SoilNitrogen</string>
                <string>[Irrigation].IrrigationApplied as Irrigation</string>
                <string>[Fertiliser].NitrogenApplied as Fertiliser</string>
              </VariableNames>
              <EventNames>
                <string>[Clock].EndOfDay</string>
              </EventNames>
            </Report>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <Area>1</Area>
            <Slope>0</Slope>
          </Zone>
          <Zone>
            <Name>Zone1</Name>
            <Folder>
              <Name>Managers</Name>
              <Manager>
                <Name>AutomaticFertiliser</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <AllowFertiliser>yes</AllowFertiliser>
                  <Depth2SoilN>600</Depth2SoilN>
                  <CriticalSoilN>100</CriticalSoilN>
                  <FertNAmount>50</FertNAmount>
                  <FertType>UreaN</FertType>
                  <FertApplicationDepth>1</FertApplicationDepth>
                  <FertMinimumDays>1</FertMinimumDays>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using APSIM.Shared.Utilities;
using System.Xml.Serialization;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		[Link] Soil Soil;

		//User inputs from properties tab
		[Description("Turn ferliser applications on? ")]
		public yesnoType AllowFertiliser { get; set; }
		
		[Description("Depth to calculate available soil N (mm): ")]
		public double Depth2SoilN { get; set; }

		[Description("Minimum available N, triggers an application (kgN/ha): ")]
		public double CriticalSoilN { get; set; }

		[Description("Amount of N fertiliser for each application (kgN/ha): ")]
		public double FertNAmount { get; set; }

		[Description("Type of N fertiliser to apply: ")]
		public Fertiliser.Types FertType { get; set; }

		[Description("Depth at which to apply the fertiliser (mm): ")]
		public double FertApplicationDepth { get; set; }
	   
		[Description("Minimum period between applications (days): ")]
		public double FertMinimumDays { get; set; }
	   
		public enum yesnoType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		[XmlIgnore] public double TopMineralN { get; set; }
		
		private DateTime lastApplicationDate;
		private bool fertiliserIsAllowed;
		private int nLayers;

		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{
			fertiliserIsAllowed = (AllowFertiliser == yesnoType.yes);
			nLayers = Soil.SoilWater.Thickness.Length;
		}

		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			double daysSinceLastApplication = (Clock.Today - lastApplicationDate).TotalDays;
			
			// get the N stored in the soil
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopMineralN = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (Depth2SoilN - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopMineralN += (Soil.SoilNitrogen.NO3[layer]
				+ Soil.SoilNitrogen.NH4[layer]
				+ Soil.SoilNitrogen.urea[layer])
				* fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= Depth2SoilN)
					layer = nLayers;
			}

			if (fertiliserIsAllowed && (daysSinceLastApplication >= FertMinimumDays) && (TopMineralN <= CriticalSoilN))
			{
				fertiliser.Apply(FertNAmount, FertType, FertApplicationDepth);
				lastApplicationDate = Clock.Today;
			}
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>AutomaticIrrigation</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <allowIrrigation>no</allowIrrigation>
                  <allowIrrigationAll>yes</allowIrrigationAll>
                  <seasonStart>1-Jan</seasonStart>
                  <seasonEnd>31-Dec</seasonEnd>
                  <seasonsAllocation>10000</seasonsAllocation>
                  <triggerDeficit>99</triggerDeficit>
                  <targetDeficit>100</targetDeficit>
                  <returndays>1</returndays>
                  <maximumAmount>5</maximumAmount>
                  <depthPAWC>600</depthPAWC>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using System.Xml.Serialization;
using Models.PMF;
using APSIM.Shared.Utilities;

        
namespace Models
{
	[Serializable] 
	[System.Xml.Serialization.XmlInclude(typeof(Model))]
	public class Script : Model
	{
		//Communication to other modules
		[Link] ISummary summary = null;
		[Link] Irrigation Irrigation;
		[Link] Clock Clock;
		[Link] Soil Soil;
		[Link(IsOptional = true)] ICrop existingCrop;
	   
		//User inputs from properties tab
		[Description("Turn irrigation on?")] public answerType allowIrrigation { get; set; }
		[Description("Irrigate regardless of crop state?")] public answerType allowIrrigationAll { get; set; }
		[Description("Start of irrigation season (dd-MMM)")]
		public string seasonStart { get; set; }
		[Description("End of irrigation season (dd-MMM)")]
		public string seasonEnd { get; set; }
		[Description("Season allocation (mm)")]
		public double seasonsAllocation { get; set; }
		[Description("Deficit to trigger irrigation (% PAWC)")]
		public double triggerDeficit { get; set; }
		[Description("Deficit to stop irrigaton (% PAWC)")]
		public double targetDeficit { get; set; }
		[Description("Minimum days for irrigation to return")]
		public double returndays { get; set; }
		[Description("Maximum irrigation application (mm/day)")]
		public double maximumAmount { get; set; }
		[Description("Depth to calculate PAWC (mm)")]
		public double depthPAWC { get; set; }
	   
		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		//Class members
		[XmlIgnore] public double TopSWdeficit { get; set; }
		[XmlIgnore] public double TopSWC { get; set; }
		[XmlIgnore] public double DaysSinceIrrigation { get; set; }
		[XmlIgnore] public double AmountToApply { get; set; }
		[XmlIgnore] public double SeasonAppliedAmount { get; set; }
		
		private bool IrrigationIsAllowed { get; set; }
		private bool IrrigationIsAlwaysAllowed { get; set; }
		
		private bool SeasonIsOpen { get; set; }
		private bool CropIsActive { get; set; }
		private bool IrrigatorIsAvailable { get; set; }
		private bool SoilIsDry { get; set; }

		private DateTime StartDate;
		private DateTime EndDate;
		private double TopDUL;
		private double TopLL;
		private int nLayers;
	
		//Calculate static soil variables
		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{   
			//Set the season dates
			StartDate = DateTime.Parse(seasonStart + "-" + Clock.Today.Year.ToString());
			EndDate = DateTime.Parse(seasonEnd + "-" + Clock.Today.Year.ToString());
			
			//Can we irrigate at all?
			IrrigationIsAllowed = false; 
			if (allowIrrigation == answerType.yes)
				IrrigationIsAllowed = true; 
			if (allowIrrigationAll == answerType.yes)
				IrrigationIsAlwaysAllowed = true; 





			//Calculate soil water variables
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			nLayers = Soil.SoilWater.Thickness.Length;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopLL += Soil.SoilWater.LL15mm[layer] * fracLayer;
				TopDUL += Soil.SoilWater.DULmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
		}
	   	  
		//Determine daily requirement for irrigation
		[EventSubscribe("StartOfDay")]
		private void OnStartOfDay(object sender, EventArgs e)
		{
			//Can we irrigate today?		  
			SeasonIsOpen = isBetween(Clock.Today, StartDate, EndDate);

			//Is there a crop in the ground that needs irrigation?
			CropIsActive = false;
			if (IrrigationIsAlwaysAllowed)
				CropIsActive = true;  // might not be but we don't care
			else if ((existingCrop != null) && (existingCrop.IsAlive))
				CropIsActive = true;
			//if ((existingCrop.Phenology.Stage >= 3.0) && (existingCrop.Phenology.Stage < 6.0))
	      
			//Is the irrigator available?
			IrrigatorIsAvailable = false;
			DaysSinceIrrigation += 1;
			if (DaysSinceIrrigation >= returndays)
				IrrigatorIsAvailable = true;
	      
			//Is the soil dry enough to require irrigation?
			SoilIsDry = false;
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopSWC = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			//for (int layer = 0; depthFromSurface < depthPAWC + Soil.SoilWater.Thickness[layer]; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopSWC += Soil.SoilWater.SWmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
			
			TopSWdeficit = TopSWC - TopDUL;
			if (Math.Max(0.0, -TopSWdeficit) >= (TopDUL - TopLL) * (100 - triggerDeficit) / 100)
				SoilIsDry = true;
	            
			//Are all the conditions ratifying irrigation
			if (IrrigationIsAllowed && SeasonIsOpen && CropIsActive && IrrigatorIsAvailable && SoilIsDry)
			{
				//Lets bloody well irrigate then!!!!
				AmountToApply = TopDUL * targetDeficit / 100 - TopSWC;
				AmountToApply = Math.Max(0.0, Math.Min(AmountToApply, seasonsAllocation - SeasonAppliedAmount));
				Irrigation.Apply(AmountToApply);
				DaysSinceIrrigation = 0;
				SeasonAppliedAmount += AmountToApply;
			}
		}
		
		///Checks whether theDate is between iniDate and endDate (non-year specific)
		private bool isBetween(DateTime theDay, DateTime iniDate, DateTime endDate)
		{
			bool result = false;
			if (iniDate.DayOfYear < endDate.DayOfYear)
			{
				// period is within one year, ex: summer in the northern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) && (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			else
			{
				// period goes over the end of the year, ex: summer in the southern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) || (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			
			return result;
		}
	}
}
]]></Code>
              </Manager>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ShowPageOfGraphs>true</ShowPageOfGraphs>
            </Folder>
            <MicroClimate>
              <Name>MicroClimate</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <a_interception>0</a_interception>
              <b_interception>1</b_interception>
              <c_interception>0</c_interception>
              <d_interception>0</d_interception>
              <soil_albedo>0.23</soil_albedo>
              <sun_angle>15</sun_angle>
              <soil_heat_flux_fraction>0.4</soil_heat_flux_fraction>
              <night_interception_fraction>0.5</night_interception_fraction>
              <refheight>2</refheight>
              <albedo>0.15</albedo>
              <emissivity>0.96</emissivity>
              <RadIntTotal>0</RadIntTotal>
            </MicroClimate>
            <Irrigation>
              <Name>Irrigation</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Irrigation>
            <Fertiliser>
              <Name>Fertiliser</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Fertiliser>
            <SurfaceOrganicMatter>
              <Name>SurfaceOrganicMatter</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <PondActive>no</PondActive>
              <ReportAdditions>no</ReportAdditions>
              <ReportRemovals>no</ReportRemovals>
              <ResidueTypes>
                <Name>ResidueTypes</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LoadFromResource>ResidueTypes</LoadFromResource>
              </ResidueTypes>
              <TillageTypes>
                <Name>TillageTypesList</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <TillageType />
              </TillageTypes>
              <Pools>
                <Pool>
                  <PoolName>Sward</PoolName>
                  <ResidueType>grass</ResidueType>
                  <Mass>0</Mass>
                  <CNRatio>15</CNRatio>
                  <CPRatio>NaN</CPRatio>
                  <StandingFraction>0</StandingFraction>
                </Pool>
              </Pools>
              <PoolName>Sward</PoolName>
              <type>grass</type>
              <mass>0</mass>
              <standing_fraction>0</standing_fraction>
              <cpr />
              <cnr>15</cnr>
              <CriticalResidueWeight>2000</CriticalResidueWeight>
              <OptimumDecompTemp>20</OptimumDecompTemp>
              <MaxCumulativeEOS>20</MaxCumulativeEOS>
              <CNRatioDecompCoeff>0.277</CNRatioDecompCoeff>
              <CNRatioDecompThreshold>25</CNRatioDecompThreshold>
              <TotalLeachRain>25</TotalLeachRain>
              <MinRainToLeach>10</MinRainToLeach>
              <CriticalMinimumOrganicC>0.004</CriticalMinimumOrganicC>
              <DefaultCPRatio>0</DefaultCPRatio>
              <DefaultStandingFraction>0</DefaultStandingFraction>
              <StandingExtinctCoeff>0.5</StandingExtinctCoeff>
              <FractionFaecesAdded>0.5</FractionFaecesAdded>
            </SurfaceOrganicMatter>
            <Soil>
              <Name>Soil</Name>
              <Analysis>
                <Name>Analysis</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <Rocks>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </Rocks>
                <Texture />
                <MunsellColour />
                <PH>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                </PH>
                <CEC>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                </CEC>
                <ParticleSizeSand>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                </ParticleSizeSand>
                <ParticleSizeSilt>
                  <double>30</double>
                  <double>30</double>
                  <double>30</double>
                  <double>30</double>
                </ParticleSizeSilt>
                <ParticleSizeClay>
                  <double>60</double>
                  <double>60</double>
                  <double>60</double>
                  <double>60</double>
                </ParticleSizeClay>
                <PHUnits>Water</PHUnits>
                <BoronUnits>HotWater</BoronUnits>
              </Analysis>
              <Water>
                <Name>Water</Name>
                <SoilCrop>
                  <Name>RyegrassSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                  </LL>
                  <KL>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>WhiteCloverSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                  </LL>
                  <KL>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                  </XF>
                </SoilCrop>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <BD>
                  <double>1.3</double>
                  <double>1.3</double>
                  <double>1.3</double>
                  <double>1.3</double>
                </BD>
                <AirDry>
                  <double>0.05</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </AirDry>
                <LL15>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </LL15>
                <DUL>
                  <double>0.45</double>
                  <double>0.45</double>
                  <double>0.45</double>
                  <double>0.45</double>
                </DUL>
                <SAT>
                  <double>0.5</double>
                  <double>0.5</double>
                  <double>0.5</double>
                  <double>0.5</double>
                </SAT>
                <KS>
                  <double>500</double>
                  <double>500</double>
                  <double>500</double>
                  <double>500</double>
                </KS>
              </Water>
              <SoilWater>
                <Name>SoilWater</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <SummerDate>1-Nov</SummerDate>
                <SummerU>6</SummerU>
                <SummerCona>3.5</SummerCona>
                <WinterDate>1-apr</WinterDate>
                <WinterU>6</WinterU>
                <WinterCona>3.5</WinterCona>
                <DiffusConst>88</DiffusConst>
                <DiffusSlope>35</DiffusSlope>
                <Salb>0.13</Salb>
                <CN2Bare>73</CN2Bare>
                <CNRed>20</CNRed>
                <CNCov>0.8</CNCov>
                <slope>0</slope>
                <discharge_width>0</discharge_width>
                <catchment_area>0</catchment_area>
                <max_pond>0</max_pond>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <SWCON>
                  <double>0.3</double>
                  <double>0.3</double>
                  <double>0.3</double>
                  <double>0.3</double>
                </SWCON>
                <KLAT>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </KLAT>
                <residueinterception>0</residueinterception>
              </SoilWater>
              <SoilNitrogen>
                <Name>SoilNitrogen</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <fom_type>
                  <string>default</string>
                  <string>manure</string>
                  <string>mucuna</string>
                  <string>lablab</string>
                  <string>shemp</string>
                  <string>stable</string>
                </fom_type>
                <fract_carb>
                  <double>0.2</double>
                  <double>0.3</double>
                  <double>0.54</double>
                  <double>0.57</double>
                  <double>0.45</double>
                  <double>0</double>
                </fract_carb>
                <fract_cell>
                  <double>0.7</double>
                  <double>0.3</double>
                  <double>0.37</double>
                  <double>0.37</double>
                  <double>0.47</double>
                  <double>0.1</double>
                </fract_cell>
                <fract_lign>
                  <double>0.1</double>
                  <double>0.4</double>
                  <double>0.09</double>
                  <double>0.06</double>
                  <double>0.08</double>
                  <double>0.9</double>
                </fract_lign>
                <wfpsN2N2O_x>
                  <double>22</double>
                  <double>88</double>
                </wfpsN2N2O_x>
                <wfpsN2N2O_y>
                  <double>0.1</double>
                  <double>1</double>
                </wfpsN2N2O_y>
                <oc>
                  <double>3.7136764881329496</double>
                  <double>2.4698281813043792</double>
                  <double>1.2383961716086014</double>
                  <double>0.49836009167083023</double>
                </oc>
              </SoilNitrogen>
              <SoilOrganicMatter>
                <Name>SoilOrganicMatter</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <RootCN>40</RootCN>
                <RootWt>0</RootWt>
                <SoilCN>12</SoilCN>
                <EnrACoeff>7.4</EnrACoeff>
                <EnrBCoeff>0.2</EnrBCoeff>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <Depth>
                  <string>0-15</string>
                  <string>15-30</string>
                  <string>30-45</string>
                  <string>45-60</string>
                </Depth>
                <OC>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </OC>
                <FBiom>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </FBiom>
                <FInert>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </FInert>
                <OCUnits>Total</OCUnits>
              </SoilOrganicMatter>
              <InitialWater>
                <Name>Initial water</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <PercentMethod>EvenlyDistributed</PercentMethod>
                <FractionFull>0.95</FractionFull>
                <DepthWetSoil>NaN</DepthWetSoil>
              </InitialWater>
              <Sample>
                <Name>Initial nitrogen</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <NO3>
                  <double>15</double>
                  <double>15</double>
                  <double>15</double>
                  <double>15</double>
                </NO3>
                <NH4>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </NH4>
                <NO3Units>ppm</NO3Units>
                <NH4Units>ppm</NH4Units>
                <SWUnits>Volumetric</SWUnits>
                <OCUnits>Total</OCUnits>
                <PHUnits>Water</PHUnits>
              </Sample>
              <CERESSoilTemperature>
                <Name>CERESSoilTemperature</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
              </CERESSoilTemperature>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <RecordNumber>0</RecordNumber>
              <SoilType />
              <LocalName>Stores lots of water</LocalName>
              <Site>Made up</Site>
              <NearestTown />
              <Region />
              <Country />
              <NaturalVegetation />
              <Latitude>0</Latitude>
              <Longitude>0</Longitude>
            </Soil>
            <SoluteManager>
              <Name>SoluteManager</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </SoluteManager>
            <Report>
              <Name>TestWithWaterStress</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ExperimentFactorNames />
              <ExperimentFactorValues />
              <VariableNames>
                <string>[Clock].Today as Date</string>
                <string>sum([Soil].SoilWater.SWmm) as SoilWater</string>
                <string>sum([Soil].SoilNitrogen.NH4)+sum([Soil].SoilNitrogen.NO3) as SoilNitrogen</string>
                <string>[Irrigation].IrrigationApplied as Irrigation</string>
                <string>[Fertiliser].NitrogenApplied as Fertiliser</string>
              </VariableNames>
              <EventNames>
                <string>[Clock].EndOfDay</string>
              </EventNames>
            </Report>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <Area>1</Area>
            <Slope>0</Slope>
          </Zone>
          <IncludeInDocumentation>true</IncludeInDocumentation>
        </Simulation>
        <IncludeInDocumentation>true</IncludeInDocumentation>
      </Experiment>
      <Graph>
        <Name>PlantWt</Name>
        <Series>
          <Name>Ryegrass</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithWaterStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>PlantMass</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>2600</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>Harvested</Name>
        <Series>
          <Name>Ryegrass</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithWaterStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Harvested</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>WaterDemand</Name>
        <Series>
          <Name>Demand</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithWaterStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SW_Demand</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>5</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>WaterUptake</Name>
        <Series>
          <Name>Uptake</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithWaterStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SW_Uptake</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>5</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>WaterStress</Name>
        <Series>
          <Name>Ryegrass</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithWaterStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>glfWater</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>1.05</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>NStress</Name>
        <Series>
          <Name>Ryegrass</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithWaterStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>glfNitrogen</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>1.05</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>SoilWaterZone0</Name>
        <Series>
          <Name>Water</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithWaterStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SoilWater</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone0'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>50</Minimum>
          <Maximum>275</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>SoilWaterZone1</Name>
        <Series>
          <Name>Water</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithWaterStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SoilWater</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone1'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>50</Minimum>
          <Maximum>275</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>SoilNitrogenZone1</Name>
        <Series>
          <Name>Nitrogen</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithWaterStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SoilNitrogen</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone1'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>150</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>SoilNitrogenZone0</Name>
        <Series>
          <Name>Nitrogen</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithWaterStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SoilNitrogen</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone0'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>150</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>IrrigationAppliedZone0</Name>
        <Series>
          <Name>Irrigation</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithWaterStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Irrigation</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone0'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>2000</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>IrrigationAppliedZone1</Name>
        <Series>
          <Name>Irrigation</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithWaterStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Irrigation</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone1'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>2000</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>FertiliserAppliedZone0</Name>
        <Series>
          <Name>Fertiliser</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithWaterStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Fertiliser</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone0'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>300</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>FertiliserAppliedZone1</Name>
        <Series>
          <Name>Fertiliser</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithWaterStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Fertiliser</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone1'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>300</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <IncludeInDocumentation>true</IncludeInDocumentation>
      <ShowPageOfGraphs>true</ShowPageOfGraphs>
    </Folder>
    <Folder>
      <Name>Test With Nitrogen Stress</Name>
      <Memo>
        <Name>Memo TestWithNitrogenStress</Name>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <MemoText><![CDATA[This series of simulations are as for the ‘No Stress’ series except there is no fertiliser (irrigation remains turned on).  There is also no soil organic matter or initial mineral N so this is a run-down experiment.  The expectation is that as more roots are spread into Zone1 that:
•	The plant can access more N so more dry matter will be harvested and, later on when there is insufficient stored N, senescence will be slower;

•	Water demand and water uptake will be maintained for longer;

•	There will be no water stress;

•	N stress will be delayed and less severe;

•	Soil water storage will be unaffected;

•	The soil N storage in Zone0 will be depleted more slowly while the soil N in Zone1 will be depleted more quickly; and


•	There is likely to be a reduction in irrigation applied to Zone0 and an increase in Zone1 as more water is extracted from Zone1 but this will be moderated by the reduction in growth as N becomes severely limited.

These expectations are largely met.  There are some strange dynamics when 0.25 of the roots are in Zone1 for which there is no obvious explanation but otherwise the patterns are as expected.
]]></MemoText>
      </Memo>
      <Experiment>
        <Name>Experiment</Name>
        <Factors>
          <Name>Factors</Name>
          <Factor>
            <Name>NumOfZones</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <Specifications>
              <string>[DoRootsSingle].Script.Zone1Prop=0.0,0.25,0.5,0.75,1.0</string>
            </Specifications>
          </Factor>
          <IncludeInDocumentation>true</IncludeInDocumentation>
        </Factors>
        <Simulation>
          <Name>TestWithNitrogenStress</Name>
          <Clock>
            <Name>Clock</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <StartDate>2000-01-01T00:00:00</StartDate>
            <EndDate>2000-12-31T00:00:00</EndDate>
          </Clock>
          <ControlledEnvironment>
            <Name>ControlledEnvironment</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <MaxT>25</MaxT>
            <MinT>15</MinT>
            <Rain>0</Rain>
            <Radn>25</Radn>
            <PanEvap>0</PanEvap>
            <VP>17</VP>
            <Wind>3</Wind>
            <CO2>350</CO2>
            <AirPressure>1010</AirPressure>
            <Latitude>0</Latitude>
            <DayLength>12</DayLength>
          </ControlledEnvironment>
          <SoilArbitrator>
            <Name>SoilArbitrator</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </SoilArbitrator>
          <Summary>
            <Name>Summary</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </Summary>
          <Zone>
            <Name>Zone0</Name>
            <Folder>
              <Name>Managers</Name>
              <Manager>
                <Name>DoRootsSingle</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <Zone0Depth>600</Zone0Depth>
                  <Zone0Mass>500</Zone0Mass>
                  <Zone1Name>Zone1</Zone1Name>
                  <Zone1Prop>0</Zone1Prop>
                  <Zone2Name>Zone2</Zone2Name>
                  <Zone2Prop>0</Zone2Prop>
                  <Zone3Name>Zone3</Zone3Name>
                  <Zone3Prop>0</Zone3Prop>
                </Script>
                <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Root depth in the plant's zone (mm): ")]  public double Zone0Depth { get; set; }
		[Description("Root mass  in the plant's zone (mm): ")]  public double Zone0Mass { get; set; }

		[Description("Name of the first zone: ")] public string Zone1Name { get; set; }
		[Description("Proportionate depth and mass in the first zone (-): ")]  public double Zone1Prop { get; set; }

		[Description("Name of the second zone: ")] public string Zone2Name { get; set; }
		[Description("Proportionate depth and mass in the first zone (-): ")]  public double Zone2Prop { get; set; }

		[Description("Name of the third zone: ")] public string Zone3Name { get; set; }
		[Description("Proportionate depth and mass in the first zone (-): ")]  public double Zone3Prop { get; set; }

		// - Outputs from this manager

		// - Internal variables

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			int SpeciesNum = 0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				SpeciesNum += 1;
				if (SpeciesNum == 1)
				{
					//double test = species.RootWt;
					if (Zone1Prop > 0)
						species.AddZone(zoneName: Zone1Name, rootDepth: Zone1Prop * Zone0Depth, rootDM: Zone1Prop * Zone0Mass, specificRootLength: 100);
					if (Zone2Prop > 0)
						species.AddZone(zoneName: Zone1Name, rootDepth: Zone2Prop * Zone0Depth, rootDM: Zone2Prop * Zone0Mass, specificRootLength: 100);
					if (Zone3Prop > 0)
						species.AddZone(zoneName: Zone1Name, rootDepth: Zone3Prop * Zone0Depth, rootDM: Zone3Prop * Zone0Mass, specificRootLength: 100);
				}
			}

			//Pasture[1].AddZone(zoneName: "Zone1", rootDepth: 100, rootDM: 1000, specificRootLength: 100);
			//Pasture[1].AddZone(zoneName: "Zone2", rootDepth: 50, rootDM: 500, specificRootLength: 100);
		}
	}
}]]></Code>
              </Manager>
              <Manager>
                <Name>AutomaticFertiliser</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <AllowFertiliser>no</AllowFertiliser>
                  <Depth2SoilN>600</Depth2SoilN>
                  <CriticalSoilN>100</CriticalSoilN>
                  <FertNAmount>50</FertNAmount>
                  <FertType>UreaN</FertType>
                  <FertApplicationDepth>1</FertApplicationDepth>
                  <FertMinimumDays>1</FertMinimumDays>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using APSIM.Shared.Utilities;
using System.Xml.Serialization;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		[Link] Soil Soil;

		//User inputs from properties tab
		[Description("Turn ferliser applications on? ")]
		public yesnoType AllowFertiliser { get; set; }
		
		[Description("Depth to calculate available soil N (mm): ")]
		public double Depth2SoilN { get; set; }

		[Description("Minimum available N, triggers an application (kgN/ha): ")]
		public double CriticalSoilN { get; set; }

		[Description("Amount of N fertiliser for each application (kgN/ha): ")]
		public double FertNAmount { get; set; }

		[Description("Type of N fertiliser to apply: ")]
		public Fertiliser.Types FertType { get; set; }

		[Description("Depth at which to apply the fertiliser (mm): ")]
		public double FertApplicationDepth { get; set; }
	   
		[Description("Minimum period between applications (days): ")]
		public double FertMinimumDays { get; set; }
	   
		public enum yesnoType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		[XmlIgnore] public double TopMineralN { get; set; }
		
		private DateTime lastApplicationDate;
		private bool fertiliserIsAllowed;
		private int nLayers;

		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{
			fertiliserIsAllowed = (AllowFertiliser == yesnoType.yes);
			nLayers = Soil.SoilWater.Thickness.Length;
		}

		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			double daysSinceLastApplication = (Clock.Today - lastApplicationDate).TotalDays;
			
			// get the N stored in the soil
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopMineralN = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (Depth2SoilN - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopMineralN += (Soil.SoilNitrogen.NO3[layer]
				+ Soil.SoilNitrogen.NH4[layer]
				+ Soil.SoilNitrogen.urea[layer])
				* fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= Depth2SoilN)
					layer = nLayers;
			}

			if (fertiliserIsAllowed && (daysSinceLastApplication >= FertMinimumDays) && (TopMineralN <= CriticalSoilN))
			{
				fertiliser.Apply(FertNAmount, FertType, FertApplicationDepth);
				lastApplicationDate = Clock.Today;
			}
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>AutomaticIrrigation</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <allowIrrigation>yes</allowIrrigation>
                  <allowIrrigationAll>yes</allowIrrigationAll>
                  <seasonStart>1-Jan</seasonStart>
                  <seasonEnd>31-Dec</seasonEnd>
                  <seasonsAllocation>10000</seasonsAllocation>
                  <triggerDeficit>99</triggerDeficit>
                  <targetDeficit>100</targetDeficit>
                  <returndays>1</returndays>
                  <maximumAmount>5</maximumAmount>
                  <depthPAWC>600</depthPAWC>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using System.Xml.Serialization;
using Models.PMF;
using APSIM.Shared.Utilities;

        
namespace Models
{
	[Serializable] 
	[System.Xml.Serialization.XmlInclude(typeof(Model))]
	public class Script : Model
	{
		//Communication to other modules
		[Link] ISummary summary = null;
		[Link] Irrigation Irrigation;
		[Link] Clock Clock;
		[Link] Soil Soil;
		[Link(IsOptional = true)] ICrop existingCrop;
	   
		//User inputs from properties tab
		[Description("Turn irrigation on?")] public answerType allowIrrigation { get; set; }
		[Description("Irrigate regardless of crop state?")] public answerType allowIrrigationAll { get; set; }
		[Description("Start of irrigation season (dd-MMM)")]
		public string seasonStart { get; set; }
		[Description("End of irrigation season (dd-MMM)")]
		public string seasonEnd { get; set; }
		[Description("Season allocation (mm)")]
		public double seasonsAllocation { get; set; }
		[Description("Deficit to trigger irrigation (% PAWC)")]
		public double triggerDeficit { get; set; }
		[Description("Deficit to stop irrigaton (% PAWC)")]
		public double targetDeficit { get; set; }
		[Description("Minimum days for irrigation to return")]
		public double returndays { get; set; }
		[Description("Maximum irrigation application (mm/day)")]
		public double maximumAmount { get; set; }
		[Description("Depth to calculate PAWC (mm)")]
		public double depthPAWC { get; set; }
	   
		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		//Class members
		[XmlIgnore] public double TopSWdeficit { get; set; }
		[XmlIgnore] public double TopSWC { get; set; }
		[XmlIgnore] public double DaysSinceIrrigation { get; set; }
		[XmlIgnore] public double AmountToApply { get; set; }
		[XmlIgnore] public double SeasonAppliedAmount { get; set; }
		
		private bool IrrigationIsAllowed { get; set; }
		private bool IrrigationIsAlwaysAllowed { get; set; }
		
		private bool SeasonIsOpen { get; set; }
		private bool CropIsActive { get; set; }
		private bool IrrigatorIsAvailable { get; set; }
		private bool SoilIsDry { get; set; }

		private DateTime StartDate;
		private DateTime EndDate;
		private double TopDUL;
		private double TopLL;
		private int nLayers;
	
		//Calculate static soil variables
		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{   
			//Set the season dates
			StartDate = DateTime.Parse(seasonStart + "-" + Clock.Today.Year.ToString());
			EndDate = DateTime.Parse(seasonEnd + "-" + Clock.Today.Year.ToString());
			
			//Can we irrigate at all?
			IrrigationIsAllowed = false; 
			if (allowIrrigation == answerType.yes)
				IrrigationIsAllowed = true; 
			if (allowIrrigationAll == answerType.yes)
				IrrigationIsAlwaysAllowed = true; 





			//Calculate soil water variables
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			nLayers = Soil.SoilWater.Thickness.Length;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopLL += Soil.SoilWater.LL15mm[layer] * fracLayer;
				TopDUL += Soil.SoilWater.DULmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
		}
	   	  
		//Determine daily requirement for irrigation
		[EventSubscribe("StartOfDay")]
		private void OnStartOfDay(object sender, EventArgs e)
		{
			//Can we irrigate today?		  
			SeasonIsOpen = isBetween(Clock.Today, StartDate, EndDate);

			//Is there a crop in the ground that needs irrigation?
			CropIsActive = false;
			if (IrrigationIsAlwaysAllowed)
				CropIsActive = true;  // might not be but we don't care
			else if ((existingCrop != null) && (existingCrop.IsAlive))
				CropIsActive = true;
			//if ((existingCrop.Phenology.Stage >= 3.0) && (existingCrop.Phenology.Stage < 6.0))
	      
			//Is the irrigator available?
			IrrigatorIsAvailable = false;
			DaysSinceIrrigation += 1;
			if (DaysSinceIrrigation >= returndays)
				IrrigatorIsAvailable = true;
	      
			//Is the soil dry enough to require irrigation?
			SoilIsDry = false;
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopSWC = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			//for (int layer = 0; depthFromSurface < depthPAWC + Soil.SoilWater.Thickness[layer]; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopSWC += Soil.SoilWater.SWmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
			
			TopSWdeficit = TopSWC - TopDUL;
			if (Math.Max(0.0, -TopSWdeficit) >= (TopDUL - TopLL) * (100 - triggerDeficit) / 100)
				SoilIsDry = true;
	            
			//Are all the conditions ratifying irrigation
			if (IrrigationIsAllowed && SeasonIsOpen && CropIsActive && IrrigatorIsAvailable && SoilIsDry)
			{
				//Lets bloody well irrigate then!!!!
				AmountToApply = TopDUL * targetDeficit / 100 - TopSWC;
				AmountToApply = Math.Max(0.0, Math.Min(AmountToApply, seasonsAllocation - SeasonAppliedAmount));
				Irrigation.Apply(AmountToApply);
				DaysSinceIrrigation = 0;
				SeasonAppliedAmount += AmountToApply;
			}
		}
		
		///Checks whether theDate is between iniDate and endDate (non-year specific)
		private bool isBetween(DateTime theDay, DateTime iniDate, DateTime endDate)
		{
			bool result = false;
			if (iniDate.DayOfYear < endDate.DayOfYear)
			{
				// period is within one year, ex: summer in the northern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) && (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			else
			{
				// period goes over the end of the year, ex: summer in the southern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) || (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			
			return result;
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>CutRotation</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <rotationAllowed>True</rotationAllowed>
                  <CutRotationStartDate>1900-07-01</CutRotationStartDate>
                  <CutRotationEndDate>2100-12-31</CutRotationEndDate>
                  <CutInterval>1</CutInterval>
                  <IntervalType>FixedInterval</IntervalType>
                  <DurationOfCut>1</DurationOfCut>
                  <RemoveAmountType>ResidualDM</RemoveAmountType>
                  <AmountGiven>2250</AmountGiven>
                  <DMRemoveType>RemoveAll</DMRemoveType>
                  <FractionN2Remove>1</FractionN2Remove>
                  <ProportionN2Dung>0</ProportionN2Dung>
                </Script>
                <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Do the grazing/cutting?: ")] public bool rotationAllowed { get; set; }
		[Description("Date to begin the rotation: ")] public DateTime CutRotationStartDate { get; set; }
		[Description("Date to finish the rotation: ")] public DateTime CutRotationEndDate { get; set; }
		[Description("Rotation interval (days): ")] public int CutInterval { get; set; }
		[Description("How the interval is defined: ")] public rotationIntervalTypes IntervalType { get; set; }
		[Description("Duration of each event (days): ")] public int DurationOfCut { get; set; }
		[Description("What amount is being defined: ")] public removeAmountTypes RemoveAmountType { get; set; }
		[Description("Amount to use (kg/ha): ")] public double AmountGiven { get; set; }
		[Description("Fraction of DM that is removed from the field:")] public removeDMTypes DMRemoveType { get; set; }
		[Description("Fraction of N that is removed from the field (0-1):")] public double FractionN2Remove { get; set; }
		[Description("Proportion of N returned in dung (0-1):")] public double ProportionN2Dung { get; set; }

		// - Outputs from this manager
		[XmlIgnore][Units("g/m2")] public double DefoliatedWt { get; set; }
		// Description: Pasture DM defoliated today
		[XmlIgnore][Units("g/m2")] public double DefoliatedN { get; set; }
		// Description: Pasture N defoliate today
		[XmlIgnore][Units("g/m2")] public double HarvestedWt { get; set; }
		// Description: Pasture DM harvested today
		[XmlIgnore][Units("g/m2")] public double HarvestedN { get; set; }
		// Description: Pasture N harvested today
		[XmlIgnore][Units("g/m2")] public double RemovedWt { get; set; }
		// Description: Pasture DM removed from the field
		[XmlIgnore][Units("g/m2")] public double RemovedN { get; set; }
		// Description: Pasture N removed from the field
		[XmlIgnore][Units("g/m2")] public double ReturnedWt { get; set; }
		// Description: Residue DM returned to the field
		[XmlIgnore][Units("g/m2")] public double ReturnedN { get; set; }
		// Description: Residue N returned to the field
		[XmlIgnore][Units("g/m2")] public double NReturnedInDung { get; set; }
		// Description: Harvested N returned as dung (SurfaceOM)
		[XmlIgnore][Units("g/m2")] public double NReturnedInUrine { get; set; }
		// Description: Harvested N returned as urine (urea)
		[XmlIgnore][Units("day")] public int DaysAfterCut { get; set; }
		// Description: Number of days after last defoliation
		[XmlIgnore][Units("g/m2")] public double PreHarvestDM { get; set; }
		// Description: Total standing DM (Leaf + Stem/Sheath) before cut
		[XmlIgnore][Units("g/m2")] public double PostHarvestDM { get; set; }
		// Description: Total standing DM (Leaf + Stem/Sheath) after cut
		
		// - Internal variables
		// fraction of harvested Dm to actually remove from field
		private double fractionDM2Remove = 1.0;
		// flag whether defoliation is allowed
		//private bool rotationAllowed = true;
		// number of days for each defoliation event
		private int cuttingDuration = 0;
		// counter for day within each defoliation
		private int daysCutting = 0;
		// type of interval (Fixed or target)
		private string intervalType;
		// total herbage to remove in g/m2 per day
		private double herbageToRemove;
		// type of DM amount (ResidualDM or DMToRemove)
		private string amountType;
		// auxiliary flag for defoliation
		private bool aCutHasHappened = false;

		// - Event to add residue or dung to surface OM
		public event BiomassRemovedDelegate BiomassRemoved;

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				Pasture.Add(species);
			}

			// reset variables
			DaysAfterCut = 0;
			resetVariables();
			cuttingDuration = DurationOfCut;
			
			// get the type of amount given
			if (RemoveAmountType == removeAmountTypes.ResidualDM)
				amountType = "SetResidueAmount";
			else
				amountType = "SetRemoveAmount";

			// get the type of amount given
			if (IntervalType == rotationIntervalTypes.FixedInterval)
				intervalType = "Fixed";
			else
				intervalType = "Target";

			// make sure that rotation starts when startDate < simulationStartDay
			if ((Clock.Today > CutRotationStartDate) && (Clock.Today < CutRotationEndDate))
				CutRotationStartDate = Clock.Today;
		}
		
		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			if (rotationAllowed)
			{
				if (Clock.Today == CutRotationStartDate)
					DaysAfterCut = CutInterval;

				bool SwardIsAlive = false;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				{
					if (species.IsAlive)
						SwardIsAlive = true;
				}
				
				// Check whether we can defoliate
				if ((Clock.Today >= CutRotationStartDate) && (Clock.Today <= CutRotationEndDate) && (SwardIsAlive))
				{
					// Check whether we should start a defoliation
					if (DaysAfterCut >= (CutInterval - 1))
					{
						Graze(AmountGiven, amountType, DurationOfCut);
					}
				}
			}

			// Check whether we need to continue cutting
			if ((daysCutting > 0) && (daysCutting < cuttingDuration))
			{
				// reset outputs
				resetVariables();

				removeDM(herbageToRemove);
				returnExcreta();
				daysCutting += 1;
				if (daysCutting == cuttingDuration)
				{
					PostHarvestDM = 0.0;
					foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
						PostHarvestDM += species.StandingHerbageWt;
				}
			}

			// reset outputs
			if (daysCutting < 0)
			{
				resetVariables();
				daysCutting = 0;
			}
		}

		[EventSubscribe("DoManagementCalculations")]
		private void OnDoManagementCalculations(object sender, EventArgs e)
		{
			// Check whether a cutting has finished
			if (daysCutting == cuttingDuration)
			{
				aCutHasHappened = true;
				daysCutting = -1;
			}

			// Increase the counter for days after cutting
			if (aCutHasHappened && (daysCutting == 0))
				DaysAfterCut += 1;
		}

		public enum removeAmountTypes
		{
			/// <summary>Setting DM amount to remove</summary>
			DMToRemove,
			/// <summary>Setting residual DM amount</summary>
			ResidualDM
		}

		public enum rotationIntervalTypes
		{
			/// <summary>Setting a fixed interval</summary>
			FixedInterval,
			/// <summary>Setting a target (minimum) inteval</summary>
			TargetInterval
		}

		public enum removeDMTypes
		{
			/// <summary>Remove all DM</summary>
			RemoveAll,
			/// <summary>Remove no DM</summary>
			RemoveNone,
			/// <summary>Remove a fraction based on digestibility</summary>
			BasedOnDigestibility
		}

		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}
		
				
		// Resets the values of all outputs
		private void resetVariables()
		{
			DefoliatedWt = 0.0;
			DefoliatedN = 0.0;
			HarvestedWt = 0.0;
			HarvestedN = 0.0;
			RemovedWt = 0.0;
			RemovedN = 0.0;
			ReturnedWt = 0.0;
			ReturnedN = 0.0;
			NReturnedInDung = 0.0;
			NReturnedInUrine = 0.0;
		}

		// Description: Perform the basic calculations for defoliation
		public void Graze(double amountDM, string amountType, int duration)
		{
			// Get the existing plant amount
			PreHarvestDM = 0.0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				PreHarvestDM += species.StandingHerbageWt;
			
			// Check the amount to remove and print some info
			if ((amountType == "SetRemoveAmount") && (PreHarvestDM >= amountDM / duration))
			{
				summary.WriteMessage(this, "   Defoliating " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = amountDM / duration;
			}
			else if ((amountType == "SetResidueAmount") && (PreHarvestDM >= amountDM))
			{
				summary.WriteMessage(this, "   Defoliating down to approximately " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = (PreHarvestDM - amountDM) / duration;
			}
			else
			{
				summary.WriteMessage(this, "   Defoliation will not happend because there is not enough plant material");
				if (intervalType == "Fixed")
					DaysAfterCut = -duration;
				return;
			}

			cuttingDuration = duration;
			// Preform first defoliation
			removeDM(herbageToRemove);
			returnExcreta();
			daysCutting = 1;
			DaysAfterCut = 0;
			if (daysCutting == cuttingDuration)
			{
				PostHarvestDM = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					PostHarvestDM += species.StandingHerbageWt;
			}
		}

		// Do the DM removal
		private void removeDM(double removeAmount)
		{
			double existingWt = 0.0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
				existingWt += species.HarvestableWt;


			// Check whether we harvest anything
			if (existingWt >= removeAmount)
			{
				foreach (AgPasture.PastureSpecies species in Pasture)
				{
					double amountToRemove = removeAmount * species.HarvestableWt / existingWt;
					species.Graze(amount: amountToRemove, type: "SetRemoveAmount");
				}
				
				// get total harvested
				DefoliatedWt = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					DefoliatedWt += species.HarvestedWt;
				DefoliatedN = 0.0;
				foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
					DefoliatedN += species.HarvestedN;
				HarvestedWt = DefoliatedWt;
				HarvestedN = DefoliatedN;

				// get amounts actually removed from field and that to be returned (dung/urine)
				if (DMRemoveType == removeDMTypes.RemoveAll)
					fractionDM2Remove = 1.0;
				else if (DMRemoveType == removeDMTypes.RemoveNone)
					fractionDM2Remove = 0.0;
				else
				{
					fractionDM2Remove = 0.0;
					foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
						fractionDM2Remove += species.HarvestedDigestibility * species.HarvestedWt;
					fractionDM2Remove /= removeAmount;
				}
				
				RemovedWt = HarvestedWt * fractionDM2Remove;
				RemovedN = HarvestedN * FractionN2Remove;
				ReturnedWt = HarvestedWt - RemovedWt;
				ReturnedN = HarvestedN - RemovedN;
				NReturnedInDung = ReturnedN * ProportionN2Dung;
				NReturnedInUrine = ReturnedN - NReturnedInDung;
			}
		}

		// Return dung and urine
		private void returnExcreta()
		{
			if ((ReturnedWt > 0.0) || (NReturnedInDung > 0.0))
			{
				PMF.BiomassRemovedType BiomassDung = new PMF.BiomassRemovedType();
				string[] type = new string[] { "RuminantDung_PastureFed" };
				float[] dltdm = new float[] { (Single)ReturnedWt };
				float[] dltn = new float[] { (Single)NReturnedInDung };
				float[] dltp = new float[] { 0 };
				float[] fraction = new float[] { 1 };     // fraction is always 1.0 here

				BiomassDung.crop_type = "RuminantDung_PastureFed";
				BiomassDung.dm_type = type;
				BiomassDung.dlt_crop_dm = dltdm;
				BiomassDung.dlt_dm_n = dltn;
				BiomassDung.dlt_dm_p = dltp;
				BiomassDung.fraction_to_residue = fraction;
				BiomassRemoved.Invoke(BiomassDung);
			}

			if (NReturnedInUrine > 0.0)
			{
				fertiliser.Apply(NReturnedInUrine * 10, Fertiliser.Types.UreaN, 1.0);
			}
		}
	}
}
]]></Code>
              </Manager>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ShowPageOfGraphs>true</ShowPageOfGraphs>
            </Folder>
            <MicroClimate>
              <Name>MicroClimate</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <a_interception>0</a_interception>
              <b_interception>1</b_interception>
              <c_interception>0</c_interception>
              <d_interception>0</d_interception>
              <soil_albedo>0.23</soil_albedo>
              <sun_angle>15</sun_angle>
              <soil_heat_flux_fraction>0.4</soil_heat_flux_fraction>
              <night_interception_fraction>0.5</night_interception_fraction>
              <refheight>2</refheight>
              <albedo>0.15</albedo>
              <emissivity>0.96</emissivity>
              <RadIntTotal>0</RadIntTotal>
            </MicroClimate>
            <Irrigation>
              <Name>Irrigation</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Irrigation>
            <Fertiliser>
              <Name>Fertiliser</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Fertiliser>
            <SurfaceOrganicMatter>
              <Name>SurfaceOrganicMatter</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <PondActive>no</PondActive>
              <ReportAdditions>no</ReportAdditions>
              <ReportRemovals>no</ReportRemovals>
              <ResidueTypes>
                <Name>ResidueTypes</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LoadFromResource>ResidueTypes</LoadFromResource>
              </ResidueTypes>
              <TillageTypes>
                <Name>TillageTypesList</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <TillageType />
              </TillageTypes>
              <Pools>
                <Pool>
                  <PoolName>Sward</PoolName>
                  <ResidueType>grass</ResidueType>
                  <Mass>0</Mass>
                  <CNRatio>15</CNRatio>
                  <CPRatio>NaN</CPRatio>
                  <StandingFraction>0</StandingFraction>
                </Pool>
              </Pools>
              <PoolName>Sward</PoolName>
              <type>grass</type>
              <mass>0</mass>
              <standing_fraction>0</standing_fraction>
              <cpr />
              <cnr>15</cnr>
              <CriticalResidueWeight>2000</CriticalResidueWeight>
              <OptimumDecompTemp>20</OptimumDecompTemp>
              <MaxCumulativeEOS>20</MaxCumulativeEOS>
              <CNRatioDecompCoeff>0.277</CNRatioDecompCoeff>
              <CNRatioDecompThreshold>25</CNRatioDecompThreshold>
              <TotalLeachRain>25</TotalLeachRain>
              <MinRainToLeach>10</MinRainToLeach>
              <CriticalMinimumOrganicC>0.004</CriticalMinimumOrganicC>
              <DefaultCPRatio>0</DefaultCPRatio>
              <DefaultStandingFraction>0</DefaultStandingFraction>
              <StandingExtinctCoeff>0.5</StandingExtinctCoeff>
              <FractionFaecesAdded>0.5</FractionFaecesAdded>
            </SurfaceOrganicMatter>
            <Soil>
              <Name>Soil</Name>
              <Analysis>
                <Name>Analysis</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <Rocks>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </Rocks>
                <Texture />
                <MunsellColour />
                <PH>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                </PH>
                <CEC>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                </CEC>
                <ParticleSizeSand>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                </ParticleSizeSand>
                <ParticleSizeSilt>
                  <double>30</double>
                  <double>30</double>
                  <double>30</double>
                  <double>30</double>
                </ParticleSizeSilt>
                <ParticleSizeClay>
                  <double>60</double>
                  <double>60</double>
                  <double>60</double>
                  <double>60</double>
                </ParticleSizeClay>
                <PHUnits>Water</PHUnits>
                <BoronUnits>HotWater</BoronUnits>
              </Analysis>
              <Water>
                <Name>Water</Name>
                <SoilCrop>
                  <Name>RyegrassSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                  </LL>
                  <KL>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>WhiteCloverSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                  </LL>
                  <KL>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                  </XF>
                </SoilCrop>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <BD>
                  <double>1.3</double>
                  <double>1.3</double>
                  <double>1.3</double>
                  <double>1.3</double>
                </BD>
                <AirDry>
                  <double>0.05</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </AirDry>
                <LL15>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </LL15>
                <DUL>
                  <double>0.45</double>
                  <double>0.45</double>
                  <double>0.45</double>
                  <double>0.45</double>
                </DUL>
                <SAT>
                  <double>0.5</double>
                  <double>0.5</double>
                  <double>0.5</double>
                  <double>0.5</double>
                </SAT>
                <KS>
                  <double>500</double>
                  <double>500</double>
                  <double>500</double>
                  <double>500</double>
                </KS>
              </Water>
              <SoilWater>
                <Name>SoilWater</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <SummerDate>1-Nov</SummerDate>
                <SummerU>6</SummerU>
                <SummerCona>3.5</SummerCona>
                <WinterDate>1-apr</WinterDate>
                <WinterU>6</WinterU>
                <WinterCona>3.5</WinterCona>
                <DiffusConst>88</DiffusConst>
                <DiffusSlope>35</DiffusSlope>
                <Salb>0.13</Salb>
                <CN2Bare>73</CN2Bare>
                <CNRed>20</CNRed>
                <CNCov>0.8</CNCov>
                <slope>0</slope>
                <discharge_width>0</discharge_width>
                <catchment_area>0</catchment_area>
                <max_pond>0</max_pond>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <SWCON>
                  <double>0.3</double>
                  <double>0.3</double>
                  <double>0.3</double>
                  <double>0.3</double>
                </SWCON>
                <KLAT>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </KLAT>
                <residueinterception>0</residueinterception>
              </SoilWater>
              <SoilNitrogen>
                <Name>SoilNitrogen</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <fom_type>
                  <string>default</string>
                  <string>manure</string>
                  <string>mucuna</string>
                  <string>lablab</string>
                  <string>shemp</string>
                  <string>stable</string>
                </fom_type>
                <fract_carb>
                  <double>0.2</double>
                  <double>0.3</double>
                  <double>0.54</double>
                  <double>0.57</double>
                  <double>0.45</double>
                  <double>0</double>
                </fract_carb>
                <fract_cell>
                  <double>0.7</double>
                  <double>0.3</double>
                  <double>0.37</double>
                  <double>0.37</double>
                  <double>0.47</double>
                  <double>0.1</double>
                </fract_cell>
                <fract_lign>
                  <double>0.1</double>
                  <double>0.4</double>
                  <double>0.09</double>
                  <double>0.06</double>
                  <double>0.08</double>
                  <double>0.9</double>
                </fract_lign>
                <wfpsN2N2O_x>
                  <double>22</double>
                  <double>88</double>
                </wfpsN2N2O_x>
                <wfpsN2N2O_y>
                  <double>0.1</double>
                  <double>1</double>
                </wfpsN2N2O_y>
                <oc>
                  <double>3.7136764881329496</double>
                  <double>2.4698281813043792</double>
                  <double>1.2383961716086014</double>
                  <double>0.49836009167083023</double>
                </oc>
              </SoilNitrogen>
              <SoilOrganicMatter>
                <Name>SoilOrganicMatter</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <RootCN>40</RootCN>
                <RootWt>0</RootWt>
                <SoilCN>12</SoilCN>
                <EnrACoeff>7.4</EnrACoeff>
                <EnrBCoeff>0.2</EnrBCoeff>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <Depth>
                  <string>0-15</string>
                  <string>15-30</string>
                  <string>30-45</string>
                  <string>45-60</string>
                </Depth>
                <OC>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </OC>
                <FBiom>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </FBiom>
                <FInert>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </FInert>
                <OCUnits>Total</OCUnits>
              </SoilOrganicMatter>
              <InitialWater>
                <Name>Initial water</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <PercentMethod>EvenlyDistributed</PercentMethod>
                <FractionFull>0.95</FractionFull>
                <DepthWetSoil>NaN</DepthWetSoil>
              </InitialWater>
              <Sample>
                <Name>Initial nitrogen</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <NO3>
                  <double>15</double>
                  <double>15</double>
                  <double>15</double>
                  <double>15</double>
                </NO3>
                <NH4>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </NH4>
                <NO3Units>ppm</NO3Units>
                <NH4Units>ppm</NH4Units>
                <SWUnits>Volumetric</SWUnits>
                <OCUnits>Total</OCUnits>
                <PHUnits>Water</PHUnits>
              </Sample>
              <CERESSoilTemperature>
                <Name>CERESSoilTemperature</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
              </CERESSoilTemperature>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <RecordNumber>0</RecordNumber>
              <SoilType />
              <LocalName>Stores lots of water</LocalName>
              <Site>Made up</Site>
              <NearestTown />
              <Region />
              <Country />
              <NaturalVegetation />
              <Latitude>0</Latitude>
              <Longitude>0</Longitude>
            </Soil>
            <SoluteManager>
              <Name>SoluteManager</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </SoluteManager>
            <PastureSpecies>
              <Name>Ryegrass</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <MaximumNUptake>10</MaximumNUptake>
              <Albedo>0.26</Albedo>
              <Gsmax>0.011</Gsmax>
              <R50>200</R50>
              <SpeciesFamily>Grass</SpeciesFamily>
              <PhotosyntheticPathway>C3</PhotosyntheticPathway>
              <InitialShootDM>2500</InitialShootDM>
              <InitialRootDM>500</InitialRootDM>
              <InitialRootDepth>600</InitialRootDepth>
              <ReferencePhotosyntheticRate>1</ReferencePhotosyntheticRate>
              <LightExtinctionCoefficient>0.5</LightExtinctionCoefficient>
              <GrowthTminimum>1</GrowthTminimum>
              <GrowthToptimum>20</GrowthToptimum>
              <GrowthTEffectExponent>1.7</GrowthTEffectExponent>
              <UseHeatStressFactor>yes</UseHeatStressFactor>
              <HeatOnsetTemperature>28</HeatOnsetTemperature>
              <HeatFullTemperature>35</HeatFullTemperature>
              <HeatRecoverySumDD>30</HeatRecoverySumDD>
              <HeatRecoveryTReference>25</HeatRecoveryTReference>
              <UseColdStressFactor>yes</UseColdStressFactor>
              <ColdOnsetTemperature>1</ColdOnsetTemperature>
              <ColdFullTemperature>-5</ColdFullTemperature>
              <ColdRecoverySumDD>25</ColdRecoverySumDD>
              <ColdRecoveryTReference>0</ColdRecoveryTReference>
              <MaintenanceRespirationCoefficient>0.03</MaintenanceRespirationCoefficient>
              <GrowthRespirationCoefficient>0.25</GrowthRespirationCoefficient>
              <RespirationTReference>20</RespirationTReference>
              <RespirationExponent>1.5</RespirationExponent>
              <NThresholdsForLeaves>
                <double>0.04</double>
                <double>0.012</double>
                <double>0.05</double>
              </NThresholdsForLeaves>
              <NThresholdsForStems>
                <double>0.02</double>
                <double>0.006</double>
                <double>0.025</double>
              </NThresholdsForStems>
              <NThresholdsForStolons>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </NThresholdsForStolons>
              <NThresholdsForRoots>
                <double>0.02</double>
                <double>0.006</double>
                <double>0.025</double>
              </NThresholdsForRoots>
              <DegreesDayForGermination>125</DegreesDayForGermination>
              <TargetShootRootRatio>4</TargetShootRootRatio>
              <MaxRootAllocation>0.25</MaxRootAllocation>
              <ShootRootGlfFactor>0.5</ShootRootGlfFactor>
              <UseReproSeasonFactor>yes</UseReproSeasonFactor>
              <ReproSeasonReferenceLatitude>41</ReproSeasonReferenceLatitude>
              <ReproSeasonTimingCoeff>0.14</ReproSeasonTimingCoeff>
              <ReproSeasonMaxAllocationIncrease>0.5</ReproSeasonMaxAllocationIncrease>
              <ReproSeasonAllocationCoeff>0.1</ReproSeasonAllocationCoeff>
              <FractionLeafMaximum>0.7</FractionLeafMaximum>
              <FractionLeafMinimum>0.7</FractionLeafMinimum>
              <FractionLeafDMThreshold>500</FractionLeafDMThreshold>
              <FractionLeafDMFactor>2000</FractionLeafDMFactor>
              <FractionLeafExponent>3</FractionLeafExponent>
              <FractionToStolon>0</FractionToStolon>
              <SpecificLeafArea>25</SpecificLeafArea>
              <SpecificRootLength>100</SpecificRootLength>
              <StolonEffectOnLAI>0</StolonEffectOnLAI>
              <ShootMaxEffectOnLAI>1000</ShootMaxEffectOnLAI>
              <MaxStemEffectOnLAI>1</MaxStemEffectOnLAI>
              <LiveLeavesPerTiller>3</LiveLeavesPerTiller>
              <TissueTurnoverRateShoot>0.05</TissueTurnoverRateShoot>
              <TissueTurnoverRateRoot>0.02</TissueTurnoverRateRoot>
              <DetachmentRateShoot>0.08</DetachmentRateShoot>
              <TurnoverTemperatureMin>2</TurnoverTemperatureMin>
              <TurnoverTemperatureRef>20</TurnoverTemperatureRef>
              <TurnoverTemperatureExponent>1</TurnoverTemperatureExponent>
              <TurnoverDroughtEffectMax>1</TurnoverDroughtEffectMax>
              <TurnoverDroughtThreshold>0.5</TurnoverDroughtThreshold>
              <TurnoverDefoliationCoefficient>0.5</TurnoverDefoliationCoefficient>
              <TurnoverDefoliationRootEffect>0.1</TurnoverDefoliationRootEffect>
              <FractionNLuxuryRemobilisable>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </FractionNLuxuryRemobilisable>
              <MinimumNFixation>0</MinimumNFixation>
              <MaximumNFixation>0</MaximumNFixation>
              <SoilSaturationEffectMax>0.1</SoilSaturationEffectMax>
              <MinimumWaterFreePorosity>-1</MinimumWaterFreePorosity>
              <SoilSaturationRecoveryFactor>0.25</SoilSaturationRecoveryFactor>
              <NDillutionCoefficient>0.25</NDillutionCoefficient>
              <GlfGeneric>1</GlfGeneric>
              <GlfSoilFertility>1</GlfSoilFertility>
              <PlantHeightMinimum>25</PlantHeightMinimum>
              <PlantHeightMaximum>600</PlantHeightMaximum>
              <PlantHeightMassForMax>10000</PlantHeightMassForMax>
              <PlantHeightExponent>2.8</PlantHeightExponent>
              <RootDepthMinimum>50</RootDepthMinimum>
              <RootDepthMaximum>750</RootDepthMaximum>
              <RootElongationRate>25</RootElongationRate>
              <RootDistributionDepthParam>90</RootDistributionDepthParam>
              <RootDistributionExponent>3.2</RootDistributionExponent>
              <DigestibilitiesCellWall>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.6</double>
                <double>0.2</double>
              </DigestibilitiesCellWall>
              <MinimumGreenWt>100</MinimumGreenWt>
              <FractionStolonStanding>0</FractionStolonStanding>
              <PreferenceForGreenOverDead>1</PreferenceForGreenOverDead>
              <PreferenceForLeafOverStems>1</PreferenceForLeafOverStems>
              <WaterAvailableMethod>DefaultAPSIM</WaterAvailableMethod>
              <NitrogenAvailableMethod>BasicAgPasture</NitrogenAvailableMethod>
            </PastureSpecies>
            <Report>
              <Name>TestWithNitrogenStress</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ExperimentFactorNames />
              <ExperimentFactorValues />
              <VariableNames>
                <string>[Clock].Today as Date</string>
                <string>[Ryegrass].AboveGroundWt as PlantMass</string>
                <string>[Ryegrass].HarvestedWt as Harvested</string>
                <string>[Ryegrass].WaterDemand as SW_Demand</string>
                <string>sum([Ryegrass].WaterUptake) as SW_Uptake</string>
                <string>[Ryegrass].GlfWaterSupply as glfWater</string>
                <string>[Ryegrass].GlfNSupply as glfNitrogen</string>
                <string>sum([Soil].SoilWater.SWmm) as SoilWater</string>
                <string>sum([Soil].SoilNitrogen.NH4)+sum([Soil].SoilNitrogen.NO3) as SoilNitrogen</string>
                <string>[Irrigation].IrrigationApplied as Irrigation</string>
                <string>[Fertiliser].NitrogenApplied as Fertiliser</string>
              </VariableNames>
              <EventNames>
                <string>[Clock].EndOfDay</string>
              </EventNames>
            </Report>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <Area>1</Area>
            <Slope>0</Slope>
          </Zone>
          <Zone>
            <Name>Zone1</Name>
            <Folder>
              <Name>Managers</Name>
              <Manager>
                <Name>AutomaticFertiliser</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <AllowFertiliser>no</AllowFertiliser>
                  <Depth2SoilN>600</Depth2SoilN>
                  <CriticalSoilN>100</CriticalSoilN>
                  <FertNAmount>50</FertNAmount>
                  <FertType>UreaN</FertType>
                  <FertApplicationDepth>1</FertApplicationDepth>
                  <FertMinimumDays>1</FertMinimumDays>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using APSIM.Shared.Utilities;
using System.Xml.Serialization;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		[Link] Soil Soil;

		//User inputs from properties tab
		[Description("Turn ferliser applications on? ")]
		public yesnoType AllowFertiliser { get; set; }
		
		[Description("Depth to calculate available soil N (mm): ")]
		public double Depth2SoilN { get; set; }

		[Description("Minimum available N, triggers an application (kgN/ha): ")]
		public double CriticalSoilN { get; set; }

		[Description("Amount of N fertiliser for each application (kgN/ha): ")]
		public double FertNAmount { get; set; }

		[Description("Type of N fertiliser to apply: ")]
		public Fertiliser.Types FertType { get; set; }

		[Description("Depth at which to apply the fertiliser (mm): ")]
		public double FertApplicationDepth { get; set; }
	   
		[Description("Minimum period between applications (days): ")]
		public double FertMinimumDays { get; set; }
	   
		public enum yesnoType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		[XmlIgnore] public double TopMineralN { get; set; }
		
		private DateTime lastApplicationDate;
		private bool fertiliserIsAllowed;
		private int nLayers;

		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{
			fertiliserIsAllowed = (AllowFertiliser == yesnoType.yes);
			nLayers = Soil.SoilWater.Thickness.Length;
		}

		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			double daysSinceLastApplication = (Clock.Today - lastApplicationDate).TotalDays;
			
			// get the N stored in the soil
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopMineralN = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (Depth2SoilN - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopMineralN += (Soil.SoilNitrogen.NO3[layer]
				+ Soil.SoilNitrogen.NH4[layer]
				+ Soil.SoilNitrogen.urea[layer])
				* fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= Depth2SoilN)
					layer = nLayers;
			}

			if (fertiliserIsAllowed && (daysSinceLastApplication >= FertMinimumDays) && (TopMineralN <= CriticalSoilN))
			{
				fertiliser.Apply(FertNAmount, FertType, FertApplicationDepth);
				lastApplicationDate = Clock.Today;
			}
		}
	}
}
]]></Code>
              </Manager>
              <Manager>
                <Name>AutomaticIrrigation</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Script>
                  <allowIrrigation>yes</allowIrrigation>
                  <allowIrrigationAll>yes</allowIrrigationAll>
                  <seasonStart>1-Jan</seasonStart>
                  <seasonEnd>31-Dec</seasonEnd>
                  <seasonsAllocation>10000</seasonsAllocation>
                  <triggerDeficit>99</triggerDeficit>
                  <targetDeficit>100</targetDeficit>
                  <returndays>1</returndays>
                  <maximumAmount>5</maximumAmount>
                  <depthPAWC>600</depthPAWC>
                </Script>
                <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using System.Xml.Serialization;
using Models.PMF;
using APSIM.Shared.Utilities;

        
namespace Models
{
	[Serializable] 
	[System.Xml.Serialization.XmlInclude(typeof(Model))]
	public class Script : Model
	{
		//Communication to other modules
		[Link] ISummary summary = null;
		[Link] Irrigation Irrigation;
		[Link] Clock Clock;
		[Link] Soil Soil;
		[Link(IsOptional = true)] ICrop existingCrop;
	   
		//User inputs from properties tab
		[Description("Turn irrigation on?")] public answerType allowIrrigation { get; set; }
		[Description("Irrigate regardless of crop state?")] public answerType allowIrrigationAll { get; set; }
		[Description("Start of irrigation season (dd-MMM)")]
		public string seasonStart { get; set; }
		[Description("End of irrigation season (dd-MMM)")]
		public string seasonEnd { get; set; }
		[Description("Season allocation (mm)")]
		public double seasonsAllocation { get; set; }
		[Description("Deficit to trigger irrigation (% PAWC)")]
		public double triggerDeficit { get; set; }
		[Description("Deficit to stop irrigaton (% PAWC)")]
		public double targetDeficit { get; set; }
		[Description("Minimum days for irrigation to return")]
		public double returndays { get; set; }
		[Description("Maximum irrigation application (mm/day)")]
		public double maximumAmount { get; set; }
		[Description("Depth to calculate PAWC (mm)")]
		public double depthPAWC { get; set; }
	   
		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		//Class members
		[XmlIgnore] public double TopSWdeficit { get; set; }
		[XmlIgnore] public double TopSWC { get; set; }
		[XmlIgnore] public double DaysSinceIrrigation { get; set; }
		[XmlIgnore] public double AmountToApply { get; set; }
		[XmlIgnore] public double SeasonAppliedAmount { get; set; }
		
		private bool IrrigationIsAllowed { get; set; }
		private bool IrrigationIsAlwaysAllowed { get; set; }
		
		private bool SeasonIsOpen { get; set; }
		private bool CropIsActive { get; set; }
		private bool IrrigatorIsAvailable { get; set; }
		private bool SoilIsDry { get; set; }

		private DateTime StartDate;
		private DateTime EndDate;
		private double TopDUL;
		private double TopLL;
		private int nLayers;
	
		//Calculate static soil variables
		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{   
			//Set the season dates
			StartDate = DateTime.Parse(seasonStart + "-" + Clock.Today.Year.ToString());
			EndDate = DateTime.Parse(seasonEnd + "-" + Clock.Today.Year.ToString());
			
			//Can we irrigate at all?
			IrrigationIsAllowed = false; 
			if (allowIrrigation == answerType.yes)
				IrrigationIsAllowed = true; 
			if (allowIrrigationAll == answerType.yes)
				IrrigationIsAlwaysAllowed = true; 





			//Calculate soil water variables
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			nLayers = Soil.SoilWater.Thickness.Length;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopLL += Soil.SoilWater.LL15mm[layer] * fracLayer;
				TopDUL += Soil.SoilWater.DULmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
		}
	   	  
		//Determine daily requirement for irrigation
		[EventSubscribe("StartOfDay")]
		private void OnStartOfDay(object sender, EventArgs e)
		{
			//Can we irrigate today?		  
			SeasonIsOpen = isBetween(Clock.Today, StartDate, EndDate);

			//Is there a crop in the ground that needs irrigation?
			CropIsActive = false;
			if (IrrigationIsAlwaysAllowed)
				CropIsActive = true;  // might not be but we don't care
			else if ((existingCrop != null) && (existingCrop.IsAlive))
				CropIsActive = true;
			//if ((existingCrop.Phenology.Stage >= 3.0) && (existingCrop.Phenology.Stage < 6.0))
	      
			//Is the irrigator available?
			IrrigatorIsAvailable = false;
			DaysSinceIrrigation += 1;
			if (DaysSinceIrrigation >= returndays)
				IrrigatorIsAvailable = true;
	      
			//Is the soil dry enough to require irrigation?
			SoilIsDry = false;
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopSWC = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			//for (int layer = 0; depthFromSurface < depthPAWC + Soil.SoilWater.Thickness[layer]; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopSWC += Soil.SoilWater.SWmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
			
			TopSWdeficit = TopSWC - TopDUL;
			if (Math.Max(0.0, -TopSWdeficit) >= (TopDUL - TopLL) * (100 - triggerDeficit) / 100)
				SoilIsDry = true;
	            
			//Are all the conditions ratifying irrigation
			if (IrrigationIsAllowed && SeasonIsOpen && CropIsActive && IrrigatorIsAvailable && SoilIsDry)
			{
				//Lets bloody well irrigate then!!!!
				AmountToApply = TopDUL * targetDeficit / 100 - TopSWC;
				AmountToApply = Math.Max(0.0, Math.Min(AmountToApply, seasonsAllocation - SeasonAppliedAmount));
				Irrigation.Apply(AmountToApply);
				DaysSinceIrrigation = 0;
				SeasonAppliedAmount += AmountToApply;
			}
		}
		
		///Checks whether theDate is between iniDate and endDate (non-year specific)
		private bool isBetween(DateTime theDay, DateTime iniDate, DateTime endDate)
		{
			bool result = false;
			if (iniDate.DayOfYear < endDate.DayOfYear)
			{
				// period is within one year, ex: summer in the northern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) && (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			else
			{
				// period goes over the end of the year, ex: summer in the southern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) || (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			
			return result;
		}
	}
}
]]></Code>
              </Manager>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ShowPageOfGraphs>true</ShowPageOfGraphs>
            </Folder>
            <MicroClimate>
              <Name>MicroClimate</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <a_interception>0</a_interception>
              <b_interception>1</b_interception>
              <c_interception>0</c_interception>
              <d_interception>0</d_interception>
              <soil_albedo>0.23</soil_albedo>
              <sun_angle>15</sun_angle>
              <soil_heat_flux_fraction>0.4</soil_heat_flux_fraction>
              <night_interception_fraction>0.5</night_interception_fraction>
              <refheight>2</refheight>
              <albedo>0.15</albedo>
              <emissivity>0.96</emissivity>
              <RadIntTotal>0</RadIntTotal>
            </MicroClimate>
            <Irrigation>
              <Name>Irrigation</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Irrigation>
            <Fertiliser>
              <Name>Fertiliser</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </Fertiliser>
            <SurfaceOrganicMatter>
              <Name>SurfaceOrganicMatter</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <PondActive>no</PondActive>
              <ReportAdditions>no</ReportAdditions>
              <ReportRemovals>no</ReportRemovals>
              <ResidueTypes>
                <Name>ResidueTypes</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LoadFromResource>ResidueTypes</LoadFromResource>
              </ResidueTypes>
              <TillageTypes>
                <Name>TillageTypesList</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <TillageType />
              </TillageTypes>
              <Pools>
                <Pool>
                  <PoolName>Sward</PoolName>
                  <ResidueType>grass</ResidueType>
                  <Mass>0</Mass>
                  <CNRatio>15</CNRatio>
                  <CPRatio>NaN</CPRatio>
                  <StandingFraction>0</StandingFraction>
                </Pool>
              </Pools>
              <PoolName>Sward</PoolName>
              <type>grass</type>
              <mass>0</mass>
              <standing_fraction>0</standing_fraction>
              <cpr />
              <cnr>15</cnr>
              <CriticalResidueWeight>2000</CriticalResidueWeight>
              <OptimumDecompTemp>20</OptimumDecompTemp>
              <MaxCumulativeEOS>20</MaxCumulativeEOS>
              <CNRatioDecompCoeff>0.277</CNRatioDecompCoeff>
              <CNRatioDecompThreshold>25</CNRatioDecompThreshold>
              <TotalLeachRain>25</TotalLeachRain>
              <MinRainToLeach>10</MinRainToLeach>
              <CriticalMinimumOrganicC>0.004</CriticalMinimumOrganicC>
              <DefaultCPRatio>0</DefaultCPRatio>
              <DefaultStandingFraction>0</DefaultStandingFraction>
              <StandingExtinctCoeff>0.5</StandingExtinctCoeff>
              <FractionFaecesAdded>0.5</FractionFaecesAdded>
            </SurfaceOrganicMatter>
            <Soil>
              <Name>Soil</Name>
              <Analysis>
                <Name>Analysis</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <Rocks>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </Rocks>
                <Texture />
                <MunsellColour />
                <PH>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                  <double>6</double>
                </PH>
                <CEC>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                </CEC>
                <ParticleSizeSand>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                  <double>10</double>
                </ParticleSizeSand>
                <ParticleSizeSilt>
                  <double>30</double>
                  <double>30</double>
                  <double>30</double>
                  <double>30</double>
                </ParticleSizeSilt>
                <ParticleSizeClay>
                  <double>60</double>
                  <double>60</double>
                  <double>60</double>
                  <double>60</double>
                </ParticleSizeClay>
                <PHUnits>Water</PHUnits>
                <BoronUnits>HotWater</BoronUnits>
              </Analysis>
              <Water>
                <Name>Water</Name>
                <SoilCrop>
                  <Name>RyegrassSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                  </LL>
                  <KL>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                  </XF>
                </SoilCrop>
                <SoilCrop>
                  <Name>WhiteCloverSoil</Name>
                  <IncludeInDocumentation>true</IncludeInDocumentation>
                  <LL>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                    <double>0.1</double>
                  </LL>
                  <KL>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                    <double>0.05</double>
                  </KL>
                  <XF>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                    <double>1</double>
                  </XF>
                </SoilCrop>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <BD>
                  <double>1.3</double>
                  <double>1.3</double>
                  <double>1.3</double>
                  <double>1.3</double>
                </BD>
                <AirDry>
                  <double>0.05</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </AirDry>
                <LL15>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </LL15>
                <DUL>
                  <double>0.45</double>
                  <double>0.45</double>
                  <double>0.45</double>
                  <double>0.45</double>
                </DUL>
                <SAT>
                  <double>0.5</double>
                  <double>0.5</double>
                  <double>0.5</double>
                  <double>0.5</double>
                </SAT>
                <KS>
                  <double>500</double>
                  <double>500</double>
                  <double>500</double>
                  <double>500</double>
                </KS>
              </Water>
              <SoilWater>
                <Name>SoilWater</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <SummerDate>1-Nov</SummerDate>
                <SummerU>6</SummerU>
                <SummerCona>3.5</SummerCona>
                <WinterDate>1-apr</WinterDate>
                <WinterU>6</WinterU>
                <WinterCona>3.5</WinterCona>
                <DiffusConst>88</DiffusConst>
                <DiffusSlope>35</DiffusSlope>
                <Salb>0.13</Salb>
                <CN2Bare>73</CN2Bare>
                <CNRed>20</CNRed>
                <CNCov>0.8</CNCov>
                <slope>0</slope>
                <discharge_width>0</discharge_width>
                <catchment_area>0</catchment_area>
                <max_pond>0</max_pond>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <SWCON>
                  <double>0.3</double>
                  <double>0.3</double>
                  <double>0.3</double>
                  <double>0.3</double>
                </SWCON>
                <KLAT>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </KLAT>
                <residueinterception>0</residueinterception>
              </SoilWater>
              <SoilNitrogen>
                <Name>SoilNitrogen</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <fom_type>
                  <string>default</string>
                  <string>manure</string>
                  <string>mucuna</string>
                  <string>lablab</string>
                  <string>shemp</string>
                  <string>stable</string>
                </fom_type>
                <fract_carb>
                  <double>0.2</double>
                  <double>0.3</double>
                  <double>0.54</double>
                  <double>0.57</double>
                  <double>0.45</double>
                  <double>0</double>
                </fract_carb>
                <fract_cell>
                  <double>0.7</double>
                  <double>0.3</double>
                  <double>0.37</double>
                  <double>0.37</double>
                  <double>0.47</double>
                  <double>0.1</double>
                </fract_cell>
                <fract_lign>
                  <double>0.1</double>
                  <double>0.4</double>
                  <double>0.09</double>
                  <double>0.06</double>
                  <double>0.08</double>
                  <double>0.9</double>
                </fract_lign>
                <wfpsN2N2O_x>
                  <double>22</double>
                  <double>88</double>
                </wfpsN2N2O_x>
                <wfpsN2N2O_y>
                  <double>0.1</double>
                  <double>1</double>
                </wfpsN2N2O_y>
                <oc>
                  <double>3.7136764881329496</double>
                  <double>2.4698281813043792</double>
                  <double>1.2383961716086014</double>
                  <double>0.49836009167083023</double>
                </oc>
              </SoilNitrogen>
              <SoilOrganicMatter>
                <Name>SoilOrganicMatter</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <RootCN>40</RootCN>
                <RootWt>0</RootWt>
                <SoilCN>12</SoilCN>
                <EnrACoeff>7.4</EnrACoeff>
                <EnrBCoeff>0.2</EnrBCoeff>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <Depth>
                  <string>0-15</string>
                  <string>15-30</string>
                  <string>30-45</string>
                  <string>45-60</string>
                </Depth>
                <OC>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </OC>
                <FBiom>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </FBiom>
                <FInert>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </FInert>
                <OCUnits>Total</OCUnits>
              </SoilOrganicMatter>
              <InitialWater>
                <Name>Initial water</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <PercentMethod>EvenlyDistributed</PercentMethod>
                <FractionFull>0.95</FractionFull>
                <DepthWetSoil>NaN</DepthWetSoil>
              </InitialWater>
              <Sample>
                <Name>Initial nitrogen</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <Thickness>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                  <double>150</double>
                </Thickness>
                <NO3>
                  <double>15</double>
                  <double>15</double>
                  <double>15</double>
                  <double>15</double>
                </NO3>
                <NH4>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                  <double>0</double>
                </NH4>
                <NO3Units>ppm</NO3Units>
                <NH4Units>ppm</NH4Units>
                <SWUnits>Volumetric</SWUnits>
                <OCUnits>Total</OCUnits>
                <PHUnits>Water</PHUnits>
              </Sample>
              <CERESSoilTemperature>
                <Name>CERESSoilTemperature</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
              </CERESSoilTemperature>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <RecordNumber>0</RecordNumber>
              <SoilType />
              <LocalName>Stores lots of water</LocalName>
              <Site>Made up</Site>
              <NearestTown />
              <Region />
              <Country />
              <NaturalVegetation />
              <Latitude>0</Latitude>
              <Longitude>0</Longitude>
            </Soil>
            <SoluteManager>
              <Name>SoluteManager</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </SoluteManager>
            <Report>
              <Name>TestWithNitrogenStress</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <ExperimentFactorNames />
              <ExperimentFactorValues />
              <VariableNames>
                <string>[Clock].Today as Date</string>
                <string>sum([Soil].SoilWater.SWmm) as SoilWater</string>
                <string>sum([Soil].SoilNitrogen.NH4)+sum([Soil].SoilNitrogen.NO3) as SoilNitrogen</string>
                <string>[Irrigation].IrrigationApplied as Irrigation</string>
                <string>[Fertiliser].NitrogenApplied as Fertiliser</string>
              </VariableNames>
              <EventNames>
                <string>[Clock].EndOfDay</string>
              </EventNames>
            </Report>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <Area>1</Area>
            <Slope>0</Slope>
          </Zone>
          <IncludeInDocumentation>true</IncludeInDocumentation>
        </Simulation>
        <IncludeInDocumentation>true</IncludeInDocumentation>
      </Experiment>
      <Graph>
        <Name>PlantWt</Name>
        <Series>
          <Name>Ryegrass</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNitrogenStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>PlantMass</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>2600</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>Harvested</Name>
        <Series>
          <Name>Ryegrass</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNitrogenStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Harvested</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>WaterDemand</Name>
        <Series>
          <Name>Demand</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNitrogenStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SW_Demand</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>5</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>WaterUptake</Name>
        <Series>
          <Name>Uptake</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNitrogenStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SW_Uptake</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>5</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>WaterStress</Name>
        <Series>
          <Name>Ryegrass</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNitrogenStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>glfWater</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>1.05</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>NStress</Name>
        <Series>
          <Name>Ryegrass</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNitrogenStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>glfNitrogen</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>1.05</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>SoilWaterZone0</Name>
        <Series>
          <Name>Water</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNitrogenStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SoilWater</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone0'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>50</Minimum>
          <Maximum>275</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>SoilWaterZone1</Name>
        <Series>
          <Name>Water</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNitrogenStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SoilWater</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone1'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>50</Minimum>
          <Maximum>275</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>SoilNitrogenZone1</Name>
        <Series>
          <Name>Nitrogen</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNitrogenStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SoilNitrogen</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone1'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>150</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>SoilNitrogenZone0</Name>
        <Series>
          <Name>Nitrogen</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNitrogenStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SoilNitrogen</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone0'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>150</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>IrrigationAppliedZone0</Name>
        <Series>
          <Name>Irrigation</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNitrogenStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Irrigation</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone0'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>2000</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>IrrigationAppliedZone1</Name>
        <Series>
          <Name>Irrigation</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNitrogenStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Irrigation</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone1'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>2000</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>FertiliserAppliedZone0</Name>
        <Series>
          <Name>Fertiliser</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNitrogenStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Fertiliser</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone0'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>2300</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>FertiliserAppliedZone1</Name>
        <Series>
          <Name>Fertiliser</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>1</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>TestWithNitrogenStress</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Fertiliser</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter>[Zone] = 'Zone1'</Filter>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>2300</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <IncludeInDocumentation>true</IncludeInDocumentation>
      <ShowPageOfGraphs>true</ShowPageOfGraphs>
    </Folder>
    <Folder>
      <Name>Three Zone Simulation with Initial Uniform Soil N</Name>
      <Memo>
        <Name>Memo ThreeZoneSimulationInitialUniformSoilN</Name>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <MemoText><![CDATA[In this simulation, which is largely based on the one above, there are three zones with a ryegrass, lots of irrigation but no fertiliser and about 35 kg mineral N in the soil at initialisation.  The roots from the ryegrass in Zone1 has roots on Zone0 and Zone2 but the ryegrasses in Zone0 and Zone2 only have roots in their own zone.  As expected:

•	the ryegrass in Zone1 grows more (note that Zone0 and Zone2 are mostly plotting on top of each other), 

•	water demand and uptake is higher, 

•	N stress is lower for longer because the plant has access to some of the N in Zone 0 and 2, 

•	soil N storage declines more slowly, and 

•	more irrigation is required in Zones 0 and 2 because of the additional water uptake from the Sone1 ryegrass and its spreading roots.  
]]></MemoText>
      </Memo>
      <Graph>
        <Name>PlantWt</Name>
        <Series>
          <Name>Ryegrass</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>ThreeZoneSimulationInitialUniformSoilN</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>PlantMass</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>2600</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>Harvested</Name>
        <Series>
          <Name>Ryegrass</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>ThreeZoneSimulationInitialUniformSoilN</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Harvested</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>WaterDemand</Name>
        <Series>
          <Name>Demand</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>ThreeZoneSimulationInitialUniformSoilN</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SW_Demand</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>5</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>WaterUptake</Name>
        <Series>
          <Name>Uptake</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>ThreeZoneSimulationInitialUniformSoilN</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SW_Uptake</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>5</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>WaterStress</Name>
        <Series>
          <Name>Ryegrass</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>ThreeZoneSimulationInitialUniformSoilN</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>glfWater</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>1.05</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>NStress</Name>
        <Series>
          <Name>Ryegrass</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>ThreeZoneSimulationInitialUniformSoilN</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>glfNitrogen</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>1.05</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>SoilWater</Name>
        <Series>
          <Name>Water</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>ThreeZoneSimulationInitialUniformSoilN</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SoilWater</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter />
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>50</Minimum>
          <Maximum>275</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>SoilNitrogen</Name>
        <Series>
          <Name>Nitrogen</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>ThreeZoneSimulationInitialUniformSoilN</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SoilNitrogen</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter />
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>IrrigationApplied</Name>
        <Series>
          <Name>Irrigation</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>ThreeZoneSimulationInitialUniformSoilN</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Irrigation</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter />
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>FertiliserApplied</Name>
        <Series>
          <Name>Fertiliser</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>ThreeZoneSimulationInitialUniformSoilN</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Fertiliser</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter />
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Simulation>
        <Name>ThreeZoneSimulationInitialUniformSoilN</Name>
        <Clock>
          <Name>Clock</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <StartDate>2000-01-01T00:00:00</StartDate>
          <EndDate>2000-03-31T00:00:00</EndDate>
        </Clock>
        <ControlledEnvironment>
          <Name>ControlledEnvironment</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <MaxT>25</MaxT>
          <MinT>15</MinT>
          <Rain>0</Rain>
          <Radn>25</Radn>
          <PanEvap>0</PanEvap>
          <VP>17</VP>
          <Wind>3</Wind>
          <CO2>350</CO2>
          <AirPressure>1010</AirPressure>
          <Latitude>0</Latitude>
          <DayLength>12</DayLength>
        </ControlledEnvironment>
        <SoilArbitrator>
          <Name>SoilArbitrator</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
        </SoilArbitrator>
        <Summary>
          <Name>Summary</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
        </Summary>
        <Zone>
          <Name>Zone0</Name>
          <Folder>
            <Name>Managers</Name>
            <Manager>
              <Name>DoRootsThreeZone</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <RootDepth>600</RootDepth>
                <RootMass>500</RootMass>
                <Zone0Name>Zone0</Zone0Name>
                <Zone0Prop>0</Zone0Prop>
                <Zone2Name>Zone1</Zone2Name>
                <Zone2Prop>0</Zone2Prop>
              </Script>
              <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Root depth in the plant's zone (mm): ")]  public double RootDepth { get; set; }
		[Description("Root mass  in the plant's zone (mm): ")]  public double RootMass { get; set; }

		[Description("Name of zone ot the left: ")] public string Zone0Name { get; set; }
		[Description("Proportionate depth and mass in zone to the left (-): ")]  public double Zone0Prop { get; set; }

		[Description("Name of zone ot the right: ")] public string Zone2Name { get; set; }
		[Description("Proportionate depth and mass in zone to the right (-): ")]  public double Zone2Prop { get; set; }

		// - Outputs from this manager

		// - Internal variables

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			int SpeciesNum = 0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				SpeciesNum += 1;
				if (SpeciesNum == 1)
				{
					if (Zone0Prop > 0)
						species.AddZone(zoneName: Zone0Name, rootDepth: Zone0Prop * RootDepth, rootDM: Zone0Prop * RootMass, specificRootLength: 100);
					if (Zone2Prop > 0)
						species.AddZone(zoneName: Zone2Name, rootDepth: Zone2Prop * RootDepth, rootDM: Zone2Prop * RootMass, specificRootLength: 100);
				}
			}

			//Pasture[1].AddZone(zoneName: "Zone1", rootDepth: 100, rootDM: 1000, specificRootLength: 100);
			//Pasture[1].AddZone(zoneName: "Zone2", rootDepth: 50, rootDM: 500, specificRootLength: 100);
		}
	}
}]]></Code>
            </Manager>
            <Manager>
              <Name>CutRotationSingle</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <CutRotationStartDate>1900-07-01</CutRotationStartDate>
                <CutRotationEndDate>2100-12-31</CutRotationEndDate>
                <CutInterval>1</CutInterval>
                <IntervalType>FixedInterval</IntervalType>
                <DurationOfCut>1</DurationOfCut>
                <RemoveAmountType>ResidualDM</RemoveAmountType>
                <AmountGiven>2250</AmountGiven>
                <DMRemoveType>RemoveAll</DMRemoveType>
                <FractionN2Remove>1</FractionN2Remove>
                <ProportionN2Dung>0</ProportionN2Dung>
              </Script>
              <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Date to begin the rotation: ")]
		public DateTime CutRotationStartDate { get; set; }

		[Description("Date to finish the rotation: ")]
		public DateTime CutRotationEndDate { get; set; }

		[Description("Rotation interval (days): ")]
		public int CutInterval { get; set; }

		[Description("How the interval is defined: ")]
		public rotationIntervalTypes IntervalType { get; set; }

		[Description("Duration of each event (days): ")]
		public int DurationOfCut { get; set; }

		[Description("What amount is being defined: ")]
		public removeAmountTypes RemoveAmountType { get; set; }

		[Description("Amount to use (kg/ha): ")]
		public double AmountGiven { get; set; }

		[Description("Fraction of DM that is removed from the field:")]
		public removeDMTypes DMRemoveType { get; set; }

		[Description("Fraction of N that is removed from the field (0-1):")]
		public double FractionN2Remove { get; set; }

		[Description("Proportion of N returned in dung (0-1):")]
		public double ProportionN2Dung { get; set; }

		// - Outputs from this manager
		[XmlIgnore][Units("g/m2")]// Description: Pasture DM defoliated today
		public double DefoliatedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture N defoliate today
		public double DefoliatedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture DM harvested today
		public double HarvestedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture N harvested today
		public double HarvestedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture DM removed from the field
		public double RemovedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture N removed from the field
		public double RemovedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Residue DM returned to the field
		public double ReturnedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Residue N returned to the field
		public double ReturnedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Harvested N returned as dung (SurfaceOM)
		public double NReturnedInDung { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Harvested N returned as urine (urea)
		public double NReturnedInUrine { get; set; }
		[XmlIgnore][Units("day")]// Description: Number of days after last defoliation
		public int DaysAfterCut { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Total standing DM (Leaf + Stem/Sheath) before cut
		public double PreHarvestDM { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Total standing DM (Leaf + Stem/Sheath) after cut
		public double PostHarvestDM { get; set; }
		
		// - Internal variables
		// fraction of harvested Dm to actually remove from field
		private double fractionDM2Remove = 1.0;
		// flag whether defoliation is allowed
		private bool rotationAllowed = true;
		// number of days for each defoliation event
		private int cuttingDuration = 0;
		// counter for day within each defoliation
		private int daysCutting = 0;
		// type of interval (Fixed or target)
		private string intervalType;
		// total herbage to remove in g/m2 per day
		private double herbageToRemove;
		// type of DM amount (ResidualDM or DMToRemove)
		private string amountType;
		// auxiliary flag for defoliation
		private bool aCutHasHappened = false;

		// - Event to add residue or dung to surface OM
		public event BiomassRemovedDelegate BiomassRemoved;

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				Pasture.Add(species);
			}

			// reset variables
			DaysAfterCut = 0;
			resetVariables();
			cuttingDuration = DurationOfCut;
			
			// get the type of amount given
			if (RemoveAmountType == removeAmountTypes.ResidualDM)
				amountType = "SetResidueAmount";
			else
				amountType = "SetRemoveAmount";

			// get the type of amount given
			if (IntervalType == rotationIntervalTypes.FixedInterval)
				intervalType = "Fixed";
			else
				intervalType = "Target";

			// make sure that rotation start when startDate < simulationStartDay
			if ((Clock.Today > CutRotationStartDate) && (Clock.Today < CutRotationEndDate))
				CutRotationStartDate = Clock.Today;
		}
		
		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			if (rotationAllowed)
			{
				if (Clock.Today == CutRotationStartDate)
					DaysAfterCut = CutInterval;

				// Check whether we can defoliate
				if ((Clock.Today >= CutRotationStartDate) && (Clock.Today <= CutRotationEndDate) && (Pasture[0].IsAlive))
				{
					// Check whether we should start a defoliation
					if (DaysAfterCut >= (CutInterval - 1))
					{
						Graze(AmountGiven, amountType, DurationOfCut);
					}
				}
			}

			// Check whether we need to continue cutting
			if ((daysCutting > 0) && (daysCutting < cuttingDuration))
			{
				// reset outputs
				resetVariables();

				removeDM(herbageToRemove);
				returnExcreta();
				daysCutting += 1;
				if (daysCutting == cuttingDuration)
					PostHarvestDM = Pasture[0].StandingHerbageWt; //+ Pasture[1].StandingHerbageWt
			}

			// reset outputs
			if (daysCutting < 0)
			{
				resetVariables();
				daysCutting = 0;
			}
		}

		[EventSubscribe("DoManagementCalculations")]
		private void OnDoManagementCalculations(object sender, EventArgs e)
		{
			// Check whether a cutting has finished
			if (daysCutting == cuttingDuration)
			{
				aCutHasHappened = true;
				daysCutting = -1;
			}

			// Increase the counter for days after cutting
			if (aCutHasHappened && (daysCutting == 0))
				DaysAfterCut += 1;
		}

		public enum removeAmountTypes
		{
			/// <summary>Setting DM amount to remove</summary>
			DMToRemove,
			/// <summary>Setting residual DM amount</summary>
			ResidualDM
		}

		public enum rotationIntervalTypes
		{
			/// <summary>Setting a fixed interval</summary>
			FixedInterval,
			/// <summary>Setting a target (minimum) inteval</summary>
			TargetInterval
		}

		public enum removeDMTypes
		{
			/// <summary>Remove all DM</summary>
			RemoveAll,
			/// <summary>Remove no DM</summary>
			RemoveNone,
			/// <summary>Remove a fraction based on digestibility</summary>
			BasedOnDigestibility
		}

		// Resets the values of all outputs
		private void resetVariables()
		{
			DefoliatedWt = 0.0;
			DefoliatedN = 0.0;
			HarvestedWt = 0.0;
			HarvestedN = 0.0;
			RemovedWt = 0.0;
			RemovedN = 0.0;
			ReturnedWt = 0.0;
			ReturnedN = 0.0;
			NReturnedInDung = 0.0;
			NReturnedInUrine = 0.0;
		}

		// Description: Perform the basic calculations for defoliation
		public void Graze(double amountDM, string amountType, int duration)
		{
			// Get the existing plant amount
			PreHarvestDM = Pasture[0].StandingHerbageWt;  //+ Pasture[1].StandingHerbageWt
			
			// Check the amount to remove and print some info
			if ((amountType == "SetRemoveAmount") && (PreHarvestDM >= amountDM / duration))
			{
				summary.WriteMessage(this, "   Defoliating " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = amountDM / duration;
			}
			else if ((amountType == "SetResidueAmount") && (PreHarvestDM >= amountDM))
			{
				summary.WriteMessage(this, "   Defoliating down to approximately " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = (PreHarvestDM - amountDM) / duration;
			}
			else
			{
				summary.WriteMessage(this, "   Defoliation will not happend because there is not enough plant material");
				if (intervalType == "Fixed")
					DaysAfterCut = -duration;
				return;
			}

			cuttingDuration = duration;
			// Preform first defoliation
			removeDM(herbageToRemove);
			returnExcreta();
			daysCutting = 1;
			DaysAfterCut = 0;
			if (daysCutting == cuttingDuration)
				PostHarvestDM = Pasture[0].StandingHerbageWt;  //+ Pasture[1].StandingHerbageWt
		}

		// Do the DM removal
		private void removeDM(double removeAmount)
		{
			double existingWt = Pasture[0].HarvestableWt;  // + Pasture[1].HarvestableWt

			// Check whether we harvest anything
			if (existingWt >= removeAmount)
			{
				foreach (AgPasture.PastureSpecies species in Pasture)
				{
					double amountToRemove = removeAmount * species.HarvestableWt / existingWt;
					species.Graze(amount: amountToRemove, type: "SetRemoveAmount");
				}
				
				// get total harvested
				DefoliatedWt = Pasture[0].HarvestedWt;  // + Pasture[1].HarvestedWt
				DefoliatedN = Pasture[0].HarvestedN;  //+ Pasture[1].HarvestedN
				HarvestedWt = DefoliatedWt;
				HarvestedN = DefoliatedN;

				// get amounts actually removed from field and that to be returned (dung/urine)
				if (DMRemoveType == removeDMTypes.RemoveAll)
					fractionDM2Remove = 1.0;
				else if (DMRemoveType == removeDMTypes.RemoveNone)
					fractionDM2Remove = 0.0;
				else
				{
					fractionDM2Remove = Pasture[0].HarvestedDigestibility * Pasture[0].HarvestedWt;  //+ Pasture[1].HarvestedDigestibility * Pasture[1].HarvestedWt
					fractionDM2Remove /= removeAmount;
				}
				
				RemovedWt = HarvestedWt * fractionDM2Remove;
				RemovedN = HarvestedN * FractionN2Remove;
				ReturnedWt = HarvestedWt - RemovedWt;
				ReturnedN = HarvestedN - RemovedN;
				NReturnedInDung = ReturnedN * ProportionN2Dung;
				NReturnedInUrine = ReturnedN - NReturnedInDung;
			}
		}

		// Return dung and urine
		private void returnExcreta()
		{
			if ((ReturnedWt > 0.0) || (NReturnedInDung > 0.0))
			{
				PMF.BiomassRemovedType BiomassDung = new PMF.BiomassRemovedType();
				string[] type = new string[] { "RuminantDung_PastureFed" };
				float[] dltdm = new float[] { (Single)ReturnedWt };
				float[] dltn = new float[] { (Single)NReturnedInDung };
				float[] dltp = new float[] { 0 };
				float[] fraction = new float[] { 1 };     // fraction is always 1.0 here

				BiomassDung.crop_type = "RuminantDung_PastureFed";
				BiomassDung.dm_type = type;
				BiomassDung.dlt_crop_dm = dltdm;
				BiomassDung.dlt_dm_n = dltn;
				BiomassDung.dlt_dm_p = dltp;
				BiomassDung.fraction_to_residue = fraction;
				BiomassRemoved.Invoke(BiomassDung);
			}

			if (NReturnedInUrine > 0.0)
			{
				fertiliser.Apply(NReturnedInUrine * 10, Fertiliser.Types.UreaN, 1.0);
			}
		}
	}
}
]]></Code>
            </Manager>
            <Manager>
              <Name>AutomaticFertiliser</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <AllowFertiliser>no</AllowFertiliser>
                <Depth2SoilN>500</Depth2SoilN>
                <CriticalSoilN>50</CriticalSoilN>
                <FertNAmount>25</FertNAmount>
                <FertType>UreaN</FertType>
                <FertApplicationDepth>1</FertApplicationDepth>
                <FertMinimumDays>1</FertMinimumDays>
              </Script>
              <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using APSIM.Shared.Utilities;
using System.Xml.Serialization;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		[Link] Soil Soil;

		//User inputs from properties tab
		[Description("Turn ferliser applications on? ")]
		public yesnoType AllowFertiliser { get; set; }
		
		[Description("Depth to calculate available soil N (mm): ")]
		public double Depth2SoilN { get; set; }

		[Description("Minimum available N, triggers an application (kgN/ha): ")]
		public double CriticalSoilN { get; set; }

		[Description("Amount of N fertiliser for each application (kgN/ha): ")]
		public double FertNAmount { get; set; }

		[Description("Type of N fertiliser to apply: ")]
		public Fertiliser.Types FertType { get; set; }

		[Description("Depth at which to apply the fertiliser (mm): ")]
		public double FertApplicationDepth { get; set; }
	   
		[Description("Minimum period between applications (days): ")]
		public double FertMinimumDays { get; set; }
	   
		public enum yesnoType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		[XmlIgnore] public double TopMineralN { get; set; }
		
		private DateTime lastApplicationDate;
		private bool fertiliserIsAllowed;
		private int nLayers;

		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{
			fertiliserIsAllowed = (AllowFertiliser == yesnoType.yes);
			nLayers = Soil.SoilWater.Thickness.Length;
		}

		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			double daysSinceLastApplication = (Clock.Today - lastApplicationDate).TotalDays;
			
			// get the N stored in the soil
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopMineralN = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (Depth2SoilN - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopMineralN += (Soil.SoilNitrogen.NO3[layer]
				+ Soil.SoilNitrogen.NH4[layer]
				+ Soil.SoilNitrogen.urea[layer])
				* fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= Depth2SoilN)
					layer = nLayers;
			}

			if (fertiliserIsAllowed && (daysSinceLastApplication >= FertMinimumDays) && (TopMineralN <= CriticalSoilN))
			{
				fertiliser.Apply(FertNAmount, FertType, FertApplicationDepth);
				lastApplicationDate = Clock.Today;
			}
		}
	}
}
]]></Code>
            </Manager>
            <Manager>
              <Name>AutomaticIrrigation</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <allowIrrigation>yes</allowIrrigation>
                <allowIrrigationAll>yes</allowIrrigationAll>
                <seasonStart>15-Aug</seasonStart>
                <seasonEnd>30-May</seasonEnd>
                <seasonsAllocation>10000</seasonsAllocation>
                <triggerDeficit>99</triggerDeficit>
                <targetDeficit>100</targetDeficit>
                <returndays>1</returndays>
                <maximumAmount>5</maximumAmount>
                <depthPAWC>600</depthPAWC>
              </Script>
              <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using System.Xml.Serialization;
using Models.PMF;
using APSIM.Shared.Utilities;

        
namespace Models
{
	[Serializable] 
	[System.Xml.Serialization.XmlInclude(typeof(Model))]
	public class Script : Model
	{
		//Communication to other modules
		[Link] ISummary summary = null;
		[Link] Irrigation Irrigation;
		[Link] Clock Clock;
		[Link] Soil Soil;
		[Link(IsOptional = true)] ICrop existingCrop;
	   
		//User inputs from properties tab
		[Description("Turn irrigation on?")] public answerType allowIrrigation { get; set; }
		[Description("Irrigate regardless of crop state?")] public answerType allowIrrigationAll { get; set; }
		[Description("Start of irrigation season (dd-MMM)")]
		public string seasonStart { get; set; }
		[Description("End of irrigation season (dd-MMM)")]
		public string seasonEnd { get; set; }
		[Description("Season allocation (mm)")]
		public double seasonsAllocation { get; set; }
		[Description("Deficit to trigger irrigation (% PAWC)")]
		public double triggerDeficit { get; set; }
		[Description("Deficit to stop irrigaton (% PAWC)")]
		public double targetDeficit { get; set; }
		[Description("Minimum days for irrigation to return")]
		public double returndays { get; set; }
		[Description("Maximum irrigation application (mm/day)")]
		public double maximumAmount { get; set; }
		[Description("Depth to calculate PAWC (mm)")]
		public double depthPAWC { get; set; }
	   
		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		//Class members
		[XmlIgnore] public double TopSWdeficit { get; set; }
		[XmlIgnore] public double TopSWC { get; set; }
		[XmlIgnore] public double DaysSinceIrrigation { get; set; }
		[XmlIgnore] public double AmountToApply { get; set; }
		[XmlIgnore] public double SeasonAppliedAmount { get; set; }
		
		private bool IrrigationIsAllowed { get; set; }
		private bool IrrigationIsAlwaysAllowed { get; set; }
		
		private bool SeasonIsOpen { get; set; }
		private bool CropIsActive { get; set; }
		private bool IrrigatorIsAvailable { get; set; }
		private bool SoilIsDry { get; set; }

		private DateTime StartDate;
		private DateTime EndDate;
		private double TopDUL;
		private double TopLL;
		private int nLayers;
	
		//Calculate static soil variables
		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{   
			//Set the season dates
			StartDate = DateTime.Parse(seasonStart + "-" + Clock.Today.Year.ToString());
			EndDate = DateTime.Parse(seasonEnd + "-" + Clock.Today.Year.ToString());
			
			//Can we irrigate at all?
			IrrigationIsAllowed = false; 
			if (allowIrrigation == answerType.yes)
				IrrigationIsAllowed = true; 
			if (allowIrrigationAll == answerType.yes)
				IrrigationIsAlwaysAllowed = true; 





			//Calculate soil water variables
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			nLayers = Soil.SoilWater.Thickness.Length;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopLL += Soil.SoilWater.LL15mm[layer] * fracLayer;
				TopDUL += Soil.SoilWater.DULmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
		}
	   	  
		//Determine daily requirement for irrigation
		[EventSubscribe("StartOfDay")]
		private void OnStartOfDay(object sender, EventArgs e)
		{
			//Can we irrigate today?		  
			SeasonIsOpen = isBetween(Clock.Today, StartDate, EndDate);

			//Is there a crop in the ground that needs irrigation?
			CropIsActive = false;
			if (IrrigationIsAlwaysAllowed)
				CropIsActive = true;  // might not be but we don't care
			else if ((existingCrop != null) && (existingCrop.IsAlive))
				CropIsActive = true;
			//if ((existingCrop.Phenology.Stage >= 3.0) && (existingCrop.Phenology.Stage < 6.0))
	      
			//Is the irrigator available?
			IrrigatorIsAvailable = false;
			DaysSinceIrrigation += 1;
			if (DaysSinceIrrigation >= returndays)
				IrrigatorIsAvailable = true;
	      
			//Is the soil dry enough to require irrigation?
			SoilIsDry = false;
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopSWC = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			//for (int layer = 0; depthFromSurface < depthPAWC + Soil.SoilWater.Thickness[layer]; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopSWC += Soil.SoilWater.SWmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
			
			TopSWdeficit = TopSWC - TopDUL;
			if (Math.Max(0.0, -TopSWdeficit) >= (TopDUL - TopLL) * (100 - triggerDeficit) / 100)
				SoilIsDry = true;
	            
			//Are all the conditions ratifying irrigation
			if (IrrigationIsAllowed && SeasonIsOpen && CropIsActive && IrrigatorIsAvailable && SoilIsDry)
			{
				//Lets bloody well irrigate then!!!!
				AmountToApply = TopDUL * targetDeficit / 100 - TopSWC;
				AmountToApply = Math.Max(0.0, Math.Min(AmountToApply, seasonsAllocation - SeasonAppliedAmount));
				Irrigation.Apply(AmountToApply);
				DaysSinceIrrigation = 0;
				SeasonAppliedAmount += AmountToApply;
			}
		}
		
		///Checks whether theDate is between iniDate and endDate (non-year specific)
		private bool isBetween(DateTime theDay, DateTime iniDate, DateTime endDate)
		{
			bool result = false;
			if (iniDate.DayOfYear < endDate.DayOfYear)
			{
				// period is within one year, ex: summer in the northern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) && (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			else
			{
				// period goes over the end of the year, ex: summer in the southern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) || (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			
			return result;
		}
	}
}
]]></Code>
            </Manager>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <ShowPageOfGraphs>true</ShowPageOfGraphs>
          </Folder>
          <MicroClimate>
            <Name>MicroClimate</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <a_interception>0</a_interception>
            <b_interception>1</b_interception>
            <c_interception>0</c_interception>
            <d_interception>0</d_interception>
            <soil_albedo>0.23</soil_albedo>
            <sun_angle>15</sun_angle>
            <soil_heat_flux_fraction>0.4</soil_heat_flux_fraction>
            <night_interception_fraction>0.5</night_interception_fraction>
            <refheight>2</refheight>
            <albedo>0.15</albedo>
            <emissivity>0.96</emissivity>
            <RadIntTotal>0</RadIntTotal>
          </MicroClimate>
          <Irrigation>
            <Name>Irrigation</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </Irrigation>
          <Fertiliser>
            <Name>Fertiliser</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </Fertiliser>
          <SurfaceOrganicMatter>
            <Name>SurfaceOrganicMatter</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <PondActive>no</PondActive>
            <ReportAdditions>no</ReportAdditions>
            <ReportRemovals>no</ReportRemovals>
            <ResidueTypes>
              <Name>ResidueTypes</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <LoadFromResource>ResidueTypes</LoadFromResource>
            </ResidueTypes>
            <TillageTypes>
              <Name>TillageTypesList</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <TillageType />
            </TillageTypes>
            <Pools>
              <Pool>
                <PoolName>Sward</PoolName>
                <ResidueType>grass</ResidueType>
                <Mass>0</Mass>
                <CNRatio>15</CNRatio>
                <CPRatio>NaN</CPRatio>
                <StandingFraction>0</StandingFraction>
              </Pool>
            </Pools>
            <PoolName>Sward</PoolName>
            <type>grass</type>
            <mass>0</mass>
            <standing_fraction>0</standing_fraction>
            <cpr />
            <cnr>15</cnr>
            <CriticalResidueWeight>2000</CriticalResidueWeight>
            <OptimumDecompTemp>20</OptimumDecompTemp>
            <MaxCumulativeEOS>20</MaxCumulativeEOS>
            <CNRatioDecompCoeff>0.277</CNRatioDecompCoeff>
            <CNRatioDecompThreshold>25</CNRatioDecompThreshold>
            <TotalLeachRain>25</TotalLeachRain>
            <MinRainToLeach>10</MinRainToLeach>
            <CriticalMinimumOrganicC>0.004</CriticalMinimumOrganicC>
            <DefaultCPRatio>0</DefaultCPRatio>
            <DefaultStandingFraction>0</DefaultStandingFraction>
            <StandingExtinctCoeff>0.5</StandingExtinctCoeff>
            <FractionFaecesAdded>0.5</FractionFaecesAdded>
          </SurfaceOrganicMatter>
          <Soil>
            <Name>Soil</Name>
            <Analysis>
              <Name>Analysis</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <Rocks>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </Rocks>
              <Texture />
              <MunsellColour />
              <PH>
                <double>6</double>
                <double>6</double>
                <double>6</double>
                <double>6</double>
              </PH>
              <CEC>
                <double>10</double>
                <double>10</double>
                <double>10</double>
                <double>10</double>
              </CEC>
              <ParticleSizeSand>
                <double>10</double>
                <double>10</double>
                <double>10</double>
                <double>10</double>
              </ParticleSizeSand>
              <ParticleSizeSilt>
                <double>30</double>
                <double>30</double>
                <double>30</double>
                <double>30</double>
              </ParticleSizeSilt>
              <ParticleSizeClay>
                <double>60</double>
                <double>60</double>
                <double>60</double>
                <double>60</double>
              </ParticleSizeClay>
              <PHUnits>Water</PHUnits>
              <BoronUnits>HotWater</BoronUnits>
            </Analysis>
            <Water>
              <Name>Water</Name>
              <SoilCrop>
                <Name>RyegrassSoil</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LL>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </LL>
                <KL>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                </KL>
                <XF>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                </XF>
              </SoilCrop>
              <SoilCrop>
                <Name>WhiteCloverSoil</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LL>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </LL>
                <KL>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                </KL>
                <XF>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                </XF>
              </SoilCrop>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <BD>
                <double>1.3</double>
                <double>1.3</double>
                <double>1.3</double>
                <double>1.3</double>
              </BD>
              <AirDry>
                <double>0.05</double>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </AirDry>
              <LL15>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </LL15>
              <DUL>
                <double>0.45</double>
                <double>0.45</double>
                <double>0.45</double>
                <double>0.45</double>
              </DUL>
              <SAT>
                <double>0.5</double>
                <double>0.5</double>
                <double>0.5</double>
                <double>0.5</double>
              </SAT>
              <KS>
                <double>500</double>
                <double>500</double>
                <double>500</double>
                <double>500</double>
              </KS>
            </Water>
            <SoilWater>
              <Name>SoilWater</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <SummerDate>1-Nov</SummerDate>
              <SummerU>6</SummerU>
              <SummerCona>3.5</SummerCona>
              <WinterDate>1-apr</WinterDate>
              <WinterU>6</WinterU>
              <WinterCona>3.5</WinterCona>
              <DiffusConst>88</DiffusConst>
              <DiffusSlope>35</DiffusSlope>
              <Salb>0.13</Salb>
              <CN2Bare>73</CN2Bare>
              <CNRed>20</CNRed>
              <CNCov>0.8</CNCov>
              <slope>0</slope>
              <discharge_width>0</discharge_width>
              <catchment_area>0</catchment_area>
              <max_pond>0</max_pond>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <SWCON>
                <double>0.3</double>
                <double>0.3</double>
                <double>0.3</double>
                <double>0.3</double>
              </SWCON>
              <KLAT>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </KLAT>
              <residueinterception>0</residueinterception>
            </SoilWater>
            <SoilNitrogen>
              <Name>SoilNitrogen</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <fom_type>
                <string>default</string>
                <string>manure</string>
                <string>mucuna</string>
                <string>lablab</string>
                <string>shemp</string>
                <string>stable</string>
              </fom_type>
              <fract_carb>
                <double>0.2</double>
                <double>0.3</double>
                <double>0.54</double>
                <double>0.57</double>
                <double>0.45</double>
                <double>0</double>
              </fract_carb>
              <fract_cell>
                <double>0.7</double>
                <double>0.3</double>
                <double>0.37</double>
                <double>0.37</double>
                <double>0.47</double>
                <double>0.1</double>
              </fract_cell>
              <fract_lign>
                <double>0.1</double>
                <double>0.4</double>
                <double>0.09</double>
                <double>0.06</double>
                <double>0.08</double>
                <double>0.9</double>
              </fract_lign>
              <wfpsN2N2O_x>
                <double>22</double>
                <double>88</double>
              </wfpsN2N2O_x>
              <wfpsN2N2O_y>
                <double>0.1</double>
                <double>1</double>
              </wfpsN2N2O_y>
              <oc>
                <double>3.7136764881329496</double>
                <double>2.4698281813043792</double>
                <double>1.2383961716086014</double>
                <double>0.49836009167083023</double>
              </oc>
            </SoilNitrogen>
            <SoilOrganicMatter>
              <Name>SoilOrganicMatter</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <RootCN>40</RootCN>
              <RootWt>0</RootWt>
              <SoilCN>12</SoilCN>
              <EnrACoeff>7.4</EnrACoeff>
              <EnrBCoeff>0.2</EnrBCoeff>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <Depth>
                <string>0-15</string>
                <string>15-30</string>
                <string>30-45</string>
                <string>45-60</string>
              </Depth>
              <OC>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </OC>
              <FBiom>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </FBiom>
              <FInert>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </FInert>
              <OCUnits>Total</OCUnits>
            </SoilOrganicMatter>
            <InitialWater>
              <Name>Initial water</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <PercentMethod>EvenlyDistributed</PercentMethod>
              <FractionFull>0.95</FractionFull>
              <DepthWetSoil>NaN</DepthWetSoil>
            </InitialWater>
            <Sample>
              <Name>Initial nitrogen</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <NO3>
                <double>5</double>
                <double>5</double>
                <double>5</double>
                <double>5</double>
              </NO3>
              <NH4>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </NH4>
              <NO3Units>ppm</NO3Units>
              <NH4Units>ppm</NH4Units>
              <SWUnits>Volumetric</SWUnits>
              <OCUnits>Total</OCUnits>
              <PHUnits>Water</PHUnits>
            </Sample>
            <CERESSoilTemperature>
              <Name>CERESSoilTemperature</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </CERESSoilTemperature>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <RecordNumber>0</RecordNumber>
            <SoilType />
            <LocalName>Stores lots of water</LocalName>
            <Site>Made up</Site>
            <NearestTown />
            <Region />
            <Country />
            <NaturalVegetation />
            <Latitude>0</Latitude>
            <Longitude>0</Longitude>
          </Soil>
          <SoluteManager>
            <Name>SoluteManager</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </SoluteManager>
          <PastureSpecies>
            <Name>Ryegrass</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <MaximumNUptake>10</MaximumNUptake>
            <Albedo>0.26</Albedo>
            <Gsmax>0.011</Gsmax>
            <R50>200</R50>
            <SpeciesFamily>Grass</SpeciesFamily>
            <PhotosyntheticPathway>C3</PhotosyntheticPathway>
            <InitialShootDM>2500</InitialShootDM>
            <InitialRootDM>500</InitialRootDM>
            <InitialRootDepth>600</InitialRootDepth>
            <ReferencePhotosyntheticRate>1</ReferencePhotosyntheticRate>
            <LightExtinctionCoefficient>0.5</LightExtinctionCoefficient>
            <GrowthTminimum>1</GrowthTminimum>
            <GrowthToptimum>20</GrowthToptimum>
            <GrowthTEffectExponent>1.7</GrowthTEffectExponent>
            <UseHeatStressFactor>yes</UseHeatStressFactor>
            <HeatOnsetTemperature>28</HeatOnsetTemperature>
            <HeatFullTemperature>35</HeatFullTemperature>
            <HeatRecoverySumDD>30</HeatRecoverySumDD>
            <HeatRecoveryTReference>25</HeatRecoveryTReference>
            <UseColdStressFactor>yes</UseColdStressFactor>
            <ColdOnsetTemperature>1</ColdOnsetTemperature>
            <ColdFullTemperature>-5</ColdFullTemperature>
            <ColdRecoverySumDD>25</ColdRecoverySumDD>
            <ColdRecoveryTReference>0</ColdRecoveryTReference>
            <MaintenanceRespirationCoefficient>0.03</MaintenanceRespirationCoefficient>
            <GrowthRespirationCoefficient>0.25</GrowthRespirationCoefficient>
            <RespirationTReference>20</RespirationTReference>
            <RespirationExponent>1.5</RespirationExponent>
            <NThresholdsForLeaves>
              <double>0.04</double>
              <double>0.012</double>
              <double>0.05</double>
            </NThresholdsForLeaves>
            <NThresholdsForStems>
              <double>0.02</double>
              <double>0.006</double>
              <double>0.025</double>
            </NThresholdsForStems>
            <NThresholdsForStolons>
              <double>0</double>
              <double>0</double>
              <double>0</double>
            </NThresholdsForStolons>
            <NThresholdsForRoots>
              <double>0.02</double>
              <double>0.006</double>
              <double>0.025</double>
            </NThresholdsForRoots>
            <DegreesDayForGermination>125</DegreesDayForGermination>
            <TargetShootRootRatio>4</TargetShootRootRatio>
            <MaxRootAllocation>0.25</MaxRootAllocation>
            <ShootRootGlfFactor>0.5</ShootRootGlfFactor>
            <UseReproSeasonFactor>yes</UseReproSeasonFactor>
            <ReproSeasonReferenceLatitude>41</ReproSeasonReferenceLatitude>
            <ReproSeasonTimingCoeff>0.14</ReproSeasonTimingCoeff>
            <ReproSeasonMaxAllocationIncrease>0.5</ReproSeasonMaxAllocationIncrease>
            <ReproSeasonAllocationCoeff>0.1</ReproSeasonAllocationCoeff>
            <FractionLeafMaximum>0.7</FractionLeafMaximum>
            <FractionLeafMinimum>0.7</FractionLeafMinimum>
            <FractionLeafDMThreshold>500</FractionLeafDMThreshold>
            <FractionLeafDMFactor>2000</FractionLeafDMFactor>
            <FractionLeafExponent>3</FractionLeafExponent>
            <FractionToStolon>0</FractionToStolon>
            <SpecificLeafArea>25</SpecificLeafArea>
            <SpecificRootLength>100</SpecificRootLength>
            <StolonEffectOnLAI>0</StolonEffectOnLAI>
            <ShootMaxEffectOnLAI>1000</ShootMaxEffectOnLAI>
            <MaxStemEffectOnLAI>1</MaxStemEffectOnLAI>
            <LiveLeavesPerTiller>3</LiveLeavesPerTiller>
            <TissueTurnoverRateShoot>0.05</TissueTurnoverRateShoot>
            <TissueTurnoverRateRoot>0.02</TissueTurnoverRateRoot>
            <DetachmentRateShoot>0.08</DetachmentRateShoot>
            <TurnoverTemperatureMin>2</TurnoverTemperatureMin>
            <TurnoverTemperatureRef>20</TurnoverTemperatureRef>
            <TurnoverTemperatureExponent>1</TurnoverTemperatureExponent>
            <TurnoverDroughtEffectMax>1</TurnoverDroughtEffectMax>
            <TurnoverDroughtThreshold>0.5</TurnoverDroughtThreshold>
            <TurnoverDefoliationCoefficient>0.5</TurnoverDefoliationCoefficient>
            <TurnoverDefoliationRootEffect>0.1</TurnoverDefoliationRootEffect>
            <FractionNLuxuryRemobilisable>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.1</double>
            </FractionNLuxuryRemobilisable>
            <MinimumNFixation>0</MinimumNFixation>
            <MaximumNFixation>0</MaximumNFixation>
            <SoilSaturationEffectMax>0.1</SoilSaturationEffectMax>
            <MinimumWaterFreePorosity>-1</MinimumWaterFreePorosity>
            <SoilSaturationRecoveryFactor>0.25</SoilSaturationRecoveryFactor>
            <NDillutionCoefficient>0.25</NDillutionCoefficient>
            <GlfGeneric>1</GlfGeneric>
            <GlfSoilFertility>1</GlfSoilFertility>
            <PlantHeightMinimum>25</PlantHeightMinimum>
            <PlantHeightMaximum>600</PlantHeightMaximum>
            <PlantHeightMassForMax>10000</PlantHeightMassForMax>
            <PlantHeightExponent>2.8</PlantHeightExponent>
            <RootDepthMinimum>50</RootDepthMinimum>
            <RootDepthMaximum>750</RootDepthMaximum>
            <RootElongationRate>25</RootElongationRate>
            <RootDistributionDepthParam>90</RootDistributionDepthParam>
            <RootDistributionExponent>3.2</RootDistributionExponent>
            <DigestibilitiesCellWall>
              <double>0.6</double>
              <double>0.6</double>
              <double>0.6</double>
              <double>0.2</double>
            </DigestibilitiesCellWall>
            <MinimumGreenWt>100</MinimumGreenWt>
            <FractionStolonStanding>0</FractionStolonStanding>
            <PreferenceForGreenOverDead>1</PreferenceForGreenOverDead>
            <PreferenceForLeafOverStems>1</PreferenceForLeafOverStems>
            <WaterAvailableMethod>DefaultAPSIM</WaterAvailableMethod>
            <NitrogenAvailableMethod>BasicAgPasture</NitrogenAvailableMethod>
          </PastureSpecies>
          <Report>
            <Name>ThreeZoneSimulationInitialUniformSoilN</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <ExperimentFactorNames />
            <ExperimentFactorValues />
            <VariableNames>
              <string>[Clock].Today as Date</string>
              <string>[Ryegrass].AboveGroundWt as PlantMass</string>
              <string>[Ryegrass].HarvestedWt as Harvested</string>
              <string>[Ryegrass].WaterDemand as SW_Demand</string>
              <string>sum([Ryegrass].WaterUptake) as SW_Uptake</string>
              <string>[Ryegrass].GlfWaterSupply as glfWater</string>
              <string>[Ryegrass].GlfNSupply as glfNitrogen</string>
              <string>sum([Soil].SoilWater.SWmm) as SoilWater</string>
              <string>sum([Soil].SoilNitrogen.NH4)+sum([Soil].SoilNitrogen.NO3) as SoilNitrogen</string>
              <string>[Irrigation].IrrigationApplied as Irrigation</string>
              <string>[Fertiliser].NitrogenApplied as Fertiliser</string>
            </VariableNames>
            <EventNames>
              <string>[Clock].EndOfDay</string>
            </EventNames>
          </Report>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Area>1</Area>
          <Slope>0</Slope>
        </Zone>
        <Zone>
          <Name>Zone1</Name>
          <Folder>
            <Name>Managers</Name>
            <Manager>
              <Name>DoRootsThreeZone</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <RootDepth>600</RootDepth>
                <RootMass>500</RootMass>
                <Zone0Name>Zone0</Zone0Name>
                <Zone0Prop>0.3</Zone0Prop>
                <Zone2Name>Zone2</Zone2Name>
                <Zone2Prop>0.3</Zone2Prop>
              </Script>
              <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Root depth in the plant's zone (mm): ")]  public double RootDepth { get; set; }
		[Description("Root mass  in the plant's zone (mm): ")]  public double RootMass { get; set; }

		[Description("Name of zone ot the left: ")] public string Zone0Name { get; set; }
		[Description("Proportionate depth and mass in zone to the left (-): ")]  public double Zone0Prop { get; set; }

		[Description("Name of zone ot the right: ")] public string Zone2Name { get; set; }
		[Description("Proportionate depth and mass in zone to the right (-): ")]  public double Zone2Prop { get; set; }

		// - Outputs from this manager

		// - Internal variables

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			int SpeciesNum = 0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				SpeciesNum += 1;
				if (SpeciesNum == 1)
				{
					if (Zone0Prop > 0)
						species.AddZone(zoneName: Zone0Name, rootDepth: Zone0Prop * RootDepth, rootDM: Zone0Prop * RootMass, specificRootLength: 100);
					if (Zone2Prop > 0)
						species.AddZone(zoneName: Zone2Name, rootDepth: Zone2Prop * RootDepth, rootDM: Zone2Prop * RootMass, specificRootLength: 100);
				}
			}

			//Pasture[1].AddZone(zoneName: "Zone1", rootDepth: 100, rootDM: 1000, specificRootLength: 100);
			//Pasture[1].AddZone(zoneName: "Zone2", rootDepth: 50, rootDM: 500, specificRootLength: 100);
		}
	}
}]]></Code>
            </Manager>
            <Manager>
              <Name>CutRotationSingle</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <CutRotationStartDate>1900-07-01</CutRotationStartDate>
                <CutRotationEndDate>2100-12-31</CutRotationEndDate>
                <CutInterval>1</CutInterval>
                <IntervalType>FixedInterval</IntervalType>
                <DurationOfCut>1</DurationOfCut>
                <RemoveAmountType>ResidualDM</RemoveAmountType>
                <AmountGiven>2250</AmountGiven>
                <DMRemoveType>RemoveAll</DMRemoveType>
                <FractionN2Remove>1</FractionN2Remove>
                <ProportionN2Dung>0</ProportionN2Dung>
              </Script>
              <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Date to begin the rotation: ")]
		public DateTime CutRotationStartDate { get; set; }

		[Description("Date to finish the rotation: ")]
		public DateTime CutRotationEndDate { get; set; }

		[Description("Rotation interval (days): ")]
		public int CutInterval { get; set; }

		[Description("How the interval is defined: ")]
		public rotationIntervalTypes IntervalType { get; set; }

		[Description("Duration of each event (days): ")]
		public int DurationOfCut { get; set; }

		[Description("What amount is being defined: ")]
		public removeAmountTypes RemoveAmountType { get; set; }

		[Description("Amount to use (kg/ha): ")]
		public double AmountGiven { get; set; }

		[Description("Fraction of DM that is removed from the field:")]
		public removeDMTypes DMRemoveType { get; set; }

		[Description("Fraction of N that is removed from the field (0-1):")]
		public double FractionN2Remove { get; set; }

		[Description("Proportion of N returned in dung (0-1):")]
		public double ProportionN2Dung { get; set; }

		// - Outputs from this manager
		[XmlIgnore][Units("g/m2")]// Description: Pasture DM defoliated today
		public double DefoliatedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture N defoliate today
		public double DefoliatedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture DM harvested today
		public double HarvestedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture N harvested today
		public double HarvestedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture DM removed from the field
		public double RemovedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture N removed from the field
		public double RemovedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Residue DM returned to the field
		public double ReturnedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Residue N returned to the field
		public double ReturnedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Harvested N returned as dung (SurfaceOM)
		public double NReturnedInDung { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Harvested N returned as urine (urea)
		public double NReturnedInUrine { get; set; }
		[XmlIgnore][Units("day")]// Description: Number of days after last defoliation
		public int DaysAfterCut { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Total standing DM (Leaf + Stem/Sheath) before cut
		public double PreHarvestDM { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Total standing DM (Leaf + Stem/Sheath) after cut
		public double PostHarvestDM { get; set; }
		
		// - Internal variables
		// fraction of harvested Dm to actually remove from field
		private double fractionDM2Remove = 1.0;
		// flag whether defoliation is allowed
		private bool rotationAllowed = true;
		// number of days for each defoliation event
		private int cuttingDuration = 0;
		// counter for day within each defoliation
		private int daysCutting = 0;
		// type of interval (Fixed or target)
		private string intervalType;
		// total herbage to remove in g/m2 per day
		private double herbageToRemove;
		// type of DM amount (ResidualDM or DMToRemove)
		private string amountType;
		// auxiliary flag for defoliation
		private bool aCutHasHappened = false;

		// - Event to add residue or dung to surface OM
		public event BiomassRemovedDelegate BiomassRemoved;

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				Pasture.Add(species);
			}

			// reset variables
			DaysAfterCut = 0;
			resetVariables();
			cuttingDuration = DurationOfCut;
			
			// get the type of amount given
			if (RemoveAmountType == removeAmountTypes.ResidualDM)
				amountType = "SetResidueAmount";
			else
				amountType = "SetRemoveAmount";

			// get the type of amount given
			if (IntervalType == rotationIntervalTypes.FixedInterval)
				intervalType = "Fixed";
			else
				intervalType = "Target";

			// make sure that rotation start when startDate < simulationStartDay
			if ((Clock.Today > CutRotationStartDate) && (Clock.Today < CutRotationEndDate))
				CutRotationStartDate = Clock.Today;
		}
		
		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			if (rotationAllowed)
			{
				if (Clock.Today == CutRotationStartDate)
					DaysAfterCut = CutInterval;

				// Check whether we can defoliate
				if ((Clock.Today >= CutRotationStartDate) && (Clock.Today <= CutRotationEndDate) && (Pasture[0].IsAlive))
				{
					// Check whether we should start a defoliation
					if (DaysAfterCut >= (CutInterval - 1))
					{
						Graze(AmountGiven, amountType, DurationOfCut);
					}
				}
			}

			// Check whether we need to continue cutting
			if ((daysCutting > 0) && (daysCutting < cuttingDuration))
			{
				// reset outputs
				resetVariables();

				removeDM(herbageToRemove);
				returnExcreta();
				daysCutting += 1;
				if (daysCutting == cuttingDuration)
					PostHarvestDM = Pasture[0].StandingHerbageWt; //+ Pasture[1].StandingHerbageWt
			}

			// reset outputs
			if (daysCutting < 0)
			{
				resetVariables();
				daysCutting = 0;
			}
		}

		[EventSubscribe("DoManagementCalculations")]
		private void OnDoManagementCalculations(object sender, EventArgs e)
		{
			// Check whether a cutting has finished
			if (daysCutting == cuttingDuration)
			{
				aCutHasHappened = true;
				daysCutting = -1;
			}

			// Increase the counter for days after cutting
			if (aCutHasHappened && (daysCutting == 0))
				DaysAfterCut += 1;
		}

		public enum removeAmountTypes
		{
			/// <summary>Setting DM amount to remove</summary>
			DMToRemove,
			/// <summary>Setting residual DM amount</summary>
			ResidualDM
		}

		public enum rotationIntervalTypes
		{
			/// <summary>Setting a fixed interval</summary>
			FixedInterval,
			/// <summary>Setting a target (minimum) inteval</summary>
			TargetInterval
		}

		public enum removeDMTypes
		{
			/// <summary>Remove all DM</summary>
			RemoveAll,
			/// <summary>Remove no DM</summary>
			RemoveNone,
			/// <summary>Remove a fraction based on digestibility</summary>
			BasedOnDigestibility
		}

		// Resets the values of all outputs
		private void resetVariables()
		{
			DefoliatedWt = 0.0;
			DefoliatedN = 0.0;
			HarvestedWt = 0.0;
			HarvestedN = 0.0;
			RemovedWt = 0.0;
			RemovedN = 0.0;
			ReturnedWt = 0.0;
			ReturnedN = 0.0;
			NReturnedInDung = 0.0;
			NReturnedInUrine = 0.0;
		}

		// Description: Perform the basic calculations for defoliation
		public void Graze(double amountDM, string amountType, int duration)
		{
			// Get the existing plant amount
			PreHarvestDM = Pasture[0].StandingHerbageWt;  //+ Pasture[1].StandingHerbageWt
			
			// Check the amount to remove and print some info
			if ((amountType == "SetRemoveAmount") && (PreHarvestDM >= amountDM / duration))
			{
				summary.WriteMessage(this, "   Defoliating " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = amountDM / duration;
			}
			else if ((amountType == "SetResidueAmount") && (PreHarvestDM >= amountDM))
			{
				summary.WriteMessage(this, "   Defoliating down to approximately " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = (PreHarvestDM - amountDM) / duration;
			}
			else
			{
				summary.WriteMessage(this, "   Defoliation will not happend because there is not enough plant material");
				if (intervalType == "Fixed")
					DaysAfterCut = -duration;
				return;
			}

			cuttingDuration = duration;
			// Preform first defoliation
			removeDM(herbageToRemove);
			returnExcreta();
			daysCutting = 1;
			DaysAfterCut = 0;
			if (daysCutting == cuttingDuration)
				PostHarvestDM = Pasture[0].StandingHerbageWt;  //+ Pasture[1].StandingHerbageWt
		}

		// Do the DM removal
		private void removeDM(double removeAmount)
		{
			double existingWt = Pasture[0].HarvestableWt;  // + Pasture[1].HarvestableWt

			// Check whether we harvest anything
			if (existingWt >= removeAmount)
			{
				foreach (AgPasture.PastureSpecies species in Pasture)
				{
					double amountToRemove = removeAmount * species.HarvestableWt / existingWt;
					species.Graze(amount: amountToRemove, type: "SetRemoveAmount");
				}
				
				// get total harvested
				DefoliatedWt = Pasture[0].HarvestedWt;  // + Pasture[1].HarvestedWt
				DefoliatedN = Pasture[0].HarvestedN;  //+ Pasture[1].HarvestedN
				HarvestedWt = DefoliatedWt;
				HarvestedN = DefoliatedN;

				// get amounts actually removed from field and that to be returned (dung/urine)
				if (DMRemoveType == removeDMTypes.RemoveAll)
					fractionDM2Remove = 1.0;
				else if (DMRemoveType == removeDMTypes.RemoveNone)
					fractionDM2Remove = 0.0;
				else
				{
					fractionDM2Remove = Pasture[0].HarvestedDigestibility * Pasture[0].HarvestedWt;  //+ Pasture[1].HarvestedDigestibility * Pasture[1].HarvestedWt
					fractionDM2Remove /= removeAmount;
				}
				
				RemovedWt = HarvestedWt * fractionDM2Remove;
				RemovedN = HarvestedN * FractionN2Remove;
				ReturnedWt = HarvestedWt - RemovedWt;
				ReturnedN = HarvestedN - RemovedN;
				NReturnedInDung = ReturnedN * ProportionN2Dung;
				NReturnedInUrine = ReturnedN - NReturnedInDung;
			}
		}

		// Return dung and urine
		private void returnExcreta()
		{
			if ((ReturnedWt > 0.0) || (NReturnedInDung > 0.0))
			{
				PMF.BiomassRemovedType BiomassDung = new PMF.BiomassRemovedType();
				string[] type = new string[] { "RuminantDung_PastureFed" };
				float[] dltdm = new float[] { (Single)ReturnedWt };
				float[] dltn = new float[] { (Single)NReturnedInDung };
				float[] dltp = new float[] { 0 };
				float[] fraction = new float[] { 1 };     // fraction is always 1.0 here

				BiomassDung.crop_type = "RuminantDung_PastureFed";
				BiomassDung.dm_type = type;
				BiomassDung.dlt_crop_dm = dltdm;
				BiomassDung.dlt_dm_n = dltn;
				BiomassDung.dlt_dm_p = dltp;
				BiomassDung.fraction_to_residue = fraction;
				BiomassRemoved.Invoke(BiomassDung);
			}

			if (NReturnedInUrine > 0.0)
			{
				fertiliser.Apply(NReturnedInUrine * 10, Fertiliser.Types.UreaN, 1.0);
			}
		}
	}
}
]]></Code>
            </Manager>
            <Manager>
              <Name>AutomaticFertiliser</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <AllowFertiliser>no</AllowFertiliser>
                <Depth2SoilN>500</Depth2SoilN>
                <CriticalSoilN>50</CriticalSoilN>
                <FertNAmount>25</FertNAmount>
                <FertType>UreaN</FertType>
                <FertApplicationDepth>1</FertApplicationDepth>
                <FertMinimumDays>1</FertMinimumDays>
              </Script>
              <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using APSIM.Shared.Utilities;
using System.Xml.Serialization;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		[Link] Soil Soil;

		//User inputs from properties tab
		[Description("Turn ferliser applications on? ")]
		public yesnoType AllowFertiliser { get; set; }
		
		[Description("Depth to calculate available soil N (mm): ")]
		public double Depth2SoilN { get; set; }

		[Description("Minimum available N, triggers an application (kgN/ha): ")]
		public double CriticalSoilN { get; set; }

		[Description("Amount of N fertiliser for each application (kgN/ha): ")]
		public double FertNAmount { get; set; }

		[Description("Type of N fertiliser to apply: ")]
		public Fertiliser.Types FertType { get; set; }

		[Description("Depth at which to apply the fertiliser (mm): ")]
		public double FertApplicationDepth { get; set; }
	   
		[Description("Minimum period between applications (days): ")]
		public double FertMinimumDays { get; set; }
	   
		public enum yesnoType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		[XmlIgnore] public double TopMineralN { get; set; }
		
		private DateTime lastApplicationDate;
		private bool fertiliserIsAllowed;
		private int nLayers;

		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{
			fertiliserIsAllowed = (AllowFertiliser == yesnoType.yes);
			nLayers = Soil.SoilWater.Thickness.Length;
		}

		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			double daysSinceLastApplication = (Clock.Today - lastApplicationDate).TotalDays;
			
			// get the N stored in the soil
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopMineralN = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (Depth2SoilN - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopMineralN += (Soil.SoilNitrogen.NO3[layer]
				+ Soil.SoilNitrogen.NH4[layer]
				+ Soil.SoilNitrogen.urea[layer])
				* fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= Depth2SoilN)
					layer = nLayers;
			}

			if (fertiliserIsAllowed && (daysSinceLastApplication >= FertMinimumDays) && (TopMineralN <= CriticalSoilN))
			{
				fertiliser.Apply(FertNAmount, FertType, FertApplicationDepth);
				lastApplicationDate = Clock.Today;
			}
		}
	}
}
]]></Code>
            </Manager>
            <Manager>
              <Name>AutomaticIrrigation</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <allowIrrigation>yes</allowIrrigation>
                <allowIrrigationAll>yes</allowIrrigationAll>
                <seasonStart>15-Aug</seasonStart>
                <seasonEnd>30-May</seasonEnd>
                <seasonsAllocation>10000</seasonsAllocation>
                <triggerDeficit>99</triggerDeficit>
                <targetDeficit>100</targetDeficit>
                <returndays>1</returndays>
                <maximumAmount>5</maximumAmount>
                <depthPAWC>600</depthPAWC>
              </Script>
              <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using System.Xml.Serialization;
using Models.PMF;
using APSIM.Shared.Utilities;

        
namespace Models
{
	[Serializable] 
	[System.Xml.Serialization.XmlInclude(typeof(Model))]
	public class Script : Model
	{
		//Communication to other modules
		[Link] ISummary summary = null;
		[Link] Irrigation Irrigation;
		[Link] Clock Clock;
		[Link] Soil Soil;
		[Link(IsOptional = true)] ICrop existingCrop;
	   
		//User inputs from properties tab
		[Description("Turn irrigation on?")] public answerType allowIrrigation { get; set; }
		[Description("Irrigate regardless of crop state?")] public answerType allowIrrigationAll { get; set; }
		[Description("Start of irrigation season (dd-MMM)")]
		public string seasonStart { get; set; }
		[Description("End of irrigation season (dd-MMM)")]
		public string seasonEnd { get; set; }
		[Description("Season allocation (mm)")]
		public double seasonsAllocation { get; set; }
		[Description("Deficit to trigger irrigation (% PAWC)")]
		public double triggerDeficit { get; set; }
		[Description("Deficit to stop irrigaton (% PAWC)")]
		public double targetDeficit { get; set; }
		[Description("Minimum days for irrigation to return")]
		public double returndays { get; set; }
		[Description("Maximum irrigation application (mm/day)")]
		public double maximumAmount { get; set; }
		[Description("Depth to calculate PAWC (mm)")]
		public double depthPAWC { get; set; }
	   
		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		//Class members
		[XmlIgnore] public double TopSWdeficit { get; set; }
		[XmlIgnore] public double TopSWC { get; set; }
		[XmlIgnore] public double DaysSinceIrrigation { get; set; }
		[XmlIgnore] public double AmountToApply { get; set; }
		[XmlIgnore] public double SeasonAppliedAmount { get; set; }
		
		private bool IrrigationIsAllowed { get; set; }
		private bool IrrigationIsAlwaysAllowed { get; set; }
		
		private bool SeasonIsOpen { get; set; }
		private bool CropIsActive { get; set; }
		private bool IrrigatorIsAvailable { get; set; }
		private bool SoilIsDry { get; set; }

		private DateTime StartDate;
		private DateTime EndDate;
		private double TopDUL;
		private double TopLL;
		private int nLayers;
	
		//Calculate static soil variables
		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{   
			//Set the season dates
			StartDate = DateTime.Parse(seasonStart + "-" + Clock.Today.Year.ToString());
			EndDate = DateTime.Parse(seasonEnd + "-" + Clock.Today.Year.ToString());
			
			//Can we irrigate at all?
			IrrigationIsAllowed = false; 
			if (allowIrrigation == answerType.yes)
				IrrigationIsAllowed = true; 
			if (allowIrrigationAll == answerType.yes)
				IrrigationIsAlwaysAllowed = true; 





			//Calculate soil water variables
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			nLayers = Soil.SoilWater.Thickness.Length;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopLL += Soil.SoilWater.LL15mm[layer] * fracLayer;
				TopDUL += Soil.SoilWater.DULmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
		}
	   	  
		//Determine daily requirement for irrigation
		[EventSubscribe("StartOfDay")]
		private void OnStartOfDay(object sender, EventArgs e)
		{
			//Can we irrigate today?		  
			SeasonIsOpen = isBetween(Clock.Today, StartDate, EndDate);

			//Is there a crop in the ground that needs irrigation?
			CropIsActive = false;
			if (IrrigationIsAlwaysAllowed)
				CropIsActive = true;  // might not be but we don't care
			else if ((existingCrop != null) && (existingCrop.IsAlive))
				CropIsActive = true;
			//if ((existingCrop.Phenology.Stage >= 3.0) && (existingCrop.Phenology.Stage < 6.0))
	      
			//Is the irrigator available?
			IrrigatorIsAvailable = false;
			DaysSinceIrrigation += 1;
			if (DaysSinceIrrigation >= returndays)
				IrrigatorIsAvailable = true;
	      
			//Is the soil dry enough to require irrigation?
			SoilIsDry = false;
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopSWC = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			//for (int layer = 0; depthFromSurface < depthPAWC + Soil.SoilWater.Thickness[layer]; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopSWC += Soil.SoilWater.SWmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
			
			TopSWdeficit = TopSWC - TopDUL;
			if (Math.Max(0.0, -TopSWdeficit) >= (TopDUL - TopLL) * (100 - triggerDeficit) / 100)
				SoilIsDry = true;
	            
			//Are all the conditions ratifying irrigation
			if (IrrigationIsAllowed && SeasonIsOpen && CropIsActive && IrrigatorIsAvailable && SoilIsDry)
			{
				//Lets bloody well irrigate then!!!!
				AmountToApply = TopDUL * targetDeficit / 100 - TopSWC;
				AmountToApply = Math.Max(0.0, Math.Min(AmountToApply, seasonsAllocation - SeasonAppliedAmount));
				Irrigation.Apply(AmountToApply);
				DaysSinceIrrigation = 0;
				SeasonAppliedAmount += AmountToApply;
			}
		}
		
		///Checks whether theDate is between iniDate and endDate (non-year specific)
		private bool isBetween(DateTime theDay, DateTime iniDate, DateTime endDate)
		{
			bool result = false;
			if (iniDate.DayOfYear < endDate.DayOfYear)
			{
				// period is within one year, ex: summer in the northern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) && (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			else
			{
				// period goes over the end of the year, ex: summer in the southern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) || (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			
			return result;
		}
	}
}
]]></Code>
            </Manager>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <ShowPageOfGraphs>true</ShowPageOfGraphs>
          </Folder>
          <MicroClimate>
            <Name>MicroClimate</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <a_interception>0</a_interception>
            <b_interception>1</b_interception>
            <c_interception>0</c_interception>
            <d_interception>0</d_interception>
            <soil_albedo>0.23</soil_albedo>
            <sun_angle>15</sun_angle>
            <soil_heat_flux_fraction>0.4</soil_heat_flux_fraction>
            <night_interception_fraction>0.5</night_interception_fraction>
            <refheight>2</refheight>
            <albedo>0.15</albedo>
            <emissivity>0.96</emissivity>
            <RadIntTotal>0</RadIntTotal>
          </MicroClimate>
          <Irrigation>
            <Name>Irrigation</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </Irrigation>
          <Fertiliser>
            <Name>Fertiliser</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </Fertiliser>
          <SurfaceOrganicMatter>
            <Name>SurfaceOrganicMatter</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <PondActive>no</PondActive>
            <ReportAdditions>no</ReportAdditions>
            <ReportRemovals>no</ReportRemovals>
            <ResidueTypes>
              <Name>ResidueTypes</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <LoadFromResource>ResidueTypes</LoadFromResource>
            </ResidueTypes>
            <TillageTypes>
              <Name>TillageTypesList</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <TillageType />
            </TillageTypes>
            <Pools>
              <Pool>
                <PoolName>Sward</PoolName>
                <ResidueType>grass</ResidueType>
                <Mass>0</Mass>
                <CNRatio>15</CNRatio>
                <CPRatio>NaN</CPRatio>
                <StandingFraction>0</StandingFraction>
              </Pool>
            </Pools>
            <PoolName>Sward</PoolName>
            <type>grass</type>
            <mass>0</mass>
            <standing_fraction>0</standing_fraction>
            <cpr />
            <cnr>15</cnr>
            <CriticalResidueWeight>2000</CriticalResidueWeight>
            <OptimumDecompTemp>20</OptimumDecompTemp>
            <MaxCumulativeEOS>20</MaxCumulativeEOS>
            <CNRatioDecompCoeff>0.277</CNRatioDecompCoeff>
            <CNRatioDecompThreshold>25</CNRatioDecompThreshold>
            <TotalLeachRain>25</TotalLeachRain>
            <MinRainToLeach>10</MinRainToLeach>
            <CriticalMinimumOrganicC>0.004</CriticalMinimumOrganicC>
            <DefaultCPRatio>0</DefaultCPRatio>
            <DefaultStandingFraction>0</DefaultStandingFraction>
            <StandingExtinctCoeff>0.5</StandingExtinctCoeff>
            <FractionFaecesAdded>0.5</FractionFaecesAdded>
          </SurfaceOrganicMatter>
          <Soil>
            <Name>Soil</Name>
            <Analysis>
              <Name>Analysis</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <Rocks>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </Rocks>
              <Texture />
              <MunsellColour />
              <PH>
                <double>6</double>
                <double>6</double>
                <double>6</double>
                <double>6</double>
              </PH>
              <CEC>
                <double>10</double>
                <double>10</double>
                <double>10</double>
                <double>10</double>
              </CEC>
              <ParticleSizeSand>
                <double>10</double>
                <double>10</double>
                <double>10</double>
                <double>10</double>
              </ParticleSizeSand>
              <ParticleSizeSilt>
                <double>30</double>
                <double>30</double>
                <double>30</double>
                <double>30</double>
              </ParticleSizeSilt>
              <ParticleSizeClay>
                <double>60</double>
                <double>60</double>
                <double>60</double>
                <double>60</double>
              </ParticleSizeClay>
              <PHUnits>Water</PHUnits>
              <BoronUnits>HotWater</BoronUnits>
            </Analysis>
            <Water>
              <Name>Water</Name>
              <SoilCrop>
                <Name>RyegrassSoil</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LL>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </LL>
                <KL>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                </KL>
                <XF>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                </XF>
              </SoilCrop>
              <SoilCrop>
                <Name>WhiteCloverSoil</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LL>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </LL>
                <KL>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                </KL>
                <XF>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                </XF>
              </SoilCrop>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <BD>
                <double>1.3</double>
                <double>1.3</double>
                <double>1.3</double>
                <double>1.3</double>
              </BD>
              <AirDry>
                <double>0.05</double>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </AirDry>
              <LL15>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </LL15>
              <DUL>
                <double>0.45</double>
                <double>0.45</double>
                <double>0.45</double>
                <double>0.45</double>
              </DUL>
              <SAT>
                <double>0.5</double>
                <double>0.5</double>
                <double>0.5</double>
                <double>0.5</double>
              </SAT>
              <KS>
                <double>500</double>
                <double>500</double>
                <double>500</double>
                <double>500</double>
              </KS>
            </Water>
            <SoilWater>
              <Name>SoilWater</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <SummerDate>1-Nov</SummerDate>
              <SummerU>6</SummerU>
              <SummerCona>3.5</SummerCona>
              <WinterDate>1-apr</WinterDate>
              <WinterU>6</WinterU>
              <WinterCona>3.5</WinterCona>
              <DiffusConst>88</DiffusConst>
              <DiffusSlope>35</DiffusSlope>
              <Salb>0.13</Salb>
              <CN2Bare>73</CN2Bare>
              <CNRed>20</CNRed>
              <CNCov>0.8</CNCov>
              <slope>0</slope>
              <discharge_width>0</discharge_width>
              <catchment_area>0</catchment_area>
              <max_pond>0</max_pond>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <SWCON>
                <double>0.3</double>
                <double>0.3</double>
                <double>0.3</double>
                <double>0.3</double>
              </SWCON>
              <KLAT>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </KLAT>
              <residueinterception>0</residueinterception>
            </SoilWater>
            <SoilNitrogen>
              <Name>SoilNitrogen</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <fom_type>
                <string>default</string>
                <string>manure</string>
                <string>mucuna</string>
                <string>lablab</string>
                <string>shemp</string>
                <string>stable</string>
              </fom_type>
              <fract_carb>
                <double>0.2</double>
                <double>0.3</double>
                <double>0.54</double>
                <double>0.57</double>
                <double>0.45</double>
                <double>0</double>
              </fract_carb>
              <fract_cell>
                <double>0.7</double>
                <double>0.3</double>
                <double>0.37</double>
                <double>0.37</double>
                <double>0.47</double>
                <double>0.1</double>
              </fract_cell>
              <fract_lign>
                <double>0.1</double>
                <double>0.4</double>
                <double>0.09</double>
                <double>0.06</double>
                <double>0.08</double>
                <double>0.9</double>
              </fract_lign>
              <wfpsN2N2O_x>
                <double>22</double>
                <double>88</double>
              </wfpsN2N2O_x>
              <wfpsN2N2O_y>
                <double>0.1</double>
                <double>1</double>
              </wfpsN2N2O_y>
              <oc>
                <double>3.7136764881329496</double>
                <double>2.4698281813043792</double>
                <double>1.2383961716086014</double>
                <double>0.49836009167083023</double>
              </oc>
            </SoilNitrogen>
            <SoilOrganicMatter>
              <Name>SoilOrganicMatter</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <RootCN>40</RootCN>
              <RootWt>0</RootWt>
              <SoilCN>12</SoilCN>
              <EnrACoeff>7.4</EnrACoeff>
              <EnrBCoeff>0.2</EnrBCoeff>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <Depth>
                <string>0-15</string>
                <string>15-30</string>
                <string>30-45</string>
                <string>45-60</string>
              </Depth>
              <OC>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </OC>
              <FBiom>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </FBiom>
              <FInert>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </FInert>
              <OCUnits>Total</OCUnits>
            </SoilOrganicMatter>
            <InitialWater>
              <Name>Initial water</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <PercentMethod>EvenlyDistributed</PercentMethod>
              <FractionFull>0.95</FractionFull>
              <DepthWetSoil>NaN</DepthWetSoil>
            </InitialWater>
            <Sample>
              <Name>Initial nitrogen</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <NO3>
                <double>5</double>
                <double>5</double>
                <double>5</double>
                <double>5</double>
              </NO3>
              <NH4>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </NH4>
              <NO3Units>ppm</NO3Units>
              <NH4Units>ppm</NH4Units>
              <SWUnits>Volumetric</SWUnits>
              <OCUnits>Total</OCUnits>
              <PHUnits>Water</PHUnits>
            </Sample>
            <CERESSoilTemperature>
              <Name>CERESSoilTemperature</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </CERESSoilTemperature>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <RecordNumber>0</RecordNumber>
            <SoilType />
            <LocalName>Stores lots of water</LocalName>
            <Site>Made up</Site>
            <NearestTown />
            <Region />
            <Country />
            <NaturalVegetation />
            <Latitude>0</Latitude>
            <Longitude>0</Longitude>
          </Soil>
          <SoluteManager>
            <Name>SoluteManager</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </SoluteManager>
          <PastureSpecies>
            <Name>Ryegrass</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <MaximumNUptake>10</MaximumNUptake>
            <Albedo>0.26</Albedo>
            <Gsmax>0.011</Gsmax>
            <R50>200</R50>
            <SpeciesFamily>Grass</SpeciesFamily>
            <PhotosyntheticPathway>C3</PhotosyntheticPathway>
            <InitialShootDM>2500</InitialShootDM>
            <InitialRootDM>500</InitialRootDM>
            <InitialRootDepth>600</InitialRootDepth>
            <ReferencePhotosyntheticRate>1</ReferencePhotosyntheticRate>
            <LightExtinctionCoefficient>0.5</LightExtinctionCoefficient>
            <GrowthTminimum>1</GrowthTminimum>
            <GrowthToptimum>20</GrowthToptimum>
            <GrowthTEffectExponent>1.7</GrowthTEffectExponent>
            <UseHeatStressFactor>yes</UseHeatStressFactor>
            <HeatOnsetTemperature>28</HeatOnsetTemperature>
            <HeatFullTemperature>35</HeatFullTemperature>
            <HeatRecoverySumDD>30</HeatRecoverySumDD>
            <HeatRecoveryTReference>25</HeatRecoveryTReference>
            <UseColdStressFactor>yes</UseColdStressFactor>
            <ColdOnsetTemperature>1</ColdOnsetTemperature>
            <ColdFullTemperature>-5</ColdFullTemperature>
            <ColdRecoverySumDD>25</ColdRecoverySumDD>
            <ColdRecoveryTReference>0</ColdRecoveryTReference>
            <MaintenanceRespirationCoefficient>0.03</MaintenanceRespirationCoefficient>
            <GrowthRespirationCoefficient>0.25</GrowthRespirationCoefficient>
            <RespirationTReference>20</RespirationTReference>
            <RespirationExponent>1.5</RespirationExponent>
            <NThresholdsForLeaves>
              <double>0.04</double>
              <double>0.012</double>
              <double>0.05</double>
            </NThresholdsForLeaves>
            <NThresholdsForStems>
              <double>0.02</double>
              <double>0.006</double>
              <double>0.025</double>
            </NThresholdsForStems>
            <NThresholdsForStolons>
              <double>0</double>
              <double>0</double>
              <double>0</double>
            </NThresholdsForStolons>
            <NThresholdsForRoots>
              <double>0.02</double>
              <double>0.006</double>
              <double>0.025</double>
            </NThresholdsForRoots>
            <DegreesDayForGermination>125</DegreesDayForGermination>
            <TargetShootRootRatio>4</TargetShootRootRatio>
            <MaxRootAllocation>0.25</MaxRootAllocation>
            <ShootRootGlfFactor>0.5</ShootRootGlfFactor>
            <UseReproSeasonFactor>yes</UseReproSeasonFactor>
            <ReproSeasonReferenceLatitude>41</ReproSeasonReferenceLatitude>
            <ReproSeasonTimingCoeff>0.14</ReproSeasonTimingCoeff>
            <ReproSeasonMaxAllocationIncrease>0.5</ReproSeasonMaxAllocationIncrease>
            <ReproSeasonAllocationCoeff>0.1</ReproSeasonAllocationCoeff>
            <FractionLeafMaximum>0.7</FractionLeafMaximum>
            <FractionLeafMinimum>0.7</FractionLeafMinimum>
            <FractionLeafDMThreshold>500</FractionLeafDMThreshold>
            <FractionLeafDMFactor>2000</FractionLeafDMFactor>
            <FractionLeafExponent>3</FractionLeafExponent>
            <FractionToStolon>0</FractionToStolon>
            <SpecificLeafArea>25</SpecificLeafArea>
            <SpecificRootLength>100</SpecificRootLength>
            <StolonEffectOnLAI>0</StolonEffectOnLAI>
            <ShootMaxEffectOnLAI>1000</ShootMaxEffectOnLAI>
            <MaxStemEffectOnLAI>1</MaxStemEffectOnLAI>
            <LiveLeavesPerTiller>3</LiveLeavesPerTiller>
            <TissueTurnoverRateShoot>0.05</TissueTurnoverRateShoot>
            <TissueTurnoverRateRoot>0.02</TissueTurnoverRateRoot>
            <DetachmentRateShoot>0.08</DetachmentRateShoot>
            <TurnoverTemperatureMin>2</TurnoverTemperatureMin>
            <TurnoverTemperatureRef>20</TurnoverTemperatureRef>
            <TurnoverTemperatureExponent>1</TurnoverTemperatureExponent>
            <TurnoverDroughtEffectMax>1</TurnoverDroughtEffectMax>
            <TurnoverDroughtThreshold>0.5</TurnoverDroughtThreshold>
            <TurnoverDefoliationCoefficient>0.5</TurnoverDefoliationCoefficient>
            <TurnoverDefoliationRootEffect>0.1</TurnoverDefoliationRootEffect>
            <FractionNLuxuryRemobilisable>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.1</double>
            </FractionNLuxuryRemobilisable>
            <MinimumNFixation>0</MinimumNFixation>
            <MaximumNFixation>0</MaximumNFixation>
            <SoilSaturationEffectMax>0.1</SoilSaturationEffectMax>
            <MinimumWaterFreePorosity>-1</MinimumWaterFreePorosity>
            <SoilSaturationRecoveryFactor>0.25</SoilSaturationRecoveryFactor>
            <NDillutionCoefficient>0.25</NDillutionCoefficient>
            <GlfGeneric>1</GlfGeneric>
            <GlfSoilFertility>1</GlfSoilFertility>
            <PlantHeightMinimum>25</PlantHeightMinimum>
            <PlantHeightMaximum>600</PlantHeightMaximum>
            <PlantHeightMassForMax>10000</PlantHeightMassForMax>
            <PlantHeightExponent>2.8</PlantHeightExponent>
            <RootDepthMinimum>50</RootDepthMinimum>
            <RootDepthMaximum>750</RootDepthMaximum>
            <RootElongationRate>25</RootElongationRate>
            <RootDistributionDepthParam>90</RootDistributionDepthParam>
            <RootDistributionExponent>3.2</RootDistributionExponent>
            <DigestibilitiesCellWall>
              <double>0.6</double>
              <double>0.6</double>
              <double>0.6</double>
              <double>0.2</double>
            </DigestibilitiesCellWall>
            <MinimumGreenWt>100</MinimumGreenWt>
            <FractionStolonStanding>0</FractionStolonStanding>
            <PreferenceForGreenOverDead>1</PreferenceForGreenOverDead>
            <PreferenceForLeafOverStems>1</PreferenceForLeafOverStems>
            <WaterAvailableMethod>DefaultAPSIM</WaterAvailableMethod>
            <NitrogenAvailableMethod>BasicAgPasture</NitrogenAvailableMethod>
          </PastureSpecies>
          <Report>
            <Name>ThreeZoneSimulationInitialUniformSoilN</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <ExperimentFactorNames />
            <ExperimentFactorValues />
            <VariableNames>
              <string>[Clock].Today as Date</string>
              <string>[Ryegrass].AboveGroundWt as PlantMass</string>
              <string>[Ryegrass].HarvestedWt as Harvested</string>
              <string>[Ryegrass].WaterDemand as SW_Demand</string>
              <string>sum([Ryegrass].WaterUptake) as SW_Uptake</string>
              <string>[Ryegrass].GlfWaterSupply as glfWater</string>
              <string>[Ryegrass].GlfNSupply as glfNitrogen</string>
              <string>sum([Soil].SoilWater.SWmm) as SoilWater</string>
              <string>sum([Soil].SoilNitrogen.NH4)+sum([Soil].SoilNitrogen.NO3) as SoilNitrogen</string>
              <string>[Irrigation].IrrigationApplied as Irrigation</string>
              <string>[Fertiliser].NitrogenApplied as Fertiliser</string>
            </VariableNames>
            <EventNames>
              <string>[Clock].EndOfDay</string>
            </EventNames>
          </Report>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Area>1</Area>
          <Slope>0</Slope>
        </Zone>
        <Zone>
          <Name>Zone2</Name>
          <Folder>
            <Name>Managers</Name>
            <Manager>
              <Name>DoRootsThreeZone</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <RootDepth>600</RootDepth>
                <RootMass>500</RootMass>
                <Zone0Name>Zone1</Zone0Name>
                <Zone0Prop>0</Zone0Prop>
                <Zone2Name>Zone2</Zone2Name>
                <Zone2Prop>0</Zone2Prop>
              </Script>
              <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Root depth in the plant's zone (mm): ")]  public double RootDepth { get; set; }
		[Description("Root mass  in the plant's zone (mm): ")]  public double RootMass { get; set; }

		[Description("Name of zone ot the left: ")] public string Zone0Name { get; set; }
		[Description("Proportionate depth and mass in zone to the left (-): ")]  public double Zone0Prop { get; set; }

		[Description("Name of zone ot the right: ")] public string Zone2Name { get; set; }
		[Description("Proportionate depth and mass in zone to the right (-): ")]  public double Zone2Prop { get; set; }

		// - Outputs from this manager

		// - Internal variables

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			int SpeciesNum = 0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				SpeciesNum += 1;
				if (SpeciesNum == 1)
				{
					if (Zone0Prop > 0)
						species.AddZone(zoneName: Zone0Name, rootDepth: Zone0Prop * RootDepth, rootDM: Zone0Prop * RootMass, specificRootLength: 100);
					if (Zone2Prop > 0)
						species.AddZone(zoneName: Zone2Name, rootDepth: Zone2Prop * RootDepth, rootDM: Zone2Prop * RootMass, specificRootLength: 100);
				}
			}

			//Pasture[1].AddZone(zoneName: "Zone1", rootDepth: 100, rootDM: 1000, specificRootLength: 100);
			//Pasture[1].AddZone(zoneName: "Zone2", rootDepth: 50, rootDM: 500, specificRootLength: 100);
		}
	}
}]]></Code>
            </Manager>
            <Manager>
              <Name>CutRotationSingle</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <CutRotationStartDate>1900-07-01</CutRotationStartDate>
                <CutRotationEndDate>2100-12-31</CutRotationEndDate>
                <CutInterval>1</CutInterval>
                <IntervalType>FixedInterval</IntervalType>
                <DurationOfCut>1</DurationOfCut>
                <RemoveAmountType>ResidualDM</RemoveAmountType>
                <AmountGiven>2250</AmountGiven>
                <DMRemoveType>RemoveAll</DMRemoveType>
                <FractionN2Remove>1</FractionN2Remove>
                <ProportionN2Dung>0</ProportionN2Dung>
              </Script>
              <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Date to begin the rotation: ")]
		public DateTime CutRotationStartDate { get; set; }

		[Description("Date to finish the rotation: ")]
		public DateTime CutRotationEndDate { get; set; }

		[Description("Rotation interval (days): ")]
		public int CutInterval { get; set; }

		[Description("How the interval is defined: ")]
		public rotationIntervalTypes IntervalType { get; set; }

		[Description("Duration of each event (days): ")]
		public int DurationOfCut { get; set; }

		[Description("What amount is being defined: ")]
		public removeAmountTypes RemoveAmountType { get; set; }

		[Description("Amount to use (kg/ha): ")]
		public double AmountGiven { get; set; }

		[Description("Fraction of DM that is removed from the field:")]
		public removeDMTypes DMRemoveType { get; set; }

		[Description("Fraction of N that is removed from the field (0-1):")]
		public double FractionN2Remove { get; set; }

		[Description("Proportion of N returned in dung (0-1):")]
		public double ProportionN2Dung { get; set; }

		// - Outputs from this manager
		[XmlIgnore][Units("g/m2")]// Description: Pasture DM defoliated today
		public double DefoliatedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture N defoliate today
		public double DefoliatedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture DM harvested today
		public double HarvestedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture N harvested today
		public double HarvestedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture DM removed from the field
		public double RemovedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture N removed from the field
		public double RemovedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Residue DM returned to the field
		public double ReturnedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Residue N returned to the field
		public double ReturnedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Harvested N returned as dung (SurfaceOM)
		public double NReturnedInDung { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Harvested N returned as urine (urea)
		public double NReturnedInUrine { get; set; }
		[XmlIgnore][Units("day")]// Description: Number of days after last defoliation
		public int DaysAfterCut { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Total standing DM (Leaf + Stem/Sheath) before cut
		public double PreHarvestDM { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Total standing DM (Leaf + Stem/Sheath) after cut
		public double PostHarvestDM { get; set; }
		
		// - Internal variables
		// fraction of harvested Dm to actually remove from field
		private double fractionDM2Remove = 1.0;
		// flag whether defoliation is allowed
		private bool rotationAllowed = true;
		// number of days for each defoliation event
		private int cuttingDuration = 0;
		// counter for day within each defoliation
		private int daysCutting = 0;
		// type of interval (Fixed or target)
		private string intervalType;
		// total herbage to remove in g/m2 per day
		private double herbageToRemove;
		// type of DM amount (ResidualDM or DMToRemove)
		private string amountType;
		// auxiliary flag for defoliation
		private bool aCutHasHappened = false;

		// - Event to add residue or dung to surface OM
		public event BiomassRemovedDelegate BiomassRemoved;

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				Pasture.Add(species);
			}

			// reset variables
			DaysAfterCut = 0;
			resetVariables();
			cuttingDuration = DurationOfCut;
			
			// get the type of amount given
			if (RemoveAmountType == removeAmountTypes.ResidualDM)
				amountType = "SetResidueAmount";
			else
				amountType = "SetRemoveAmount";

			// get the type of amount given
			if (IntervalType == rotationIntervalTypes.FixedInterval)
				intervalType = "Fixed";
			else
				intervalType = "Target";

			// make sure that rotation start when startDate < simulationStartDay
			if ((Clock.Today > CutRotationStartDate) && (Clock.Today < CutRotationEndDate))
				CutRotationStartDate = Clock.Today;
		}
		
		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			if (rotationAllowed)
			{
				if (Clock.Today == CutRotationStartDate)
					DaysAfterCut = CutInterval;

				// Check whether we can defoliate
				if ((Clock.Today >= CutRotationStartDate) && (Clock.Today <= CutRotationEndDate) && (Pasture[0].IsAlive))
				{
					// Check whether we should start a defoliation
					if (DaysAfterCut >= (CutInterval - 1))
					{
						Graze(AmountGiven, amountType, DurationOfCut);
					}
				}
			}

			// Check whether we need to continue cutting
			if ((daysCutting > 0) && (daysCutting < cuttingDuration))
			{
				// reset outputs
				resetVariables();

				removeDM(herbageToRemove);
				returnExcreta();
				daysCutting += 1;
				if (daysCutting == cuttingDuration)
					PostHarvestDM = Pasture[0].StandingHerbageWt; //+ Pasture[1].StandingHerbageWt
			}

			// reset outputs
			if (daysCutting < 0)
			{
				resetVariables();
				daysCutting = 0;
			}
		}

		[EventSubscribe("DoManagementCalculations")]
		private void OnDoManagementCalculations(object sender, EventArgs e)
		{
			// Check whether a cutting has finished
			if (daysCutting == cuttingDuration)
			{
				aCutHasHappened = true;
				daysCutting = -1;
			}

			// Increase the counter for days after cutting
			if (aCutHasHappened && (daysCutting == 0))
				DaysAfterCut += 1;
		}

		public enum removeAmountTypes
		{
			/// <summary>Setting DM amount to remove</summary>
			DMToRemove,
			/// <summary>Setting residual DM amount</summary>
			ResidualDM
		}

		public enum rotationIntervalTypes
		{
			/// <summary>Setting a fixed interval</summary>
			FixedInterval,
			/// <summary>Setting a target (minimum) inteval</summary>
			TargetInterval
		}

		public enum removeDMTypes
		{
			/// <summary>Remove all DM</summary>
			RemoveAll,
			/// <summary>Remove no DM</summary>
			RemoveNone,
			/// <summary>Remove a fraction based on digestibility</summary>
			BasedOnDigestibility
		}

		// Resets the values of all outputs
		private void resetVariables()
		{
			DefoliatedWt = 0.0;
			DefoliatedN = 0.0;
			HarvestedWt = 0.0;
			HarvestedN = 0.0;
			RemovedWt = 0.0;
			RemovedN = 0.0;
			ReturnedWt = 0.0;
			ReturnedN = 0.0;
			NReturnedInDung = 0.0;
			NReturnedInUrine = 0.0;
		}

		// Description: Perform the basic calculations for defoliation
		public void Graze(double amountDM, string amountType, int duration)
		{
			// Get the existing plant amount
			PreHarvestDM = Pasture[0].StandingHerbageWt;  //+ Pasture[1].StandingHerbageWt
			
			// Check the amount to remove and print some info
			if ((amountType == "SetRemoveAmount") && (PreHarvestDM >= amountDM / duration))
			{
				summary.WriteMessage(this, "   Defoliating " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = amountDM / duration;
			}
			else if ((amountType == "SetResidueAmount") && (PreHarvestDM >= amountDM))
			{
				summary.WriteMessage(this, "   Defoliating down to approximately " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = (PreHarvestDM - amountDM) / duration;
			}
			else
			{
				summary.WriteMessage(this, "   Defoliation will not happend because there is not enough plant material");
				if (intervalType == "Fixed")
					DaysAfterCut = -duration;
				return;
			}

			cuttingDuration = duration;
			// Preform first defoliation
			removeDM(herbageToRemove);
			returnExcreta();
			daysCutting = 1;
			DaysAfterCut = 0;
			if (daysCutting == cuttingDuration)
				PostHarvestDM = Pasture[0].StandingHerbageWt;  //+ Pasture[1].StandingHerbageWt
		}

		// Do the DM removal
		private void removeDM(double removeAmount)
		{
			double existingWt = Pasture[0].HarvestableWt;  // + Pasture[1].HarvestableWt

			// Check whether we harvest anything
			if (existingWt >= removeAmount)
			{
				foreach (AgPasture.PastureSpecies species in Pasture)
				{
					double amountToRemove = removeAmount * species.HarvestableWt / existingWt;
					species.Graze(amount: amountToRemove, type: "SetRemoveAmount");
				}
				
				// get total harvested
				DefoliatedWt = Pasture[0].HarvestedWt;  // + Pasture[1].HarvestedWt
				DefoliatedN = Pasture[0].HarvestedN;  //+ Pasture[1].HarvestedN
				HarvestedWt = DefoliatedWt;
				HarvestedN = DefoliatedN;

				// get amounts actually removed from field and that to be returned (dung/urine)
				if (DMRemoveType == removeDMTypes.RemoveAll)
					fractionDM2Remove = 1.0;
				else if (DMRemoveType == removeDMTypes.RemoveNone)
					fractionDM2Remove = 0.0;
				else
				{
					fractionDM2Remove = Pasture[0].HarvestedDigestibility * Pasture[0].HarvestedWt;  //+ Pasture[1].HarvestedDigestibility * Pasture[1].HarvestedWt
					fractionDM2Remove /= removeAmount;
				}
				
				RemovedWt = HarvestedWt * fractionDM2Remove;
				RemovedN = HarvestedN * FractionN2Remove;
				ReturnedWt = HarvestedWt - RemovedWt;
				ReturnedN = HarvestedN - RemovedN;
				NReturnedInDung = ReturnedN * ProportionN2Dung;
				NReturnedInUrine = ReturnedN - NReturnedInDung;
			}
		}

		// Return dung and urine
		private void returnExcreta()
		{
			if ((ReturnedWt > 0.0) || (NReturnedInDung > 0.0))
			{
				PMF.BiomassRemovedType BiomassDung = new PMF.BiomassRemovedType();
				string[] type = new string[] { "RuminantDung_PastureFed" };
				float[] dltdm = new float[] { (Single)ReturnedWt };
				float[] dltn = new float[] { (Single)NReturnedInDung };
				float[] dltp = new float[] { 0 };
				float[] fraction = new float[] { 1 };     // fraction is always 1.0 here

				BiomassDung.crop_type = "RuminantDung_PastureFed";
				BiomassDung.dm_type = type;
				BiomassDung.dlt_crop_dm = dltdm;
				BiomassDung.dlt_dm_n = dltn;
				BiomassDung.dlt_dm_p = dltp;
				BiomassDung.fraction_to_residue = fraction;
				BiomassRemoved.Invoke(BiomassDung);
			}

			if (NReturnedInUrine > 0.0)
			{
				fertiliser.Apply(NReturnedInUrine * 10, Fertiliser.Types.UreaN, 1.0);
			}
		}
	}
}
]]></Code>
            </Manager>
            <Manager>
              <Name>AutomaticFertiliser</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <AllowFertiliser>no</AllowFertiliser>
                <Depth2SoilN>500</Depth2SoilN>
                <CriticalSoilN>50</CriticalSoilN>
                <FertNAmount>25</FertNAmount>
                <FertType>UreaN</FertType>
                <FertApplicationDepth>1</FertApplicationDepth>
                <FertMinimumDays>1</FertMinimumDays>
              </Script>
              <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using APSIM.Shared.Utilities;
using System.Xml.Serialization;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		[Link] Soil Soil;

		//User inputs from properties tab
		[Description("Turn ferliser applications on? ")]
		public yesnoType AllowFertiliser { get; set; }
		
		[Description("Depth to calculate available soil N (mm): ")]
		public double Depth2SoilN { get; set; }

		[Description("Minimum available N, triggers an application (kgN/ha): ")]
		public double CriticalSoilN { get; set; }

		[Description("Amount of N fertiliser for each application (kgN/ha): ")]
		public double FertNAmount { get; set; }

		[Description("Type of N fertiliser to apply: ")]
		public Fertiliser.Types FertType { get; set; }

		[Description("Depth at which to apply the fertiliser (mm): ")]
		public double FertApplicationDepth { get; set; }
	   
		[Description("Minimum period between applications (days): ")]
		public double FertMinimumDays { get; set; }
	   
		public enum yesnoType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		[XmlIgnore] public double TopMineralN { get; set; }
		
		private DateTime lastApplicationDate;
		private bool fertiliserIsAllowed;
		private int nLayers;

		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{
			fertiliserIsAllowed = (AllowFertiliser == yesnoType.yes);
			nLayers = Soil.SoilWater.Thickness.Length;
		}

		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			double daysSinceLastApplication = (Clock.Today - lastApplicationDate).TotalDays;
			
			// get the N stored in the soil
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopMineralN = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (Depth2SoilN - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopMineralN += (Soil.SoilNitrogen.NO3[layer]
				+ Soil.SoilNitrogen.NH4[layer]
				+ Soil.SoilNitrogen.urea[layer])
				* fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= Depth2SoilN)
					layer = nLayers;
			}

			if (fertiliserIsAllowed && (daysSinceLastApplication >= FertMinimumDays) && (TopMineralN <= CriticalSoilN))
			{
				fertiliser.Apply(FertNAmount, FertType, FertApplicationDepth);
				lastApplicationDate = Clock.Today;
			}
		}
	}
}
]]></Code>
            </Manager>
            <Manager>
              <Name>AutomaticIrrigation</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <allowIrrigation>yes</allowIrrigation>
                <allowIrrigationAll>yes</allowIrrigationAll>
                <seasonStart>15-Aug</seasonStart>
                <seasonEnd>30-May</seasonEnd>
                <seasonsAllocation>10000</seasonsAllocation>
                <triggerDeficit>99</triggerDeficit>
                <targetDeficit>100</targetDeficit>
                <returndays>1</returndays>
                <maximumAmount>5</maximumAmount>
                <depthPAWC>600</depthPAWC>
              </Script>
              <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using System.Xml.Serialization;
using Models.PMF;
using APSIM.Shared.Utilities;

        
namespace Models
{
	[Serializable] 
	[System.Xml.Serialization.XmlInclude(typeof(Model))]
	public class Script : Model
	{
		//Communication to other modules
		[Link] ISummary summary = null;
		[Link] Irrigation Irrigation;
		[Link] Clock Clock;
		[Link] Soil Soil;
		[Link(IsOptional = true)] ICrop existingCrop;
	   
		//User inputs from properties tab
		[Description("Turn irrigation on?")] public answerType allowIrrigation { get; set; }
		[Description("Irrigate regardless of crop state?")] public answerType allowIrrigationAll { get; set; }
		[Description("Start of irrigation season (dd-MMM)")]
		public string seasonStart { get; set; }
		[Description("End of irrigation season (dd-MMM)")]
		public string seasonEnd { get; set; }
		[Description("Season allocation (mm)")]
		public double seasonsAllocation { get; set; }
		[Description("Deficit to trigger irrigation (% PAWC)")]
		public double triggerDeficit { get; set; }
		[Description("Deficit to stop irrigaton (% PAWC)")]
		public double targetDeficit { get; set; }
		[Description("Minimum days for irrigation to return")]
		public double returndays { get; set; }
		[Description("Maximum irrigation application (mm/day)")]
		public double maximumAmount { get; set; }
		[Description("Depth to calculate PAWC (mm)")]
		public double depthPAWC { get; set; }
	   
		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		//Class members
		[XmlIgnore] public double TopSWdeficit { get; set; }
		[XmlIgnore] public double TopSWC { get; set; }
		[XmlIgnore] public double DaysSinceIrrigation { get; set; }
		[XmlIgnore] public double AmountToApply { get; set; }
		[XmlIgnore] public double SeasonAppliedAmount { get; set; }
		
		private bool IrrigationIsAllowed { get; set; }
		private bool IrrigationIsAlwaysAllowed { get; set; }
		
		private bool SeasonIsOpen { get; set; }
		private bool CropIsActive { get; set; }
		private bool IrrigatorIsAvailable { get; set; }
		private bool SoilIsDry { get; set; }

		private DateTime StartDate;
		private DateTime EndDate;
		private double TopDUL;
		private double TopLL;
		private int nLayers;
	
		//Calculate static soil variables
		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{   
			//Set the season dates
			StartDate = DateTime.Parse(seasonStart + "-" + Clock.Today.Year.ToString());
			EndDate = DateTime.Parse(seasonEnd + "-" + Clock.Today.Year.ToString());
			
			//Can we irrigate at all?
			IrrigationIsAllowed = false; 
			if (allowIrrigation == answerType.yes)
				IrrigationIsAllowed = true; 
			if (allowIrrigationAll == answerType.yes)
				IrrigationIsAlwaysAllowed = true; 





			//Calculate soil water variables
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			nLayers = Soil.SoilWater.Thickness.Length;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopLL += Soil.SoilWater.LL15mm[layer] * fracLayer;
				TopDUL += Soil.SoilWater.DULmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
		}
	   	  
		//Determine daily requirement for irrigation
		[EventSubscribe("StartOfDay")]
		private void OnStartOfDay(object sender, EventArgs e)
		{
			//Can we irrigate today?		  
			SeasonIsOpen = isBetween(Clock.Today, StartDate, EndDate);

			//Is there a crop in the ground that needs irrigation?
			CropIsActive = false;
			if (IrrigationIsAlwaysAllowed)
				CropIsActive = true;  // might not be but we don't care
			else if ((existingCrop != null) && (existingCrop.IsAlive))
				CropIsActive = true;
			//if ((existingCrop.Phenology.Stage >= 3.0) && (existingCrop.Phenology.Stage < 6.0))
	      
			//Is the irrigator available?
			IrrigatorIsAvailable = false;
			DaysSinceIrrigation += 1;
			if (DaysSinceIrrigation >= returndays)
				IrrigatorIsAvailable = true;
	      
			//Is the soil dry enough to require irrigation?
			SoilIsDry = false;
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopSWC = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			//for (int layer = 0; depthFromSurface < depthPAWC + Soil.SoilWater.Thickness[layer]; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopSWC += Soil.SoilWater.SWmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
			
			TopSWdeficit = TopSWC - TopDUL;
			if (Math.Max(0.0, -TopSWdeficit) >= (TopDUL - TopLL) * (100 - triggerDeficit) / 100)
				SoilIsDry = true;
	            
			//Are all the conditions ratifying irrigation
			if (IrrigationIsAllowed && SeasonIsOpen && CropIsActive && IrrigatorIsAvailable && SoilIsDry)
			{
				//Lets bloody well irrigate then!!!!
				AmountToApply = TopDUL * targetDeficit / 100 - TopSWC;
				AmountToApply = Math.Max(0.0, Math.Min(AmountToApply, seasonsAllocation - SeasonAppliedAmount));
				Irrigation.Apply(AmountToApply);
				DaysSinceIrrigation = 0;
				SeasonAppliedAmount += AmountToApply;
			}
		}
		
		///Checks whether theDate is between iniDate and endDate (non-year specific)
		private bool isBetween(DateTime theDay, DateTime iniDate, DateTime endDate)
		{
			bool result = false;
			if (iniDate.DayOfYear < endDate.DayOfYear)
			{
				// period is within one year, ex: summer in the northern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) && (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			else
			{
				// period goes over the end of the year, ex: summer in the southern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) || (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			
			return result;
		}
	}
}
]]></Code>
            </Manager>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <ShowPageOfGraphs>true</ShowPageOfGraphs>
          </Folder>
          <MicroClimate>
            <Name>MicroClimate</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <a_interception>0</a_interception>
            <b_interception>1</b_interception>
            <c_interception>0</c_interception>
            <d_interception>0</d_interception>
            <soil_albedo>0.23</soil_albedo>
            <sun_angle>15</sun_angle>
            <soil_heat_flux_fraction>0.4</soil_heat_flux_fraction>
            <night_interception_fraction>0.5</night_interception_fraction>
            <refheight>2</refheight>
            <albedo>0.15</albedo>
            <emissivity>0.96</emissivity>
            <RadIntTotal>0</RadIntTotal>
          </MicroClimate>
          <Irrigation>
            <Name>Irrigation</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </Irrigation>
          <Fertiliser>
            <Name>Fertiliser</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </Fertiliser>
          <SurfaceOrganicMatter>
            <Name>SurfaceOrganicMatter</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <PondActive>no</PondActive>
            <ReportAdditions>no</ReportAdditions>
            <ReportRemovals>no</ReportRemovals>
            <ResidueTypes>
              <Name>ResidueTypes</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <LoadFromResource>ResidueTypes</LoadFromResource>
            </ResidueTypes>
            <TillageTypes>
              <Name>TillageTypesList</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <TillageType />
            </TillageTypes>
            <Pools>
              <Pool>
                <PoolName>Sward</PoolName>
                <ResidueType>grass</ResidueType>
                <Mass>0</Mass>
                <CNRatio>15</CNRatio>
                <CPRatio>NaN</CPRatio>
                <StandingFraction>0</StandingFraction>
              </Pool>
            </Pools>
            <PoolName>Sward</PoolName>
            <type>grass</type>
            <mass>0</mass>
            <standing_fraction>0</standing_fraction>
            <cpr />
            <cnr>15</cnr>
            <CriticalResidueWeight>2000</CriticalResidueWeight>
            <OptimumDecompTemp>20</OptimumDecompTemp>
            <MaxCumulativeEOS>20</MaxCumulativeEOS>
            <CNRatioDecompCoeff>0.277</CNRatioDecompCoeff>
            <CNRatioDecompThreshold>25</CNRatioDecompThreshold>
            <TotalLeachRain>25</TotalLeachRain>
            <MinRainToLeach>10</MinRainToLeach>
            <CriticalMinimumOrganicC>0.004</CriticalMinimumOrganicC>
            <DefaultCPRatio>0</DefaultCPRatio>
            <DefaultStandingFraction>0</DefaultStandingFraction>
            <StandingExtinctCoeff>0.5</StandingExtinctCoeff>
            <FractionFaecesAdded>0.5</FractionFaecesAdded>
          </SurfaceOrganicMatter>
          <Soil>
            <Name>Soil</Name>
            <Analysis>
              <Name>Analysis</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <Rocks>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </Rocks>
              <Texture />
              <MunsellColour />
              <PH>
                <double>6</double>
                <double>6</double>
                <double>6</double>
                <double>6</double>
              </PH>
              <CEC>
                <double>10</double>
                <double>10</double>
                <double>10</double>
                <double>10</double>
              </CEC>
              <ParticleSizeSand>
                <double>10</double>
                <double>10</double>
                <double>10</double>
                <double>10</double>
              </ParticleSizeSand>
              <ParticleSizeSilt>
                <double>30</double>
                <double>30</double>
                <double>30</double>
                <double>30</double>
              </ParticleSizeSilt>
              <ParticleSizeClay>
                <double>60</double>
                <double>60</double>
                <double>60</double>
                <double>60</double>
              </ParticleSizeClay>
              <PHUnits>Water</PHUnits>
              <BoronUnits>HotWater</BoronUnits>
            </Analysis>
            <Water>
              <Name>Water</Name>
              <SoilCrop>
                <Name>RyegrassSoil</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LL>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </LL>
                <KL>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                </KL>
                <XF>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                </XF>
              </SoilCrop>
              <SoilCrop>
                <Name>WhiteCloverSoil</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LL>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </LL>
                <KL>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                </KL>
                <XF>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                </XF>
              </SoilCrop>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <BD>
                <double>1.3</double>
                <double>1.3</double>
                <double>1.3</double>
                <double>1.3</double>
              </BD>
              <AirDry>
                <double>0.05</double>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </AirDry>
              <LL15>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </LL15>
              <DUL>
                <double>0.45</double>
                <double>0.45</double>
                <double>0.45</double>
                <double>0.45</double>
              </DUL>
              <SAT>
                <double>0.5</double>
                <double>0.5</double>
                <double>0.5</double>
                <double>0.5</double>
              </SAT>
              <KS>
                <double>500</double>
                <double>500</double>
                <double>500</double>
                <double>500</double>
              </KS>
            </Water>
            <SoilWater>
              <Name>SoilWater</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <SummerDate>1-Nov</SummerDate>
              <SummerU>6</SummerU>
              <SummerCona>3.5</SummerCona>
              <WinterDate>1-apr</WinterDate>
              <WinterU>6</WinterU>
              <WinterCona>3.5</WinterCona>
              <DiffusConst>88</DiffusConst>
              <DiffusSlope>35</DiffusSlope>
              <Salb>0.13</Salb>
              <CN2Bare>73</CN2Bare>
              <CNRed>20</CNRed>
              <CNCov>0.8</CNCov>
              <slope>0</slope>
              <discharge_width>0</discharge_width>
              <catchment_area>0</catchment_area>
              <max_pond>0</max_pond>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <SWCON>
                <double>0.3</double>
                <double>0.3</double>
                <double>0.3</double>
                <double>0.3</double>
              </SWCON>
              <KLAT>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </KLAT>
              <residueinterception>0</residueinterception>
            </SoilWater>
            <SoilNitrogen>
              <Name>SoilNitrogen</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <fom_type>
                <string>default</string>
                <string>manure</string>
                <string>mucuna</string>
                <string>lablab</string>
                <string>shemp</string>
                <string>stable</string>
              </fom_type>
              <fract_carb>
                <double>0.2</double>
                <double>0.3</double>
                <double>0.54</double>
                <double>0.57</double>
                <double>0.45</double>
                <double>0</double>
              </fract_carb>
              <fract_cell>
                <double>0.7</double>
                <double>0.3</double>
                <double>0.37</double>
                <double>0.37</double>
                <double>0.47</double>
                <double>0.1</double>
              </fract_cell>
              <fract_lign>
                <double>0.1</double>
                <double>0.4</double>
                <double>0.09</double>
                <double>0.06</double>
                <double>0.08</double>
                <double>0.9</double>
              </fract_lign>
              <wfpsN2N2O_x>
                <double>22</double>
                <double>88</double>
              </wfpsN2N2O_x>
              <wfpsN2N2O_y>
                <double>0.1</double>
                <double>1</double>
              </wfpsN2N2O_y>
              <oc>
                <double>3.7136764881329496</double>
                <double>2.4698281813043792</double>
                <double>1.2383961716086014</double>
                <double>0.49836009167083023</double>
              </oc>
            </SoilNitrogen>
            <SoilOrganicMatter>
              <Name>SoilOrganicMatter</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <RootCN>40</RootCN>
              <RootWt>0</RootWt>
              <SoilCN>12</SoilCN>
              <EnrACoeff>7.4</EnrACoeff>
              <EnrBCoeff>0.2</EnrBCoeff>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <Depth>
                <string>0-15</string>
                <string>15-30</string>
                <string>30-45</string>
                <string>45-60</string>
              </Depth>
              <OC>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </OC>
              <FBiom>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </FBiom>
              <FInert>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </FInert>
              <OCUnits>Total</OCUnits>
            </SoilOrganicMatter>
            <InitialWater>
              <Name>Initial water</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <PercentMethod>EvenlyDistributed</PercentMethod>
              <FractionFull>0.95</FractionFull>
              <DepthWetSoil>NaN</DepthWetSoil>
            </InitialWater>
            <Sample>
              <Name>Initial nitrogen</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <NO3>
                <double>5</double>
                <double>5</double>
                <double>5</double>
                <double>5</double>
              </NO3>
              <NH4>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </NH4>
              <NO3Units>ppm</NO3Units>
              <NH4Units>ppm</NH4Units>
              <SWUnits>Volumetric</SWUnits>
              <OCUnits>Total</OCUnits>
              <PHUnits>Water</PHUnits>
            </Sample>
            <CERESSoilTemperature>
              <Name>CERESSoilTemperature</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </CERESSoilTemperature>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <RecordNumber>0</RecordNumber>
            <SoilType />
            <LocalName>Stores lots of water</LocalName>
            <Site>Made up</Site>
            <NearestTown />
            <Region />
            <Country />
            <NaturalVegetation />
            <Latitude>0</Latitude>
            <Longitude>0</Longitude>
          </Soil>
          <SoluteManager>
            <Name>SoluteManager</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </SoluteManager>
          <PastureSpecies>
            <Name>Ryegrass</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <MaximumNUptake>10</MaximumNUptake>
            <Albedo>0.26</Albedo>
            <Gsmax>0.011</Gsmax>
            <R50>200</R50>
            <SpeciesFamily>Grass</SpeciesFamily>
            <PhotosyntheticPathway>C3</PhotosyntheticPathway>
            <InitialShootDM>2500</InitialShootDM>
            <InitialRootDM>500</InitialRootDM>
            <InitialRootDepth>600</InitialRootDepth>
            <ReferencePhotosyntheticRate>1</ReferencePhotosyntheticRate>
            <LightExtinctionCoefficient>0.5</LightExtinctionCoefficient>
            <GrowthTminimum>1</GrowthTminimum>
            <GrowthToptimum>20</GrowthToptimum>
            <GrowthTEffectExponent>1.7</GrowthTEffectExponent>
            <UseHeatStressFactor>yes</UseHeatStressFactor>
            <HeatOnsetTemperature>28</HeatOnsetTemperature>
            <HeatFullTemperature>35</HeatFullTemperature>
            <HeatRecoverySumDD>30</HeatRecoverySumDD>
            <HeatRecoveryTReference>25</HeatRecoveryTReference>
            <UseColdStressFactor>yes</UseColdStressFactor>
            <ColdOnsetTemperature>1</ColdOnsetTemperature>
            <ColdFullTemperature>-5</ColdFullTemperature>
            <ColdRecoverySumDD>25</ColdRecoverySumDD>
            <ColdRecoveryTReference>0</ColdRecoveryTReference>
            <MaintenanceRespirationCoefficient>0.03</MaintenanceRespirationCoefficient>
            <GrowthRespirationCoefficient>0.25</GrowthRespirationCoefficient>
            <RespirationTReference>20</RespirationTReference>
            <RespirationExponent>1.5</RespirationExponent>
            <NThresholdsForLeaves>
              <double>0.04</double>
              <double>0.012</double>
              <double>0.05</double>
            </NThresholdsForLeaves>
            <NThresholdsForStems>
              <double>0.02</double>
              <double>0.006</double>
              <double>0.025</double>
            </NThresholdsForStems>
            <NThresholdsForStolons>
              <double>0</double>
              <double>0</double>
              <double>0</double>
            </NThresholdsForStolons>
            <NThresholdsForRoots>
              <double>0.02</double>
              <double>0.006</double>
              <double>0.025</double>
            </NThresholdsForRoots>
            <DegreesDayForGermination>125</DegreesDayForGermination>
            <TargetShootRootRatio>4</TargetShootRootRatio>
            <MaxRootAllocation>0.25</MaxRootAllocation>
            <ShootRootGlfFactor>0.5</ShootRootGlfFactor>
            <UseReproSeasonFactor>yes</UseReproSeasonFactor>
            <ReproSeasonReferenceLatitude>41</ReproSeasonReferenceLatitude>
            <ReproSeasonTimingCoeff>0.14</ReproSeasonTimingCoeff>
            <ReproSeasonMaxAllocationIncrease>0.5</ReproSeasonMaxAllocationIncrease>
            <ReproSeasonAllocationCoeff>0.1</ReproSeasonAllocationCoeff>
            <FractionLeafMaximum>0.7</FractionLeafMaximum>
            <FractionLeafMinimum>0.7</FractionLeafMinimum>
            <FractionLeafDMThreshold>500</FractionLeafDMThreshold>
            <FractionLeafDMFactor>2000</FractionLeafDMFactor>
            <FractionLeafExponent>3</FractionLeafExponent>
            <FractionToStolon>0</FractionToStolon>
            <SpecificLeafArea>25</SpecificLeafArea>
            <SpecificRootLength>100</SpecificRootLength>
            <StolonEffectOnLAI>0</StolonEffectOnLAI>
            <ShootMaxEffectOnLAI>1000</ShootMaxEffectOnLAI>
            <MaxStemEffectOnLAI>1</MaxStemEffectOnLAI>
            <LiveLeavesPerTiller>3</LiveLeavesPerTiller>
            <TissueTurnoverRateShoot>0.05</TissueTurnoverRateShoot>
            <TissueTurnoverRateRoot>0.02</TissueTurnoverRateRoot>
            <DetachmentRateShoot>0.08</DetachmentRateShoot>
            <TurnoverTemperatureMin>2</TurnoverTemperatureMin>
            <TurnoverTemperatureRef>20</TurnoverTemperatureRef>
            <TurnoverTemperatureExponent>1</TurnoverTemperatureExponent>
            <TurnoverDroughtEffectMax>1</TurnoverDroughtEffectMax>
            <TurnoverDroughtThreshold>0.5</TurnoverDroughtThreshold>
            <TurnoverDefoliationCoefficient>0.5</TurnoverDefoliationCoefficient>
            <TurnoverDefoliationRootEffect>0.1</TurnoverDefoliationRootEffect>
            <FractionNLuxuryRemobilisable>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.1</double>
            </FractionNLuxuryRemobilisable>
            <MinimumNFixation>0</MinimumNFixation>
            <MaximumNFixation>0</MaximumNFixation>
            <SoilSaturationEffectMax>0.1</SoilSaturationEffectMax>
            <MinimumWaterFreePorosity>-1</MinimumWaterFreePorosity>
            <SoilSaturationRecoveryFactor>0.25</SoilSaturationRecoveryFactor>
            <NDillutionCoefficient>0.25</NDillutionCoefficient>
            <GlfGeneric>1</GlfGeneric>
            <GlfSoilFertility>1</GlfSoilFertility>
            <PlantHeightMinimum>25</PlantHeightMinimum>
            <PlantHeightMaximum>600</PlantHeightMaximum>
            <PlantHeightMassForMax>10000</PlantHeightMassForMax>
            <PlantHeightExponent>2.8</PlantHeightExponent>
            <RootDepthMinimum>50</RootDepthMinimum>
            <RootDepthMaximum>750</RootDepthMaximum>
            <RootElongationRate>25</RootElongationRate>
            <RootDistributionDepthParam>90</RootDistributionDepthParam>
            <RootDistributionExponent>3.2</RootDistributionExponent>
            <DigestibilitiesCellWall>
              <double>0.6</double>
              <double>0.6</double>
              <double>0.6</double>
              <double>0.2</double>
            </DigestibilitiesCellWall>
            <MinimumGreenWt>100</MinimumGreenWt>
            <FractionStolonStanding>0</FractionStolonStanding>
            <PreferenceForGreenOverDead>1</PreferenceForGreenOverDead>
            <PreferenceForLeafOverStems>1</PreferenceForLeafOverStems>
            <WaterAvailableMethod>DefaultAPSIM</WaterAvailableMethod>
            <NitrogenAvailableMethod>BasicAgPasture</NitrogenAvailableMethod>
          </PastureSpecies>
          <Report>
            <Name>ThreeZoneSimulationInitialUniformSoilN</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <ExperimentFactorNames />
            <ExperimentFactorValues />
            <VariableNames>
              <string>[Clock].Today as Date</string>
              <string>[Ryegrass].AboveGroundWt as PlantMass</string>
              <string>[Ryegrass].HarvestedWt as Harvested</string>
              <string>[Ryegrass].WaterDemand as SW_Demand</string>
              <string>sum([Ryegrass].WaterUptake) as SW_Uptake</string>
              <string>[Ryegrass].GlfWaterSupply as glfWater</string>
              <string>[Ryegrass].GlfNSupply as glfNitrogen</string>
              <string>sum([Soil].SoilWater.SWmm) as SoilWater</string>
              <string>sum([Soil].SoilNitrogen.NH4)+sum([Soil].SoilNitrogen.NO3) as SoilNitrogen</string>
              <string>[Irrigation].IrrigationApplied as Irrigation</string>
              <string>[Fertiliser].NitrogenApplied as Fertiliser</string>
            </VariableNames>
            <EventNames>
              <string>[Clock].EndOfDay</string>
            </EventNames>
          </Report>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Area>1</Area>
          <Slope>0</Slope>
        </Zone>
        <IncludeInDocumentation>true</IncludeInDocumentation>
      </Simulation>
      <IncludeInDocumentation>true</IncludeInDocumentation>
      <ShowPageOfGraphs>true</ShowPageOfGraphs>
    </Folder>
    <Folder>
      <Name>Three Zone Simulation with Initial Nonuniform Soil N</Name>
      <Memo>
        <Name>Memo ThreeZoneSimulationInitialNonuniformSoilN</Name>
        <IncludeInDocumentation>true</IncludeInDocumentation>
        <MemoText><![CDATA[This simulation differs from the previous only in that Zone0 initially starts with 100 kg of mineral N in the soil. This results in the expected changes in plant performance and depletion of soil N and water.
]]></MemoText>
      </Memo>
      <Graph>
        <Name>PlantWt</Name>
        <Series>
          <Name>Ryegrass</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>ThreeZoneSimulationInitialNonuniformSoilN</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>PlantMass</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>2600</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>Harvested</Name>
        <Series>
          <Name>Ryegrass</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>ThreeZoneSimulationInitialNonuniformSoilN</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Harvested</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>WaterDemand</Name>
        <Series>
          <Name>Demand</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>ThreeZoneSimulationInitialNonuniformSoilN</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SW_Demand</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>5</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>WaterUptake</Name>
        <Series>
          <Name>Uptake</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-1663232</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>ThreeZoneSimulationInitialNonuniformSoilN</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SW_Uptake</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>5</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>WaterStress</Name>
        <Series>
          <Name>Ryegrass</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>ThreeZoneSimulationInitialNonuniformSoilN</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>glfWater</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>1.05</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>NStress</Name>
        <Series>
          <Name>Ryegrass</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>ThreeZoneSimulationInitialNonuniformSoilN</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>glfNitrogen</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>1.05</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>SoilWater</Name>
        <Series>
          <Name>Water</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>ThreeZoneSimulationInitialNonuniformSoilN</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SoilWater</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter />
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>50</Minimum>
          <Maximum>275</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>SoilNitrogen</Name>
        <Series>
          <Name>Nitrogen</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>ThreeZoneSimulationInitialNonuniformSoilN</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>SoilNitrogen</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>false</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter />
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>IrrigationApplied</Name>
        <Series>
          <Name>Irrigation</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>ThreeZoneSimulationInitialNonuniformSoilN</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Irrigation</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter />
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Graph>
        <Name>FertiliserApplied</Name>
        <Series>
          <Name>Fertiliser</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Type>Scatter</Type>
          <XAxis>Bottom</XAxis>
          <YAxis>Left</YAxis>
          <ColourArgb>-16736653</ColourArgb>
          <FactorIndexToVaryColours>0</FactorIndexToVaryColours>
          <FactorIndexToVaryMarkers>-1</FactorIndexToVaryMarkers>
          <FactorIndexToVaryLines>-1</FactorIndexToVaryLines>
          <Marker>None</Marker>
          <MarkerSize>Normal</MarkerSize>
          <Line>Solid</Line>
          <LineThickness>Normal</LineThickness>
          <TableName>ThreeZoneSimulationInitialNonuniformSoilN</TableName>
          <XFieldName>Date</XFieldName>
          <YFieldName>Fertiliser</YFieldName>
          <ShowInLegend>true</ShowInLegend>
          <IncludeSeriesNameInLegend>false</IncludeSeriesNameInLegend>
          <Cumulative>true</Cumulative>
          <CumulativeX>false</CumulativeX>
          <Filter />
        </Series>
        <IncludeInDocumentation>false</IncludeInDocumentation>
        <Axis>
          <Type>Left</Type>
          <Title />
          <Inverted>false</Inverted>
          <Minimum>0</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <Axis>
          <Type>Bottom</Type>
          <Inverted>false</Inverted>
          <Minimum>NaN</Minimum>
          <Maximum>NaN</Maximum>
          <Interval>NaN</Interval>
        </Axis>
        <LegendPosition>TopRight</LegendPosition>
        <DisabledSeries />
      </Graph>
      <Simulation>
        <Name>ThreeZoneSimulationInitialNonuniformSoilN</Name>
        <Clock>
          <Name>Clock</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <StartDate>2000-01-01T00:00:00</StartDate>
          <EndDate>2000-03-31T00:00:00</EndDate>
        </Clock>
        <ControlledEnvironment>
          <Name>ControlledEnvironment</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <MaxT>25</MaxT>
          <MinT>15</MinT>
          <Rain>0</Rain>
          <Radn>25</Radn>
          <PanEvap>0</PanEvap>
          <VP>17</VP>
          <Wind>3</Wind>
          <CO2>350</CO2>
          <AirPressure>1010</AirPressure>
          <Latitude>0</Latitude>
          <DayLength>12</DayLength>
        </ControlledEnvironment>
        <SoilArbitrator>
          <Name>SoilArbitrator</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
        </SoilArbitrator>
        <Summary>
          <Name>Summary</Name>
          <IncludeInDocumentation>true</IncludeInDocumentation>
        </Summary>
        <Zone>
          <Name>Zone0</Name>
          <Folder>
            <Name>Managers</Name>
            <Manager>
              <Name>DoRootsThreeZone</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <RootDepth>600</RootDepth>
                <RootMass>500</RootMass>
                <Zone0Name>Zone0</Zone0Name>
                <Zone0Prop>0</Zone0Prop>
                <Zone2Name>Zone1</Zone2Name>
                <Zone2Prop>0</Zone2Prop>
              </Script>
              <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Root depth in the plant's zone (mm): ")]  public double RootDepth { get; set; }
		[Description("Root mass  in the plant's zone (mm): ")]  public double RootMass { get; set; }

		[Description("Name of zone ot the left: ")] public string Zone0Name { get; set; }
		[Description("Proportionate depth and mass in zone to the left (-): ")]  public double Zone0Prop { get; set; }

		[Description("Name of zone ot the right: ")] public string Zone2Name { get; set; }
		[Description("Proportionate depth and mass in zone to the right (-): ")]  public double Zone2Prop { get; set; }

		// - Outputs from this manager

		// - Internal variables

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			int SpeciesNum = 0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				SpeciesNum += 1;
				if (SpeciesNum == 1)
				{
					if (Zone0Prop > 0)
						species.AddZone(zoneName: Zone0Name, rootDepth: Zone0Prop * RootDepth, rootDM: Zone0Prop * RootMass, specificRootLength: 100);
					if (Zone2Prop > 0)
						species.AddZone(zoneName: Zone2Name, rootDepth: Zone2Prop * RootDepth, rootDM: Zone2Prop * RootMass, specificRootLength: 100);
				}
			}

			//Pasture[1].AddZone(zoneName: "Zone1", rootDepth: 100, rootDM: 1000, specificRootLength: 100);
			//Pasture[1].AddZone(zoneName: "Zone2", rootDepth: 50, rootDM: 500, specificRootLength: 100);
		}
	}
}]]></Code>
            </Manager>
            <Manager>
              <Name>CutRotationSingle</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <CutRotationStartDate>1900-07-01</CutRotationStartDate>
                <CutRotationEndDate>2100-12-31</CutRotationEndDate>
                <CutInterval>1</CutInterval>
                <IntervalType>FixedInterval</IntervalType>
                <DurationOfCut>1</DurationOfCut>
                <RemoveAmountType>ResidualDM</RemoveAmountType>
                <AmountGiven>2250</AmountGiven>
                <DMRemoveType>RemoveAll</DMRemoveType>
                <FractionN2Remove>1</FractionN2Remove>
                <ProportionN2Dung>0</ProportionN2Dung>
              </Script>
              <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Date to begin the rotation: ")]
		public DateTime CutRotationStartDate { get; set; }

		[Description("Date to finish the rotation: ")]
		public DateTime CutRotationEndDate { get; set; }

		[Description("Rotation interval (days): ")]
		public int CutInterval { get; set; }

		[Description("How the interval is defined: ")]
		public rotationIntervalTypes IntervalType { get; set; }

		[Description("Duration of each event (days): ")]
		public int DurationOfCut { get; set; }

		[Description("What amount is being defined: ")]
		public removeAmountTypes RemoveAmountType { get; set; }

		[Description("Amount to use (kg/ha): ")]
		public double AmountGiven { get; set; }

		[Description("Fraction of DM that is removed from the field:")]
		public removeDMTypes DMRemoveType { get; set; }

		[Description("Fraction of N that is removed from the field (0-1):")]
		public double FractionN2Remove { get; set; }

		[Description("Proportion of N returned in dung (0-1):")]
		public double ProportionN2Dung { get; set; }

		// - Outputs from this manager
		[XmlIgnore][Units("g/m2")]// Description: Pasture DM defoliated today
		public double DefoliatedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture N defoliate today
		public double DefoliatedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture DM harvested today
		public double HarvestedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture N harvested today
		public double HarvestedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture DM removed from the field
		public double RemovedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture N removed from the field
		public double RemovedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Residue DM returned to the field
		public double ReturnedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Residue N returned to the field
		public double ReturnedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Harvested N returned as dung (SurfaceOM)
		public double NReturnedInDung { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Harvested N returned as urine (urea)
		public double NReturnedInUrine { get; set; }
		[XmlIgnore][Units("day")]// Description: Number of days after last defoliation
		public int DaysAfterCut { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Total standing DM (Leaf + Stem/Sheath) before cut
		public double PreHarvestDM { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Total standing DM (Leaf + Stem/Sheath) after cut
		public double PostHarvestDM { get; set; }
		
		// - Internal variables
		// fraction of harvested Dm to actually remove from field
		private double fractionDM2Remove = 1.0;
		// flag whether defoliation is allowed
		private bool rotationAllowed = true;
		// number of days for each defoliation event
		private int cuttingDuration = 0;
		// counter for day within each defoliation
		private int daysCutting = 0;
		// type of interval (Fixed or target)
		private string intervalType;
		// total herbage to remove in g/m2 per day
		private double herbageToRemove;
		// type of DM amount (ResidualDM or DMToRemove)
		private string amountType;
		// auxiliary flag for defoliation
		private bool aCutHasHappened = false;

		// - Event to add residue or dung to surface OM
		public event BiomassRemovedDelegate BiomassRemoved;

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				Pasture.Add(species);
			}

			// reset variables
			DaysAfterCut = 0;
			resetVariables();
			cuttingDuration = DurationOfCut;
			
			// get the type of amount given
			if (RemoveAmountType == removeAmountTypes.ResidualDM)
				amountType = "SetResidueAmount";
			else
				amountType = "SetRemoveAmount";

			// get the type of amount given
			if (IntervalType == rotationIntervalTypes.FixedInterval)
				intervalType = "Fixed";
			else
				intervalType = "Target";

			// make sure that rotation start when startDate < simulationStartDay
			if ((Clock.Today > CutRotationStartDate) && (Clock.Today < CutRotationEndDate))
				CutRotationStartDate = Clock.Today;
		}
		
		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			if (rotationAllowed)
			{
				if (Clock.Today == CutRotationStartDate)
					DaysAfterCut = CutInterval;

				// Check whether we can defoliate
				if ((Clock.Today >= CutRotationStartDate) && (Clock.Today <= CutRotationEndDate) && (Pasture[0].IsAlive))
				{
					// Check whether we should start a defoliation
					if (DaysAfterCut >= (CutInterval - 1))
					{
						Graze(AmountGiven, amountType, DurationOfCut);
					}
				}
			}

			// Check whether we need to continue cutting
			if ((daysCutting > 0) && (daysCutting < cuttingDuration))
			{
				// reset outputs
				resetVariables();

				removeDM(herbageToRemove);
				returnExcreta();
				daysCutting += 1;
				if (daysCutting == cuttingDuration)
					PostHarvestDM = Pasture[0].StandingHerbageWt; //+ Pasture[1].StandingHerbageWt
			}

			// reset outputs
			if (daysCutting < 0)
			{
				resetVariables();
				daysCutting = 0;
			}
		}

		[EventSubscribe("DoManagementCalculations")]
		private void OnDoManagementCalculations(object sender, EventArgs e)
		{
			// Check whether a cutting has finished
			if (daysCutting == cuttingDuration)
			{
				aCutHasHappened = true;
				daysCutting = -1;
			}

			// Increase the counter for days after cutting
			if (aCutHasHappened && (daysCutting == 0))
				DaysAfterCut += 1;
		}

		public enum removeAmountTypes
		{
			/// <summary>Setting DM amount to remove</summary>
			DMToRemove,
			/// <summary>Setting residual DM amount</summary>
			ResidualDM
		}

		public enum rotationIntervalTypes
		{
			/// <summary>Setting a fixed interval</summary>
			FixedInterval,
			/// <summary>Setting a target (minimum) inteval</summary>
			TargetInterval
		}

		public enum removeDMTypes
		{
			/// <summary>Remove all DM</summary>
			RemoveAll,
			/// <summary>Remove no DM</summary>
			RemoveNone,
			/// <summary>Remove a fraction based on digestibility</summary>
			BasedOnDigestibility
		}

		// Resets the values of all outputs
		private void resetVariables()
		{
			DefoliatedWt = 0.0;
			DefoliatedN = 0.0;
			HarvestedWt = 0.0;
			HarvestedN = 0.0;
			RemovedWt = 0.0;
			RemovedN = 0.0;
			ReturnedWt = 0.0;
			ReturnedN = 0.0;
			NReturnedInDung = 0.0;
			NReturnedInUrine = 0.0;
		}

		// Description: Perform the basic calculations for defoliation
		public void Graze(double amountDM, string amountType, int duration)
		{
			// Get the existing plant amount
			PreHarvestDM = Pasture[0].StandingHerbageWt;  //+ Pasture[1].StandingHerbageWt
			
			// Check the amount to remove and print some info
			if ((amountType == "SetRemoveAmount") && (PreHarvestDM >= amountDM / duration))
			{
				summary.WriteMessage(this, "   Defoliating " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = amountDM / duration;
			}
			else if ((amountType == "SetResidueAmount") && (PreHarvestDM >= amountDM))
			{
				summary.WriteMessage(this, "   Defoliating down to approximately " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = (PreHarvestDM - amountDM) / duration;
			}
			else
			{
				summary.WriteMessage(this, "   Defoliation will not happend because there is not enough plant material");
				if (intervalType == "Fixed")
					DaysAfterCut = -duration;
				return;
			}

			cuttingDuration = duration;
			// Preform first defoliation
			removeDM(herbageToRemove);
			returnExcreta();
			daysCutting = 1;
			DaysAfterCut = 0;
			if (daysCutting == cuttingDuration)
				PostHarvestDM = Pasture[0].StandingHerbageWt;  //+ Pasture[1].StandingHerbageWt
		}

		// Do the DM removal
		private void removeDM(double removeAmount)
		{
			double existingWt = Pasture[0].HarvestableWt;  // + Pasture[1].HarvestableWt

			// Check whether we harvest anything
			if (existingWt >= removeAmount)
			{
				foreach (AgPasture.PastureSpecies species in Pasture)
				{
					double amountToRemove = removeAmount * species.HarvestableWt / existingWt;
					species.Graze(amount: amountToRemove, type: "SetRemoveAmount");
				}
				
				// get total harvested
				DefoliatedWt = Pasture[0].HarvestedWt;  // + Pasture[1].HarvestedWt
				DefoliatedN = Pasture[0].HarvestedN;  //+ Pasture[1].HarvestedN
				HarvestedWt = DefoliatedWt;
				HarvestedN = DefoliatedN;

				// get amounts actually removed from field and that to be returned (dung/urine)
				if (DMRemoveType == removeDMTypes.RemoveAll)
					fractionDM2Remove = 1.0;
				else if (DMRemoveType == removeDMTypes.RemoveNone)
					fractionDM2Remove = 0.0;
				else
				{
					fractionDM2Remove = Pasture[0].HarvestedDigestibility * Pasture[0].HarvestedWt;  //+ Pasture[1].HarvestedDigestibility * Pasture[1].HarvestedWt
					fractionDM2Remove /= removeAmount;
				}
				
				RemovedWt = HarvestedWt * fractionDM2Remove;
				RemovedN = HarvestedN * FractionN2Remove;
				ReturnedWt = HarvestedWt - RemovedWt;
				ReturnedN = HarvestedN - RemovedN;
				NReturnedInDung = ReturnedN * ProportionN2Dung;
				NReturnedInUrine = ReturnedN - NReturnedInDung;
			}
		}

		// Return dung and urine
		private void returnExcreta()
		{
			if ((ReturnedWt > 0.0) || (NReturnedInDung > 0.0))
			{
				PMF.BiomassRemovedType BiomassDung = new PMF.BiomassRemovedType();
				string[] type = new string[] { "RuminantDung_PastureFed" };
				float[] dltdm = new float[] { (Single)ReturnedWt };
				float[] dltn = new float[] { (Single)NReturnedInDung };
				float[] dltp = new float[] { 0 };
				float[] fraction = new float[] { 1 };     // fraction is always 1.0 here

				BiomassDung.crop_type = "RuminantDung_PastureFed";
				BiomassDung.dm_type = type;
				BiomassDung.dlt_crop_dm = dltdm;
				BiomassDung.dlt_dm_n = dltn;
				BiomassDung.dlt_dm_p = dltp;
				BiomassDung.fraction_to_residue = fraction;
				BiomassRemoved.Invoke(BiomassDung);
			}

			if (NReturnedInUrine > 0.0)
			{
				fertiliser.Apply(NReturnedInUrine * 10, Fertiliser.Types.UreaN, 1.0);
			}
		}
	}
}
]]></Code>
            </Manager>
            <Manager>
              <Name>AutomaticFertiliser</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <AllowFertiliser>no</AllowFertiliser>
                <Depth2SoilN>500</Depth2SoilN>
                <CriticalSoilN>50</CriticalSoilN>
                <FertNAmount>25</FertNAmount>
                <FertType>UreaN</FertType>
                <FertApplicationDepth>1</FertApplicationDepth>
                <FertMinimumDays>1</FertMinimumDays>
              </Script>
              <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using APSIM.Shared.Utilities;
using System.Xml.Serialization;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		[Link] Soil Soil;

		//User inputs from properties tab
		[Description("Turn ferliser applications on? ")]
		public yesnoType AllowFertiliser { get; set; }
		
		[Description("Depth to calculate available soil N (mm): ")]
		public double Depth2SoilN { get; set; }

		[Description("Minimum available N, triggers an application (kgN/ha): ")]
		public double CriticalSoilN { get; set; }

		[Description("Amount of N fertiliser for each application (kgN/ha): ")]
		public double FertNAmount { get; set; }

		[Description("Type of N fertiliser to apply: ")]
		public Fertiliser.Types FertType { get; set; }

		[Description("Depth at which to apply the fertiliser (mm): ")]
		public double FertApplicationDepth { get; set; }
	   
		[Description("Minimum period between applications (days): ")]
		public double FertMinimumDays { get; set; }
	   
		public enum yesnoType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		[XmlIgnore] public double TopMineralN { get; set; }
		
		private DateTime lastApplicationDate;
		private bool fertiliserIsAllowed;
		private int nLayers;

		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{
			fertiliserIsAllowed = (AllowFertiliser == yesnoType.yes);
			nLayers = Soil.SoilWater.Thickness.Length;
		}

		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			double daysSinceLastApplication = (Clock.Today - lastApplicationDate).TotalDays;
			
			// get the N stored in the soil
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopMineralN = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (Depth2SoilN - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopMineralN += (Soil.SoilNitrogen.NO3[layer]
				+ Soil.SoilNitrogen.NH4[layer]
				+ Soil.SoilNitrogen.urea[layer])
				* fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= Depth2SoilN)
					layer = nLayers;
			}

			if (fertiliserIsAllowed && (daysSinceLastApplication >= FertMinimumDays) && (TopMineralN <= CriticalSoilN))
			{
				fertiliser.Apply(FertNAmount, FertType, FertApplicationDepth);
				lastApplicationDate = Clock.Today;
			}
		}
	}
}
]]></Code>
            </Manager>
            <Manager>
              <Name>AutomaticIrrigation</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <allowIrrigation>yes</allowIrrigation>
                <allowIrrigationAll>yes</allowIrrigationAll>
                <seasonStart>15-Aug</seasonStart>
                <seasonEnd>30-May</seasonEnd>
                <seasonsAllocation>10000</seasonsAllocation>
                <triggerDeficit>99</triggerDeficit>
                <targetDeficit>100</targetDeficit>
                <returndays>1</returndays>
                <maximumAmount>5</maximumAmount>
                <depthPAWC>600</depthPAWC>
              </Script>
              <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using System.Xml.Serialization;
using Models.PMF;
using APSIM.Shared.Utilities;

        
namespace Models
{
	[Serializable] 
	[System.Xml.Serialization.XmlInclude(typeof(Model))]
	public class Script : Model
	{
		//Communication to other modules
		[Link] ISummary summary = null;
		[Link] Irrigation Irrigation;
		[Link] Clock Clock;
		[Link] Soil Soil;
		[Link(IsOptional = true)] ICrop existingCrop;
	   
		//User inputs from properties tab
		[Description("Turn irrigation on?")] public answerType allowIrrigation { get; set; }
		[Description("Irrigate regardless of crop state?")] public answerType allowIrrigationAll { get; set; }
		[Description("Start of irrigation season (dd-MMM)")]
		public string seasonStart { get; set; }
		[Description("End of irrigation season (dd-MMM)")]
		public string seasonEnd { get; set; }
		[Description("Season allocation (mm)")]
		public double seasonsAllocation { get; set; }
		[Description("Deficit to trigger irrigation (% PAWC)")]
		public double triggerDeficit { get; set; }
		[Description("Deficit to stop irrigaton (% PAWC)")]
		public double targetDeficit { get; set; }
		[Description("Minimum days for irrigation to return")]
		public double returndays { get; set; }
		[Description("Maximum irrigation application (mm/day)")]
		public double maximumAmount { get; set; }
		[Description("Depth to calculate PAWC (mm)")]
		public double depthPAWC { get; set; }
	   
		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		//Class members
		[XmlIgnore] public double TopSWdeficit { get; set; }
		[XmlIgnore] public double TopSWC { get; set; }
		[XmlIgnore] public double DaysSinceIrrigation { get; set; }
		[XmlIgnore] public double AmountToApply { get; set; }
		[XmlIgnore] public double SeasonAppliedAmount { get; set; }
		
		private bool IrrigationIsAllowed { get; set; }
		private bool IrrigationIsAlwaysAllowed { get; set; }
		
		private bool SeasonIsOpen { get; set; }
		private bool CropIsActive { get; set; }
		private bool IrrigatorIsAvailable { get; set; }
		private bool SoilIsDry { get; set; }

		private DateTime StartDate;
		private DateTime EndDate;
		private double TopDUL;
		private double TopLL;
		private int nLayers;
	
		//Calculate static soil variables
		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{   
			//Set the season dates
			StartDate = DateTime.Parse(seasonStart + "-" + Clock.Today.Year.ToString());
			EndDate = DateTime.Parse(seasonEnd + "-" + Clock.Today.Year.ToString());
			
			//Can we irrigate at all?
			IrrigationIsAllowed = false; 
			if (allowIrrigation == answerType.yes)
				IrrigationIsAllowed = true; 
			if (allowIrrigationAll == answerType.yes)
				IrrigationIsAlwaysAllowed = true; 





			//Calculate soil water variables
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			nLayers = Soil.SoilWater.Thickness.Length;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopLL += Soil.SoilWater.LL15mm[layer] * fracLayer;
				TopDUL += Soil.SoilWater.DULmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
		}
	   	  
		//Determine daily requirement for irrigation
		[EventSubscribe("StartOfDay")]
		private void OnStartOfDay(object sender, EventArgs e)
		{
			//Can we irrigate today?		  
			SeasonIsOpen = isBetween(Clock.Today, StartDate, EndDate);

			//Is there a crop in the ground that needs irrigation?
			CropIsActive = false;
			if (IrrigationIsAlwaysAllowed)
				CropIsActive = true;  // might not be but we don't care
			else if ((existingCrop != null) && (existingCrop.IsAlive))
				CropIsActive = true;
			//if ((existingCrop.Phenology.Stage >= 3.0) && (existingCrop.Phenology.Stage < 6.0))
	      
			//Is the irrigator available?
			IrrigatorIsAvailable = false;
			DaysSinceIrrigation += 1;
			if (DaysSinceIrrigation >= returndays)
				IrrigatorIsAvailable = true;
	      
			//Is the soil dry enough to require irrigation?
			SoilIsDry = false;
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopSWC = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			//for (int layer = 0; depthFromSurface < depthPAWC + Soil.SoilWater.Thickness[layer]; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopSWC += Soil.SoilWater.SWmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
			
			TopSWdeficit = TopSWC - TopDUL;
			if (Math.Max(0.0, -TopSWdeficit) >= (TopDUL - TopLL) * (100 - triggerDeficit) / 100)
				SoilIsDry = true;
	            
			//Are all the conditions ratifying irrigation
			if (IrrigationIsAllowed && SeasonIsOpen && CropIsActive && IrrigatorIsAvailable && SoilIsDry)
			{
				//Lets bloody well irrigate then!!!!
				AmountToApply = TopDUL * targetDeficit / 100 - TopSWC;
				AmountToApply = Math.Max(0.0, Math.Min(AmountToApply, seasonsAllocation - SeasonAppliedAmount));
				Irrigation.Apply(AmountToApply);
				DaysSinceIrrigation = 0;
				SeasonAppliedAmount += AmountToApply;
			}
		}
		
		///Checks whether theDate is between iniDate and endDate (non-year specific)
		private bool isBetween(DateTime theDay, DateTime iniDate, DateTime endDate)
		{
			bool result = false;
			if (iniDate.DayOfYear < endDate.DayOfYear)
			{
				// period is within one year, ex: summer in the northern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) && (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			else
			{
				// period goes over the end of the year, ex: summer in the southern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) || (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			
			return result;
		}
	}
}
]]></Code>
            </Manager>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <ShowPageOfGraphs>true</ShowPageOfGraphs>
          </Folder>
          <MicroClimate>
            <Name>MicroClimate</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <a_interception>0</a_interception>
            <b_interception>1</b_interception>
            <c_interception>0</c_interception>
            <d_interception>0</d_interception>
            <soil_albedo>0.23</soil_albedo>
            <sun_angle>15</sun_angle>
            <soil_heat_flux_fraction>0.4</soil_heat_flux_fraction>
            <night_interception_fraction>0.5</night_interception_fraction>
            <refheight>2</refheight>
            <albedo>0.15</albedo>
            <emissivity>0.96</emissivity>
            <RadIntTotal>0</RadIntTotal>
          </MicroClimate>
          <Irrigation>
            <Name>Irrigation</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </Irrigation>
          <Fertiliser>
            <Name>Fertiliser</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </Fertiliser>
          <SurfaceOrganicMatter>
            <Name>SurfaceOrganicMatter</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <PondActive>no</PondActive>
            <ReportAdditions>no</ReportAdditions>
            <ReportRemovals>no</ReportRemovals>
            <ResidueTypes>
              <Name>ResidueTypes</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <LoadFromResource>ResidueTypes</LoadFromResource>
            </ResidueTypes>
            <TillageTypes>
              <Name>TillageTypesList</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <TillageType />
            </TillageTypes>
            <Pools>
              <Pool>
                <PoolName>Sward</PoolName>
                <ResidueType>grass</ResidueType>
                <Mass>0</Mass>
                <CNRatio>15</CNRatio>
                <CPRatio>NaN</CPRatio>
                <StandingFraction>0</StandingFraction>
              </Pool>
            </Pools>
            <PoolName>Sward</PoolName>
            <type>grass</type>
            <mass>0</mass>
            <standing_fraction>0</standing_fraction>
            <cpr />
            <cnr>15</cnr>
            <CriticalResidueWeight>2000</CriticalResidueWeight>
            <OptimumDecompTemp>20</OptimumDecompTemp>
            <MaxCumulativeEOS>20</MaxCumulativeEOS>
            <CNRatioDecompCoeff>0.277</CNRatioDecompCoeff>
            <CNRatioDecompThreshold>25</CNRatioDecompThreshold>
            <TotalLeachRain>25</TotalLeachRain>
            <MinRainToLeach>10</MinRainToLeach>
            <CriticalMinimumOrganicC>0.004</CriticalMinimumOrganicC>
            <DefaultCPRatio>0</DefaultCPRatio>
            <DefaultStandingFraction>0</DefaultStandingFraction>
            <StandingExtinctCoeff>0.5</StandingExtinctCoeff>
            <FractionFaecesAdded>0.5</FractionFaecesAdded>
          </SurfaceOrganicMatter>
          <Soil>
            <Name>Soil</Name>
            <Analysis>
              <Name>Analysis</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <Rocks>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </Rocks>
              <Texture />
              <MunsellColour />
              <PH>
                <double>6</double>
                <double>6</double>
                <double>6</double>
                <double>6</double>
              </PH>
              <CEC>
                <double>10</double>
                <double>10</double>
                <double>10</double>
                <double>10</double>
              </CEC>
              <ParticleSizeSand>
                <double>10</double>
                <double>10</double>
                <double>10</double>
                <double>10</double>
              </ParticleSizeSand>
              <ParticleSizeSilt>
                <double>30</double>
                <double>30</double>
                <double>30</double>
                <double>30</double>
              </ParticleSizeSilt>
              <ParticleSizeClay>
                <double>60</double>
                <double>60</double>
                <double>60</double>
                <double>60</double>
              </ParticleSizeClay>
              <PHUnits>Water</PHUnits>
              <BoronUnits>HotWater</BoronUnits>
            </Analysis>
            <Water>
              <Name>Water</Name>
              <SoilCrop>
                <Name>RyegrassSoil</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LL>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </LL>
                <KL>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                </KL>
                <XF>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                </XF>
              </SoilCrop>
              <SoilCrop>
                <Name>WhiteCloverSoil</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LL>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </LL>
                <KL>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                </KL>
                <XF>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                </XF>
              </SoilCrop>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <BD>
                <double>1.3</double>
                <double>1.3</double>
                <double>1.3</double>
                <double>1.3</double>
              </BD>
              <AirDry>
                <double>0.05</double>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </AirDry>
              <LL15>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </LL15>
              <DUL>
                <double>0.45</double>
                <double>0.45</double>
                <double>0.45</double>
                <double>0.45</double>
              </DUL>
              <SAT>
                <double>0.5</double>
                <double>0.5</double>
                <double>0.5</double>
                <double>0.5</double>
              </SAT>
              <KS>
                <double>500</double>
                <double>500</double>
                <double>500</double>
                <double>500</double>
              </KS>
            </Water>
            <SoilWater>
              <Name>SoilWater</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <SummerDate>1-Nov</SummerDate>
              <SummerU>6</SummerU>
              <SummerCona>3.5</SummerCona>
              <WinterDate>1-apr</WinterDate>
              <WinterU>6</WinterU>
              <WinterCona>3.5</WinterCona>
              <DiffusConst>88</DiffusConst>
              <DiffusSlope>35</DiffusSlope>
              <Salb>0.13</Salb>
              <CN2Bare>73</CN2Bare>
              <CNRed>20</CNRed>
              <CNCov>0.8</CNCov>
              <slope>0</slope>
              <discharge_width>0</discharge_width>
              <catchment_area>0</catchment_area>
              <max_pond>0</max_pond>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <SWCON>
                <double>0.3</double>
                <double>0.3</double>
                <double>0.3</double>
                <double>0.3</double>
              </SWCON>
              <KLAT>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </KLAT>
              <residueinterception>0</residueinterception>
            </SoilWater>
            <SoilNitrogen>
              <Name>SoilNitrogen</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <fom_type>
                <string>default</string>
                <string>manure</string>
                <string>mucuna</string>
                <string>lablab</string>
                <string>shemp</string>
                <string>stable</string>
              </fom_type>
              <fract_carb>
                <double>0.2</double>
                <double>0.3</double>
                <double>0.54</double>
                <double>0.57</double>
                <double>0.45</double>
                <double>0</double>
              </fract_carb>
              <fract_cell>
                <double>0.7</double>
                <double>0.3</double>
                <double>0.37</double>
                <double>0.37</double>
                <double>0.47</double>
                <double>0.1</double>
              </fract_cell>
              <fract_lign>
                <double>0.1</double>
                <double>0.4</double>
                <double>0.09</double>
                <double>0.06</double>
                <double>0.08</double>
                <double>0.9</double>
              </fract_lign>
              <wfpsN2N2O_x>
                <double>22</double>
                <double>88</double>
              </wfpsN2N2O_x>
              <wfpsN2N2O_y>
                <double>0.1</double>
                <double>1</double>
              </wfpsN2N2O_y>
              <oc>
                <double>3.7136764881329496</double>
                <double>2.4698281813043792</double>
                <double>1.2383961716086014</double>
                <double>0.49836009167083023</double>
              </oc>
            </SoilNitrogen>
            <SoilOrganicMatter>
              <Name>SoilOrganicMatter</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <RootCN>40</RootCN>
              <RootWt>0</RootWt>
              <SoilCN>12</SoilCN>
              <EnrACoeff>7.4</EnrACoeff>
              <EnrBCoeff>0.2</EnrBCoeff>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <Depth>
                <string>0-15</string>
                <string>15-30</string>
                <string>30-45</string>
                <string>45-60</string>
              </Depth>
              <OC>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </OC>
              <FBiom>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </FBiom>
              <FInert>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </FInert>
              <OCUnits>Total</OCUnits>
            </SoilOrganicMatter>
            <InitialWater>
              <Name>Initial water</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <PercentMethod>EvenlyDistributed</PercentMethod>
              <FractionFull>0.95</FractionFull>
              <DepthWetSoil>NaN</DepthWetSoil>
            </InitialWater>
            <Sample>
              <Name>Initial nitrogen</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <NO3>
                <double>15</double>
                <double>15</double>
                <double>15</double>
                <double>15</double>
              </NO3>
              <NH4>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </NH4>
              <NO3Units>ppm</NO3Units>
              <NH4Units>ppm</NH4Units>
              <SWUnits>Volumetric</SWUnits>
              <OCUnits>Total</OCUnits>
              <PHUnits>Water</PHUnits>
            </Sample>
            <CERESSoilTemperature>
              <Name>CERESSoilTemperature</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </CERESSoilTemperature>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <RecordNumber>0</RecordNumber>
            <SoilType />
            <LocalName>Stores lots of water</LocalName>
            <Site>Made up</Site>
            <NearestTown />
            <Region />
            <Country />
            <NaturalVegetation />
            <Latitude>0</Latitude>
            <Longitude>0</Longitude>
          </Soil>
          <SoluteManager>
            <Name>SoluteManager</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </SoluteManager>
          <PastureSpecies>
            <Name>Ryegrass</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <MaximumNUptake>10</MaximumNUptake>
            <Albedo>0.26</Albedo>
            <Gsmax>0.011</Gsmax>
            <R50>200</R50>
            <SpeciesFamily>Grass</SpeciesFamily>
            <PhotosyntheticPathway>C3</PhotosyntheticPathway>
            <InitialShootDM>2500</InitialShootDM>
            <InitialRootDM>500</InitialRootDM>
            <InitialRootDepth>600</InitialRootDepth>
            <ReferencePhotosyntheticRate>1</ReferencePhotosyntheticRate>
            <LightExtinctionCoefficient>0.5</LightExtinctionCoefficient>
            <GrowthTminimum>1</GrowthTminimum>
            <GrowthToptimum>20</GrowthToptimum>
            <GrowthTEffectExponent>1.7</GrowthTEffectExponent>
            <UseHeatStressFactor>yes</UseHeatStressFactor>
            <HeatOnsetTemperature>28</HeatOnsetTemperature>
            <HeatFullTemperature>35</HeatFullTemperature>
            <HeatRecoverySumDD>30</HeatRecoverySumDD>
            <HeatRecoveryTReference>25</HeatRecoveryTReference>
            <UseColdStressFactor>yes</UseColdStressFactor>
            <ColdOnsetTemperature>1</ColdOnsetTemperature>
            <ColdFullTemperature>-5</ColdFullTemperature>
            <ColdRecoverySumDD>25</ColdRecoverySumDD>
            <ColdRecoveryTReference>0</ColdRecoveryTReference>
            <MaintenanceRespirationCoefficient>0.03</MaintenanceRespirationCoefficient>
            <GrowthRespirationCoefficient>0.25</GrowthRespirationCoefficient>
            <RespirationTReference>20</RespirationTReference>
            <RespirationExponent>1.5</RespirationExponent>
            <NThresholdsForLeaves>
              <double>0.04</double>
              <double>0.012</double>
              <double>0.05</double>
            </NThresholdsForLeaves>
            <NThresholdsForStems>
              <double>0.02</double>
              <double>0.006</double>
              <double>0.025</double>
            </NThresholdsForStems>
            <NThresholdsForStolons>
              <double>0</double>
              <double>0</double>
              <double>0</double>
            </NThresholdsForStolons>
            <NThresholdsForRoots>
              <double>0.02</double>
              <double>0.006</double>
              <double>0.025</double>
            </NThresholdsForRoots>
            <DegreesDayForGermination>125</DegreesDayForGermination>
            <TargetShootRootRatio>4</TargetShootRootRatio>
            <MaxRootAllocation>0.25</MaxRootAllocation>
            <ShootRootGlfFactor>0.5</ShootRootGlfFactor>
            <UseReproSeasonFactor>yes</UseReproSeasonFactor>
            <ReproSeasonReferenceLatitude>41</ReproSeasonReferenceLatitude>
            <ReproSeasonTimingCoeff>0.14</ReproSeasonTimingCoeff>
            <ReproSeasonMaxAllocationIncrease>0.5</ReproSeasonMaxAllocationIncrease>
            <ReproSeasonAllocationCoeff>0.1</ReproSeasonAllocationCoeff>
            <FractionLeafMaximum>0.7</FractionLeafMaximum>
            <FractionLeafMinimum>0.7</FractionLeafMinimum>
            <FractionLeafDMThreshold>500</FractionLeafDMThreshold>
            <FractionLeafDMFactor>2000</FractionLeafDMFactor>
            <FractionLeafExponent>3</FractionLeafExponent>
            <FractionToStolon>0</FractionToStolon>
            <SpecificLeafArea>25</SpecificLeafArea>
            <SpecificRootLength>100</SpecificRootLength>
            <StolonEffectOnLAI>0</StolonEffectOnLAI>
            <ShootMaxEffectOnLAI>1000</ShootMaxEffectOnLAI>
            <MaxStemEffectOnLAI>1</MaxStemEffectOnLAI>
            <LiveLeavesPerTiller>3</LiveLeavesPerTiller>
            <TissueTurnoverRateShoot>0.05</TissueTurnoverRateShoot>
            <TissueTurnoverRateRoot>0.02</TissueTurnoverRateRoot>
            <DetachmentRateShoot>0.08</DetachmentRateShoot>
            <TurnoverTemperatureMin>2</TurnoverTemperatureMin>
            <TurnoverTemperatureRef>20</TurnoverTemperatureRef>
            <TurnoverTemperatureExponent>1</TurnoverTemperatureExponent>
            <TurnoverDroughtEffectMax>1</TurnoverDroughtEffectMax>
            <TurnoverDroughtThreshold>0.5</TurnoverDroughtThreshold>
            <TurnoverDefoliationCoefficient>0.5</TurnoverDefoliationCoefficient>
            <TurnoverDefoliationRootEffect>0.1</TurnoverDefoliationRootEffect>
            <FractionNLuxuryRemobilisable>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.1</double>
            </FractionNLuxuryRemobilisable>
            <MinimumNFixation>0</MinimumNFixation>
            <MaximumNFixation>0</MaximumNFixation>
            <SoilSaturationEffectMax>0.1</SoilSaturationEffectMax>
            <MinimumWaterFreePorosity>-1</MinimumWaterFreePorosity>
            <SoilSaturationRecoveryFactor>0.25</SoilSaturationRecoveryFactor>
            <NDillutionCoefficient>0.25</NDillutionCoefficient>
            <GlfGeneric>1</GlfGeneric>
            <GlfSoilFertility>1</GlfSoilFertility>
            <PlantHeightMinimum>25</PlantHeightMinimum>
            <PlantHeightMaximum>600</PlantHeightMaximum>
            <PlantHeightMassForMax>10000</PlantHeightMassForMax>
            <PlantHeightExponent>2.8</PlantHeightExponent>
            <RootDepthMinimum>50</RootDepthMinimum>
            <RootDepthMaximum>750</RootDepthMaximum>
            <RootElongationRate>25</RootElongationRate>
            <RootDistributionDepthParam>90</RootDistributionDepthParam>
            <RootDistributionExponent>3.2</RootDistributionExponent>
            <DigestibilitiesCellWall>
              <double>0.6</double>
              <double>0.6</double>
              <double>0.6</double>
              <double>0.2</double>
            </DigestibilitiesCellWall>
            <MinimumGreenWt>100</MinimumGreenWt>
            <FractionStolonStanding>0</FractionStolonStanding>
            <PreferenceForGreenOverDead>1</PreferenceForGreenOverDead>
            <PreferenceForLeafOverStems>1</PreferenceForLeafOverStems>
            <WaterAvailableMethod>DefaultAPSIM</WaterAvailableMethod>
            <NitrogenAvailableMethod>BasicAgPasture</NitrogenAvailableMethod>
          </PastureSpecies>
          <Report>
            <Name>ThreeZoneSimulationInitialNonuniformSoilN</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <ExperimentFactorNames />
            <ExperimentFactorValues />
            <VariableNames>
              <string>[Clock].Today as Date</string>
              <string>[Ryegrass].AboveGroundWt as PlantMass</string>
              <string>[Ryegrass].HarvestedWt as Harvested</string>
              <string>[Ryegrass].WaterDemand as SW_Demand</string>
              <string>sum([Ryegrass].WaterUptake) as SW_Uptake</string>
              <string>[Ryegrass].GlfWaterSupply as glfWater</string>
              <string>[Ryegrass].GlfNSupply as glfNitrogen</string>
              <string>sum([Soil].SoilWater.SWmm) as SoilWater</string>
              <string>sum([Soil].SoilNitrogen.NH4)+sum([Soil].SoilNitrogen.NO3) as SoilNitrogen</string>
              <string>[Irrigation].IrrigationApplied as Irrigation</string>
              <string>[Fertiliser].NitrogenApplied as Fertiliser</string>
            </VariableNames>
            <EventNames>
              <string>[Clock].EndOfDay</string>
            </EventNames>
          </Report>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Area>1</Area>
          <Slope>0</Slope>
        </Zone>
        <Zone>
          <Name>Zone1</Name>
          <Folder>
            <Name>Managers</Name>
            <Manager>
              <Name>DoRootsThreeZone</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <RootDepth>600</RootDepth>
                <RootMass>500</RootMass>
                <Zone0Name>Zone0</Zone0Name>
                <Zone0Prop>0.3</Zone0Prop>
                <Zone2Name>Zone2</Zone2Name>
                <Zone2Prop>0.3</Zone2Prop>
              </Script>
              <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Root depth in the plant's zone (mm): ")]  public double RootDepth { get; set; }
		[Description("Root mass  in the plant's zone (mm): ")]  public double RootMass { get; set; }

		[Description("Name of zone ot the left: ")] public string Zone0Name { get; set; }
		[Description("Proportionate depth and mass in zone to the left (-): ")]  public double Zone0Prop { get; set; }

		[Description("Name of zone ot the right: ")] public string Zone2Name { get; set; }
		[Description("Proportionate depth and mass in zone to the right (-): ")]  public double Zone2Prop { get; set; }

		// - Outputs from this manager

		// - Internal variables

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			int SpeciesNum = 0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				SpeciesNum += 1;
				if (SpeciesNum == 1)
				{
					if (Zone0Prop > 0)
						species.AddZone(zoneName: Zone0Name, rootDepth: Zone0Prop * RootDepth, rootDM: Zone0Prop * RootMass, specificRootLength: 100);
					if (Zone2Prop > 0)
						species.AddZone(zoneName: Zone2Name, rootDepth: Zone2Prop * RootDepth, rootDM: Zone2Prop * RootMass, specificRootLength: 100);
				}
			}

			//Pasture[1].AddZone(zoneName: "Zone1", rootDepth: 100, rootDM: 1000, specificRootLength: 100);
			//Pasture[1].AddZone(zoneName: "Zone2", rootDepth: 50, rootDM: 500, specificRootLength: 100);
		}
	}
}]]></Code>
            </Manager>
            <Manager>
              <Name>CutRotationSingle</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <CutRotationStartDate>1900-07-01</CutRotationStartDate>
                <CutRotationEndDate>2100-12-31</CutRotationEndDate>
                <CutInterval>1</CutInterval>
                <IntervalType>FixedInterval</IntervalType>
                <DurationOfCut>1</DurationOfCut>
                <RemoveAmountType>ResidualDM</RemoveAmountType>
                <AmountGiven>2250</AmountGiven>
                <DMRemoveType>RemoveAll</DMRemoveType>
                <FractionN2Remove>1</FractionN2Remove>
                <ProportionN2Dung>0</ProportionN2Dung>
              </Script>
              <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Date to begin the rotation: ")]
		public DateTime CutRotationStartDate { get; set; }

		[Description("Date to finish the rotation: ")]
		public DateTime CutRotationEndDate { get; set; }

		[Description("Rotation interval (days): ")]
		public int CutInterval { get; set; }

		[Description("How the interval is defined: ")]
		public rotationIntervalTypes IntervalType { get; set; }

		[Description("Duration of each event (days): ")]
		public int DurationOfCut { get; set; }

		[Description("What amount is being defined: ")]
		public removeAmountTypes RemoveAmountType { get; set; }

		[Description("Amount to use (kg/ha): ")]
		public double AmountGiven { get; set; }

		[Description("Fraction of DM that is removed from the field:")]
		public removeDMTypes DMRemoveType { get; set; }

		[Description("Fraction of N that is removed from the field (0-1):")]
		public double FractionN2Remove { get; set; }

		[Description("Proportion of N returned in dung (0-1):")]
		public double ProportionN2Dung { get; set; }

		// - Outputs from this manager
		[XmlIgnore][Units("g/m2")]// Description: Pasture DM defoliated today
		public double DefoliatedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture N defoliate today
		public double DefoliatedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture DM harvested today
		public double HarvestedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture N harvested today
		public double HarvestedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture DM removed from the field
		public double RemovedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture N removed from the field
		public double RemovedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Residue DM returned to the field
		public double ReturnedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Residue N returned to the field
		public double ReturnedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Harvested N returned as dung (SurfaceOM)
		public double NReturnedInDung { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Harvested N returned as urine (urea)
		public double NReturnedInUrine { get; set; }
		[XmlIgnore][Units("day")]// Description: Number of days after last defoliation
		public int DaysAfterCut { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Total standing DM (Leaf + Stem/Sheath) before cut
		public double PreHarvestDM { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Total standing DM (Leaf + Stem/Sheath) after cut
		public double PostHarvestDM { get; set; }
		
		// - Internal variables
		// fraction of harvested Dm to actually remove from field
		private double fractionDM2Remove = 1.0;
		// flag whether defoliation is allowed
		private bool rotationAllowed = true;
		// number of days for each defoliation event
		private int cuttingDuration = 0;
		// counter for day within each defoliation
		private int daysCutting = 0;
		// type of interval (Fixed or target)
		private string intervalType;
		// total herbage to remove in g/m2 per day
		private double herbageToRemove;
		// type of DM amount (ResidualDM or DMToRemove)
		private string amountType;
		// auxiliary flag for defoliation
		private bool aCutHasHappened = false;

		// - Event to add residue or dung to surface OM
		public event BiomassRemovedDelegate BiomassRemoved;

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				Pasture.Add(species);
			}

			// reset variables
			DaysAfterCut = 0;
			resetVariables();
			cuttingDuration = DurationOfCut;
			
			// get the type of amount given
			if (RemoveAmountType == removeAmountTypes.ResidualDM)
				amountType = "SetResidueAmount";
			else
				amountType = "SetRemoveAmount";

			// get the type of amount given
			if (IntervalType == rotationIntervalTypes.FixedInterval)
				intervalType = "Fixed";
			else
				intervalType = "Target";

			// make sure that rotation start when startDate < simulationStartDay
			if ((Clock.Today > CutRotationStartDate) && (Clock.Today < CutRotationEndDate))
				CutRotationStartDate = Clock.Today;
		}
		
		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			if (rotationAllowed)
			{
				if (Clock.Today == CutRotationStartDate)
					DaysAfterCut = CutInterval;

				// Check whether we can defoliate
				if ((Clock.Today >= CutRotationStartDate) && (Clock.Today <= CutRotationEndDate) && (Pasture[0].IsAlive))
				{
					// Check whether we should start a defoliation
					if (DaysAfterCut >= (CutInterval - 1))
					{
						Graze(AmountGiven, amountType, DurationOfCut);
					}
				}
			}

			// Check whether we need to continue cutting
			if ((daysCutting > 0) && (daysCutting < cuttingDuration))
			{
				// reset outputs
				resetVariables();

				removeDM(herbageToRemove);
				returnExcreta();
				daysCutting += 1;
				if (daysCutting == cuttingDuration)
					PostHarvestDM = Pasture[0].StandingHerbageWt; //+ Pasture[1].StandingHerbageWt
			}

			// reset outputs
			if (daysCutting < 0)
			{
				resetVariables();
				daysCutting = 0;
			}
		}

		[EventSubscribe("DoManagementCalculations")]
		private void OnDoManagementCalculations(object sender, EventArgs e)
		{
			// Check whether a cutting has finished
			if (daysCutting == cuttingDuration)
			{
				aCutHasHappened = true;
				daysCutting = -1;
			}

			// Increase the counter for days after cutting
			if (aCutHasHappened && (daysCutting == 0))
				DaysAfterCut += 1;
		}

		public enum removeAmountTypes
		{
			/// <summary>Setting DM amount to remove</summary>
			DMToRemove,
			/// <summary>Setting residual DM amount</summary>
			ResidualDM
		}

		public enum rotationIntervalTypes
		{
			/// <summary>Setting a fixed interval</summary>
			FixedInterval,
			/// <summary>Setting a target (minimum) inteval</summary>
			TargetInterval
		}

		public enum removeDMTypes
		{
			/// <summary>Remove all DM</summary>
			RemoveAll,
			/// <summary>Remove no DM</summary>
			RemoveNone,
			/// <summary>Remove a fraction based on digestibility</summary>
			BasedOnDigestibility
		}

		// Resets the values of all outputs
		private void resetVariables()
		{
			DefoliatedWt = 0.0;
			DefoliatedN = 0.0;
			HarvestedWt = 0.0;
			HarvestedN = 0.0;
			RemovedWt = 0.0;
			RemovedN = 0.0;
			ReturnedWt = 0.0;
			ReturnedN = 0.0;
			NReturnedInDung = 0.0;
			NReturnedInUrine = 0.0;
		}

		// Description: Perform the basic calculations for defoliation
		public void Graze(double amountDM, string amountType, int duration)
		{
			// Get the existing plant amount
			PreHarvestDM = Pasture[0].StandingHerbageWt;  //+ Pasture[1].StandingHerbageWt
			
			// Check the amount to remove and print some info
			if ((amountType == "SetRemoveAmount") && (PreHarvestDM >= amountDM / duration))
			{
				summary.WriteMessage(this, "   Defoliating " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = amountDM / duration;
			}
			else if ((amountType == "SetResidueAmount") && (PreHarvestDM >= amountDM))
			{
				summary.WriteMessage(this, "   Defoliating down to approximately " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = (PreHarvestDM - amountDM) / duration;
			}
			else
			{
				summary.WriteMessage(this, "   Defoliation will not happend because there is not enough plant material");
				if (intervalType == "Fixed")
					DaysAfterCut = -duration;
				return;
			}

			cuttingDuration = duration;
			// Preform first defoliation
			removeDM(herbageToRemove);
			returnExcreta();
			daysCutting = 1;
			DaysAfterCut = 0;
			if (daysCutting == cuttingDuration)
				PostHarvestDM = Pasture[0].StandingHerbageWt;  //+ Pasture[1].StandingHerbageWt
		}

		// Do the DM removal
		private void removeDM(double removeAmount)
		{
			double existingWt = Pasture[0].HarvestableWt;  // + Pasture[1].HarvestableWt

			// Check whether we harvest anything
			if (existingWt >= removeAmount)
			{
				foreach (AgPasture.PastureSpecies species in Pasture)
				{
					double amountToRemove = removeAmount * species.HarvestableWt / existingWt;
					species.Graze(amount: amountToRemove, type: "SetRemoveAmount");
				}
				
				// get total harvested
				DefoliatedWt = Pasture[0].HarvestedWt;  // + Pasture[1].HarvestedWt
				DefoliatedN = Pasture[0].HarvestedN;  //+ Pasture[1].HarvestedN
				HarvestedWt = DefoliatedWt;
				HarvestedN = DefoliatedN;

				// get amounts actually removed from field and that to be returned (dung/urine)
				if (DMRemoveType == removeDMTypes.RemoveAll)
					fractionDM2Remove = 1.0;
				else if (DMRemoveType == removeDMTypes.RemoveNone)
					fractionDM2Remove = 0.0;
				else
				{
					fractionDM2Remove = Pasture[0].HarvestedDigestibility * Pasture[0].HarvestedWt;  //+ Pasture[1].HarvestedDigestibility * Pasture[1].HarvestedWt
					fractionDM2Remove /= removeAmount;
				}
				
				RemovedWt = HarvestedWt * fractionDM2Remove;
				RemovedN = HarvestedN * FractionN2Remove;
				ReturnedWt = HarvestedWt - RemovedWt;
				ReturnedN = HarvestedN - RemovedN;
				NReturnedInDung = ReturnedN * ProportionN2Dung;
				NReturnedInUrine = ReturnedN - NReturnedInDung;
			}
		}

		// Return dung and urine
		private void returnExcreta()
		{
			if ((ReturnedWt > 0.0) || (NReturnedInDung > 0.0))
			{
				PMF.BiomassRemovedType BiomassDung = new PMF.BiomassRemovedType();
				string[] type = new string[] { "RuminantDung_PastureFed" };
				float[] dltdm = new float[] { (Single)ReturnedWt };
				float[] dltn = new float[] { (Single)NReturnedInDung };
				float[] dltp = new float[] { 0 };
				float[] fraction = new float[] { 1 };     // fraction is always 1.0 here

				BiomassDung.crop_type = "RuminantDung_PastureFed";
				BiomassDung.dm_type = type;
				BiomassDung.dlt_crop_dm = dltdm;
				BiomassDung.dlt_dm_n = dltn;
				BiomassDung.dlt_dm_p = dltp;
				BiomassDung.fraction_to_residue = fraction;
				BiomassRemoved.Invoke(BiomassDung);
			}

			if (NReturnedInUrine > 0.0)
			{
				fertiliser.Apply(NReturnedInUrine * 10, Fertiliser.Types.UreaN, 1.0);
			}
		}
	}
}
]]></Code>
            </Manager>
            <Manager>
              <Name>AutomaticFertiliser</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <AllowFertiliser>no</AllowFertiliser>
                <Depth2SoilN>500</Depth2SoilN>
                <CriticalSoilN>50</CriticalSoilN>
                <FertNAmount>25</FertNAmount>
                <FertType>UreaN</FertType>
                <FertApplicationDepth>1</FertApplicationDepth>
                <FertMinimumDays>1</FertMinimumDays>
              </Script>
              <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using APSIM.Shared.Utilities;
using System.Xml.Serialization;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		[Link] Soil Soil;

		//User inputs from properties tab
		[Description("Turn ferliser applications on? ")]
		public yesnoType AllowFertiliser { get; set; }
		
		[Description("Depth to calculate available soil N (mm): ")]
		public double Depth2SoilN { get; set; }

		[Description("Minimum available N, triggers an application (kgN/ha): ")]
		public double CriticalSoilN { get; set; }

		[Description("Amount of N fertiliser for each application (kgN/ha): ")]
		public double FertNAmount { get; set; }

		[Description("Type of N fertiliser to apply: ")]
		public Fertiliser.Types FertType { get; set; }

		[Description("Depth at which to apply the fertiliser (mm): ")]
		public double FertApplicationDepth { get; set; }
	   
		[Description("Minimum period between applications (days): ")]
		public double FertMinimumDays { get; set; }
	   
		public enum yesnoType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		[XmlIgnore] public double TopMineralN { get; set; }
		
		private DateTime lastApplicationDate;
		private bool fertiliserIsAllowed;
		private int nLayers;

		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{
			fertiliserIsAllowed = (AllowFertiliser == yesnoType.yes);
			nLayers = Soil.SoilWater.Thickness.Length;
		}

		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			double daysSinceLastApplication = (Clock.Today - lastApplicationDate).TotalDays;
			
			// get the N stored in the soil
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopMineralN = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (Depth2SoilN - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopMineralN += (Soil.SoilNitrogen.NO3[layer]
				+ Soil.SoilNitrogen.NH4[layer]
				+ Soil.SoilNitrogen.urea[layer])
				* fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= Depth2SoilN)
					layer = nLayers;
			}

			if (fertiliserIsAllowed && (daysSinceLastApplication >= FertMinimumDays) && (TopMineralN <= CriticalSoilN))
			{
				fertiliser.Apply(FertNAmount, FertType, FertApplicationDepth);
				lastApplicationDate = Clock.Today;
			}
		}
	}
}
]]></Code>
            </Manager>
            <Manager>
              <Name>AutomaticIrrigation</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <allowIrrigation>yes</allowIrrigation>
                <allowIrrigationAll>yes</allowIrrigationAll>
                <seasonStart>15-Aug</seasonStart>
                <seasonEnd>30-May</seasonEnd>
                <seasonsAllocation>10000</seasonsAllocation>
                <triggerDeficit>99</triggerDeficit>
                <targetDeficit>100</targetDeficit>
                <returndays>1</returndays>
                <maximumAmount>5</maximumAmount>
                <depthPAWC>600</depthPAWC>
              </Script>
              <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using System.Xml.Serialization;
using Models.PMF;
using APSIM.Shared.Utilities;

        
namespace Models
{
	[Serializable] 
	[System.Xml.Serialization.XmlInclude(typeof(Model))]
	public class Script : Model
	{
		//Communication to other modules
		[Link] ISummary summary = null;
		[Link] Irrigation Irrigation;
		[Link] Clock Clock;
		[Link] Soil Soil;
		[Link(IsOptional = true)] ICrop existingCrop;
	   
		//User inputs from properties tab
		[Description("Turn irrigation on?")] public answerType allowIrrigation { get; set; }
		[Description("Irrigate regardless of crop state?")] public answerType allowIrrigationAll { get; set; }
		[Description("Start of irrigation season (dd-MMM)")]
		public string seasonStart { get; set; }
		[Description("End of irrigation season (dd-MMM)")]
		public string seasonEnd { get; set; }
		[Description("Season allocation (mm)")]
		public double seasonsAllocation { get; set; }
		[Description("Deficit to trigger irrigation (% PAWC)")]
		public double triggerDeficit { get; set; }
		[Description("Deficit to stop irrigaton (% PAWC)")]
		public double targetDeficit { get; set; }
		[Description("Minimum days for irrigation to return")]
		public double returndays { get; set; }
		[Description("Maximum irrigation application (mm/day)")]
		public double maximumAmount { get; set; }
		[Description("Depth to calculate PAWC (mm)")]
		public double depthPAWC { get; set; }
	   
		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		//Class members
		[XmlIgnore] public double TopSWdeficit { get; set; }
		[XmlIgnore] public double TopSWC { get; set; }
		[XmlIgnore] public double DaysSinceIrrigation { get; set; }
		[XmlIgnore] public double AmountToApply { get; set; }
		[XmlIgnore] public double SeasonAppliedAmount { get; set; }
		
		private bool IrrigationIsAllowed { get; set; }
		private bool IrrigationIsAlwaysAllowed { get; set; }
		
		private bool SeasonIsOpen { get; set; }
		private bool CropIsActive { get; set; }
		private bool IrrigatorIsAvailable { get; set; }
		private bool SoilIsDry { get; set; }

		private DateTime StartDate;
		private DateTime EndDate;
		private double TopDUL;
		private double TopLL;
		private int nLayers;
	
		//Calculate static soil variables
		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{   
			//Set the season dates
			StartDate = DateTime.Parse(seasonStart + "-" + Clock.Today.Year.ToString());
			EndDate = DateTime.Parse(seasonEnd + "-" + Clock.Today.Year.ToString());
			
			//Can we irrigate at all?
			IrrigationIsAllowed = false; 
			if (allowIrrigation == answerType.yes)
				IrrigationIsAllowed = true; 
			if (allowIrrigationAll == answerType.yes)
				IrrigationIsAlwaysAllowed = true; 





			//Calculate soil water variables
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			nLayers = Soil.SoilWater.Thickness.Length;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopLL += Soil.SoilWater.LL15mm[layer] * fracLayer;
				TopDUL += Soil.SoilWater.DULmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
		}
	   	  
		//Determine daily requirement for irrigation
		[EventSubscribe("StartOfDay")]
		private void OnStartOfDay(object sender, EventArgs e)
		{
			//Can we irrigate today?		  
			SeasonIsOpen = isBetween(Clock.Today, StartDate, EndDate);

			//Is there a crop in the ground that needs irrigation?
			CropIsActive = false;
			if (IrrigationIsAlwaysAllowed)
				CropIsActive = true;  // might not be but we don't care
			else if ((existingCrop != null) && (existingCrop.IsAlive))
				CropIsActive = true;
			//if ((existingCrop.Phenology.Stage >= 3.0) && (existingCrop.Phenology.Stage < 6.0))
	      
			//Is the irrigator available?
			IrrigatorIsAvailable = false;
			DaysSinceIrrigation += 1;
			if (DaysSinceIrrigation >= returndays)
				IrrigatorIsAvailable = true;
	      
			//Is the soil dry enough to require irrigation?
			SoilIsDry = false;
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopSWC = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			//for (int layer = 0; depthFromSurface < depthPAWC + Soil.SoilWater.Thickness[layer]; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopSWC += Soil.SoilWater.SWmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
			
			TopSWdeficit = TopSWC - TopDUL;
			if (Math.Max(0.0, -TopSWdeficit) >= (TopDUL - TopLL) * (100 - triggerDeficit) / 100)
				SoilIsDry = true;
	            
			//Are all the conditions ratifying irrigation
			if (IrrigationIsAllowed && SeasonIsOpen && CropIsActive && IrrigatorIsAvailable && SoilIsDry)
			{
				//Lets bloody well irrigate then!!!!
				AmountToApply = TopDUL * targetDeficit / 100 - TopSWC;
				AmountToApply = Math.Max(0.0, Math.Min(AmountToApply, seasonsAllocation - SeasonAppliedAmount));
				Irrigation.Apply(AmountToApply);
				DaysSinceIrrigation = 0;
				SeasonAppliedAmount += AmountToApply;
			}
		}
		
		///Checks whether theDate is between iniDate and endDate (non-year specific)
		private bool isBetween(DateTime theDay, DateTime iniDate, DateTime endDate)
		{
			bool result = false;
			if (iniDate.DayOfYear < endDate.DayOfYear)
			{
				// period is within one year, ex: summer in the northern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) && (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			else
			{
				// period goes over the end of the year, ex: summer in the southern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) || (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			
			return result;
		}
	}
}
]]></Code>
            </Manager>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <ShowPageOfGraphs>true</ShowPageOfGraphs>
          </Folder>
          <MicroClimate>
            <Name>MicroClimate</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <a_interception>0</a_interception>
            <b_interception>1</b_interception>
            <c_interception>0</c_interception>
            <d_interception>0</d_interception>
            <soil_albedo>0.23</soil_albedo>
            <sun_angle>15</sun_angle>
            <soil_heat_flux_fraction>0.4</soil_heat_flux_fraction>
            <night_interception_fraction>0.5</night_interception_fraction>
            <refheight>2</refheight>
            <albedo>0.15</albedo>
            <emissivity>0.96</emissivity>
            <RadIntTotal>0</RadIntTotal>
          </MicroClimate>
          <Irrigation>
            <Name>Irrigation</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </Irrigation>
          <Fertiliser>
            <Name>Fertiliser</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </Fertiliser>
          <SurfaceOrganicMatter>
            <Name>SurfaceOrganicMatter</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <PondActive>no</PondActive>
            <ReportAdditions>no</ReportAdditions>
            <ReportRemovals>no</ReportRemovals>
            <ResidueTypes>
              <Name>ResidueTypes</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <LoadFromResource>ResidueTypes</LoadFromResource>
            </ResidueTypes>
            <TillageTypes>
              <Name>TillageTypesList</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <TillageType />
            </TillageTypes>
            <Pools>
              <Pool>
                <PoolName>Sward</PoolName>
                <ResidueType>grass</ResidueType>
                <Mass>0</Mass>
                <CNRatio>15</CNRatio>
                <CPRatio>NaN</CPRatio>
                <StandingFraction>0</StandingFraction>
              </Pool>
            </Pools>
            <PoolName>Sward</PoolName>
            <type>grass</type>
            <mass>0</mass>
            <standing_fraction>0</standing_fraction>
            <cpr />
            <cnr>15</cnr>
            <CriticalResidueWeight>2000</CriticalResidueWeight>
            <OptimumDecompTemp>20</OptimumDecompTemp>
            <MaxCumulativeEOS>20</MaxCumulativeEOS>
            <CNRatioDecompCoeff>0.277</CNRatioDecompCoeff>
            <CNRatioDecompThreshold>25</CNRatioDecompThreshold>
            <TotalLeachRain>25</TotalLeachRain>
            <MinRainToLeach>10</MinRainToLeach>
            <CriticalMinimumOrganicC>0.004</CriticalMinimumOrganicC>
            <DefaultCPRatio>0</DefaultCPRatio>
            <DefaultStandingFraction>0</DefaultStandingFraction>
            <StandingExtinctCoeff>0.5</StandingExtinctCoeff>
            <FractionFaecesAdded>0.5</FractionFaecesAdded>
          </SurfaceOrganicMatter>
          <Soil>
            <Name>Soil</Name>
            <Analysis>
              <Name>Analysis</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <Rocks>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </Rocks>
              <Texture />
              <MunsellColour />
              <PH>
                <double>6</double>
                <double>6</double>
                <double>6</double>
                <double>6</double>
              </PH>
              <CEC>
                <double>10</double>
                <double>10</double>
                <double>10</double>
                <double>10</double>
              </CEC>
              <ParticleSizeSand>
                <double>10</double>
                <double>10</double>
                <double>10</double>
                <double>10</double>
              </ParticleSizeSand>
              <ParticleSizeSilt>
                <double>30</double>
                <double>30</double>
                <double>30</double>
                <double>30</double>
              </ParticleSizeSilt>
              <ParticleSizeClay>
                <double>60</double>
                <double>60</double>
                <double>60</double>
                <double>60</double>
              </ParticleSizeClay>
              <PHUnits>Water</PHUnits>
              <BoronUnits>HotWater</BoronUnits>
            </Analysis>
            <Water>
              <Name>Water</Name>
              <SoilCrop>
                <Name>RyegrassSoil</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LL>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </LL>
                <KL>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                </KL>
                <XF>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                </XF>
              </SoilCrop>
              <SoilCrop>
                <Name>WhiteCloverSoil</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LL>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </LL>
                <KL>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                </KL>
                <XF>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                </XF>
              </SoilCrop>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <BD>
                <double>1.3</double>
                <double>1.3</double>
                <double>1.3</double>
                <double>1.3</double>
              </BD>
              <AirDry>
                <double>0.05</double>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </AirDry>
              <LL15>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </LL15>
              <DUL>
                <double>0.45</double>
                <double>0.45</double>
                <double>0.45</double>
                <double>0.45</double>
              </DUL>
              <SAT>
                <double>0.5</double>
                <double>0.5</double>
                <double>0.5</double>
                <double>0.5</double>
              </SAT>
              <KS>
                <double>500</double>
                <double>500</double>
                <double>500</double>
                <double>500</double>
              </KS>
            </Water>
            <SoilWater>
              <Name>SoilWater</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <SummerDate>1-Nov</SummerDate>
              <SummerU>6</SummerU>
              <SummerCona>3.5</SummerCona>
              <WinterDate>1-apr</WinterDate>
              <WinterU>6</WinterU>
              <WinterCona>3.5</WinterCona>
              <DiffusConst>88</DiffusConst>
              <DiffusSlope>35</DiffusSlope>
              <Salb>0.13</Salb>
              <CN2Bare>73</CN2Bare>
              <CNRed>20</CNRed>
              <CNCov>0.8</CNCov>
              <slope>0</slope>
              <discharge_width>0</discharge_width>
              <catchment_area>0</catchment_area>
              <max_pond>0</max_pond>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <SWCON>
                <double>0.3</double>
                <double>0.3</double>
                <double>0.3</double>
                <double>0.3</double>
              </SWCON>
              <KLAT>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </KLAT>
              <residueinterception>0</residueinterception>
            </SoilWater>
            <SoilNitrogen>
              <Name>SoilNitrogen</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <fom_type>
                <string>default</string>
                <string>manure</string>
                <string>mucuna</string>
                <string>lablab</string>
                <string>shemp</string>
                <string>stable</string>
              </fom_type>
              <fract_carb>
                <double>0.2</double>
                <double>0.3</double>
                <double>0.54</double>
                <double>0.57</double>
                <double>0.45</double>
                <double>0</double>
              </fract_carb>
              <fract_cell>
                <double>0.7</double>
                <double>0.3</double>
                <double>0.37</double>
                <double>0.37</double>
                <double>0.47</double>
                <double>0.1</double>
              </fract_cell>
              <fract_lign>
                <double>0.1</double>
                <double>0.4</double>
                <double>0.09</double>
                <double>0.06</double>
                <double>0.08</double>
                <double>0.9</double>
              </fract_lign>
              <wfpsN2N2O_x>
                <double>22</double>
                <double>88</double>
              </wfpsN2N2O_x>
              <wfpsN2N2O_y>
                <double>0.1</double>
                <double>1</double>
              </wfpsN2N2O_y>
              <oc>
                <double>3.7136764881329496</double>
                <double>2.4698281813043792</double>
                <double>1.2383961716086014</double>
                <double>0.49836009167083023</double>
              </oc>
            </SoilNitrogen>
            <SoilOrganicMatter>
              <Name>SoilOrganicMatter</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <RootCN>40</RootCN>
              <RootWt>0</RootWt>
              <SoilCN>12</SoilCN>
              <EnrACoeff>7.4</EnrACoeff>
              <EnrBCoeff>0.2</EnrBCoeff>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <Depth>
                <string>0-15</string>
                <string>15-30</string>
                <string>30-45</string>
                <string>45-60</string>
              </Depth>
              <OC>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </OC>
              <FBiom>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </FBiom>
              <FInert>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </FInert>
              <OCUnits>Total</OCUnits>
            </SoilOrganicMatter>
            <InitialWater>
              <Name>Initial water</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <PercentMethod>EvenlyDistributed</PercentMethod>
              <FractionFull>0.95</FractionFull>
              <DepthWetSoil>NaN</DepthWetSoil>
            </InitialWater>
            <Sample>
              <Name>Initial nitrogen</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <NO3>
                <double>5</double>
                <double>5</double>
                <double>5</double>
                <double>5</double>
              </NO3>
              <NH4>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </NH4>
              <NO3Units>ppm</NO3Units>
              <NH4Units>ppm</NH4Units>
              <SWUnits>Volumetric</SWUnits>
              <OCUnits>Total</OCUnits>
              <PHUnits>Water</PHUnits>
            </Sample>
            <CERESSoilTemperature>
              <Name>CERESSoilTemperature</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </CERESSoilTemperature>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <RecordNumber>0</RecordNumber>
            <SoilType />
            <LocalName>Stores lots of water</LocalName>
            <Site>Made up</Site>
            <NearestTown />
            <Region />
            <Country />
            <NaturalVegetation />
            <Latitude>0</Latitude>
            <Longitude>0</Longitude>
          </Soil>
          <SoluteManager>
            <Name>SoluteManager</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </SoluteManager>
          <PastureSpecies>
            <Name>Ryegrass</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <MaximumNUptake>10</MaximumNUptake>
            <Albedo>0.26</Albedo>
            <Gsmax>0.011</Gsmax>
            <R50>200</R50>
            <SpeciesFamily>Grass</SpeciesFamily>
            <PhotosyntheticPathway>C3</PhotosyntheticPathway>
            <InitialShootDM>2500</InitialShootDM>
            <InitialRootDM>500</InitialRootDM>
            <InitialRootDepth>600</InitialRootDepth>
            <ReferencePhotosyntheticRate>1</ReferencePhotosyntheticRate>
            <LightExtinctionCoefficient>0.5</LightExtinctionCoefficient>
            <GrowthTminimum>1</GrowthTminimum>
            <GrowthToptimum>20</GrowthToptimum>
            <GrowthTEffectExponent>1.7</GrowthTEffectExponent>
            <UseHeatStressFactor>yes</UseHeatStressFactor>
            <HeatOnsetTemperature>28</HeatOnsetTemperature>
            <HeatFullTemperature>35</HeatFullTemperature>
            <HeatRecoverySumDD>30</HeatRecoverySumDD>
            <HeatRecoveryTReference>25</HeatRecoveryTReference>
            <UseColdStressFactor>yes</UseColdStressFactor>
            <ColdOnsetTemperature>1</ColdOnsetTemperature>
            <ColdFullTemperature>-5</ColdFullTemperature>
            <ColdRecoverySumDD>25</ColdRecoverySumDD>
            <ColdRecoveryTReference>0</ColdRecoveryTReference>
            <MaintenanceRespirationCoefficient>0.03</MaintenanceRespirationCoefficient>
            <GrowthRespirationCoefficient>0.25</GrowthRespirationCoefficient>
            <RespirationTReference>20</RespirationTReference>
            <RespirationExponent>1.5</RespirationExponent>
            <NThresholdsForLeaves>
              <double>0.04</double>
              <double>0.012</double>
              <double>0.05</double>
            </NThresholdsForLeaves>
            <NThresholdsForStems>
              <double>0.02</double>
              <double>0.006</double>
              <double>0.025</double>
            </NThresholdsForStems>
            <NThresholdsForStolons>
              <double>0</double>
              <double>0</double>
              <double>0</double>
            </NThresholdsForStolons>
            <NThresholdsForRoots>
              <double>0.02</double>
              <double>0.006</double>
              <double>0.025</double>
            </NThresholdsForRoots>
            <DegreesDayForGermination>125</DegreesDayForGermination>
            <TargetShootRootRatio>4</TargetShootRootRatio>
            <MaxRootAllocation>0.25</MaxRootAllocation>
            <ShootRootGlfFactor>0.5</ShootRootGlfFactor>
            <UseReproSeasonFactor>yes</UseReproSeasonFactor>
            <ReproSeasonReferenceLatitude>41</ReproSeasonReferenceLatitude>
            <ReproSeasonTimingCoeff>0.14</ReproSeasonTimingCoeff>
            <ReproSeasonMaxAllocationIncrease>0.5</ReproSeasonMaxAllocationIncrease>
            <ReproSeasonAllocationCoeff>0.1</ReproSeasonAllocationCoeff>
            <FractionLeafMaximum>0.7</FractionLeafMaximum>
            <FractionLeafMinimum>0.7</FractionLeafMinimum>
            <FractionLeafDMThreshold>500</FractionLeafDMThreshold>
            <FractionLeafDMFactor>2000</FractionLeafDMFactor>
            <FractionLeafExponent>3</FractionLeafExponent>
            <FractionToStolon>0</FractionToStolon>
            <SpecificLeafArea>25</SpecificLeafArea>
            <SpecificRootLength>100</SpecificRootLength>
            <StolonEffectOnLAI>0</StolonEffectOnLAI>
            <ShootMaxEffectOnLAI>1000</ShootMaxEffectOnLAI>
            <MaxStemEffectOnLAI>1</MaxStemEffectOnLAI>
            <LiveLeavesPerTiller>3</LiveLeavesPerTiller>
            <TissueTurnoverRateShoot>0.05</TissueTurnoverRateShoot>
            <TissueTurnoverRateRoot>0.02</TissueTurnoverRateRoot>
            <DetachmentRateShoot>0.08</DetachmentRateShoot>
            <TurnoverTemperatureMin>2</TurnoverTemperatureMin>
            <TurnoverTemperatureRef>20</TurnoverTemperatureRef>
            <TurnoverTemperatureExponent>1</TurnoverTemperatureExponent>
            <TurnoverDroughtEffectMax>1</TurnoverDroughtEffectMax>
            <TurnoverDroughtThreshold>0.5</TurnoverDroughtThreshold>
            <TurnoverDefoliationCoefficient>0.5</TurnoverDefoliationCoefficient>
            <TurnoverDefoliationRootEffect>0.1</TurnoverDefoliationRootEffect>
            <FractionNLuxuryRemobilisable>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.1</double>
            </FractionNLuxuryRemobilisable>
            <MinimumNFixation>0</MinimumNFixation>
            <MaximumNFixation>0</MaximumNFixation>
            <SoilSaturationEffectMax>0.1</SoilSaturationEffectMax>
            <MinimumWaterFreePorosity>-1</MinimumWaterFreePorosity>
            <SoilSaturationRecoveryFactor>0.25</SoilSaturationRecoveryFactor>
            <NDillutionCoefficient>0.25</NDillutionCoefficient>
            <GlfGeneric>1</GlfGeneric>
            <GlfSoilFertility>1</GlfSoilFertility>
            <PlantHeightMinimum>25</PlantHeightMinimum>
            <PlantHeightMaximum>600</PlantHeightMaximum>
            <PlantHeightMassForMax>10000</PlantHeightMassForMax>
            <PlantHeightExponent>2.8</PlantHeightExponent>
            <RootDepthMinimum>50</RootDepthMinimum>
            <RootDepthMaximum>750</RootDepthMaximum>
            <RootElongationRate>25</RootElongationRate>
            <RootDistributionDepthParam>90</RootDistributionDepthParam>
            <RootDistributionExponent>3.2</RootDistributionExponent>
            <DigestibilitiesCellWall>
              <double>0.6</double>
              <double>0.6</double>
              <double>0.6</double>
              <double>0.2</double>
            </DigestibilitiesCellWall>
            <MinimumGreenWt>100</MinimumGreenWt>
            <FractionStolonStanding>0</FractionStolonStanding>
            <PreferenceForGreenOverDead>1</PreferenceForGreenOverDead>
            <PreferenceForLeafOverStems>1</PreferenceForLeafOverStems>
            <WaterAvailableMethod>DefaultAPSIM</WaterAvailableMethod>
            <NitrogenAvailableMethod>BasicAgPasture</NitrogenAvailableMethod>
          </PastureSpecies>
          <Report>
            <Name>ThreeZoneSimulationInitialNonuniformSoilN</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <ExperimentFactorNames />
            <ExperimentFactorValues />
            <VariableNames>
              <string>[Clock].Today as Date</string>
              <string>[Ryegrass].AboveGroundWt as PlantMass</string>
              <string>[Ryegrass].HarvestedWt as Harvested</string>
              <string>[Ryegrass].WaterDemand as SW_Demand</string>
              <string>sum([Ryegrass].WaterUptake) as SW_Uptake</string>
              <string>[Ryegrass].GlfWaterSupply as glfWater</string>
              <string>[Ryegrass].GlfNSupply as glfNitrogen</string>
              <string>sum([Soil].SoilWater.SWmm) as SoilWater</string>
              <string>sum([Soil].SoilNitrogen.NH4)+sum([Soil].SoilNitrogen.NO3) as SoilNitrogen</string>
              <string>[Irrigation].IrrigationApplied as Irrigation</string>
              <string>[Fertiliser].NitrogenApplied as Fertiliser</string>
            </VariableNames>
            <EventNames>
              <string>[Clock].EndOfDay</string>
            </EventNames>
          </Report>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Area>1</Area>
          <Slope>0</Slope>
        </Zone>
        <Zone>
          <Name>Zone2</Name>
          <Folder>
            <Name>Managers</Name>
            <Manager>
              <Name>DoRootsThreeZone</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <RootDepth>600</RootDepth>
                <RootMass>500</RootMass>
                <Zone0Name>Zone1</Zone0Name>
                <Zone0Prop>0</Zone0Prop>
                <Zone2Name>Zone2</Zone2Name>
                <Zone2Prop>0</Zone2Prop>
              </Script>
              <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Root depth in the plant's zone (mm): ")]  public double RootDepth { get; set; }
		[Description("Root mass  in the plant's zone (mm): ")]  public double RootMass { get; set; }

		[Description("Name of zone ot the left: ")] public string Zone0Name { get; set; }
		[Description("Proportionate depth and mass in zone to the left (-): ")]  public double Zone0Prop { get; set; }

		[Description("Name of zone ot the right: ")] public string Zone2Name { get; set; }
		[Description("Proportionate depth and mass in zone to the right (-): ")]  public double Zone2Prop { get; set; }

		// - Outputs from this manager

		// - Internal variables

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			int SpeciesNum = 0;
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				SpeciesNum += 1;
				if (SpeciesNum == 1)
				{
					if (Zone0Prop > 0)
						species.AddZone(zoneName: Zone0Name, rootDepth: Zone0Prop * RootDepth, rootDM: Zone0Prop * RootMass, specificRootLength: 100);
					if (Zone2Prop > 0)
						species.AddZone(zoneName: Zone2Name, rootDepth: Zone2Prop * RootDepth, rootDM: Zone2Prop * RootMass, specificRootLength: 100);
				}
			}

			//Pasture[1].AddZone(zoneName: "Zone1", rootDepth: 100, rootDM: 1000, specificRootLength: 100);
			//Pasture[1].AddZone(zoneName: "Zone2", rootDepth: 50, rootDM: 500, specificRootLength: 100);
		}
	}
}]]></Code>
            </Manager>
            <Manager>
              <Name>CutRotationSingle</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <CutRotationStartDate>1900-07-01</CutRotationStartDate>
                <CutRotationEndDate>2100-12-31</CutRotationEndDate>
                <CutInterval>1</CutInterval>
                <IntervalType>FixedInterval</IntervalType>
                <DurationOfCut>1</DurationOfCut>
                <RemoveAmountType>ResidualDM</RemoveAmountType>
                <AmountGiven>2250</AmountGiven>
                <DMRemoveType>RemoveAll</DMRemoveType>
                <FractionN2Remove>1</FractionN2Remove>
                <ProportionN2Dung>0</ProportionN2Dung>
              </Script>
              <Code><![CDATA[// Defoliates AgPasture on a regular rotation or one-off via a schedule
// currenty defoliates the amount specified by spreading evenly over the specified period

using System;
using System.Collections.Generic;
using System.Xml.Serialization;
using Models.Core;
using Models.PMF;
using APSIM.Shared.Utilities;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		// - Links to APSIM models
		[Link] Zone myZone;
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		
		List<AgPasture.PastureSpecies> Pasture = new List<AgPasture.PastureSpecies>();
		
		// - Paramters for this manager
		[Description("Date to begin the rotation: ")]
		public DateTime CutRotationStartDate { get; set; }

		[Description("Date to finish the rotation: ")]
		public DateTime CutRotationEndDate { get; set; }

		[Description("Rotation interval (days): ")]
		public int CutInterval { get; set; }

		[Description("How the interval is defined: ")]
		public rotationIntervalTypes IntervalType { get; set; }

		[Description("Duration of each event (days): ")]
		public int DurationOfCut { get; set; }

		[Description("What amount is being defined: ")]
		public removeAmountTypes RemoveAmountType { get; set; }

		[Description("Amount to use (kg/ha): ")]
		public double AmountGiven { get; set; }

		[Description("Fraction of DM that is removed from the field:")]
		public removeDMTypes DMRemoveType { get; set; }

		[Description("Fraction of N that is removed from the field (0-1):")]
		public double FractionN2Remove { get; set; }

		[Description("Proportion of N returned in dung (0-1):")]
		public double ProportionN2Dung { get; set; }

		// - Outputs from this manager
		[XmlIgnore][Units("g/m2")]// Description: Pasture DM defoliated today
		public double DefoliatedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture N defoliate today
		public double DefoliatedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture DM harvested today
		public double HarvestedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture N harvested today
		public double HarvestedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture DM removed from the field
		public double RemovedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Pasture N removed from the field
		public double RemovedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Residue DM returned to the field
		public double ReturnedWt { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Residue N returned to the field
		public double ReturnedN { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Harvested N returned as dung (SurfaceOM)
		public double NReturnedInDung { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Harvested N returned as urine (urea)
		public double NReturnedInUrine { get; set; }
		[XmlIgnore][Units("day")]// Description: Number of days after last defoliation
		public int DaysAfterCut { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Total standing DM (Leaf + Stem/Sheath) before cut
		public double PreHarvestDM { get; set; }
		[XmlIgnore][Units("g/m2")]// Description: Total standing DM (Leaf + Stem/Sheath) after cut
		public double PostHarvestDM { get; set; }
		
		// - Internal variables
		// fraction of harvested Dm to actually remove from field
		private double fractionDM2Remove = 1.0;
		// flag whether defoliation is allowed
		private bool rotationAllowed = true;
		// number of days for each defoliation event
		private int cuttingDuration = 0;
		// counter for day within each defoliation
		private int daysCutting = 0;
		// type of interval (Fixed or target)
		private string intervalType;
		// total herbage to remove in g/m2 per day
		private double herbageToRemove;
		// type of DM amount (ResidualDM or DMToRemove)
		private string amountType;
		// auxiliary flag for defoliation
		private bool aCutHasHappened = false;

		// - Event to add residue or dung to surface OM
		public event BiomassRemovedDelegate BiomassRemoved;

		[EventSubscribe("Commencing")]
		private void OnSimulationCommencing(object sender, EventArgs e)
		{
			foreach (AgPasture.PastureSpecies species in Apsim.Children(myZone, typeof(AgPasture.PastureSpecies)))
			{
				Pasture.Add(species);
			}

			// reset variables
			DaysAfterCut = 0;
			resetVariables();
			cuttingDuration = DurationOfCut;
			
			// get the type of amount given
			if (RemoveAmountType == removeAmountTypes.ResidualDM)
				amountType = "SetResidueAmount";
			else
				amountType = "SetRemoveAmount";

			// get the type of amount given
			if (IntervalType == rotationIntervalTypes.FixedInterval)
				intervalType = "Fixed";
			else
				intervalType = "Target";

			// make sure that rotation start when startDate < simulationStartDay
			if ((Clock.Today > CutRotationStartDate) && (Clock.Today < CutRotationEndDate))
				CutRotationStartDate = Clock.Today;
		}
		
		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			if (rotationAllowed)
			{
				if (Clock.Today == CutRotationStartDate)
					DaysAfterCut = CutInterval;

				// Check whether we can defoliate
				if ((Clock.Today >= CutRotationStartDate) && (Clock.Today <= CutRotationEndDate) && (Pasture[0].IsAlive))
				{
					// Check whether we should start a defoliation
					if (DaysAfterCut >= (CutInterval - 1))
					{
						Graze(AmountGiven, amountType, DurationOfCut);
					}
				}
			}

			// Check whether we need to continue cutting
			if ((daysCutting > 0) && (daysCutting < cuttingDuration))
			{
				// reset outputs
				resetVariables();

				removeDM(herbageToRemove);
				returnExcreta();
				daysCutting += 1;
				if (daysCutting == cuttingDuration)
					PostHarvestDM = Pasture[0].StandingHerbageWt; //+ Pasture[1].StandingHerbageWt
			}

			// reset outputs
			if (daysCutting < 0)
			{
				resetVariables();
				daysCutting = 0;
			}
		}

		[EventSubscribe("DoManagementCalculations")]
		private void OnDoManagementCalculations(object sender, EventArgs e)
		{
			// Check whether a cutting has finished
			if (daysCutting == cuttingDuration)
			{
				aCutHasHappened = true;
				daysCutting = -1;
			}

			// Increase the counter for days after cutting
			if (aCutHasHappened && (daysCutting == 0))
				DaysAfterCut += 1;
		}

		public enum removeAmountTypes
		{
			/// <summary>Setting DM amount to remove</summary>
			DMToRemove,
			/// <summary>Setting residual DM amount</summary>
			ResidualDM
		}

		public enum rotationIntervalTypes
		{
			/// <summary>Setting a fixed interval</summary>
			FixedInterval,
			/// <summary>Setting a target (minimum) inteval</summary>
			TargetInterval
		}

		public enum removeDMTypes
		{
			/// <summary>Remove all DM</summary>
			RemoveAll,
			/// <summary>Remove no DM</summary>
			RemoveNone,
			/// <summary>Remove a fraction based on digestibility</summary>
			BasedOnDigestibility
		}

		// Resets the values of all outputs
		private void resetVariables()
		{
			DefoliatedWt = 0.0;
			DefoliatedN = 0.0;
			HarvestedWt = 0.0;
			HarvestedN = 0.0;
			RemovedWt = 0.0;
			RemovedN = 0.0;
			ReturnedWt = 0.0;
			ReturnedN = 0.0;
			NReturnedInDung = 0.0;
			NReturnedInUrine = 0.0;
		}

		// Description: Perform the basic calculations for defoliation
		public void Graze(double amountDM, string amountType, int duration)
		{
			// Get the existing plant amount
			PreHarvestDM = Pasture[0].StandingHerbageWt;  //+ Pasture[1].StandingHerbageWt
			
			// Check the amount to remove and print some info
			if ((amountType == "SetRemoveAmount") && (PreHarvestDM >= amountDM / duration))
			{
				summary.WriteMessage(this, "   Defoliating " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = amountDM / duration;
			}
			else if ((amountType == "SetResidueAmount") && (PreHarvestDM >= amountDM))
			{
				summary.WriteMessage(this, "   Defoliating down to approximately " + (10 * amountDM).ToString("#0.0") + "kg/ha over " + duration + " days");
				herbageToRemove = (PreHarvestDM - amountDM) / duration;
			}
			else
			{
				summary.WriteMessage(this, "   Defoliation will not happend because there is not enough plant material");
				if (intervalType == "Fixed")
					DaysAfterCut = -duration;
				return;
			}

			cuttingDuration = duration;
			// Preform first defoliation
			removeDM(herbageToRemove);
			returnExcreta();
			daysCutting = 1;
			DaysAfterCut = 0;
			if (daysCutting == cuttingDuration)
				PostHarvestDM = Pasture[0].StandingHerbageWt;  //+ Pasture[1].StandingHerbageWt
		}

		// Do the DM removal
		private void removeDM(double removeAmount)
		{
			double existingWt = Pasture[0].HarvestableWt;  // + Pasture[1].HarvestableWt

			// Check whether we harvest anything
			if (existingWt >= removeAmount)
			{
				foreach (AgPasture.PastureSpecies species in Pasture)
				{
					double amountToRemove = removeAmount * species.HarvestableWt / existingWt;
					species.Graze(amount: amountToRemove, type: "SetRemoveAmount");
				}
				
				// get total harvested
				DefoliatedWt = Pasture[0].HarvestedWt;  // + Pasture[1].HarvestedWt
				DefoliatedN = Pasture[0].HarvestedN;  //+ Pasture[1].HarvestedN
				HarvestedWt = DefoliatedWt;
				HarvestedN = DefoliatedN;

				// get amounts actually removed from field and that to be returned (dung/urine)
				if (DMRemoveType == removeDMTypes.RemoveAll)
					fractionDM2Remove = 1.0;
				else if (DMRemoveType == removeDMTypes.RemoveNone)
					fractionDM2Remove = 0.0;
				else
				{
					fractionDM2Remove = Pasture[0].HarvestedDigestibility * Pasture[0].HarvestedWt;  //+ Pasture[1].HarvestedDigestibility * Pasture[1].HarvestedWt
					fractionDM2Remove /= removeAmount;
				}
				
				RemovedWt = HarvestedWt * fractionDM2Remove;
				RemovedN = HarvestedN * FractionN2Remove;
				ReturnedWt = HarvestedWt - RemovedWt;
				ReturnedN = HarvestedN - RemovedN;
				NReturnedInDung = ReturnedN * ProportionN2Dung;
				NReturnedInUrine = ReturnedN - NReturnedInDung;
			}
		}

		// Return dung and urine
		private void returnExcreta()
		{
			if ((ReturnedWt > 0.0) || (NReturnedInDung > 0.0))
			{
				PMF.BiomassRemovedType BiomassDung = new PMF.BiomassRemovedType();
				string[] type = new string[] { "RuminantDung_PastureFed" };
				float[] dltdm = new float[] { (Single)ReturnedWt };
				float[] dltn = new float[] { (Single)NReturnedInDung };
				float[] dltp = new float[] { 0 };
				float[] fraction = new float[] { 1 };     // fraction is always 1.0 here

				BiomassDung.crop_type = "RuminantDung_PastureFed";
				BiomassDung.dm_type = type;
				BiomassDung.dlt_crop_dm = dltdm;
				BiomassDung.dlt_dm_n = dltn;
				BiomassDung.dlt_dm_p = dltp;
				BiomassDung.fraction_to_residue = fraction;
				BiomassRemoved.Invoke(BiomassDung);
			}

			if (NReturnedInUrine > 0.0)
			{
				fertiliser.Apply(NReturnedInUrine * 10, Fertiliser.Types.UreaN, 1.0);
			}
		}
	}
}
]]></Code>
            </Manager>
            <Manager>
              <Name>AutomaticFertiliser</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <AllowFertiliser>no</AllowFertiliser>
                <Depth2SoilN>500</Depth2SoilN>
                <CriticalSoilN>50</CriticalSoilN>
                <FertNAmount>25</FertNAmount>
                <FertType>UreaN</FertType>
                <FertApplicationDepth>1</FertApplicationDepth>
                <FertMinimumDays>1</FertMinimumDays>
              </Script>
              <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using APSIM.Shared.Utilities;
using System.Xml.Serialization;

namespace Models
{
	[Serializable]
	public class Script : Model
	{
		[Link] Clock Clock;
		[Link] Fertiliser fertiliser;
		[Link] ISummary summary = null;
		[Link] Soil Soil;

		//User inputs from properties tab
		[Description("Turn ferliser applications on? ")]
		public yesnoType AllowFertiliser { get; set; }
		
		[Description("Depth to calculate available soil N (mm): ")]
		public double Depth2SoilN { get; set; }

		[Description("Minimum available N, triggers an application (kgN/ha): ")]
		public double CriticalSoilN { get; set; }

		[Description("Amount of N fertiliser for each application (kgN/ha): ")]
		public double FertNAmount { get; set; }

		[Description("Type of N fertiliser to apply: ")]
		public Fertiliser.Types FertType { get; set; }

		[Description("Depth at which to apply the fertiliser (mm): ")]
		public double FertApplicationDepth { get; set; }
	   
		[Description("Minimum period between applications (days): ")]
		public double FertMinimumDays { get; set; }
	   
		public enum yesnoType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		[XmlIgnore] public double TopMineralN { get; set; }
		
		private DateTime lastApplicationDate;
		private bool fertiliserIsAllowed;
		private int nLayers;

		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{
			fertiliserIsAllowed = (AllowFertiliser == yesnoType.yes);
			nLayers = Soil.SoilWater.Thickness.Length;
		}

		[EventSubscribe("DoManagement")]
		private void OnDoManagement(object sender, EventArgs e)
		{
			double daysSinceLastApplication = (Clock.Today - lastApplicationDate).TotalDays;
			
			// get the N stored in the soil
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopMineralN = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (Depth2SoilN - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopMineralN += (Soil.SoilNitrogen.NO3[layer]
				+ Soil.SoilNitrogen.NH4[layer]
				+ Soil.SoilNitrogen.urea[layer])
				* fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= Depth2SoilN)
					layer = nLayers;
			}

			if (fertiliserIsAllowed && (daysSinceLastApplication >= FertMinimumDays) && (TopMineralN <= CriticalSoilN))
			{
				fertiliser.Apply(FertNAmount, FertType, FertApplicationDepth);
				lastApplicationDate = Clock.Today;
			}
		}
	}
}
]]></Code>
            </Manager>
            <Manager>
              <Name>AutomaticIrrigation</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Script>
                <allowIrrigation>yes</allowIrrigation>
                <allowIrrigationAll>yes</allowIrrigationAll>
                <seasonStart>15-Aug</seasonStart>
                <seasonEnd>30-May</seasonEnd>
                <seasonsAllocation>10000</seasonsAllocation>
                <triggerDeficit>99</triggerDeficit>
                <targetDeficit>100</targetDeficit>
                <returndays>1</returndays>
                <maximumAmount>5</maximumAmount>
                <depthPAWC>600</depthPAWC>
              </Script>
              <Code><![CDATA[using System;
using Models.Core;
using Models.PMF;
using Models.Soils;
using System.Xml.Serialization;
using Models.PMF;
using APSIM.Shared.Utilities;

        
namespace Models
{
	[Serializable] 
	[System.Xml.Serialization.XmlInclude(typeof(Model))]
	public class Script : Model
	{
		//Communication to other modules
		[Link] ISummary summary = null;
		[Link] Irrigation Irrigation;
		[Link] Clock Clock;
		[Link] Soil Soil;
		[Link(IsOptional = true)] ICrop existingCrop;
	   
		//User inputs from properties tab
		[Description("Turn irrigation on?")] public answerType allowIrrigation { get; set; }
		[Description("Irrigate regardless of crop state?")] public answerType allowIrrigationAll { get; set; }
		[Description("Start of irrigation season (dd-MMM)")]
		public string seasonStart { get; set; }
		[Description("End of irrigation season (dd-MMM)")]
		public string seasonEnd { get; set; }
		[Description("Season allocation (mm)")]
		public double seasonsAllocation { get; set; }
		[Description("Deficit to trigger irrigation (% PAWC)")]
		public double triggerDeficit { get; set; }
		[Description("Deficit to stop irrigaton (% PAWC)")]
		public double targetDeficit { get; set; }
		[Description("Minimum days for irrigation to return")]
		public double returndays { get; set; }
		[Description("Maximum irrigation application (mm/day)")]
		public double maximumAmount { get; set; }
		[Description("Depth to calculate PAWC (mm)")]
		public double depthPAWC { get; set; }
	   
		public enum answerType
		{
			/// <summary>a positive answer</summary>
			yes,
			/// <summary>a negative answer</summary>
			no
		}

		//Class members
		[XmlIgnore] public double TopSWdeficit { get; set; }
		[XmlIgnore] public double TopSWC { get; set; }
		[XmlIgnore] public double DaysSinceIrrigation { get; set; }
		[XmlIgnore] public double AmountToApply { get; set; }
		[XmlIgnore] public double SeasonAppliedAmount { get; set; }
		
		private bool IrrigationIsAllowed { get; set; }
		private bool IrrigationIsAlwaysAllowed { get; set; }
		
		private bool SeasonIsOpen { get; set; }
		private bool CropIsActive { get; set; }
		private bool IrrigatorIsAvailable { get; set; }
		private bool SoilIsDry { get; set; }

		private DateTime StartDate;
		private DateTime EndDate;
		private double TopDUL;
		private double TopLL;
		private int nLayers;
	
		//Calculate static soil variables
		[EventSubscribe("StartOfSimulation")]
		private void OnStartOfSimulation(object sender, EventArgs e)
		{   
			//Set the season dates
			StartDate = DateTime.Parse(seasonStart + "-" + Clock.Today.Year.ToString());
			EndDate = DateTime.Parse(seasonEnd + "-" + Clock.Today.Year.ToString());
			
			//Can we irrigate at all?
			IrrigationIsAllowed = false; 
			if (allowIrrigation == answerType.yes)
				IrrigationIsAllowed = true; 
			if (allowIrrigationAll == answerType.yes)
				IrrigationIsAlwaysAllowed = true; 





			//Calculate soil water variables
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			nLayers = Soil.SoilWater.Thickness.Length;
			for (int layer = 0; layer < nLayers; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopLL += Soil.SoilWater.LL15mm[layer] * fracLayer;
				TopDUL += Soil.SoilWater.DULmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
		}
	   	  
		//Determine daily requirement for irrigation
		[EventSubscribe("StartOfDay")]
		private void OnStartOfDay(object sender, EventArgs e)
		{
			//Can we irrigate today?		  
			SeasonIsOpen = isBetween(Clock.Today, StartDate, EndDate);

			//Is there a crop in the ground that needs irrigation?
			CropIsActive = false;
			if (IrrigationIsAlwaysAllowed)
				CropIsActive = true;  // might not be but we don't care
			else if ((existingCrop != null) && (existingCrop.IsAlive))
				CropIsActive = true;
			//if ((existingCrop.Phenology.Stage >= 3.0) && (existingCrop.Phenology.Stage < 6.0))
	      
			//Is the irrigator available?
			IrrigatorIsAvailable = false;
			DaysSinceIrrigation += 1;
			if (DaysSinceIrrigation >= returndays)
				IrrigatorIsAvailable = true;
	      
			//Is the soil dry enough to require irrigation?
			SoilIsDry = false;
			double depthFromSurface = 0.0;
			double fracLayer = 0.0;
			TopSWC = 0.0;
			for (int layer = 0; layer < nLayers; layer++)
			//for (int layer = 0; depthFromSurface < depthPAWC + Soil.SoilWater.Thickness[layer]; layer++)
			{
				fracLayer = Math.Min(1.0, (depthPAWC - depthFromSurface) / Soil.SoilWater.Thickness[layer]);
				TopSWC += Soil.SoilWater.SWmm[layer] * fracLayer;
				depthFromSurface += Soil.SoilWater.Thickness[layer];
				if (depthFromSurface >= depthPAWC)
					layer = nLayers;
			}
			
			TopSWdeficit = TopSWC - TopDUL;
			if (Math.Max(0.0, -TopSWdeficit) >= (TopDUL - TopLL) * (100 - triggerDeficit) / 100)
				SoilIsDry = true;
	            
			//Are all the conditions ratifying irrigation
			if (IrrigationIsAllowed && SeasonIsOpen && CropIsActive && IrrigatorIsAvailable && SoilIsDry)
			{
				//Lets bloody well irrigate then!!!!
				AmountToApply = TopDUL * targetDeficit / 100 - TopSWC;
				AmountToApply = Math.Max(0.0, Math.Min(AmountToApply, seasonsAllocation - SeasonAppliedAmount));
				Irrigation.Apply(AmountToApply);
				DaysSinceIrrigation = 0;
				SeasonAppliedAmount += AmountToApply;
			}
		}
		
		///Checks whether theDate is between iniDate and endDate (non-year specific)
		private bool isBetween(DateTime theDay, DateTime iniDate, DateTime endDate)
		{
			bool result = false;
			if (iniDate.DayOfYear < endDate.DayOfYear)
			{
				// period is within one year, ex: summer in the northern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) && (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			else
			{
				// period goes over the end of the year, ex: summer in the southern hemisphere
				if ((theDay.DayOfYear >= iniDate.DayOfYear) || (theDay.DayOfYear <= endDate.DayOfYear))
					result = true;
			}
			
			return result;
		}
	}
}
]]></Code>
            </Manager>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <ShowPageOfGraphs>true</ShowPageOfGraphs>
          </Folder>
          <MicroClimate>
            <Name>MicroClimate</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <a_interception>0</a_interception>
            <b_interception>1</b_interception>
            <c_interception>0</c_interception>
            <d_interception>0</d_interception>
            <soil_albedo>0.23</soil_albedo>
            <sun_angle>15</sun_angle>
            <soil_heat_flux_fraction>0.4</soil_heat_flux_fraction>
            <night_interception_fraction>0.5</night_interception_fraction>
            <refheight>2</refheight>
            <albedo>0.15</albedo>
            <emissivity>0.96</emissivity>
            <RadIntTotal>0</RadIntTotal>
          </MicroClimate>
          <Irrigation>
            <Name>Irrigation</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </Irrigation>
          <Fertiliser>
            <Name>Fertiliser</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </Fertiliser>
          <SurfaceOrganicMatter>
            <Name>SurfaceOrganicMatter</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <PondActive>no</PondActive>
            <ReportAdditions>no</ReportAdditions>
            <ReportRemovals>no</ReportRemovals>
            <ResidueTypes>
              <Name>ResidueTypes</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <LoadFromResource>ResidueTypes</LoadFromResource>
            </ResidueTypes>
            <TillageTypes>
              <Name>TillageTypesList</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <TillageType />
            </TillageTypes>
            <Pools>
              <Pool>
                <PoolName>Sward</PoolName>
                <ResidueType>grass</ResidueType>
                <Mass>0</Mass>
                <CNRatio>15</CNRatio>
                <CPRatio>NaN</CPRatio>
                <StandingFraction>0</StandingFraction>
              </Pool>
            </Pools>
            <PoolName>Sward</PoolName>
            <type>grass</type>
            <mass>0</mass>
            <standing_fraction>0</standing_fraction>
            <cpr />
            <cnr>15</cnr>
            <CriticalResidueWeight>2000</CriticalResidueWeight>
            <OptimumDecompTemp>20</OptimumDecompTemp>
            <MaxCumulativeEOS>20</MaxCumulativeEOS>
            <CNRatioDecompCoeff>0.277</CNRatioDecompCoeff>
            <CNRatioDecompThreshold>25</CNRatioDecompThreshold>
            <TotalLeachRain>25</TotalLeachRain>
            <MinRainToLeach>10</MinRainToLeach>
            <CriticalMinimumOrganicC>0.004</CriticalMinimumOrganicC>
            <DefaultCPRatio>0</DefaultCPRatio>
            <DefaultStandingFraction>0</DefaultStandingFraction>
            <StandingExtinctCoeff>0.5</StandingExtinctCoeff>
            <FractionFaecesAdded>0.5</FractionFaecesAdded>
          </SurfaceOrganicMatter>
          <Soil>
            <Name>Soil</Name>
            <Analysis>
              <Name>Analysis</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <Rocks>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </Rocks>
              <Texture />
              <MunsellColour />
              <PH>
                <double>6</double>
                <double>6</double>
                <double>6</double>
                <double>6</double>
              </PH>
              <CEC>
                <double>10</double>
                <double>10</double>
                <double>10</double>
                <double>10</double>
              </CEC>
              <ParticleSizeSand>
                <double>10</double>
                <double>10</double>
                <double>10</double>
                <double>10</double>
              </ParticleSizeSand>
              <ParticleSizeSilt>
                <double>30</double>
                <double>30</double>
                <double>30</double>
                <double>30</double>
              </ParticleSizeSilt>
              <ParticleSizeClay>
                <double>60</double>
                <double>60</double>
                <double>60</double>
                <double>60</double>
              </ParticleSizeClay>
              <PHUnits>Water</PHUnits>
              <BoronUnits>HotWater</BoronUnits>
            </Analysis>
            <Water>
              <Name>Water</Name>
              <SoilCrop>
                <Name>RyegrassSoil</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LL>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </LL>
                <KL>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                </KL>
                <XF>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                </XF>
              </SoilCrop>
              <SoilCrop>
                <Name>WhiteCloverSoil</Name>
                <IncludeInDocumentation>true</IncludeInDocumentation>
                <LL>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                  <double>0.1</double>
                </LL>
                <KL>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                  <double>0.05</double>
                </KL>
                <XF>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                  <double>1</double>
                </XF>
              </SoilCrop>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <BD>
                <double>1.3</double>
                <double>1.3</double>
                <double>1.3</double>
                <double>1.3</double>
              </BD>
              <AirDry>
                <double>0.05</double>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </AirDry>
              <LL15>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
                <double>0.1</double>
              </LL15>
              <DUL>
                <double>0.45</double>
                <double>0.45</double>
                <double>0.45</double>
                <double>0.45</double>
              </DUL>
              <SAT>
                <double>0.5</double>
                <double>0.5</double>
                <double>0.5</double>
                <double>0.5</double>
              </SAT>
              <KS>
                <double>500</double>
                <double>500</double>
                <double>500</double>
                <double>500</double>
              </KS>
            </Water>
            <SoilWater>
              <Name>SoilWater</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <SummerDate>1-Nov</SummerDate>
              <SummerU>6</SummerU>
              <SummerCona>3.5</SummerCona>
              <WinterDate>1-apr</WinterDate>
              <WinterU>6</WinterU>
              <WinterCona>3.5</WinterCona>
              <DiffusConst>88</DiffusConst>
              <DiffusSlope>35</DiffusSlope>
              <Salb>0.13</Salb>
              <CN2Bare>73</CN2Bare>
              <CNRed>20</CNRed>
              <CNCov>0.8</CNCov>
              <slope>0</slope>
              <discharge_width>0</discharge_width>
              <catchment_area>0</catchment_area>
              <max_pond>0</max_pond>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <SWCON>
                <double>0.3</double>
                <double>0.3</double>
                <double>0.3</double>
                <double>0.3</double>
              </SWCON>
              <KLAT>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </KLAT>
              <residueinterception>0</residueinterception>
            </SoilWater>
            <SoilNitrogen>
              <Name>SoilNitrogen</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <fom_type>
                <string>default</string>
                <string>manure</string>
                <string>mucuna</string>
                <string>lablab</string>
                <string>shemp</string>
                <string>stable</string>
              </fom_type>
              <fract_carb>
                <double>0.2</double>
                <double>0.3</double>
                <double>0.54</double>
                <double>0.57</double>
                <double>0.45</double>
                <double>0</double>
              </fract_carb>
              <fract_cell>
                <double>0.7</double>
                <double>0.3</double>
                <double>0.37</double>
                <double>0.37</double>
                <double>0.47</double>
                <double>0.1</double>
              </fract_cell>
              <fract_lign>
                <double>0.1</double>
                <double>0.4</double>
                <double>0.09</double>
                <double>0.06</double>
                <double>0.08</double>
                <double>0.9</double>
              </fract_lign>
              <wfpsN2N2O_x>
                <double>22</double>
                <double>88</double>
              </wfpsN2N2O_x>
              <wfpsN2N2O_y>
                <double>0.1</double>
                <double>1</double>
              </wfpsN2N2O_y>
              <oc>
                <double>3.7136764881329496</double>
                <double>2.4698281813043792</double>
                <double>1.2383961716086014</double>
                <double>0.49836009167083023</double>
              </oc>
            </SoilNitrogen>
            <SoilOrganicMatter>
              <Name>SoilOrganicMatter</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <RootCN>40</RootCN>
              <RootWt>0</RootWt>
              <SoilCN>12</SoilCN>
              <EnrACoeff>7.4</EnrACoeff>
              <EnrBCoeff>0.2</EnrBCoeff>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <Depth>
                <string>0-15</string>
                <string>15-30</string>
                <string>30-45</string>
                <string>45-60</string>
              </Depth>
              <OC>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </OC>
              <FBiom>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </FBiom>
              <FInert>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </FInert>
              <OCUnits>Total</OCUnits>
            </SoilOrganicMatter>
            <InitialWater>
              <Name>Initial water</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <PercentMethod>EvenlyDistributed</PercentMethod>
              <FractionFull>0.95</FractionFull>
              <DepthWetSoil>NaN</DepthWetSoil>
            </InitialWater>
            <Sample>
              <Name>Initial nitrogen</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
              <Thickness>
                <double>150</double>
                <double>150</double>
                <double>150</double>
                <double>150</double>
              </Thickness>
              <NO3>
                <double>5</double>
                <double>5</double>
                <double>5</double>
                <double>5</double>
              </NO3>
              <NH4>
                <double>0</double>
                <double>0</double>
                <double>0</double>
                <double>0</double>
              </NH4>
              <NO3Units>ppm</NO3Units>
              <NH4Units>ppm</NH4Units>
              <SWUnits>Volumetric</SWUnits>
              <OCUnits>Total</OCUnits>
              <PHUnits>Water</PHUnits>
            </Sample>
            <CERESSoilTemperature>
              <Name>CERESSoilTemperature</Name>
              <IncludeInDocumentation>true</IncludeInDocumentation>
            </CERESSoilTemperature>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <RecordNumber>0</RecordNumber>
            <SoilType />
            <LocalName>Stores lots of water</LocalName>
            <Site>Made up</Site>
            <NearestTown />
            <Region />
            <Country />
            <NaturalVegetation />
            <Latitude>0</Latitude>
            <Longitude>0</Longitude>
          </Soil>
          <SoluteManager>
            <Name>SoluteManager</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
          </SoluteManager>
          <PastureSpecies>
            <Name>Ryegrass</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <MaximumNUptake>10</MaximumNUptake>
            <Albedo>0.26</Albedo>
            <Gsmax>0.011</Gsmax>
            <R50>200</R50>
            <SpeciesFamily>Grass</SpeciesFamily>
            <PhotosyntheticPathway>C3</PhotosyntheticPathway>
            <InitialShootDM>2500</InitialShootDM>
            <InitialRootDM>500</InitialRootDM>
            <InitialRootDepth>600</InitialRootDepth>
            <ReferencePhotosyntheticRate>1</ReferencePhotosyntheticRate>
            <LightExtinctionCoefficient>0.5</LightExtinctionCoefficient>
            <GrowthTminimum>1</GrowthTminimum>
            <GrowthToptimum>20</GrowthToptimum>
            <GrowthTEffectExponent>1.7</GrowthTEffectExponent>
            <UseHeatStressFactor>yes</UseHeatStressFactor>
            <HeatOnsetTemperature>28</HeatOnsetTemperature>
            <HeatFullTemperature>35</HeatFullTemperature>
            <HeatRecoverySumDD>30</HeatRecoverySumDD>
            <HeatRecoveryTReference>25</HeatRecoveryTReference>
            <UseColdStressFactor>yes</UseColdStressFactor>
            <ColdOnsetTemperature>1</ColdOnsetTemperature>
            <ColdFullTemperature>-5</ColdFullTemperature>
            <ColdRecoverySumDD>25</ColdRecoverySumDD>
            <ColdRecoveryTReference>0</ColdRecoveryTReference>
            <MaintenanceRespirationCoefficient>0.03</MaintenanceRespirationCoefficient>
            <GrowthRespirationCoefficient>0.25</GrowthRespirationCoefficient>
            <RespirationTReference>20</RespirationTReference>
            <RespirationExponent>1.5</RespirationExponent>
            <NThresholdsForLeaves>
              <double>0.04</double>
              <double>0.012</double>
              <double>0.05</double>
            </NThresholdsForLeaves>
            <NThresholdsForStems>
              <double>0.02</double>
              <double>0.006</double>
              <double>0.025</double>
            </NThresholdsForStems>
            <NThresholdsForStolons>
              <double>0</double>
              <double>0</double>
              <double>0</double>
            </NThresholdsForStolons>
            <NThresholdsForRoots>
              <double>0.02</double>
              <double>0.006</double>
              <double>0.025</double>
            </NThresholdsForRoots>
            <DegreesDayForGermination>125</DegreesDayForGermination>
            <TargetShootRootRatio>4</TargetShootRootRatio>
            <MaxRootAllocation>0.25</MaxRootAllocation>
            <ShootRootGlfFactor>0.5</ShootRootGlfFactor>
            <UseReproSeasonFactor>yes</UseReproSeasonFactor>
            <ReproSeasonReferenceLatitude>41</ReproSeasonReferenceLatitude>
            <ReproSeasonTimingCoeff>0.14</ReproSeasonTimingCoeff>
            <ReproSeasonMaxAllocationIncrease>0.5</ReproSeasonMaxAllocationIncrease>
            <ReproSeasonAllocationCoeff>0.1</ReproSeasonAllocationCoeff>
            <FractionLeafMaximum>0.7</FractionLeafMaximum>
            <FractionLeafMinimum>0.7</FractionLeafMinimum>
            <FractionLeafDMThreshold>500</FractionLeafDMThreshold>
            <FractionLeafDMFactor>2000</FractionLeafDMFactor>
            <FractionLeafExponent>3</FractionLeafExponent>
            <FractionToStolon>0</FractionToStolon>
            <SpecificLeafArea>25</SpecificLeafArea>
            <SpecificRootLength>100</SpecificRootLength>
            <StolonEffectOnLAI>0</StolonEffectOnLAI>
            <ShootMaxEffectOnLAI>1000</ShootMaxEffectOnLAI>
            <MaxStemEffectOnLAI>1</MaxStemEffectOnLAI>
            <LiveLeavesPerTiller>3</LiveLeavesPerTiller>
            <TissueTurnoverRateShoot>0.05</TissueTurnoverRateShoot>
            <TissueTurnoverRateRoot>0.02</TissueTurnoverRateRoot>
            <DetachmentRateShoot>0.08</DetachmentRateShoot>
            <TurnoverTemperatureMin>2</TurnoverTemperatureMin>
            <TurnoverTemperatureRef>20</TurnoverTemperatureRef>
            <TurnoverTemperatureExponent>1</TurnoverTemperatureExponent>
            <TurnoverDroughtEffectMax>1</TurnoverDroughtEffectMax>
            <TurnoverDroughtThreshold>0.5</TurnoverDroughtThreshold>
            <TurnoverDefoliationCoefficient>0.5</TurnoverDefoliationCoefficient>
            <TurnoverDefoliationRootEffect>0.1</TurnoverDefoliationRootEffect>
            <FractionNLuxuryRemobilisable>
              <double>0.1</double>
              <double>0.1</double>
              <double>0.1</double>
            </FractionNLuxuryRemobilisable>
            <MinimumNFixation>0</MinimumNFixation>
            <MaximumNFixation>0</MaximumNFixation>
            <SoilSaturationEffectMax>0.1</SoilSaturationEffectMax>
            <MinimumWaterFreePorosity>-1</MinimumWaterFreePorosity>
            <SoilSaturationRecoveryFactor>0.25</SoilSaturationRecoveryFactor>
            <NDillutionCoefficient>0.25</NDillutionCoefficient>
            <GlfGeneric>1</GlfGeneric>
            <GlfSoilFertility>1</GlfSoilFertility>
            <PlantHeightMinimum>25</PlantHeightMinimum>
            <PlantHeightMaximum>600</PlantHeightMaximum>
            <PlantHeightMassForMax>10000</PlantHeightMassForMax>
            <PlantHeightExponent>2.8</PlantHeightExponent>
            <RootDepthMinimum>50</RootDepthMinimum>
            <RootDepthMaximum>750</RootDepthMaximum>
            <RootElongationRate>25</RootElongationRate>
            <RootDistributionDepthParam>90</RootDistributionDepthParam>
            <RootDistributionExponent>3.2</RootDistributionExponent>
            <DigestibilitiesCellWall>
              <double>0.6</double>
              <double>0.6</double>
              <double>0.6</double>
              <double>0.2</double>
            </DigestibilitiesCellWall>
            <MinimumGreenWt>100</MinimumGreenWt>
            <FractionStolonStanding>0</FractionStolonStanding>
            <PreferenceForGreenOverDead>1</PreferenceForGreenOverDead>
            <PreferenceForLeafOverStems>1</PreferenceForLeafOverStems>
            <WaterAvailableMethod>DefaultAPSIM</WaterAvailableMethod>
            <NitrogenAvailableMethod>BasicAgPasture</NitrogenAvailableMethod>
          </PastureSpecies>
          <Report>
            <Name>ThreeZoneSimulationInitialNonuniformSoilN</Name>
            <IncludeInDocumentation>true</IncludeInDocumentation>
            <ExperimentFactorNames />
            <ExperimentFactorValues />
            <VariableNames>
              <string>[Clock].Today as Date</string>
              <string>[Ryegrass].AboveGroundWt as PlantMass</string>
              <string>[Ryegrass].HarvestedWt as Harvested</string>
              <string>[Ryegrass].WaterDemand as SW_Demand</string>
              <string>sum([Ryegrass].WaterUptake) as SW_Uptake</string>
              <string>[Ryegrass].GlfWaterSupply as glfWater</string>
              <string>[Ryegrass].GlfNSupply as glfNitrogen</string>
              <string>sum([Soil].SoilWater.SWmm) as SoilWater</string>
              <string>sum([Soil].SoilNitrogen.NH4)+sum([Soil].SoilNitrogen.NO3) as SoilNitrogen</string>
              <string>[Irrigation].IrrigationApplied as Irrigation</string>
              <string>[Fertiliser].NitrogenApplied as Fertiliser</string>
            </VariableNames>
            <EventNames>
              <string>[Clock].EndOfDay</string>
            </EventNames>
          </Report>
          <IncludeInDocumentation>true</IncludeInDocumentation>
          <Area>1</Area>
          <Slope>0</Slope>
        </Zone>
        <IncludeInDocumentation>true</IncludeInDocumentation>
      </Simulation>
      <IncludeInDocumentation>true</IncludeInDocumentation>
      <ShowPageOfGraphs>true</ShowPageOfGraphs>
    </Folder>
    <IncludeInDocumentation>true</IncludeInDocumentation>
    <ShowPageOfGraphs>true</ShowPageOfGraphs>
  </Folder>
  <IncludeInDocumentation>true</IncludeInDocumentation>
  <ExplorerWidth>417</ExplorerWidth>
</Simulations>